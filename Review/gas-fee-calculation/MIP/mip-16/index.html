<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>MIP-16: Calculation of gas fees  - MIP</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../../../favicon.svg">
        <link rel="shortcut icon" href="../../../../favicon.png">
        <link rel="stylesheet" href="../../../../css/variables.css">
        <link rel="stylesheet" href="../../../../css/general.css">
        <link rel="stylesheet" href="../../../../css/chrome.css">
        <link rel="stylesheet" href="../../../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../../../highlight.css">
        <link rel="stylesheet" href="../../../../tomorrow-night.css">
        <link rel="stylesheet" href="../../../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../../../../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../../../../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">MIP</h1>

                    <div class="right-buttons">
                        <a href="../../../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/movementlabsxyz/MIP" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="mip-16-calculation-of-gas-fees"><a class="header" href="#mip-16-calculation-of-gas-fees">MIP-16: Calculation of gas fees</a></h1>
<ul>
<li><strong>Description</strong>: How to calculate gas fees for transactions on Movement L2.</li>
<li><strong>Authors</strong>: <a href="mailto:franck.cassez@movementlabs.xyz">Franck Cassez</a></li>
</ul>
<h2 id="abstract"><a class="header" href="#abstract">Abstract</a></h2>
<p>This MIP describes the structure of the gas fees and overall resource consumption needed to execute, and post a transaction to the DA/L1.</p>
<h2 id="motivation"><a class="header" href="#motivation">Motivation</a></h2>
<p>The transaction fees on L2s are multi-dimensional [<a href="#ref-9">9</a>, <a href="#ref-10">10</a>]. They comprise of <em>execution fees</em>, <em>settlement fees</em> and <em>data availability fees</em>.
This MIP describes what the different types of fees are, and how the transaction fees can be computed.</p>
<h2 id="scope-of-this-mip"><a class="header" href="#scope-of-this-mip">Scope of this MIP</a></h2>
<p>This MIP applies to costs/fees <strong>related to executing Move bytecode</strong>.</p>
<blockquote>
<p>[!WARNING]
It does not cover the extended future framework where EVM bytecode can be executed on a Movement chain.</p>
</blockquote>
<p>Althought the costs (in terms of resources consumption) are expressed in gas units when executing Move and EVM bytecode, the gas units are <strong>not comparable</strong>, e.g. the minimum gas for an EVM transaction is 21000 gas units, whereas for Move-Aptos it is 700 gas units. As a result designing a fee mechanism for Movement chains that support Move and EVM bytecodes will require some careful adjustments and analysis of the different fee structures (Move and EVM).</p>
<blockquote>
<p>[!WARNING]
This MIP does not cover <em>staking</em> (and slashing and rewards) for validators.</p>
</blockquote>
<h2 id="fee-structure"><a class="header" href="#fee-structure">Fee structure</a></h2>
<p>The processing costs on rollups [<a href="#ref-1">1</a> - <a href="#ref-6">6</a>] are  <a href="https://medium.com/offchainlabs/understanding-arbitrum-2-dimensional-fees-fd1d582596c9">multi-dimensional</a>. The cost of processing a transaction on a Movement chain consists of:</p>
<ol>
<li><strong>execution</strong> fees: the costs that correspond to resources usage, CPU and permanent storage.</li>
<li><strong>data availability</strong> fees: the costs of publishing transactions/blocks data to a <em>data availability layer</em>.</li>
<li><strong>settlement</strong> fees: the costs of <em>validating</em> a transaction (e.g. zk-proof generation and verification, validators attestations.)</li>
</ol>
<p>Overall the transaction fees are defined by the sum of three types of fees:</p>
<p><span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mord mathnormal">x</span><span class="mord mathnormal">ec</span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mord mathnormal">ees</span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mord mathnormal">ees</span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.13889em;">tlF</span><span class="mord mathnormal">ees</span></span><span class="mpunct"><span class="mord">.</span></span></span></span></span></span></p>
<p>The fees should be expressed in a single (crypto)-currency, e.g. USD, or a token <code>$APT</code>, <code>$MOVE</code>, <code>$ETH</code>.</p>
<h3 id="execution"><a class="header" href="#execution">Execution</a></h3>
<h4 id="movevm-execution-fees"><a class="header" href="#movevm-execution-fees">MoveVM execution fees</a></h4>
<p>To execute a transaction and store the result, the operator of the chain uses some hardware: CPU and disk storage. The <strong>execution</strong> fees represent the compensation of the operator for executing a transaction.</p>
<p>Movement Network uses Aptos-Move as the execution layer and the execution fees for Aptos-Move are defined in the Aptos documentation <a href="https://aptos.dev/en/network/blockchain/gas-txn-fee">Gas and storage fees</a>.
The Aptos-Move fee mechanism splits the execution fees in two parts:</p>
<ul>
<li>CPU and IO operations, expressed in gas units;</li>
<li>permanent storage, expressed in <code>$APT</code>.</li>
</ul>
<p>CPU and IO operations for a transaction <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">t</span><span class="mord mathnormal">x</span></span></span></span> result in a number of gas units <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">Cp</span><span class="mord mathnormal">u</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord mathnormal">o</span><span class="mord mathnormal">G</span><span class="mord mathnormal">a</span><span class="mord mathnormal">s</span><span class="mopen">(</span><span class="mord mathnormal">t</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span>, and the corresponding fees are computing using a <em>gas price</em> <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">G</span><span class="mord mathnormal">a</span><span class="mord mathnormal">s</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">i</span><span class="mord mathnormal">ce</span></span></span></span> expressed in the gas token (<code>$APT</code> for Aptos-Move). A transaction specifies the value <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">G</span><span class="mord mathnormal">a</span><span class="mord mathnormal">s</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">i</span><span class="mord mathnormal">ce</span><span class="mopen">(</span><span class="mord mathnormal">t</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span> it is willing to pay.<br />
The value <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">G</span><span class="mord mathnormal">a</span><span class="mord mathnormal">s</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">i</span><span class="mord mathnormal">ce</span><span class="mopen">(</span><span class="mord mathnormal">t</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span> must not be lower than a minimum <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">G</span><span class="mord mathnormal">a</span><span class="mord mathnormal">s</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">i</span><span class="mord mathnormal">ce</span></span></span></span>, which may fluctuate depending on network contention, and may be updated frequently (e.g. after each block).</p>
<p>In contrast, the permanent storage fees are designed to be stable and are updated infrequently. The reasoning is that they depend on how much storage costs (hardware, disks) and with advancement in technology this should go down in the future. The storage fees for <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">t</span><span class="mord mathnormal">x</span></span></span></span> are denoted <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">St</span><span class="mord mathnormal">ore</span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mord mathnormal">ees</span><span class="mopen">(</span><span class="mord mathnormal">t</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span> and expressed in <code>$APT</code><sup class="footnote-reference"><a href="#3">1</a></sup>.</p>
<p>The fees that correspond to the permanent storage are <strong>converted to gas units</strong> using the  <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">G</span><span class="mord mathnormal">a</span><span class="mord mathnormal">s</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">i</span><span class="mord mathnormal">ce</span></span></span></span> and the <code>$APT</code> price.</p>
<p>The <em>total charge in gas units</em> for a transaction is the defined by:</p>
<p><span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mord mathnormal">o</span><span class="mord mathnormal">t</span><span class="mord mathnormal">a</span><span class="mord mathnormal">lG</span><span class="mord mathnormal">a</span><span class="mord mathnormal">s</span><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="mord mathnormal">ni</span><span class="mord mathnormal">t</span><span class="mord mathnormal">s</span><span class="mopen">(</span><span class="mord mathnormal">t</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">Cp</span><span class="mord mathnormal">u</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord mathnormal">o</span><span class="mord mathnormal">G</span><span class="mord mathnormal">a</span><span class="mord mathnormal">s</span><span class="mopen">(</span><span class="mord mathnormal">t</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">St</span><span class="mord mathnormal">ore</span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mord mathnormal">ees</span><span class="mopen">(</span><span class="mord mathnormal">t</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mord">/</span><span class="mord mathnormal">G</span><span class="mord mathnormal">a</span><span class="mord mathnormal">s</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">i</span><span class="mord mathnormal">ce</span><span class="mopen">(</span><span class="mord mathnormal">t</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span></span></p>
<p>and the total transaction fees are approximately<sup class="footnote-reference"><a href="#1">2</a></sup>:</p>
<p><span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mord mathnormal">x</span><span class="mord mathnormal">ec</span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mord mathnormal">ees</span><span class="mopen">(</span><span class="mord mathnormal">t</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mord mathnormal">o</span><span class="mord mathnormal">t</span><span class="mord mathnormal">a</span><span class="mord mathnormal">lG</span><span class="mord mathnormal">a</span><span class="mord mathnormal">s</span><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="mord mathnormal">ni</span><span class="mord mathnormal">t</span><span class="mord mathnormal">s</span><span class="mopen">(</span><span class="mord mathnormal">t</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">G</span><span class="mord mathnormal">a</span><span class="mord mathnormal">s</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">i</span><span class="mord mathnormal">ce</span><span class="mopen">(</span><span class="mord mathnormal">t</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mpunct"><span class="mord">.</span></span></span></span></span></span></p>
<blockquote>
<p>[!WARNING]
We may not use the <code>$APT</code> token value to compute the fees on Movement. If we do so the <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mord mathnormal">x</span><span class="mord mathnormal">ec</span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mord mathnormal">ees</span></span></span></span> will be identical to processing fees on Aptos-Move, and the total fees including <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mord mathnormal">ees</span></span></span></span> and <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.13889em;">tlF</span><span class="mord mathnormal">ees</span></span></span></span> will be higher than the processing fees on Aptos-Move, which may not be desirable.</p>
</blockquote>
<blockquote>
<p>[!TIP]
<strong>Proposal 1</strong>: use the <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mord mathnormal">o</span><span class="mord mathnormal">t</span><span class="mord mathnormal">a</span><span class="mord mathnormal">lG</span><span class="mord mathnormal">a</span><span class="mord mathnormal">s</span><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="mord mathnormal">ni</span><span class="mord mathnormal">t</span><span class="mord mathnormal">s</span><span class="mopen">(</span><span class="mord mathnormal">t</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span> and a <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">G</span><span class="mord mathnormal">a</span><span class="mord mathnormal">s</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">i</span><span class="mord mathnormal">ce</span></span></span></span> in <code>$MOVE</code> to compute the execution fees on a Movement chain.
This may require an oracle to get the exchange rate for <code>$APT</code>/<code>$MOVE</code>.</p>
</blockquote>
<h4 id="gas-price-adjustments"><a class="header" href="#gas-price-adjustments">Gas price adjustments</a></h4>
<p>We may also want to adjust the <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">G</span><span class="mord mathnormal">a</span><span class="mord mathnormal">s</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">i</span><span class="mord mathnormal">ce</span></span></span></span> (in <code>$MOVE</code>) to reflect our network load. There are many ways the <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">G</span><span class="mord mathnormal">a</span><span class="mord mathnormal">s</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">i</span><span class="mord mathnormal">ce</span></span></span></span> can be updated. On Ethereum it is governed by rules in <a href="https://eips.ethereum.org/EIPS/eip-1559">EIP-1559</a>. zkSync, Arbitrum and OP Mainnet use different strategies [<a href="#ref-1">1</a>, <a href="#ref-4">4</a>, <a href="#ref-6">6</a>] to update the gas price.</p>
<blockquote>
<p>[!TIP]
<strong>Proposal 2</strong>: The OP Mainet [<a href="#ref-1">1</a>] strategy seems to be the simplest one so we may implement this strategy first.</p>
</blockquote>
<h3 id="data-availability-fees"><a class="header" href="#data-availability-fees">Data Availability fees</a></h3>
<p>On a rollup (L2), transactions are grouped in <em>batches</em>. Processing a batch result in a new <em>state</em>. Both the transactions data and the new state are published to the <em>data availability</em> (DA) layer. The reason is that they should be available for third-parties to retrieve and verify the correctness of the state transitions (and blocks).</p>
<p>We assume that the agreement with the DA provider is such that we pay a <strong>fixed</strong> amount, <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord mathnormal" style="margin-right:0.02778em;">er</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">i</span><span class="mord mathnormal">ce</span></span></span></span>, in USD, per bytes we publish to the DA layer.
This can be updated infrequently e.g. every 6 months or year.</p>
<blockquote>
<p>[!NOTE]
To reduce the costs, the data published to the DA layer can be compressed. This reduces the overall costs of publishing a batch (and a state) to the DA layer but makes it harder to identify the contribution of each transaction to the overall costs. OP Mainnet Ecotone has a <a href="https://docs.optimism.io/stack/transactions/fees#formula">formula</a> to try and weight the contribution of each transaction to the compressed data. It is unclear how well it works in practice.</p>
</blockquote>
<blockquote>
<p>[!TIP]
<strong>Proposal 3</strong>: If the cost of publishing a batch <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">b</span></span></span></span> to the DA is <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mord mathnormal">ees</span><span class="mopen">(</span><span class="mord mathnormal">b</span><span class="mclose">)</span></span></span></span>, and <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span> transactions are in the batch, the DA fees for each transaction are <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mord mathnormal">ees</span><span class="mopen">(</span><span class="mord mathnormal">b</span><span class="mclose">)</span><span class="mord">/</span><span class="mord mathnormal">n</span></span></span></span>. This is simple to implement and can be refined later if needed.</p>
</blockquote>
<h3 id="settlement-fees"><a class="header" href="#settlement-fees">Settlement Fees</a></h3>
<p>The settlement fees depend on a number of factors, and on the settlement mechanism used by a given Move Stack chain.
There is a common feature though: some data are posted to Ethereum mainnet, and the price of a transaction on Mainnet may fluctuate.</p>
<p>The difficulty is that we charge our users when we process a transaction on a Move Stack chain. At that time we don’t know the price of an Ethereum transaction to post our data because it will happen in the future when the transaction is included in a block. As a result we may have to use an oracle to provide an estimate of the (gas) price on Ethereum when our transaction is processed.</p>
<p>Another thing that is common to all the settlement mechanisms is that we have to publish a <em>commitment</em> to the states/blocks we produce.
This is usually done by publishing <em>state roots</em> (hashes of states).
There are two interfaces to publish data on Ethereum:</p>
<ul>
<li>transaction data, and</li>
<li>blobs.</li>
</ul>
<p>Blobs were introduced to lower the cost of L2s and offer temporary (18 days) data storage at low cost.
Blobs are limited in size to 128KB, and a maximum of 6 blobs per (Ethereum) block.</p>
<h4 id="fraud-proof-settlement"><a class="header" href="#fraud-proof-settlement">Fraud-proof settlement</a></h4>
<p>For a fraud-proof settlement mechanism, we have to publish the <em>state roots</em> of the blocks we produce, or the change sets (they may be smaller).<br />
The size of the state roots of change sets roots is known when we create a (l2) block, so we can determine the expected cost of publishing to Ethereum mainnet using an oracle for the Ethereum gas price.</p>
<h4 id="validity-proof-settlement"><a class="header" href="#validity-proof-settlement">Validity proof settlement</a></h4>
<p>In a validity proof settlement we have two sources of costs:</p>
<ol>
<li>the <em>proving</em> part, which is a task dedicated to provers (or a market thereof),</li>
<li>the <em>verification</em> part which is a transaction in Ethereum Mainnet.</li>
</ol>
<p>The second part is usually predicatable as the sizes of proofs are known for each zk-proof system, and the verification step is <em>efficient</em>.
The proving part is more complex to evaluate. The <a href="https://docs.zksync.io/zk-stack/concepts/fee-mechanism">zkSync –– Fee mechanism</a> [<a href="#ref-4">4</a>] may be a useful reference to design an equivalent mechanism for Movement chains.</p>
<blockquote>
<p>[!WARNING]
Note that we first need a zkMoveVM to develop this approach.</p>
</blockquote>
<h4 id="fast-finality-settlement"><a class="header" href="#fast-finality-settlement">Fast-finality settlement</a></h4>
<p>In our network, we will offer <em>fast-finality settlement</em> (FFS) where <em>validators</em> verify state transitions (and blocks) and interact with a contract, <code>StakingK</code>, that may live<sup class="footnote-reference"><a href="#2">3</a></sup> on Ethereum mainnet.</p>
<p>The costs incurred by the validators plus the cost of posting the attestations to Ethereum mainnet have to be factored in into the <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.13889em;">tlF</span><span class="mord mathnormal">ees</span></span></span></span></span>.</p>
<blockquote>
<p>[!WARNING]
We have not finalised the FFS details yet so it may be premature to try and define fees for this mechanism. It also pertains to <em>staking</em> which is not fully fledged yet.</p>
</blockquote>
<blockquote>
<p>[!TIP]
<strong>Proposal 4</strong>: The simplest approach seems to implement a fraud-proof fee mechanism and publish state roots to Ethereum mainnet.</p>
</blockquote>
<h2 id="references"><a class="header" href="#references">References</a></h2>
<p><a id="ref-1">[1]</a> <a href="https://docs.optimism.io/stack/transactions/fees">Transaction fees on OP Mainnet</a>. Optimism Documentation.</p>
<p><a id="ref-2">[2]</a>   <a href="https://docs.sui.io/concepts/tokenomics/gas-pricing">Sui –– Gas Pricing</a>. Sui Documentation.</p>
<p><a id="ref-3">[3]</a>  <a href="https://aptos.dev/en/network/blockchain/gas-txn-fee">Gas and storage fees</a>. Aptos documentation.</p>
<p><a id="ref-4">[4]</a>  <a href="https://docs.zksync.io/zk-stack/concepts/fee-mechanism">zkSync –– Fee mechanism</a>. zkSync documentation.</p>
<p><a id="ref-1">[5]</a>  <a href="https://docs-v2.mantle.xyz/devs/concepts/tx-fee/overviews">Transaction fees on Mantle</a>. Mantle documentation.</p>
<p><a id="ref-6">[6]</a>   <a href="https://docs.arbitrum.io/how-arbitrum-works/gas-fees">Gas and Fees</a>. Arbitrum documentation.</p>
<!-- \[4\] Arbitrum. [L1 Pricing.](https://developer.arbitrum.io/arbos/l1-pricing)

\[5\] D. Goldman. Medium, July 1st, 2022. [Understanding Arbitrum 2-Dimensional Fees.](https://medium.com/offchainlabs/understanding-arbitrum-2-dimensional-fees-fd1d582596c9) -->
<!-- \[6\] DZack23. July 2022. [L1 calldata data pricing / Sequencer reimbursement, "Fee Pool" Model.](https://research.arbitrum.io/t/l1-calldata-data-pricing-sequencer-reimbursement-fee-pool-model/107)
 -->
<p><a id="ref-7">[7]</a>  <a href="https://eips.ethereum.org/EIPS/eip-1559">EIP-1559.</a></p>
<p><a id="ref-8">[8]</a>  Ethereum. <a href="https://ethereum.org/en/developers/docs/gas/#eip-1559">Gas and Fees.</a></p>
<p><a id="ref-9">[9]</a>  <a href="https://ethresear.ch/t/multidimensional-eip-1559/11651">Multi-dimensional EIP-1559.</a></p>
<p><a id="ref-10">[10]</a>  <a href="https://youtu.be/QbR4MTgnCko">Notes on multi-dimensional EIP-1559.</a></p>
<!-- \[11\] Optimism. [Bedrock Fees Dashboard.](https://dune.com/oplabspbc/optimism-bedrock-migration-impact-dashboard.) -->
<!-- \[12\] Arbitrum Nitro. [Fees Dashboard.](https://dune.com/taem/arbitrum-gas-fee)

\[13\] [EigenLayer.](https://www.eigenlayer.xyz)

\[14\] Ethereum. [Scaling.](https://ethereum.org/pt/roadmap/scaling/)
 -->
<hr />
<div class="footnote-definition" id="1"><sup class="footnote-definition-label">2</sup>
<p>There is another <em>refund</em> component in the Aptos-Move fee statement that we ignore here.</p>
</div>
<div class="footnote-definition" id="2"><sup class="footnote-definition-label">3</sup>
<p>We may be able to have the quorum verification function in a Movement contract which would reduce the costs.</p>
</div>
<div class="footnote-definition" id="3"><sup class="footnote-definition-label">1</sup>
<p>It looks like the actual currency used to express this fee is a stable currency like USD. It can be converted to <code>$APT</code> using an oracle.</p>
</div>
<hr />
<h2 id="copyright"><a class="header" href="#copyright">Copyright</a></h2>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../../../Review/mikhail/suzuka-da-migrations/MIP/mip-13/index.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../../../Review/primata/mip-18/MIP/mip-18/index.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../../../Review/mikhail/suzuka-da-migrations/MIP/mip-13/index.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../../../Review/primata/mip-18/MIP/mip-18/index.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../../../elasticlunr.min.js"></script>
        <script src="../../../../mark.min.js"></script>
        <script src="../../../../searcher.js"></script>

        <script src="../../../../clipboard.min.js"></script>
        <script src="../../../../highlight.js"></script>
        <script src="../../../../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
