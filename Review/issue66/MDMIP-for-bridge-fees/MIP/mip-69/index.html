<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>MIP-69: Bridge Fees - MIP</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../../../../favicon.svg">
        <link rel="shortcut icon" href="../../../../../favicon.png">
        <link rel="stylesheet" href="../../../../../css/variables.css">
        <link rel="stylesheet" href="../../../../../css/general.css">
        <link rel="stylesheet" href="../../../../../css/chrome.css">
        <link rel="stylesheet" href="../../../../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../../../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../../../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../../../../highlight.css">
        <link rel="stylesheet" href="../../../../../tomorrow-night.css">
        <link rel="stylesheet" href="../../../../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../../../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../../../../../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../../../../../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">MIP</h1>

                    <div class="right-buttons">
                        <a href="../../../../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/movementlabsxyz/MIP" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="mip-69-bridge-fees"><a class="header" href="#mip-69-bridge-fees">MIP-69: Bridge Fees</a></h1>
<ul>
<li><strong>Description</strong>: How to charge bridges fees when bridging $L2MOVE to $L1MOVE.</li>
<li><strong>Authors</strong>: <a href="mailto:franck.cassez@movementlabs.xyz">Franck Cassez</a></li>
<li><strong>Desiderata</strong>: <a href="../../MD/md-69/README.html">MD-69</a></li>
<li><strong>Approval</strong>: Stagnant</li>
</ul>
<h2 id="abstract"><a class="header" href="#abstract">Abstract</a></h2>
<p>As pointed out in <a href="../../MD/md-69/README.html">MD-69</a>, bridging \ tokens from Movement Chain to Ethereum (L1) requires the <em>relayer</em> to pay for Ethereum (L1) part of bridge transaction, the <em>L1 fees</em>.
Ethereum’s transaction fees are substantially higher than Move Chain fees, and we may not sponsor the L1 fees but instead charge the user
for the L1 fees.
As a result the operator has to charge some transfer fees on top pf the Move Chain <em>initiate</em> transaction fees.</p>
<p>The requirements for the bridge fees from Move Chain to L1 are gathered in  <a href="../../MD/md-69/README.html">MD-69</a> and this
MIP proposes some strategies to satisfy these requirements.</p>
<p>More specifically, this MIP covers the following topics:</p>
<ul>
<li>adjusting bridge fees dynamically,</li>
<li>sources of uncertainty in fees,</li>
<li>using oracles to collect trustworthy and recent estimates of prices,</li>
<li>possible strategies to avoid/reduce deficit.</li>
</ul>
<h2 id="motivation"><a class="header" href="#motivation">Motivation</a></h2>
<h3 id="bridging-mechanism"><a class="header" href="#bridging-mechanism">Bridging mechanism</a></h3>
<p>Bridging $L2MOVE to $L1MOVE involves the 4 following steps (Figure 1):</p>
<ol>
<li>User request a transfer of <code>n</code> \, which initiates a <em>burn</em> transaction on Move Chain. D1 in <a href="../../MD/md-69/README.html">MD-69</a>.</li>
<li>the <em>burn</em> transaction executes and completes and an event <code>FundsBurnt!</code> is appended to the Move Chain logs. <code>n</code> tokens are burnt on Move Chain.</li>
<li>The relayer <em>relays</em> the <code>FundsBurnt!</code> event to the L1 by submitting a <em>unlock</em> transaction.</li>
<li>The <em>unlock</em> transaction executes and completes and an event  <code>FundsUnlocked!</code>. <code>n</code> tokens are transferred from the L1 Bridge to the user (on L1).</li>
</ol>
<hr />
<h2 id=""><a class="header" href="#"><img src="steps.png" alt="alt text" /></a></h2>
<p><strong>Figure 1.</strong> The 4 steps to bridge funds from Move Chain to Ethereum (L1)</p>
<hr />
<h3 id="fees"><a class="header" href="#fees">Fees</a></h3>
<p>The relayer pays the L1 fees (D2, <a href="../../MD/md-69/README.html">MD-69</a>) and it is hard to predict them <em>at the time</em> the user requests the funds transfer. Indeed the fees depend on the L1 <em>gas price</em> that evolves dynamically according to rules that take into account the network congestion (how full blocks are, gas-wise), which is described in <a href="https://github.com/ethereum/EIPs/blob/master/EIPS/eip-1559.md">EIP-1559</a>. On top of that, the L1 fees are paid in $ETH by the relayer and the price of $ETH is also time-dependent.</p>
<p>Figure 2 below examplifies the changes in gas price, \ price and their effect on the L1 fees paid by the relayer.</p>
<hr />
<p><img src="timediag.png" alt="alt text" /></p>
<hr />
<p><strong>Figure 2</strong>: L1 fees fluctuate per block according to <a href="https://github.com/ethereum/EIPs/blob/master/EIPS/eip-1559.md">EIP-1559</a></p>
<hr />
<blockquote>
<p>[!WARNING]
To cover the L1 fees, we need to collect some fees from the user (D3, <a href="../../MD/md-69/README.html">MD-69</a>), and adjust the fees to 1) cover the costs incurred by the relayer to submit the <em>unlock</em> transaction (D4, <a href="../../MD/md-69/README.html">MD-69</a>), and 2) minimise the difference between what we charge the user and what we actually pay (D5, <a href="../../MD/md-69/README.html">MD-69</a>).</p>
</blockquote>
<p>This MIP proposes strategies to satisfy the requirements D1-D5, <a href="../../MD/md-69/README.html">MD-69</a>.</p>
<h2 id="specification"><a class="header" href="#specification">Specification</a></h2>
<blockquote>
<p>[!NOTE]
We charge the user some bridging fees to cover the cost of the (relayer) L1 fees. This section reviews some possible solutions.</p>
</blockquote>
<p>As the fees are charged in $MOVE but the transaction on the L1 are paid in $ETH, we need to track the ratio <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">$ETH price</span></span><span class="mord">/</span><span class="mord text"><span class="mord">$MOVE price</span></span></span></span></span>.
Assuming we have two pools of tokens for the Move to L1 bridge, <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">A</span></span></span></span> ($MOVE) and <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span></span></span></span> $ETH, we pay with the tokens in <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span></span></span></span> and get revenues in <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">A</span></span></span></span>.
We should try to ensure that</p>
<p><span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">an</span><span class="mord mathnormal">ce</span><span class="mopen">(</span><span class="mord mathnormal">A</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.9444em;vertical-align:-0.1944em;"></span><span class="mord text"><span class="mord">$MOVE price</span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.4831em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">an</span><span class="mord mathnormal">ce</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.9444em;vertical-align:-0.1944em;"></span><span class="mord text"><span class="mord">$ETH price</span></span></span></span></span></span>
to balance the funds in the two pools.</p>
<p>More precisely we may try to bound the difference in value in the two pools by a given constant:</p>
<p><span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">∣</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">an</span><span class="mord mathnormal">ce</span><span class="mopen">(</span><span class="mord mathnormal">A</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.9444em;vertical-align:-0.1944em;"></span><span class="mord text"><span class="mord">$MOVE price</span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">an</span><span class="mord mathnormal">ce</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">$ETH price</span></span><span class="mord">∣</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord text"><span class="mord">MaxDeficit</span></span><span class="mpunct"><span class="mord">.</span></span></span></span></span></span></p>
<h3 id="request-to-transfer-l2move-move-chain"><a class="header" href="#request-to-transfer-l2move-move-chain">Request to transfer \$L2MOVE (Move Chain)</a></h3>
<ol>
<li>The user pays for the Move Chain request transaction fees, <code>ReqTxFees</code> in \,</li>
<li>The user MUST be able to request the transfer of <code>n</code> \ provided their account balance is larger or equal to <code>n</code> (after taking into the <code>ReqTxFees</code>).</li>
<li>The user SHOULD be charged some <em>bridging fees</em> and MUST be able to provide a maximum fee bound, <code>MaxBridgeFee</code>, they agree to be charged.</li>
<li><code>n</code> MUST be larger than <code>MaxBridgeFee</code></li>
<li>The bridging fees MUST be charged in \ and deducted from the user initial amount <code>n</code> during the transfer of assets.</li>
</ol>
<h3 id="completion-of-transfer-l1"><a class="header" href="#completion-of-transfer-l1">Completion of transfer (L1)</a></h3>
<ol start="6">
<li>The relayer MUST pay the L1 fees, <code>L1Fees</code>, in \.</li>
<li>The user MUST get at least <code>n - MaxBridgeFee</code> \.</li>
<li>The relayer (operator) gets <code>L1BridgeFees</code> \, and <code>L1BridgeFees</code> MUST be at most <code>MaxBridgeFee</code>.</li>
<li>The L1 fees <code>L1Fees</code> (in $ETH) paid by the relayer SHOULD be <em>covered</em> by the equivalent bridge fees <code>L1BridgeFees</code> in $MOVE.</li>
</ol>
<p>The previous requirements imply:</p>
<ol start="10">
<li>We MUST track or estimate the \ price and the L1 gas price.</li>
<li>We MUST track or estimate the $MOVE/$ETH ratio.</li>
</ol>
<p>The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”, “RECOMMENDED”, “NOT RECOMMENDED”, “MAY”, and “OPTIONAL” in this document are to be interpreted as described in RFC 2119 and RFC 8174.</p>
<h2 id="reference-implementation"><a class="header" href="#reference-implementation">Reference Implementation</a></h2>
<h3 id="request-to-transfer-l2move-move-chain-1"><a class="header" href="#request-to-transfer-l2move-move-chain-1">Request to transfer \$L2MOVE (Move Chain)</a></h3>
<p>The user (or a dedicated front-end) submits a transaction to request the transfer of <code>n</code> $L2MOVE with a maximum bridge fees expressed in $MOVE.
As a result we expect the <code>initialize</code> (bridge transfer) on the Move Chain to have the following signature:</p>
<pre><code class="language-Rust">/// Provides MOVE native bridge 
module native_bridge {

/// User submits a transfer request
///
/// @param user         The initiator on Move Chain of the transfer
/// @param recipient    The recipient on L1 of the transfer
/// @param amount       The amount (\\) to be transferred
/// @param max_fess     The maximum amount the `user` agrees to be charged for bridging fees.
///
/// Aborts if (not exhaustive): max_fees &gt; amount, user balance is less than `amount`.
public entry initialize(user: &amp;signer, recipient: ethereum_address, amount: u64, max_fees: u64) 
{
    assert!(max_fees &lt;= amount&gt;);
    ...
    // 3 in Figure 1, FundsBurnt
    event::emit_event(user, recipient, actual_amount, max_fees,...);
    
}
...
}
</code></pre>
<p>To compute the bridge (and charge) fees we have three options:</p>
<ul>
<li><strong>[Option 1]</strong>: compute the bridge fees at the time of the request. In that case the <code>actual_amount</code> takes into account the bridge fees.  <strong>The contract on the Move Chain must keep track of the L1 gas price and the $ETH/$MOVE prices.</strong></li>
<li><strong>[Option 2]</strong>: the bridging fees are computed at the time of the <code>unlock</code> transaction, and the fees are a parameter of the <code>unlock</code> (Figure 1). The Relayer computes the fees and relays the <code>actual_amount</code>. <strong>The relayer must track the L1 gas price and the $ETH/$MOVE prices.</strong></li>
<li><strong>[Option 3]</strong>: the bridging fees are computed and <strong>charged in the L1</strong> contract that executes the <code>unlock</code> (Figure 1). <strong>The L1 contract  must track the L1 gas price and the $ETH/$MOVE prices.</strong></li>
</ul>
<blockquote>
<p>[!IMPORTANT]
Overall, the bridging fees can be computed at different times, but we charge them in the L1 <code>unlock</code> (complete transfer) transaction.
We also need an oracle to provide a trustworthy estimate of the \ price and L1 gas price.</p>
</blockquote>
<blockquote>
<p>[!NOTE]
The resource consumption of the <code>unlock</code> transaction is <strong>fixed</strong> and depends on the <em>size</em> of the <code>calldata</code> (fixed for unlock`). The computation of the L1 transaction fees is explained in <a href="https://github.com/movementlabsxyz/MIP/tree/gas-fee-calculation/MIP/mip-16">MIP-16</a>.</p>
</blockquote>
<h3 id="comparisons"><a class="header" href="#comparisons">Comparisons</a></h3>
<h4 id="quality-of-the-estimates"><a class="header" href="#quality-of-the-estimates">Quality of the estimates</a></h4>
<p>The quality of the estimates for \ price ad L1 gas price depends on two main factors:</p>
<ul>
<li>how and where we get the estimates. We can assume that we use trusted <em>oracles</em> or an average on many oracles to solve this issue.</li>
<li>the <em>age</em> of the estimates. The older the estimates the less accurate they may be.</li>
</ul>
<p>As a result, if we use the same oracle device for the three options, the quality of the estimates solely depends on the <em>age</em> and:</p>
<p>Option 3 &gt; Option 2 &gt; Option 1.</p>
<h4 id="flexibility-in-implementation"><a class="header" href="#flexibility-in-implementation">Flexibility in implementation</a></h4>
<p>Options 1 and 3 require the contracts to query the oracle. This is doable to query <em>on-chain</em> oracles as explained in this <a href="https://ethereum.org/en/developers/docs/oracles/">Ethereum developers section</a>.
These options are <em>trusted</em> provided the oracle is trusted too.</p>
<p>Option 2 is an <em>off-chain</em> solution and may provide more flexibility but probably requires that <strong>the relayer</strong> can query the estimates and <strong>is trusted</strong>.</p>
<h3 id="completion-and-adjustment-of-bridge-fees"><a class="header" href="#completion-and-adjustment-of-bridge-fees">Completion and adjustment of bridge fees</a></h3>
<p>If we follow Options 1 (resp. 3), the bridging fees are adjusted either in the Move (resp. Solidity) contract that provides the <code>initialize</code> (resp. <code>unlock</code>) function.
For option 2, the Relayer keeps track of the estimates and implements the adjustment.</p>
<h3 id="when-do-we-make-an-adjustment"><a class="header" href="#when-do-we-make-an-adjustment">When do we make an adjustment?</a></h3>
<p>There are several options:</p>
<ul>
<li>at each request (every transaction), or every $k$ transactions,</li>
<li>at time intervals (to be defined).</li>
</ul>
<blockquote>
<p>[!IMPORTANT]
In between two adjustments, the fees remain constant. We refer to the <strong>adjustment window</strong> as the intervals in which the fees are constant.</p>
</blockquote>
<p>The choice may depend on the frequency of bridging requests: if bridging are rare, we may update at every request at most.
If they are frequent and we cannot afford to query oracles too frequently, we may decide on a time interval.</p>
<h3 id="strategies-to-adjust-the-bridge-fees"><a class="header" href="#strategies-to-adjust-the-bridge-fees">Strategies to adjust the bridge fees</a></h3>
<p>To adjust the bridge fees dynamically, we may want to ensure:</p>
<p>$$
| Balance(A) \times \text{$MOVE price} \times r - Balance(B) \times \text{$ETH price} | &lt; \text{MaxDeficit} \mathpunct.
$$</p>
<p>We need to design a <em>strategy</em> (in the sense of a two-player game) that guarantees the above safety property.</p>
<blockquote>
<p>[!WARNING]
Ideally, our solution should be better with recent estimates rather than older ones, but it may not be easy to guarantee.</p>
</blockquote>
<p>The most powerful state-based strategy can be obtained by recording the values of the L1 gas price, $ETH and $MOVE prices since the genesis.
It also depends on the funds in both pools $A$ and $B$.
However, we cannot reasonably store all these data, and we have to base our strategy on a smaller quantity of information.</p>
<p>To start with we may use:</p>
<ul>
<li>the estimated max gas price, $ETH/$MOVE prices when the next <code>unlock</code> transaction will be processed,</li>
<li>the current difference between the revenues (in $MOVE) and expenses (in $ETH), i.e. the gap surplus or deficit in our pools,</li>
<li>the time (seconds or blocks or transactions) we would like to cover a deficit.</li>
</ul>
<p>As discussed during the co-location we may start with a simple strategy limited to increasing the fees by a constant factor. The decision to increase or decrease can be taken using oracles or simply based on the funds in pools $A$ and $B$.</p>
<h3 id="simple-strategies"><a class="header" href="#simple-strategies">Simple strategies</a></h3>
<p>Denote $Balance(A, B)$ the difference of the balances, in USD, of pools $A$ and $B$.</p>
<p>$$ Balance(A, B) = Balance(A).USD - Balance(B).USD \mathpunct. $$</p>
<p>If $Balance(A, B) \geq 0$ we are running a <em>surplus</em>, otherwise a <em>deficit</em>.</p>
<h4 id="balance-based-strategy"><a class="header" href="#balance-based-strategy">Balance based strategy</a></h4>
<p>A simple strategy is to increase/decrease the bridge fees by a $K$ ($MOVE) tokens every time we update the fees.
If $Balance(A, B) == 0$, we keep the fees as they are, if $Balance(A, B) &gt; 0$, we increase and otherwise decrease.</p>
<p>Assume we want to adjust the fees according to:</p>
<ul>
<li>the most recent value of $Balance(A, B)$,</li>
<li>estimates of L1 gas price, $ETH/$MOVE prices in the next window.</li>
</ul>
<p>If we run a deficit we want to cover it by the next time window, and if we run a surplus, we may keep the fees unchanged or decrease them.</p>
<h4 id="estimate-and-balance-based-strategies"><a class="header" href="#estimate-and-balance-based-strategies">Estimate and balance based strategies</a></h4>
<h2 id="verification"><a class="header" href="#verification">Verification</a></h2>
<p>Needs discussion.</p>
<hr />
<h2 id="change-log"><a class="header" href="#change-log">Change Log</a></h2>
<hr />
<h2 id="appendix"><a class="header" href="#appendix">Appendix</a></h2>
<h3 id="a1-notes-from-mip-58"><a class="header" href="#a1-notes-from-mip-58">A1: Notes from <a href="https://github.com/movementlabsxyz/MIP/pull/58">MIP-58</a></a></h3>
<p>!!! warning These notes were present in MIP-58. However they do belong here instead. Please consider how to incorporate these.</p>
<ul>
<li>When bridging from L1 to L2, the protocol, through the Relayer, sponsors the gas cost on Movement. We do not need to make any modification on contracts or Relayer to support it.</li>
<li>When bridging from L2 to L1, we have a few viable solutions but it’s preferable to highlight two.
<ol>
<li>Relayer sets a fee on L2, a global variable that can be set at any given time. Considering that block validation time on L1 is bigger than on L2, it becomes a viable approach since L2 can rapidly adjust the fee according to the current block and always charge an above L1 gas cost fee to attempt that the bridge is net positive. \ is deducted from the amount of tokens that are currently being bridged and transferred to a funds manager. This gives the protocol a very reliable way to estimate how much MOVE will be charged and feed to the user a precise amount of tokens. However, bridge transfers cannot always immediately be initiated on the L1, e.g. if there is a surge in transactions.</li>
<li>Enable the Relayer to specify on the L1 <code>completeBridgeTransfer</code> transaction, the bridge fee per transaction. The amount is deducted from the total amount of tokens that were bridged and transferred to a funds manager. The dangerous situation is that we expect is this takes much more than 10 minutes before the transfer can occur, and this could lead to a big disparity between the expected amount of funds and the actual amount of tokens received.</li>
</ol>
</li>
</ul>
<hr />
<h2 id="copyright"><a class="header" href="#copyright">Copyright</a></h2>
<p>Copyright and related rights waived via <a href="../LICENSE.html">CC0</a>.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../../../../Review/l-monninger/the-bilbao-model/MIP/mip-55/index.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../../../../Review/mip/rate-limiter-lock-mint-bridge/MIP/mip-74/index.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../../../../Review/l-monninger/the-bilbao-model/MIP/mip-55/index.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../../../../Review/mip/rate-limiter-lock-mint-bridge/MIP/mip-74/index.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../../../../elasticlunr.min.js"></script>
        <script src="../../../../../mark.min.js"></script>
        <script src="../../../../../searcher.js"></script>

        <script src="../../../../../clipboard.min.js"></script>
        <script src="../../../../../highlight.js"></script>
        <script src="../../../../../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
