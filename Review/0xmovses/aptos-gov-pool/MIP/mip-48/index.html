<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>MIP-48: aptos_governance for Goverened Gas Pool - MIP</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../../../../favicon.svg">
        <link rel="shortcut icon" href="../../../../../favicon.png">
        <link rel="stylesheet" href="../../../../../css/variables.css">
        <link rel="stylesheet" href="../../../../../css/general.css">
        <link rel="stylesheet" href="../../../../../css/chrome.css">
        <link rel="stylesheet" href="../../../../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../../../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../../../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../../../../highlight.css">
        <link rel="stylesheet" href="../../../../../tomorrow-night.css">
        <link rel="stylesheet" href="../../../../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../../../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../../../../../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../../../../../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">MIP</h1>

                    <div class="right-buttons">
                        <a href="../../../../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/movementlabsxyz/MIP" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="mip-48-aptos_governance-for-goverened-gas-pool"><a class="header" href="#mip-48-aptos_governance-for-goverened-gas-pool">MIP-48: <code>aptos_governance</code> for Goverened Gas Pool</a></h1>
<ul>
<li><strong>Description</strong>: Use the <code>aptos_governance</code> framework for the Governed Gas Pool</li>
<li><strong>Authors</strong>: <a href="mailto:richard@movementlabs.xyz">Richard Melkonian</a></li>
</ul>
<h2 id="abstract"><a class="header" href="#abstract">Abstract</a></h2>
<p>The Goverened Gas Pool design presented in <a href="../mip-44/">MIP-44</a> is required to be subject to onchain governance by a governing body that holds the
<code>$L2-MOVE</code> token. In [MIP-44] governance mechanisms and roles are proposed, such as <code>Proposers</code> and <code>Executors</code> so that the collected gas can be used
for the good of the network.</p>
<p>The Governed Gas Pool may be used to provide liquidity for different network needs, such as L1 Reward Tokens, or to enable the “Trickle-back”, where the <code>$L2-MOVE</code> would be paid
directly to attestors as <code>$L1-MOVE</code> for rewards. For all these activities a dispersal of funds is required, this MIP proposes concrete ways to manage dispersal events
in a safe immutable and secure manner.</p>
<p>To decide on how acrued <code>$L2-MOVE</code> in the Governed Gas Pool should be used, a robust and thorough implementation of governance should be proposed.</p>
<h2 id="motivation"><a class="header" href="#motivation">Motivation</a></h2>
<p>This MIP proposes an implementation of the governance mechanism proposed in [MIP-44] by using the <code>aptos_governance.move</code> module. We think this has several benefits.</p>
<ol>
<li><code>aptos_governance.move</code> is fully audited and battle tested.</li>
<li><code>aptos_governance.move</code> is currently in use on the Aptos Blockchain.</li>
<li>Using aptos governance prepares us for extendeding it and using it for future proposals to upgrade or migrate the network, this will be a fairly common necessity post-mainnet.</li>
<li>It strenghtens the utility of <code>$L2-MOVE</code> as this becomes the governance token.</li>
</ol>
<h2 id="specification"><a class="header" href="#specification">Specification</a></h2>
<p>The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”, “RECOMMENDED”, “NOT RECOMMENDED”, “MAY”, and “OPTIONAL” in this document are to be interpreted as described in RFC 2119 and RFC 8174.</p>
<h2 id="reference-implementation"><a class="header" href="#reference-implementation">Reference Implementation</a></h2>
<p>The <code>governed_gas_pool.move</code> would interact with <code>aptos_framework.move</code>, seperating the roles of actual governance, voting and storing of gas and dispersing those funds.</p>
<pre><code class="language-rust">//pseudocode
module GovernedGasPool::goverened_gas_pool {
    use aptos_framework::aptos_coin::AptosCoin;
    use aptos_framework::coin;
    use aptos_framework::signer;
    use aptos_framework::aptos_governance;
    use aptos_framework::aptos_governance::{self, GovernanceProposal};
    use aptos_std::vector;
    use aptos_std::option::{self, Option};

    // Address of the governance framework module
    const GOVERNANCE_ADDRESS: address = @0x1;

    struct GovernedPool has key {
        funds: coin::Coin&lt;AptosCoin&gt;,                // holds the pool of funds in AptosCoin
        passed_proposals: vector::Vector&lt;Proposal&gt;,  // list of proposals that passed governance
        admin: address                               // address with permission to execute proposals
    }

    struct DispersalAction has copy, drop, store {
        recipient: address,
        amount: u64
    }

    struct Proposal has key {
        id: u64,
        dispersal_action: Option&lt;DispersalAction&gt;, // Only one type of action at a time
        executed: bool,
    }

    /// Initialize the Governed Pool
    public fun initialize_governed_pool(admin: &amp;signer, authorized_admin: address): address {
        let governed_pool = GovernedPool {
            funds: coin::zero&lt;AptosCoin&gt;(),
            passed_proposals: vector::empty&lt;Proposal&gt;(),
            admin: authorized_admin
        };
        let addr = signer::address_of(admin);
        move_to(admin, governed_pool);
        addr
    }

    /// Add a proposal that has passed governance
    /// Only callable by the governance module at address 0x1
    public fun add_passed_proposal(
        pool: &amp;mut GovernedPool,
        governance_signer: &amp;signer,
        id: u64,
        dispersal_action: DispersalAction
    ) {
        // Ensure only the governance framework can call this function
        assert!(signer::address_of(governance_signer) == GOVERNANCE_ADDRESS, 1);

        // Verify that the proposal is approved in aptos_governance
        assert!(aptos_governance::is_proposal_approved&lt;GovernanceProposal&gt;(id), 2);

        let proposal = Proposal {
            id,
            dispersal_action: option::some(dispersal_action),
            executed: false,
        };
        vector::push_back(&amp;mut pool.passed_proposals, proposal);
    }

    /// Execute a proposal that has been approved by governance
    /// Only callable by the designated admin
    public fun execute_passed_proposal(pool: &amp;mut GovernedPool, executor: &amp;signer, proposal_id: u64) {
        // Ensure only the authorized admin can call this function
        assert!(signer::address_of(executor) == pool.admin, 2);

        let proposal_index = find_proposal(&amp;pool.passed_proposals, proposal_id);
        let proposal = &amp;mut vector::borrow_mut(&amp;mut pool.passed_proposals, proposal_index);

        // Ensure the proposal hasn't already been executed
        assert!(!proposal.executed, 3);

        // Execute the dispersal action if present
        if (option::is_some(&amp;proposal.dispersal_action)) {
            let action = option::borrow(&amp;proposal.dispersal_action).unwrap();
            let amount = action.amount;
            assert!(amount &lt;= coin::value(&amp;pool.funds), 4); // Ensure pool has sufficient funds
            coin::withdraw(&amp;mut pool.funds, amount);
            coin::deposit(&amp;signer::create(action.recipient), amount);
        };

        proposal.executed = true;
    }
}</code></pre>
<p>Notice the call :
<code>assert!(aptos_governance::is_proposal_approved&lt;GovernanceProposal&gt;(id), 2);</code></p>
<h2 id="verification"><a class="header" href="#verification">Verification</a></h2>
<h2 id="errata"><a class="header" href="#errata">Errata</a></h2>
<h2 id="appendix"><a class="header" href="#appendix">Appendix</a></h2>
<hr />
<h2 id="copyright"><a class="header" href="#copyright">Copyright</a></h2>
<p>Copyright and related rights waived via <a href="../LICENSE.html">CC0</a>.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../../../../Review/mip/gas-fees-incremental-additions/MIP/mip-47/index.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../../../../Review/l-monninger/just-reward/MIP/mip-49/index.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../../../../Review/mip/gas-fees-incremental-additions/MIP/mip-47/index.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../../../../Review/l-monninger/just-reward/MIP/mip-49/index.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../../../../elasticlunr.min.js"></script>
        <script src="../../../../../mark.min.js"></script>
        <script src="../../../../../searcher.js"></script>

        <script src="../../../../../clipboard.min.js"></script>
        <script src="../../../../../highlight.js"></script>
        <script src="../../../../../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
