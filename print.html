<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>MIP</title>
        <meta name="robots" content="noindex">


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">MIP</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/movementlabsxyz/MIP" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h2 id="glossary"><a class="header" href="#glossary">Glossary</a></h2>
<p>Alphabetically ordered list of terms defined through MGs.</p>
<p>**<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">L</span><span class="mord">1</span><span class="mord mathnormal" style="margin-right:0.02778em;">MO</span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord">∗</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">ERC</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord">20</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mord mathnormal">p</span><span class="mord mathnormal">e</span><span class="mord mathnormal">t</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal" style="margin-right:0.02778em;">or</span><span class="mord mathnormal">t</span><span class="mord mathnormal">h</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal">e</span><span class="mord mathnormal">m</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mord mathnormal" style="margin-right:0.10903em;">tN</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.02691em;">tw</span><span class="mord mathnormal" style="margin-right:0.02778em;">or</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mord mathnormal">i</span><span class="mord mathnormal">t</span><span class="mord mathnormal">h</span><span class="mord mathnormal">t</span><span class="mord mathnormal">h</span><span class="mord mathnormal">eso</span><span class="mord mathnormal">u</span><span class="mord mathnormal">rceco</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">a</span><span class="mord mathnormal">c</span><span class="mord mathnormal">t</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord mathnormal">L</span><span class="mord">1.</span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord mathnormal">ee</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">so</span></span></span></span>MOVE. <a href="Approved/main/MG/mg-39/">→ MG-39</a></p>
<p>**<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">L</span><span class="mord">2</span><span class="mord mathnormal" style="margin-right:0.02778em;">MO</span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord">∗</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">a</span><span class="mord mathnormal">pp</span><span class="mord mathnormal">e</span><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal">ers</span><span class="mord mathnormal">i</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal">t</span><span class="mord mathnormal">h</span><span class="mord mathnormal">e</span></span></span></span>L1MOVE token. <a href="Approved/main/MG/mg-39/">→ MG-39</a></p>
<p>**<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">MO</span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord">∗</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">ERC</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord">20</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mord mathnormal">p</span><span class="mord mathnormal">e</span><span class="mord mathnormal">t</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal" style="margin-right:0.02778em;">or</span><span class="mord mathnormal">t</span><span class="mord mathnormal">h</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal">e</span><span class="mord mathnormal">m</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mord mathnormal" style="margin-right:0.10903em;">tN</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.02691em;">tw</span><span class="mord mathnormal" style="margin-right:0.02778em;">or</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mord mathnormal">i</span><span class="mord mathnormal">t</span><span class="mord mathnormal">h</span><span class="mord mathnormal">t</span><span class="mord mathnormal">h</span><span class="mord mathnormal">eso</span><span class="mord mathnormal">u</span><span class="mord mathnormal">rceco</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">a</span><span class="mord mathnormal">c</span><span class="mord mathnormal">t</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord mathnormal">L</span><span class="mord">1.</span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord mathnormal">ee</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">so</span></span></span></span>L1MOVE. <a href="Approved/main/MG/mg-39/">→ MG-39</a></p>
<p><strong>Native Bridge</strong> -
The bridge that allows the transfer of tokens between L1 and L2, which hold <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">L</span><span class="mord">1</span><span class="mord mathnormal" style="margin-right:0.02778em;">MO</span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mord mathnormal">an</span><span class="mord mathnormal">d</span></span></span></span>L2MOVE token, respectively. The native bridge has the capability to mint $L2MOVE tokens. <a href="Approved/main/MG/mg-39/">→ MG-39</a></p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="welcome-to-the-movement-network-mip-book"><a class="header" href="#welcome-to-the-movement-network-mip-book">Welcome to the Movement Network MIP Book</a></h1>
<h2 id="approved"><a class="header" href="#approved">Approved</a></h2>
<h3 id="mips"><a class="header" href="#mips">MIPs</a></h3>
<ul>
<li><a href="Approved/main/MIP/mip-1/">MIP-1: ENTL (Enclave Nonce Time-lock)</a></li>
<li><a href="Approved/main/MIP/mip-15/">MIP-15: MG (Movement Gloss)</a></li>
<li><a href="Approved/main/MIP/mip-39/">MIP-39: MOVE Token – HTLC-based Native Bridge Design</a></li>
<li><a href="Approved/main/MIP/mip-53/">MIP-53: Conventions for Proposing Progressive L2 Models</a></li>
</ul>
<h3 id="mds"><a class="header" href="#mds">MDs</a></h3>
<ul>
<li><a href="Approved/main/MD/md-1/">MD-1: Minimize Risk of Compromised Bridge Key without Governance</a></li>
<li><a href="Approved/main/MD/md-3/">MD-3: MCR under Network Partitions and Asynchrony</a></li>
<li><a href="Approved/main/MD/md-15/">MD-15: Movement Glossary</a></li>
</ul>
<h3 id="mgs"><a class="header" href="#mgs">MGs</a></h3>
<ul>
<li><a href="Approved/main/MG/mg-39/">MG-39:  MOVE Token – Bridge Design</a></li>
</ul>
<h2 id="review"><a class="header" href="#review">Review</a></h2>
<h3 id="mips-1"><a class="header" href="#mips-1">MIPs</a></h3>
<ul>
<li><a href="Review/mikhail/suzuka-da-migrations/MIP/mip-13/">MIP-13:  Suzuka DA Migrations Format</a></li>
<li><a href="Review/primata/mip-18/MIP/mip-18/">MIP-18: Stage 0 Upgradeability and Multisigs</a></li>
<li><a href="Review/gas-fee-calculation/MIP/mip-19/">MIP-19: Calculation of gas fees</a></li>
<li><a href="Review/andyjsbell/unwanted-framework/MIP/mip-24/">MIP-24: Removal of redundant functionality from framework</a></li>
<li><a href="Review/andyjsbell/proxy-root/MIP/mip-25/">MIP-25: Proxy Aptos Framework for Stage 0 governance</a></li>
<li><a href="Review/primata/mip-27/MIP/mip-27/">MIP-27: Contract Pipeline</a></li>
<li><a href="Review/l-monninger/actor-naming-conventions/MIP/mip-28/">MIP-28: Naming Conventions for Movement Protocol Design</a></li>
<li><a href="Review/mip/FFS/MIP/mip-34/">MIP-34: Fast Finality Settlement</a></li>
<li><a href="Review/mip/gas-fees-incremental-additions/MIP/mip-47/">MIP-47: Improve Gas fee collection in phases</a></li>
<li><a href="Review/0xmovses/aptos-gov-pool/MIP/mip-48/">MIP-48: <code>aptos_governance</code> for Goverened Gas Pool</a></li>
<li><a href="Review/l-monninger/just-reward/MIP/mip-49/">MIP-49: NB-FFS Governed Fees and Rewards</a></li>
<li><a href="Review/l-monninger/insured-bridge/MIP/mip-50/">MIP-50: Insured Bridge</a></li>
<li><a href="Review/l-monninger/the-biarritz-model/MIP/mip-54/">MIP-54: The Biarritz Model</a></li>
<li><a href="Review/l-monninger/the-bilbao-model/MIP/mip-55/">MIP-55: The Bilbao Model</a></li>
<li><a href="Review/mip/informer/MIP/mip-57/">MIP-57: Informer for the Operation of the HTLC-based Native Bridge</a></li>
<li><a href="Review/mip-58/MIP/mip-58/">MIP-58: Lock/Mint-type Native Bridge with trusted Relayer</a></li>
<li><a href="Review/mip-crosschain-bridges-background/MIP/mip-60/">MIP-60: Cross-chain bridge architectures</a></li>
<li><a href="Review/mip/relayer-bootstrap-and-reboot/MIP/mip-61/">MIP-61: Relayer for the lock/mint Native Bridge - Algorithm and Bootstrapping</a></li>
<li><a href="Review/issue66/MDMIP-for-bridge-fees/MIP/mip-69/">MIP-69: Bridge Fees</a></li>
<li><a href="Review/mip/informer-lockmintbridge/MIP/mip-71/">MIP-71: Informer V1 for the Operation of the Lock/Mint Native Bridge</a></li>
<li><a href="Review/mip/rate-limiter-lock-mint-bridge/MIP/mip-74/">MIP-74: Rate limiter for the Lock/Mint-type Native Bridge</a></li>
</ul>
<h3 id="mds-1"><a class="header" href="#mds-1">MDs</a></h3>
<ul>
<li><a href="Review/l-monninger/enclave-crash-resistant-keys/MD/md-2/">MD-2: Enclave Crash-resistant Key Management</a></li>
<li><a href="Review/l-monninger/long-range-attacks/MD/md-5/">MD-4: Long Range Attacks</a></li>
<li><a href="Review/l-monninger/gas-offset/MD/md-4/">MD-4: MCR Offsetting Gas Costs</a></li>
<li><a href="Review/l-monninger/block-validation/MD/md-6/">MD-6: Suzuka Block Validation</a></li>
<li><a href="Review/l-monninger/block-validation/MD/md-7/">MD-7: Prevent Suzuka MEV Exploits and Censorship</a></li>
<li><a href="Review/mikhail/suzuka-da-migrations/MD/md-13/">MD-13: Suzuka DA Migrations Format</a></li>
<li><a href="Review/primata/md-17/MD/md-17/">MD-17: Bridge Fees</a></li>
<li><a href="Review/primata/bridge-attestors/MD/md-21/">MD-21: Native Bridge with Attesters</a></li>
<li><a href="Review/andygolay/md-26/MD/md-26/">MD-26: User-facing checks</a></li>
<li><a href="Review/primata/md-30/MD/md-30/">MD-30: Movement Name Service</a></li>
<li><a href="Review/mip/FFS/MD/md-34/">MD-34: Fast Finality Settlement</a></li>
<li><a href="Review/l-monninger/provisions-for-fixed-token-supply/MD/md-38/">MD-38: Provide for Fixed Token Supply when Using Native Bridge and Fast Finality Settlement (FFS)</a></li>
<li><a href="Review/l-monninger/just-reward/MD/md-49/">MD-49: Movement L2 Gas Fees</a></li>
<li><a href="Review/mip/relayer-bootstrap-and-reboot/MD/md-61/">MD-61: Relayer for the Lock/Mint Native Bridge</a></li>
<li><a href="Review/issue66/MDMIP-for-bridge-fees/MD/md-69/">MD-69: Bridge fees</a></li>
<li><a href="Review/mip/informer-lockmintbridge/MD/md-71/">MD-71: Informer service for the Lock/Mint-based Native Bridge</a></li>
<li><a href="Review/mip/rate-limiter-lock-mint-bridge/MD/md-74/">MD-74: Rate-Limiter for the Lock/Mint-type Native Bridge</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="welcome-to-the-movement-network-mip-book-1"><a class="header" href="#welcome-to-the-movement-network-mip-book-1">Welcome to the Movement Network MIP Book</a></h1>
<h2 id="approved-1"><a class="header" href="#approved-1">Approved</a></h2>
<h3 id="mips-2"><a class="header" href="#mips-2">MIPs</a></h3>
<ul>
<li><a href="Approved/main/MIP/mip-1/">MIP-1: ENTL (Enclave Nonce Time-lock)</a></li>
<li><a href="Approved/main/MIP/mip-15/">MIP-15: MG (Movement Gloss)</a></li>
<li><a href="Approved/main/MIP/mip-39/">MIP-39: MOVE Token – HTLC-based Native Bridge Design</a></li>
<li><a href="Approved/main/MIP/mip-53/">MIP-53: Conventions for Proposing Progressive L2 Models</a></li>
</ul>
<h3 id="mds-2"><a class="header" href="#mds-2">MDs</a></h3>
<ul>
<li><a href="Approved/main/MD/md-1/">MD-1: Minimize Risk of Compromised Bridge Key without Governance</a></li>
<li><a href="Approved/main/MD/md-3/">MD-3: MCR under Network Partitions and Asynchrony</a></li>
<li><a href="Approved/main/MD/md-15/">MD-15: Movement Glossary</a></li>
</ul>
<h3 id="mgs-1"><a class="header" href="#mgs-1">MGs</a></h3>
<ul>
<li><a href="Approved/main/MG/mg-39/">MG-39:  MOVE Token – Bridge Design</a></li>
</ul>
<h2 id="review-1"><a class="header" href="#review-1">Review</a></h2>
<h3 id="mips-3"><a class="header" href="#mips-3">MIPs</a></h3>
<ul>
<li><a href="Review/mikhail/suzuka-da-migrations/MIP/mip-13/">MIP-13:  Suzuka DA Migrations Format</a></li>
<li><a href="Review/primata/mip-18/MIP/mip-18/">MIP-18: Stage 0 Upgradeability and Multisigs</a></li>
<li><a href="Review/gas-fee-calculation/MIP/mip-19/">MIP-19: Calculation of gas fees</a></li>
<li><a href="Review/andyjsbell/unwanted-framework/MIP/mip-24/">MIP-24: Removal of redundant functionality from framework</a></li>
<li><a href="Review/andyjsbell/proxy-root/MIP/mip-25/">MIP-25: Proxy Aptos Framework for Stage 0 governance</a></li>
<li><a href="Review/primata/mip-27/MIP/mip-27/">MIP-27: Contract Pipeline</a></li>
<li><a href="Review/l-monninger/actor-naming-conventions/MIP/mip-28/">MIP-28: Naming Conventions for Movement Protocol Design</a></li>
<li><a href="Review/mip/FFS/MIP/mip-34/">MIP-34: Fast Finality Settlement</a></li>
<li><a href="Review/mip/gas-fees-incremental-additions/MIP/mip-47/">MIP-47: Improve Gas fee collection in phases</a></li>
<li><a href="Review/0xmovses/aptos-gov-pool/MIP/mip-48/">MIP-48: <code>aptos_governance</code> for Goverened Gas Pool</a></li>
<li><a href="Review/l-monninger/just-reward/MIP/mip-49/">MIP-49: NB-FFS Governed Fees and Rewards</a></li>
<li><a href="Review/l-monninger/insured-bridge/MIP/mip-50/">MIP-50: Insured Bridge</a></li>
<li><a href="Review/l-monninger/the-biarritz-model/MIP/mip-54/">MIP-54: The Biarritz Model</a></li>
<li><a href="Review/l-monninger/the-bilbao-model/MIP/mip-55/">MIP-55: The Bilbao Model</a></li>
<li><a href="Review/mip/informer/MIP/mip-57/">MIP-57: Informer for the Operation of the HTLC-based Native Bridge</a></li>
<li><a href="Review/mip-58/MIP/mip-58/">MIP-58: Lock/Mint-type Native Bridge with trusted Relayer</a></li>
<li><a href="Review/mip-crosschain-bridges-background/MIP/mip-60/">MIP-60: Cross-chain bridge architectures</a></li>
<li><a href="Review/mip/relayer-bootstrap-and-reboot/MIP/mip-61/">MIP-61: Relayer for the lock/mint Native Bridge - Algorithm and Bootstrapping</a></li>
<li><a href="Review/issue66/MDMIP-for-bridge-fees/MIP/mip-69/">MIP-69: Bridge Fees</a></li>
<li><a href="Review/mip/informer-lockmintbridge/MIP/mip-71/">MIP-71: Informer V1 for the Operation of the Lock/Mint Native Bridge</a></li>
<li><a href="Review/mip/rate-limiter-lock-mint-bridge/MIP/mip-74/">MIP-74: Rate limiter for the Lock/Mint-type Native Bridge</a></li>
</ul>
<h3 id="mds-3"><a class="header" href="#mds-3">MDs</a></h3>
<ul>
<li><a href="Review/l-monninger/enclave-crash-resistant-keys/MD/md-2/">MD-2: Enclave Crash-resistant Key Management</a></li>
<li><a href="Review/l-monninger/long-range-attacks/MD/md-5/">MD-4: Long Range Attacks</a></li>
<li><a href="Review/l-monninger/gas-offset/MD/md-4/">MD-4: MCR Offsetting Gas Costs</a></li>
<li><a href="Review/l-monninger/block-validation/MD/md-6/">MD-6: Suzuka Block Validation</a></li>
<li><a href="Review/l-monninger/block-validation/MD/md-7/">MD-7: Prevent Suzuka MEV Exploits and Censorship</a></li>
<li><a href="Review/mikhail/suzuka-da-migrations/MD/md-13/">MD-13: Suzuka DA Migrations Format</a></li>
<li><a href="Review/primata/md-17/MD/md-17/">MD-17: Bridge Fees</a></li>
<li><a href="Review/primata/bridge-attestors/MD/md-21/">MD-21: Native Bridge with Attesters</a></li>
<li><a href="Review/andygolay/md-26/MD/md-26/">MD-26: User-facing checks</a></li>
<li><a href="Review/primata/md-30/MD/md-30/">MD-30: Movement Name Service</a></li>
<li><a href="Review/mip/FFS/MD/md-34/">MD-34: Fast Finality Settlement</a></li>
<li><a href="Review/l-monninger/provisions-for-fixed-token-supply/MD/md-38/">MD-38: Provide for Fixed Token Supply when Using Native Bridge and Fast Finality Settlement (FFS)</a></li>
<li><a href="Review/l-monninger/just-reward/MD/md-49/">MD-49: Movement L2 Gas Fees</a></li>
<li><a href="Review/mip/relayer-bootstrap-and-reboot/MD/md-61/">MD-61: Relayer for the Lock/Mint Native Bridge</a></li>
<li><a href="Review/issue66/MDMIP-for-bridge-fees/MD/md-69/">MD-69: Bridge fees</a></li>
<li><a href="Review/mip/informer-lockmintbridge/MD/md-71/">MD-71: Informer service for the Lock/Mint-based Native Bridge</a></li>
<li><a href="Review/mip/rate-limiter-lock-mint-bridge/MD/md-74/">MD-74: Rate-Limiter for the Lock/Mint-type Native Bridge</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="mip-1-entl-enclave-nonce-time-lock"><a class="header" href="#mip-1-entl-enclave-nonce-time-lock">MIP-1: ENTL (Enclave Nonce Time-lock)</a></h1>
<ul>
<li><strong>Description</strong>: ENTL proposes a simple challenge-reponse protocol to link Enclave usage to a given program. It additionally proposes a means of time-locking to allow the replacement of said program while maintaining security.</li>
<li><strong>Authors</strong>: <a href="mailto:liam@movementlabs.xyz">Liam Monninger</a></li>
<li><strong>Desiderata</strong>: <a href="Approved/main/MIP/mip-1/../../MD/md-1">MD-1</a></li>
</ul>
<h2 id="abstract"><a class="header" href="#abstract">Abstract</a></h2>
<p>ENTL proposes a simple challenge-response protocol to link Enclave usage to a given program. It additionally proposes a means of time-locking to allow the replacement of said program while maintaining security. This approach is demonstrated to be both generalizable and cryptographically sound.</p>
<h2 id="motivation"><a class="header" href="#motivation">Motivation</a></h2>
<p>This protocol was originally suggested as a solution to minimizing trust assumptions in the Atomic Bridge under <a href="Approved/main/MIP/mip-1/../MD/md-1">MD-1</a>. However, similar problems were encountered under Movement Labs Governance Stage 0 concerning general key usage.</p>
<h2 id="specification"><a class="header" href="#specification">Specification</a></h2>
<p>The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”, “RECOMMENDED”, “NOT RECOMMENDED”, “MAY”, and “OPTIONAL” in this document are to be interpreted as described in RFC 2119 and RFC 8174.</p>
<h3 id="protocol-description"><a class="header" href="#protocol-description">Protocol Description</a></h3>
<p>The protocol is a simple challenge-response scheme performed between two parties: the Enclave, a presumed secure compute unit, and the Client, the program requesting the Enclave’s services.</p>
<p>The following messages types are exchanged between the Enclave and the Client:</p>
<ul>
<li><strong>SYN</strong>: the Client sends a 256-bit nonce to the Enclave.</li>
<li><strong>SYN-OK</strong>: the Enclave responds indicating it has received and accepted the nonce. This can be sent as a response to either SYN or SYN-CHECK.</li>
<li><strong>SYN-TL</strong>: the Enclave responds indicating it has the received the nonce and subjected it to a time-lock and queuer. The time-lock and place in the queue are provided as response.</li>
<li><strong>APP</strong>: the Client sends an application message to the Enclave, a 256-bit nonce for the current message, and a 256-bit nonce for the next message.</li>
<li><strong>APP-OK</strong>: the Enclave responds indicating it has processed the application message and has updated the nonce for the next message.</li>
<li><strong>APP-OK-CON</strong>: the Enclave responds indicating that it has processed the application message, has updated the nonce for the next message, and has aborted a contentious synchronization attempt.</li>
<li><strong>APP-REJ</strong>: the Enclave responds indicating it has received the application message but is rejecting it and will not update the nonce for the next message.</li>
</ul>
<p>These messages are exchanged as follows:</p>
<p><strong>Synchronization Phase</strong></p>
<ol>
<li>Prior to sending its first application message, the Client generates and safely stores CSPRNG nonce and sends it to the Enclave in a SYN message.</li>
<li>The Enclave processes the SYN message:
<ul>
<li>If enclave does not have a stored nonce, this indicates that no other client has attempted to synchronize with the Enclave. The Enclave MUST accept the nonce, store the nonce, and respond with a SYN-OK message.</li>
<li>If the Enclave has a record of the nonce, this indicates that another client has attempted to synchronize with the Enclave in the past. It MUST check queue and time-lock conditions:
<ul>
<li>If the nonce is at the top of the queue and has passed its time-lock, the Enclave MUST accept, store, and respond with a SYN-OK message.</li>
<li>If the nonce is not at the top of the queue or has not passed its time-lock, the Enclave MUST respond with a SYN-TL message.</li>
</ul>
</li>
</ul>
</li>
</ol>
<p><strong>Application Phase</strong></p>
<ol>
<li>The Client sends an APP message to the Enclave with the application message and the nonce for the current message and the nonce for the next message.</li>
<li>The Enclave processes the APP message:
<ul>
<li>If the nonce for the current message is the expected nonce, the Enclave MUST process the application message and update the nonce for the next message. It MUST responds with an APP-OK message.</li>
<li>If the nonce for the current message is not the expected nonce, the Enclave MUST respond with an APP-REJ message.</li>
<li>If the nonce for the current message is the expected nonce but the Enclave has nonces in its time-lock queue, i.e., from other SYN messages, the Enclave MUST:
<ol>
<li>Empty the queue of all other nonces;</li>
<li>Process the application message;</li>
<li>Respond with an APP-OK-CON message.</li>
</ol>
</li>
</ul>
</li>
<li>The Client MUST wait for an APP-OK, APP-REJ, or APP-OK-CON message before sending the next application message.
<ul>
<li>If the message is APP-OK or APP-OK-CON, the Client MUST send the next application message with the “next nonce” specified in the previous message.</li>
<li>If the message is APP-REJ, the Client MUST re-send the application message with the “current nonce” it used in the previous message.</li>
</ul>
</li>
</ol>
<h3 id="example-application-atomic-bridge-service"><a class="header" href="#example-application-atomic-bridge-service">Example Application: Atomic Bridge Service</a></h3>
<p>To demonstrate how this protocol can be used, consider the Atomic Bridge Service.</p>
<p>To minimize trust in MLABSO, an enclave is booted which generates its own signing keys and is prepared to sign transactions to send to bridge contracts. This enclave can additionally be tooled with other application messages handlers to, for example, allow for the replacement of an initial trusted and directly accessible signing key.</p>
<p>Once the enclave has been configured, the MLABSO configures the bridge service software to start signing transactions via ENTL protocol. It synchronizes for a nonce which is immediately accepted as it is the first SYN message. The bridge service then exchanges application messages with the enclave to sign transactions. The bridge service never directly accesses the signing key, only sending application messages to the enclave.</p>
<p>A MLABSO is informed that the bridge service needs to be upgraded. Because the previous bridge service securely stored its nonce (challenges related to this discussed below), the MLABSO will need to rely on the ENTL protocol to run a new synchronization phase. This enforces a time-lock of say 20 minutes before the new bridge service has been synchronized with the enclave and can continue signing transactions.</p>
<p>Now, a malicious MLABSO decides to attempt to abuse the key. She knows she cannot directly access the key. She also knows that she will not be able to use the key until the program has synchronized to a nonce she controls. She deems discovering or replacing the nonce used in the existing program intractable. So, she must stop the service and start a new synchronization phase. This will time-lock the service for 20 minutes. However, in the end, she will have the ability to sign with the key. The MLABSO begins the synchronization phase. However, during this time, a legitimate MLABSO notices that the bridge service is being upgraded (perhaps even that it is down). The legitimate MLABSO then reviews access logs to discover the malicious MLABSO’s actions. The malicious MLABSO and her program are then removed from the system before the new bridge service can be synchronized.</p>
<h3 id="practical-considerations"><a class="header" href="#practical-considerations">Practical Considerations</a></h3>
<p>In practice, there are several phenomena regarded as external to the ENTL protocol which need to be considered in order to make it safely usable.</p>
<h4 id="securing-the-nonce"><a class="header" href="#securing-the-nonce">Securing the Nonce</a></h4>
<p>In order to avoid the possibility of malicious usage, both the current nonce and the next nonce need to be stored in a manner that is difficult to access except by the current program. We do not intend to impose cryptographically secure requirements on this storage, as that begins to invoke concepts related to the literature on succinct arguments for programs. However, there are several simpler ways that can make accessing the and using the outside  nonce difficult.</p>
<p>To describe these, it first helps to consider what enables a nonce attack and to consider the time these operations take.</p>
<ol>
<li>The attacker must first obtain the nonce which takes some duration <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05764em;">E</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.0272em;vertical-align:-0.2753em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-2.4247em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05764em;">E</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2753em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7651em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05764em;">E</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>.</li>
<li>The attacker then must use the nonce to send in an APP message which the Enclave will process. This takes some duration <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05764em;">S</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.0272em;vertical-align:-0.2753em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-2.4247em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05764em;">S</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2753em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7651em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05764em;">S</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>.</li>
<li>In total, we may say the attack takes some duration <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">A</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.0272em;vertical-align:-0.2753em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-2.4247em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05764em;">S</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2753em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.0272em;vertical-align:-0.2753em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-2.4247em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05764em;">E</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2753em;"><span></span></span></span></span></span></span></span></span></span>.</li>
<li>Meanwhile, the legitimate Client will have some duration <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">L</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.0272em;vertical-align:-0.2753em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-2.4247em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">L</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2753em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7651em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">L</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> over which the nonce is stored as either the current or next nonce and has not yet been used.</li>
<li>The period between when the legitimate Client first stores this nonce and when the Enclave would process it is bounded by a time <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0272em;vertical-align:-0.2753em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-2.4247em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05764em;">S</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2753em;"><span></span></span></span></span></span></span></span></span></span> wherein the attacker sends the malicious APP message and <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7651em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">L</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>.</li>
</ol>
<p>This model of an attack leads to several prevention strategies:</p>
<ul>
<li><strong>High Temporal Resolution</strong>: frequently updating the nonce narrows the window <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">L</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> in which the attacker can obtain the nonce and use it before the legitimate Client does. If this exceeds, the time to obtain the nonce and send it, i.e., <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">A</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>, the attack is impossible. It may thus be ideal for the Client to update the nonce even without a message that corresponds to is APP logic.</li>
<li><strong>Security via Obscurity</strong>: the implication throughout this MIP is that Client stores its nonce in program memory. As program memory is highly-dynamic, particularly on the stack, it would be difficult to identify the location of the nonce in memory, increasing <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">A</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>. This is a form of security via obscurity which could be further upgraded by data structures which further randomize the location of the nonce in memory.</li>
<li><strong>ISA-specific Approaches</strong>: there a number of ISA-specific tools which can used to make accessing certain sections of memory very difficult for even though most privileged attackers. Consider reviewing <a href="https://www.intel.com/content/www/us/en/developer/articles/community/exploring-tsx-with-software-development-emulator.html#:~:text=Intel%C2%AE%20Transactional%20Synchronization%20Extensions%20(Intel%C2%AE%20TSX)%20is%20perhaps,%E2%84%A2%20microarchitecture%20code%20name%20Haswell.">Intel TSX</a> and <a href="https://www.qualcomm.com/content/dam/qcomm-martech/dm-assets/documents/pointer-auth-v7.pdf">ARM PAC</a>.</li>
<li><strong>ENTL Hot Potato and Generalizations</strong>: the ENTL protocol can be made bidirectional and two-staged such that the Enclave also synchronizes a nonce with the Client which it expects the Client to echo with the eventual APP message. This could further reduce the time the ultimate nonce is stored in the Client’s memory and increase the time the attacker must spend to obtain and use the nonce. Generalizations and variations of this protocol could use more parties and commit-reveal schemes like Pedersen commitments to further secure the nonce.</li>
</ul>
<h4 id="crash-resistance-and-recovery"><a class="header" href="#crash-resistance-and-recovery">Crash Resistance and Recovery</a></h4>
<p>Enclave products such as <a href="https://aws.amazon.com/ec2/nitro/nitro-enclaves/">AWS Nitro Enclaves</a> and <a href="https://www.intel.com/content/www/us/en/products/docs/accelerator-engines/software-guard-extensions.html">Intel SGX</a>-based products generally <a href="https://ieeexplore.ieee.org/document/9743462">do not allow backups</a>. This means that if you were to generate keys within an enclave, as suggested above, you may not be able to recover them if the enclave crashes.</p>
<p>Several suggestions are made to resolve this problem in <a href="Approved/main/MIP/mip-1/../MD/md-2">MD-2</a>.</p>
<h2 id="reference-implementation"><a class="header" href="#reference-implementation">Reference Implementation</a></h2>
<h2 id="verification"><a class="header" href="#verification">Verification</a></h2>
<p>ENTL assumes a valid Client program is one that (1) can provide the correct nonce and (2)</p>
<h2 id="changelog"><a class="header" href="#changelog">Changelog</a></h2>
<h2 id="appendix"><a class="header" href="#appendix">Appendix</a></h2>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="mip-15-mg-movement-gloss"><a class="header" href="#mip-15-mg-movement-gloss">MIP-15: MG (Movement Gloss)</a></h1>
<ul>
<li><strong>Description</strong>: Introduces the Movement Gloss (MG) document type and establishes a process for introducing new glossary terms. Introduces the <a href="Approved/main/MIP/mip-15/../GLOSSARY.html">Glossary</a>, which contains an overview of all terms defined through MGs.</li>
<li><strong>Authors</strong>: <a href="mailto:liam@movementlabs.xyz">Liam Monninger</a></li>
<li><strong>Reviewer</strong>: Andreas Penzkofer</li>
<li><strong>Desiderata</strong>: <a href="Approved/main/MIP/mip-15/../MD/md-15/README.html">MD-15</a></li>
</ul>
<h2 id="abstract-1"><a class="header" href="#abstract-1">Abstract</a></h2>
<p>This MIP introduces the Movement Gloss (MG) document type and establishes a process for introducing new glossary terms. The MG document type will be used to define terms unique to Movement Labs and to provide specific definitions for terms that are used in a unique way, underspecified in the literature, or have a specific meaning in the context of Movement Labs.</p>
<h2 id="motivation-1"><a class="header" href="#motivation-1">Motivation</a></h2>
<p>In order to communicate with more specificity in all contexts, Movement Labs should introduce a glossary. This glossary should define terms both unique to Movement Labs and general terms that are used in a unique way, underspecified in the literature, or have a specific meaning in the context of Movement Labs.</p>
<h2 id="specification-1"><a class="header" href="#specification-1">Specification</a></h2>
<p>The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”, “RECOMMENDED”, “NOT RECOMMENDED”, “MAY”, and “OPTIONAL” in this document are to be interpreted as described in RFC 2119 and RFC 8174.</p>
<h3 id="glossary-1"><a class="header" href="#glossary-1">Glossary</a></h3>
<p>The <a href="Approved/main/MIP/mip-15/../GLOSSARY.html">Glossary</a> is an alphabetically ordered list of terms defined through MGs. Any term introduced through an MG MUST be declared in the Glossary.</p>
<p>The Glossary table contains the following columns:</p>
<ul>
<li>The Term</li>
<li>A short definition</li>
<li>The number of the MG that introduces the term</li>
</ul>
<h3 id="mg-document-type"><a class="header" href="#mg-document-type">MG Document Type</a></h3>
<p>A template for the MG is provided at <a href="Approved/main/MIP/mip-15/../../md-template.html">mg-template</a>. An example MG is provided at <a href="Approved/main/MIP/mip-15/../../MG/mg-0/README.html">mg-0</a>. These templates cover the requested elements listed in <a href="Approved/main/MIP/mip-15/../MD/md-15/README.html">MD-15.D1</a>.</p>
<h3 id="mg-process"><a class="header" href="#mg-process">MG Process</a></h3>
<ol>
<li>A new glossary term MUST be defined in an MG document matching the provided templates.</li>
<li>An MG document MUST not be accepted unless justified in an MIP.</li>
</ol>
<p>For example, herein, we justify the introduction of <a href="Approved/main/MIP/mip-15/../../MG/mg-0/README.html">MG-0</a>. MG-0 defines the term “gloss” which is used in the context of Movement Labs to denote the definition of a term as would feature as an entry in a glossary. It is important to include in the glossary both clarify as the acronym “MG” and to provide an example gloss.</p>
<h2 id="reference-implementation-1"><a class="header" href="#reference-implementation-1">Reference Implementation</a></h2>
<p>See the MG document type template at <a href="Approved/main/MIP/mip-15/../../md-template.html">mg-template</a> and the example MG at <a href="Approved/main/MIP/mip-15/../../MG/mg-0/README.html">mg-0</a>.</p>
<h2 id="verification-1"><a class="header" href="#verification-1">Verification</a></h2>
<h2 id="changelog-1"><a class="header" href="#changelog-1">Changelog</a></h2>
<h2 id="appendix-1"><a class="header" href="#appendix-1">Appendix</a></h2>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="mip-39-move-token--htlc-based-native-bridge-design"><a class="header" href="#mip-39-move-token--htlc-based-native-bridge-design">MIP-39: MOVE Token – HTLC-based Native Bridge Design</a></h1>
<ul>
<li><strong>Description</strong>: Architecture of the HTLC-based Native Bridge for \ token.</li>
<li><strong>Authors</strong>: <a href="mailto:franck.cassez@movementlabs.xyz">Franck Cassez</a></li>
</ul>
<h2 id="abstract-2"><a class="header" href="#abstract-2">Abstract</a></h2>
<p>This MIP describes the high-level architecture of the <a href="https://bitcoinwiki.org/wiki/hashed-timelock-contracts">HTLC-based</a> \ token Native Bridge. The architecture describes the main bridge components and high-level requirements.</p>
<h2 id="definitions"><a class="header" href="#definitions">Definitions</a></h2>
<ul>
<li><strong>Native Bridge</strong>: The bridge that allows the transfer of tokens between L1 and L2, which hold $L1MOVE and $L2MOVE token, respectively. The native bridge has the capability to mint $L2MOVE tokens.</li>
<li><strong>$L1MOVE</strong> (or $MOVE) : ERC-20 type token with the source contract on L1</li>
<li><strong>$L2MOVE</strong> :  Token that is created on L2 after $L1MOVE token is locked on L1. We also say $L1MOVE is bridged from L1 to L2. $L2MOVE may publicly also be called $MOVE but as this causes confusion, here we stick to $L2MOVE to make clear this token lives on L2.</li>
</ul>
<h2 id="motivation-2"><a class="header" href="#motivation-2">Motivation</a></h2>
<p>The Movement chain (L2) uses the $L2MOVE token to pay for gas fees. As a result users need to hold $L2MOVE tokens to pay for their transactions.</p>
<blockquote>
<p>[!IMPORTANT]
The <em>native</em> $L1MOVE token is an ERC-20 contract on Ethereum (L1).  By native, we mean that this is the location where the token is minted and burned and where the total supply is set and possibly modified (inflation/deflation). The <strong>$L1MOVE token reserve</strong>  is in the L1 contract.</p>
</blockquote>
<p>To use the Movement chain and pay for gas fees, a user will acquire $L1MOVE (native) tokens on L1, and <em>bridge</em> them to L2. On the L2 they can use the token to pay for gas fees or with any other dApps that transact the $L2MOVE token.
Later, a user can choose to migrate their $L2MOVE tokens back to the L1 at any time (thereby converting them to $L1MOVE). These cross-chain assets’s transfers are usually done through a component called a <em>bridge</em>.</p>
<p>In this MIP an HTLC-based bridge, which is the current implementation, is discussed which provides trustlessness.</p>
<h3 id="a-standard-bridge-architecture"><a class="header" href="#a-standard-bridge-architecture">A standard bridge architecture</a></h3>
<p>The process of transferring tokens across different chains is implemented with a <em>bridge</em> (between the chains).</p>
<p>There are several choices for the architecture of a bridge, and we describe here a classical bridge with a  <em>lock-mint</em> protocol (see Chainlink’s <a href="https://chain.link/education-hub/cross-chain-bridge">What Is a Cross-Chain Bridge?</a> for a quick introduction to types of bridges).</p>
<blockquote>
<p>[!WARNING]<br />
The transfer of tokens is one-to-one: a user bridges <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span> $L1MOVE tokens to L2, and they receive <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span> $L2MOVE tokens. Same one-to-one ratio applies from L2 to L1.  The bridge does not allow for <em>swapping</em> tokens against other tokens.</p>
</blockquote>
<p><strong>Lock-and-Mint</strong>. The main idea of the <em>lock-mint</em> protocol is as follows. For the sake of simplicity, assume the two chains (L1 and L2) have only one user and the user has an account <code>l1acc</code> on L1, and another account <code>l2acc</code> on L2.  We also assume that each transfer is for one token.</p>
<p>If the user wants to bridge one \ to L2, then</p>
<ul>
<li>they <em>lock</em> (one) $L1MOVE into a (escrow) contract <code>L1InitiatorBridge</code> on the L1 side. To do so they transfer (one) $L1MOVE from <code>l1acc</code> to the <code>L1InitiatorBridge</code> contract;</li>
<li>once the contract <code>L1InitiatorBridge</code> receives the \ it emits a corresponding event <code>FundReceivedFrom(l1acc)</code> to the L1 (append-only) logs,</li>
<li>a <em>relayer</em> monitors the logs on the L1 side, and when they see the <code>FundReceived(l1acc)</code> event, they send a transaction to an L2 contract, <code>L2CounterPartyBridge</code> asking the contract to mint (one)  \,</li>
<li>the user requests the transfer of the newly minted \ to their account <code>l2acc</code> on L2.</li>
</ul>
<p><strong>Burn-and-Unlock</strong>. The transfer from L2 to L1 is similar:</p>
<ul>
<li>the user transfers (one) \ to the <code>L2InitiatorBridge</code> contract. The <code>L2InitiatorBridge</code> burns (destroys) the token and emits an event
<code>TokenBurned(l2acc)</code> to the L2 (append-only) logs,</li>
<li>a relayer monitors the L2 logs and when they see the event <code>TokenBurned(l2acc)</code>, they send a transaction to the L1 contract <code>L1CounterPartyBridge</code> to <em>unlock</em> an \ token for account <code>l1acc</code>,</li>
<li>the user (on L1)  requests transfer of one \ from the  <code>L1CounterPartyBridge</code> to their account on L1,   <code>l1acc</code>.</li>
</ul>
<p>This protocol can be implemented with three main components:</p>
<ul>
<li>two contracts on the L1 side,</li>
<li>one contract (module) on the L2 (Move) side,</li>
<li>a relayer.</li>
</ul>
<h3 id="hash-time-lock-contracts-htlc"><a class="header" href="#hash-time-lock-contracts-htlc">Hash-time-lock contracts (HTLC)</a></h3>
<p>The proposed native bridge employs Hash-time-lock-contracts (<a href="https://bitcoinwiki.org/wiki/hashed-timelock-contracts">HTLC</a>). HTLC utilizes two main concepts:</p>
<ul>
<li>Time Locks: These ensure transactions complete within a set period. Or funds revert to their owners, preventing loss from delays or non-completion.</li>
<li>Hash Locks: A secret is required to unlock funds, ensuring only participants who fulfill the swap conditions can access the assets.</li>
</ul>
<p>These two mechanisms guarantee atomicity (complete swap or no swap) and trustlessness (no reliance on the counterparty’s honesty), making the transfer secure for cryptocurrency bridging.</p>
<h3 id="attacks-on-bridges"><a class="header" href="#attacks-on-bridges">Attacks on bridges</a></h3>
<p>As can be seen the protocol above has distinct phases, and many things can go wrong. For example</p>
<ul>
<li><strong>User becomes unable to retrieve funds</strong>. The user locks their funds in the L1 contract, but the relayer never issues the minting transaction. In that case the user may never be able to retrieve their funds. What we want is some <em>atomicity</em> between the steps: if the user locks their funds, then either the corresponding minting transaction occurs, or if it does not (and we may set a time bound), the funds are returned to the user on L1.</li>
<li><strong>Crediting the wrong user</strong>. Another source of difficulty is to make sure that only the user <code>l2acc</code> can redeem the \ tokens. i.e. they are not credited to another user.</li>
</ul>
<p>Many of the possibly issues have been thoroughly studied and bridges have been in operation for several years. However hacks related to bridges account for more than 1/3 of the total hacks value which tends to indicate that bridges are vulnerable, frequently attacked, and should be designed carefully. Infamous attacks are two Ronin bridge attacks and a Nomad bridge attack</p>
<ul>
<li><a href="https://www.bankinfosecurity.com/crypto-hackers-exploit-ronin-network-for-615-million-a-18810">2022: Crypto Hackers Exploit Ronin Network for $615 Million</a></li>
<li><a href="https://www.coindesk.com/tech/2024/08/06/ronin-bridge-paused-after-9m-drained-in-apparent-whitehat-hack/">2024: Ronin Bridge Paused, Restarted After $12M Drained in Whitehat Hack</a></li>
<li><a href="https://medium.com/immunefi/hack-analysis-nomad-bridge-august-2022-5aa63d53814a">August 2022: Hack Analysis: Nomad Bridge ($192M)</a></li>
</ul>
<p>Some solutions <a href="https://arxiv.org/abs/2410.02029">XChainWatcher</a> rely on monitoring bridges and detect attacks.</p>
<p>Designing a safe bridge is a hard problem.</p>
<h2 id="specification-2"><a class="header" href="#specification-2">Specification</a></h2>
<h3 id="bridging-from-l1-to-l2"><a class="header" href="#bridging-from-l1-to-l2">Bridging from L1 to L2</a></h3>
<p>Let <code>user1</code> be a user with an account on L1, and <code>user2</code> be a user with an account on L2.</p>
<blockquote>
<p>[!NOTE]
<strong>Simple context (without loss of generality)</strong>
Assume <code>user1</code> wants to transfer <code>1</code> \ tokens, we refer to as <code>asset</code> in the sequel, to <code>user2</code> on L2.</p>
</blockquote>
<h4 id="transfer-steps"><a class="header" href="#transfer-steps">Transfer steps</a></h4>
<p>A successful transfer requires the following these steps:</p>
<ol>
<li><em>user1</em> locks their \ tokens in the <code>AtomicBridgeInitiatorMOVE.sol</code> contract on L1. The contract emits an event <code>BridgeTransferPending</code> to the L1 logs. At this point in time the transfer becomes <code>INITIALIZED</code> on L1.</li>
<li>A <em>relayer</em> monitors the L1 logs and when they see the <code>BridgeTransferPending</code> event, they send a transaction to the <code>atomic_bridge_counterparty.move</code> module on L2 asking the module to prepare the minting of \ tokens. The status of the bridge transfer on L2 becomes <code>PENDING</code>. An event <code>BridgeTransferLocked</code> is emitted to the L2 logs.</li>
</ol>
<blockquote>
<p>[!TIP]
Check point: This is the end of the first phase. Next phase must be triggered by <code>user2</code>.
At that point the bridge transfers details are known by the L1 and the L2.</p>
</blockquote>
<ol start="3">
<li><em>user2</em> (or anybody with the secret) sends a transaction to the <code>atomic_bridge_counterparty.move</code> module on L2 asking to <em>complete the bridge transfer</em>. If the transfer has been properly initialized (step 2 above), this results in minting tokens and transfers the minted tokens to the <code>user2</code> account. If successful, an event <code>BridgeTransferComplete</code> is emitted to the L2 logs. The status of the transfer on L2 becomes <code>COMPLETED</code>.</li>
</ol>
<blockquote>
<p>[!TIP]
Check point: The transfer is completed on L2.
At that stage the \ tokens are in the <code>user2</code> account on L2.</p>
</blockquote>
<ol start="4">
<li>
<p>The relayer monitors the L2 logs and when they see the <code>BridgeTransferComplete</code> event, they send a transaction to the <code>AtomicBridgeInitiatorMOVE.sol</code> contract on L1 to <em>complete the bridge transfer</em>. This closes the status of the transfer on L1 and the status of the transfer becomes <code>COMPLETED</code>. An event <code>BridgeTransferComplete</code> is emitted to the L1 logs.</p>
</li>
<li>
<p><code>user1</code> can claim a refund on L1 after a certain time, <code>timelock1</code>, has elapsed.
This introduces possible concurrent unwanted behaviors, and a timelock has to be set on L2, <code>timelock2</code>, to prevent the relayer from completing the transfer on L2 after the refund has been claimed on L1.</p>
</li>
</ol>
<p>The following diagram (Figure 1) illustrates the steps above:</p>
<hr />
<p><img src="Approved/main/MIP/mip-39/L1ToL2.png" alt="alt text" />
<strong>Figure 1</strong>: Time chart of the bridge protocol from L1 to L2.</p>
<hr />
<blockquote>
<p>[!CAUTION]
Fault-tolerance
As there can be crashes or delays or network partitions, the protocol should be <em>fault-tolerant</em> to a certain extent.
This is done by the use of <code>timelocks</code> on the L1 and L2 sides that restrict the operations above to occur within <em>bounded time windows</em>.</p>
</blockquote>
<p>In order to ensure that the funds can only be transferred from <code>user1</code> to <code>user2</code>, <code>user1</code> locks (step 1. <code>init_bridge_transfer()</code>) the funds with a <code>secret</code>.
To unlock the funds on L2, <code>user2</code> needs to prove they know the secret when they request the funds on L2 (step 3. <code>complete_bridge_transfer()</code>).</p>
<blockquote>
<p>[!IMPORTANT]<br />
<strong>Requirements for the bridge protocol</strong>
The desired properties of the bridge protocol (L1 to L2) are  <strong>atomicity</strong> and <strong>liveness</strong>:</p>
<ul>
<li>[safety-1] <code>user1</code> SHOULD be able to initiate a transfer at any time.</li>
<li>[safety-2] <code>user1</code> MUST NOT be able to <strong>get a refund</strong> if the transfer <strong>has been completed on L2</strong> and <code>user2</code> has the funds on L2.</li>
<li>[liveness-1] if the relayer is live and relays all events within a bounded time, <code>user1</code> SHOULD be able to complete the transfer on L2 and get the asset on L2.</li>
<li>[liveness-2] if the transfer has not been completed by the L2 within a time window <code>timelock1</code> since <code>user1</code> initiated the transfer, <code>user1</code> MUST be able to get a refund on L1.</li>
</ul>
</blockquote>
<p>As can be seen in the diagram above, the safety of the bridge may depend on:</p>
<ul>
<li>the relayer being live and <strong>relaying all events within a bounded time</strong>,</li>
<li>the timelocks’ values <strong>being set</strong> correctly.</li>
</ul>
<p>For instance if <code>timeLock2</code> is larger than <code>timeLock1</code>, the following scenario can happen:</p>
<ul>
<li>the <code>complete_bridge_transfer()</code> tx completes on L2 and funds are transferred to <code>users2</code>,</li>
<li>the relayer does not relay the event <code>BridgeTransferCompleted!</code> fast enough,</li>
<li><code>user1</code> on L1 asks for a refund, <code>request_refund()</code>, which is successful and gets the asset back.</li>
</ul>
<p>The correctness of the implementation depends on the timelocks’ values and is addressed in the Verification section below.</p>
<h4 id="security--permissions"><a class="header" href="#security--permissions">Security &amp; Permissions</a></h4>
<p>Contracts’s APIs:</p>
<div class="table-wrapper"><table><thead><tr><th>Layer</th><th>Function Name</th><th>Permission</th><th>#Event</th></tr></thead><tbody>
<tr><td>L1</td><td><code>init_bridge_transfer()</code></td><td>User1</td><td>BridgeTransferPending</td></tr>
<tr><td>L1</td><td><code>request_refund()</code></td><td>User1</td><td>BridgeTransferRefunded</td></tr>
<tr><td>L1</td><td><code>complete_bridge_transfer()</code></td><td>Relayer</td><td>BridgeTransferCompleted</td></tr>
<tr><td></td><td></td><td></td><td></td></tr>
<tr><td>L2</td><td><code>lock_bridge_asset_transfer()</code></td><td>Relayer</td><td>BridgeTransferLocked</td></tr>
<tr><td>L2</td><td><code>complete_bridge_transfer()</code></td><td>User2</td><td>BridgeTransferCompleted</td></tr>
<tr><td>L2</td><td><code>abort_bridge_transfer()</code></td><td>Relayer</td><td>BridgeTransferAborted</td></tr>
</tbody></table>
</div>
<p>The permissions are set to ensure that only the user who initiated the transfer can request a refund, and only the relayer can complete the transfer on L2.</p>
<p>Other safety considerations include the use of <a href="https://eips.ethereum.org/EIPS/eip-55">EIP-55</a> (L1 side) checksums for addresses. There is some code implemented in the L2 Move contract [ethereum_module](<a href="https://github.com/movementlabsxyz/aptos-core/blob/061155119258caab512aec6aa860b086e5f312e0/aptos-move/framework/aptos-framework/sources/atomic_bridge.move#L1">https://github.com/movementlabsxyz/aptos-core/blob/061155119258caab512aec6aa860b086e5f312e0/aptos-move/framework/aptos-framework/sources/atomic_bridge.move#L1</a> to check EIP-55 compliance so we may enforce EIP-55 compliance at some stage.</p>
<h3 id="bridging-from-l2-to-l1"><a class="header" href="#bridging-from-l2-to-l1">Bridging from L2 to L1</a></h3>
<h4 id="transfer-steps-1"><a class="header" href="#transfer-steps-1">Transfer steps</a></h4>
<p>A successful transfer from L2 to L1 requires the following these steps:</p>
<ol>
<li><em>user2</em> burns their \ tokens in the <code>atoic_bridge_initiator.move</code>  contract on L2. The contract emits an event <code>BridgeTransferInitiated</code> to the L2 logs. At this point in time the transfer becomes <code>INITIALIZED</code> (or pending) on L2.</li>
<li>A <em>relayer</em> monitors the L2 logs and when they see the <code>BridgeTransferInitiated</code> event, they send a transaction to the <code>AtomicBridgeCounperPartyMOVE.sol</code> contract on L1 asking the module to prepare to <em>unlock</em> \ tokens. The status of the bridge transfer on L1 becomes <code>PENDING</code>. An event <code>BridgeTransferLocked</code> is emitted to the L1 logs.</li>
</ol>
<blockquote>
<p>[!TIP]
Check point. `user2’ does not have the asset on L2 anymore.
At that point the bridge transfers details are known by the L1 and the L2.</p>
</blockquote>
<ol start="3">
<li><em>user1</em> (or anybody with the secret) sends a transaction to the <code>AtomicBridgeCounterParty.sol</code> contract on L1 asking to <em>complete the bridge transfer</em>. If the transfer has been properly initialized (step 2 above), this results in transferring \ tokens to the <code>user1</code> account. If successful, an event <code>BridgeTransferCompleted</code> is emitted to the L1 logs. The status of the transfer on L1 becomes <code>COMPLETED</code>.</li>
</ol>
<blockquote>
<p>[!TIP]
Check point. <code>User1</code> has the asset on L1.
At that stage the \ tokens are in the <code>user1</code> account on L1.</p>
</blockquote>
<ol start="4">
<li>
<p>The relayer monitors the L1 logs and when they see the <code>BridgeTransferCompleted</code> event, they send a transaction to the <code>atomic_bridge_initiator.move</code> module on L2 to <em>complete the bridge transfer</em>. This closes the status of the transfer on L2 and the status of the transfer becomes <code>COMPLETED</code>. An event <code>BridgeTransferCompleted</code> is emitted to the L2 logs.</p>
</li>
<li>
<p><code>user2</code> can claim a refund on L1 after a certain time, <code>timelock2</code>, has elapsed.
This introduces possible concurrent unwanted behaviors, and a timelock has to be set on L2, <code>timelock2</code>, to prevent the relayer from completing the transfer on L1 after the refund has been claimed on L2.</p>
</li>
</ol>
<p>The following diagram (Figure 1) illustrates the steps above:</p>
<hr />
<p><img src="Approved/main/MIP/mip-39/L2ToL1.png" alt="alt text" /></p>
<p><strong>Figure 2</strong>: Time chart of the bridge protocol from L2 to L1.</p>
<hr />
<h4 id="security--permissions-1"><a class="header" href="#security--permissions-1">Security &amp; Permissions</a></h4>
<p>Contracts’s APIs:</p>
<div class="table-wrapper"><table><thead><tr><th>Layer</th><th>Function Name</th><th>Permission</th><th>#Event</th></tr></thead><tbody>
<tr><td>L2</td><td><code>initiate_bridge_transfer()</code></td><td>User2</td><td>BridgeTransferPending</td></tr>
<tr><td>L2</td><td><code>request_refund()</code></td><td>User2</td><td>BridgeTransferRefunded</td></tr>
<tr><td>L2</td><td><code>complete_bridge_transfer()</code></td><td>Relayer</td><td>BridgeTransferCompleted</td></tr>
<tr><td></td><td></td><td></td><td></td></tr>
<tr><td>L1</td><td><code>lock_bridge_transfer()</code></td><td>Relayer</td><td>BridgeTransferLocked</td></tr>
<tr><td>L1</td><td><code>complete_bridge_transfer()</code></td><td>User1</td><td>BridgeTransferCompleted</td></tr>
<tr><td>L1</td><td><code>request_refund()</code></td><td>User2</td><td>BridgeTransferRefunded</td></tr>
</tbody></table>
</div>
<p>The permissions are set to ensure that only the user who initiated the transfer can request a refund, and only the relayer can complete the transfer on L1.</p>
<p>The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”, “RECOMMENDED”, “NOT RECOMMENDED”, “MAY”, and “OPTIONAL” in this document are to be interpreted as described in RFC 2119 and RFC 8174.</p>
<h2 id="reference-implementation-2"><a class="header" href="#reference-implementation-2">Reference Implementation</a></h2>
<h3 id="bridging-from-l1-to-l2-1"><a class="header" href="#bridging-from-l1-to-l2-1">Bridging from L1 to L2</a></h3>
<p>The contracts involved are:</p>
<ul>
<li>Solidity contract <a href="https://github.com/movementlabsxyz/movement/blob/main/protocol-units/bridge/contracts/src/AtomicBridgeInitiatorMOVE.sol">AtomicBridgeInitiatorMOVE.sol</a> on L1.</li>
<li>Move Module <a href="https://github.com/movementlabsxyz/aptos-core/blob/061155119258caab512aec6aa860b086e5f312e0/aptos-move/framework/aptos-framework/sources/atomic_bridge.move#L1163">atomic_bridge_counterparty.move</a> on L2.</li>
</ul>
<p>The current implementation is a <em>lock-mint</em> bridge. The user locks their $L1MOVE tokens in the <code>AtomicBridgeInitiatorMOVE</code> contract, and the <code>atomic_bridge_counterparty.move</code> module mints the corresponding $L2MOVE tokens.</p>
<h3 id="bridging-from-l2-to-l1-1"><a class="header" href="#bridging-from-l2-to-l1-1">Bridging from L2 to L1</a></h3>
<p>The contracts involved are:</p>
<ul>
<li>Solidity contract <a href="http:githug.com/movementlabsxyz/movement/blob/main/protocol-units/bridge/contracts/src/AtomicBridgeCounterPartyMOVE.sol">AtomicBridgeCounterPartyMOVE.sol</a> on L1,</li>
<li>module <a href="https://github.com/movementlabsxyz/aptos-core/blob/061155119258caab512aec6aa860b086e5f312e0/aptos-move/framework/aptos-framework/sources/atomic_bridge.move#L121">atomic_bridge_initiator.move</a> on L2.</li>
</ul>
<h3 id="relayer-and-services"><a class="header" href="#relayer-and-services">Relayer and Services</a></h3>
<p>The (Rust) relayer logics are in <a href="https://github.com/movementlabsxyz/movement/tree/main/protocol-units/bridge/service">service folder</a>.</p>
<p><img src="Approved/main/MIP/mip-39/L1ToL2.png" alt="alt text" /></p>
<blockquote>
<p>[!WARNING]
If the value of the parameter <code>timeLockL2</code> is larger than <code>timeLockL1</code>, the following scenario can happen:</p>
<ul>
<li>the <code>completeBridgeTransfer</code> tx completes on L2 and funds are transferred to the target address on L2,</li>
<li>the relayer does not relay the event fast enough,</li>
<li>the user on L1 asks for a refund, and the <code>refund</code> tx is executed on L1.</li>
</ul>
</blockquote>
<p>User gets funds on L2, and gets their fund back on L1.</p>
<!--
  The Reference Implementation section should include links to and an overview of a minimal implementation that assists in understanding or implementing this specification. The reference implementation is not a replacement for the Specification section, and the proposal should still be understandable without it.

  TODO: Remove this comment before submitting
-->
<h2 id="verification-2"><a class="header" href="#verification-2">Verification</a></h2>
<h3 id="bridge-l1-to-l2"><a class="header" href="#bridge-l1-to-l2">Bridge L1 to L2</a></h3>
<p>The correctness of the bridge operation from L1 to L2 depends on several factors:</p>
<ul>
<li>the timelocks’ values,</li>
<li>the control of the keys to operate the bridge,</li>
<li>the verification of the <code>secret</code>.</li>
</ul>
<p>We assume that the keys are not compromised, and that the logics in the contracts ensure that the secret <code>user1</code> uses is requested by the <code>complete_bridge_transfer</code> tx on L2. This can tested on L1 (Solidity) and formally verified on L2 (Move and Move Prover).</p>
<p>In this section we focus on the timelocks’ values, as this involves a sequence of operations on L1 and L2.
We model the bridge transactions (L1 to L2) and the transfers of assets with a <a href="https://www.cis.upenn.edu/~alur/TCS94.pdf">network of timed automata</a>.
The safety and liveness properties are defined by temporal logics formulas and can be verified with model-checking tools such as <a href="http://www.uppaal.org/">UPPAAL</a>.</p>
<p>The UPPAAL model is available in <a href="Approved/main/MIP/mip-39/./uppaal-models/bridge-up-v2.xml">this-file</a>.
To reproduce the results and check the properties on the model, you need a working version of UPPAAL.</p>
<p>The results of the model-checking verification are as follows: let $maxRelayerDelay $ be the <strong>maximum delay</strong> for the relayer to relay an event, and $timeLock1$ and $timeLock2$ be the timelocks on L1 and L2 respectively.</p>
<blockquote>
<p>[!IMPORTANT]
<strong>Verification results</strong>
We have <strong>proved</strong> (model-checked with UPPAAL) the following properties (valid using the versions of the contracts below):</p>
<ul>
<li>contract (Move): <a href="https://github.com/movementlabsxyz/aptos-core/blob/movement/aptos-move/framework/aptos-framework/sources/atomic_bridge.move">atomic_bridge.move</a>, commit <a href="https://github.com/movementlabsxyz/aptos-core/commit/c1ecd0afd250fd71fe9ffc168b2ba7bafa97ffb3">c1ecd0a</a></li>
<li>contracts (Solidity): <a href="https://github.com/movementlabsxyz/movement/blob/main/protocol-units/bridge/contracts/src/AtomicBridgeInitiatorMOVE.sol">AtomicBridgeInitiatorMOVE.sol</a> and <a href="https://github.com/movementlabsxyz/movement/blob/main/protocol-units/bridge/contracts/src/AtomicBridgeCounterpartyMOVE.sol">AtomicBridgeCounterpartyMOVE.sol</a> in this commit  <a href="https://github.com/movementlabsxyz/movement/commit/200c9f9d10fa8863b096ab3cd5442938c358a091">200c9f9</a></li>
<li>[safety-1]: there exists an execution path such that <code>user1</code> initiates and completes a transfer on L2 within a time window $timeLock1$,</li>
<li>[safety-2]: <strong>Provided</strong> the relayer relays the events within a time window $maxRelayerDelay$, <strong>AND</strong> $timelock1 &gt; timelock2 + 2 \times  maxRelayerDelay$, <code>user1</code> cannot get a refund on L1 if the transfer has been completed on L2,</li>
<li>[liveness-1] if the relayer is not down, <code>user2</code> can get the funds on L2, after $timelock1 + 2 * maxRelayerDelay$ time units.</li>
<li>[liveness-2] if the transfer is not successful on L2 within $timelock1$, <code>user1</code> can get a refund on L1 (after $timelock1$ time units).</li>
</ul>
</blockquote>
<p>Note that [safety-2] does hold if the relayer is down for more than $maxRelayerDelay$, or the timelocks are not set correctly.</p>
<h3 id="bridge-l2-to-l1"><a class="header" href="#bridge-l2-to-l1">Bridge L2 to L1</a></h3>
<p>The only difference between L1 to L2 is the way assets are created/destroyed. However, the formal model abstracts away this difference and the same properties hold for the L2 to L1 bridge.</p>
<h2 id="changelog-2"><a class="header" href="#changelog-2">Changelog</a></h2>
<hr />
<h2 id="appendix-2"><a class="header" href="#appendix-2">Appendix</a></h2>
<p>The UPPAAL models of the L1 to L2 transfers are available in the <a href="Approved/main/MIP/mip-39/./uppaal-models">uppaal-models</a> directory.
The simplest model is <a href="Approved/main/MIP/mip-39/./uppaal-models/bridge-up-v2.xml">bridge-up-v2.xml</a> and the more complex model is <a href="Approved/main/MIP/mip-39/./uppaal-models/bridge-up-v3.xml">bridge-up-v3.xml</a> with probabilities.</p>
<p>You can request a license to use UPPAAL at <a href="http://www.uppaal.org/">UPPAAL</a>.</p>
<hr />
<h2 id="copyright"><a class="header" href="#copyright">Copyright</a></h2>
<p>Copyright and related rights waived via <a href="Approved/main/MIP/mip-39/../LICENSE.html">CC0</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="mip-53-conventions-for-proposing-progressive-l2-models"><a class="header" href="#mip-53-conventions-for-proposing-progressive-l2-models">MIP-53: Conventions for Proposing Progressive L2 Models</a></h1>
<ul>
<li><strong>Description</strong>: Introduces conventions for proposing progressive L2 models.</li>
<li><strong>Authors</strong>: <a href="mailto:liam@movementlabs.xyz">Liam Monninger</a></li>
<li><strong>Reviewer</strong>: <a href="mailto:andreas.penzkofer@movementlabs.xyz">Andreas Penzkofer</a></li>
<li><strong>Desiderata</strong>: <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8056em;vertical-align:-0.0556em;"></span><span class="mord">∅</span></span></span></span></li>
</ul>
<h2 id="abstract-3"><a class="header" href="#abstract-3">Abstract</a></h2>
<p>Movement’s L2 system will progress through various changes during its life, and each stage is presented through a new L2 model (which we call <strong>progressive L2 model</strong>). Thus a given progressive L2 model describes as a particular stage in the evolution of the L2 system.  A given progressive L2 model stage is defined through the sum of its improvements and it may encompass components that are not directly related to each other.</p>
<p>We propose a set of conventions including naming, formatting, and related standards to assist reviewing proposals for said models. Finally a collection point of these terms to provide an overview</p>
<h2 id="motivation-3"><a class="header" href="#motivation-3">Motivation</a></h2>
<p>In order to facilitate the development of L2 systems, it is important to have a clear and consistent way to propose and review models for these systems. This MIP aims to provide a set of conventions for proposing progressive L2 models that will help to ensure that proposals are clear, consistent, and easy to review.</p>
<h2 id="specification-3"><a class="header" href="#specification-3">Specification</a></h2>
<p>Progressive L2 models should adhere to conventions of the following forms:</p>
<ul>
<li><strong>naming</strong>: apply a standard naming format.</li>
<li><strong>acknowledgement of standards</strong>: acknowledge the conventions of this MIP.</li>
<li><strong>summary table</strong>: a table succinctly noting key features of the model.</li>
<li><strong>statement towards progression</strong>: a statement of how the model suits a progressive approach to L2 design and release.</li>
<li><strong>pros and cons</strong>: a list of pros and cons.</li>
</ul>
<h3 id="naming"><a class="header" href="#naming">Naming</a></h3>
<p>All proposed progressive L2 models MUST adopt a name of the form “The [Location] Model” where [Location] is a location where the proposal was drafted or a similarly symbolic location. This name should be the title of the associated MIP.</p>
<p>In text, the model SHOULD be referred to as “[Location] Model,” that is, the name of the model in title case.</p>
<h3 id="acknowledgement-of-standards"><a class="header" href="#acknowledgement-of-standards">Acknowledgement of Standards</a></h3>
<p>At the start of the “Specification” section of the MIP, the author MUST include the following markdown snippet:</p>
<pre><code>We acknowledge and apply the conventions of [MIP-53: Conventions for Proposing Progressive L2 Models](../mip-53/).
</code></pre>
<h3 id="summary-table"><a class="header" href="#summary-table">Summary Table</a></h3>
<p>All proposed progressive L2 models MUST complete the following table:</p>
<div class="table-wrapper"><table><thead><tr><th>Category</th><th>Criterion</th><th>Evaluation</th></tr></thead><tbody>
<tr><td><strong>General</strong></td><td></td><td></td></tr>
<tr><td>X</td><td>When to use</td><td>A brief general description of the circumstances under which the model is appropriate.</td></tr>
<tr><td>X</td><td>Suitable preceding models</td><td>A list of models or descriptions of models that are suitable precursors to this model.</td></tr>
<tr><td>X</td><td>Suitable succeeding models</td><td>A list of models or descriptions of models that are suitable successors to this model.</td></tr>
<tr><td>X</td><td>Technological motivations</td><td>A brief description of the technological motivations for using the model.</td></tr>
<tr><td>X</td><td>Usership motivations</td><td>A brief description of the user motivations for using the model.</td></tr>
<tr><td><strong>Components</strong></td><td></td><td></td></tr>
<tr><td>X</td><td><a href="Approved/main/MIP/mip-53/link/to/component/design">Component Name 1</a></td><td>A description of usage of said component.</td></tr>
<tr><td>X</td><td><a href="Approved/main/MIP/mip-53/link/to/component/design">Component Name 2</a></td><td>A description of usage of said component.</td></tr>
</tbody></table>
</div>
<h3 id="statement-towards-progression"><a class="header" href="#statement-towards-progression">Statement Towards Progression</a></h3>
<p>All proposed progressive L2 models MUST include a statement of how the model suits a progressive approach to L2 design and release. This statement SHOULD be a paragraph in length and immediately follow the summary table–as if it were a caption for the table.</p>
<h3 id="pros-and-cons"><a class="header" href="#pros-and-cons">Pros and Cons</a></h3>
<p>All proposed progressive L2 models MUST include a list of pros and cons. This list SHOULD be formatted as two separate bulleted lists in subsections titled “Pros” and “Cons.”</p>
<h2 id="verification-3"><a class="header" href="#verification-3">Verification</a></h2>
<h2 id="changelog-3"><a class="header" href="#changelog-3">Changelog</a></h2>
<h2 id="appendix-3"><a class="header" href="#appendix-3">Appendix</a></h2>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="welcome-to-the-movement-network-mip-book-2"><a class="header" href="#welcome-to-the-movement-network-mip-book-2">Welcome to the Movement Network MIP Book</a></h1>
<h2 id="approved-2"><a class="header" href="#approved-2">Approved</a></h2>
<h3 id="mips-4"><a class="header" href="#mips-4">MIPs</a></h3>
<ul>
<li><a href="Approved/main/MIP/mip-1/">MIP-1: ENTL (Enclave Nonce Time-lock)</a></li>
<li><a href="Approved/main/MIP/mip-15/">MIP-15: MG (Movement Gloss)</a></li>
<li><a href="Approved/main/MIP/mip-39/">MIP-39: MOVE Token – HTLC-based Native Bridge Design</a></li>
<li><a href="Approved/main/MIP/mip-53/">MIP-53: Conventions for Proposing Progressive L2 Models</a></li>
</ul>
<h3 id="mds-4"><a class="header" href="#mds-4">MDs</a></h3>
<ul>
<li><a href="Approved/main/MD/md-1/">MD-1: Minimize Risk of Compromised Bridge Key without Governance</a></li>
<li><a href="Approved/main/MD/md-3/">MD-3: MCR under Network Partitions and Asynchrony</a></li>
<li><a href="Approved/main/MD/md-15/">MD-15: Movement Glossary</a></li>
</ul>
<h3 id="mgs-2"><a class="header" href="#mgs-2">MGs</a></h3>
<ul>
<li><a href="Approved/main/MG/mg-39/">MG-39:  MOVE Token – Bridge Design</a></li>
</ul>
<h2 id="review-2"><a class="header" href="#review-2">Review</a></h2>
<h3 id="mips-5"><a class="header" href="#mips-5">MIPs</a></h3>
<ul>
<li><a href="Review/mikhail/suzuka-da-migrations/MIP/mip-13/">MIP-13:  Suzuka DA Migrations Format</a></li>
<li><a href="Review/primata/mip-18/MIP/mip-18/">MIP-18: Stage 0 Upgradeability and Multisigs</a></li>
<li><a href="Review/gas-fee-calculation/MIP/mip-19/">MIP-19: Calculation of gas fees</a></li>
<li><a href="Review/andyjsbell/unwanted-framework/MIP/mip-24/">MIP-24: Removal of redundant functionality from framework</a></li>
<li><a href="Review/andyjsbell/proxy-root/MIP/mip-25/">MIP-25: Proxy Aptos Framework for Stage 0 governance</a></li>
<li><a href="Review/primata/mip-27/MIP/mip-27/">MIP-27: Contract Pipeline</a></li>
<li><a href="Review/l-monninger/actor-naming-conventions/MIP/mip-28/">MIP-28: Naming Conventions for Movement Protocol Design</a></li>
<li><a href="Review/mip/FFS/MIP/mip-34/">MIP-34: Fast Finality Settlement</a></li>
<li><a href="Review/mip/gas-fees-incremental-additions/MIP/mip-47/">MIP-47: Improve Gas fee collection in phases</a></li>
<li><a href="Review/0xmovses/aptos-gov-pool/MIP/mip-48/">MIP-48: <code>aptos_governance</code> for Goverened Gas Pool</a></li>
<li><a href="Review/l-monninger/just-reward/MIP/mip-49/">MIP-49: NB-FFS Governed Fees and Rewards</a></li>
<li><a href="Review/l-monninger/insured-bridge/MIP/mip-50/">MIP-50: Insured Bridge</a></li>
<li><a href="Review/l-monninger/the-biarritz-model/MIP/mip-54/">MIP-54: The Biarritz Model</a></li>
<li><a href="Review/l-monninger/the-bilbao-model/MIP/mip-55/">MIP-55: The Bilbao Model</a></li>
<li><a href="Review/mip/informer/MIP/mip-57/">MIP-57: Informer for the Operation of the HTLC-based Native Bridge</a></li>
<li><a href="Review/mip-58/MIP/mip-58/">MIP-58: Lock/Mint-type Native Bridge with trusted Relayer</a></li>
<li><a href="Review/mip-crosschain-bridges-background/MIP/mip-60/">MIP-60: Cross-chain bridge architectures</a></li>
<li><a href="Review/mip/relayer-bootstrap-and-reboot/MIP/mip-61/">MIP-61: Relayer for the lock/mint Native Bridge - Algorithm and Bootstrapping</a></li>
<li><a href="Review/issue66/MDMIP-for-bridge-fees/MIP/mip-69/">MIP-69: Bridge Fees</a></li>
<li><a href="Review/mip/informer-lockmintbridge/MIP/mip-71/">MIP-71: Informer V1 for the Operation of the Lock/Mint Native Bridge</a></li>
<li><a href="Review/mip/rate-limiter-lock-mint-bridge/MIP/mip-74/">MIP-74: Rate limiter for the Lock/Mint-type Native Bridge</a></li>
</ul>
<h3 id="mds-5"><a class="header" href="#mds-5">MDs</a></h3>
<ul>
<li><a href="Review/l-monninger/enclave-crash-resistant-keys/MD/md-2/">MD-2: Enclave Crash-resistant Key Management</a></li>
<li><a href="Review/l-monninger/long-range-attacks/MD/md-5/">MD-4: Long Range Attacks</a></li>
<li><a href="Review/l-monninger/gas-offset/MD/md-4/">MD-4: MCR Offsetting Gas Costs</a></li>
<li><a href="Review/l-monninger/block-validation/MD/md-6/">MD-6: Suzuka Block Validation</a></li>
<li><a href="Review/l-monninger/block-validation/MD/md-7/">MD-7: Prevent Suzuka MEV Exploits and Censorship</a></li>
<li><a href="Review/mikhail/suzuka-da-migrations/MD/md-13/">MD-13: Suzuka DA Migrations Format</a></li>
<li><a href="Review/primata/md-17/MD/md-17/">MD-17: Bridge Fees</a></li>
<li><a href="Review/primata/bridge-attestors/MD/md-21/">MD-21: Native Bridge with Attesters</a></li>
<li><a href="Review/andygolay/md-26/MD/md-26/">MD-26: User-facing checks</a></li>
<li><a href="Review/primata/md-30/MD/md-30/">MD-30: Movement Name Service</a></li>
<li><a href="Review/mip/FFS/MD/md-34/">MD-34: Fast Finality Settlement</a></li>
<li><a href="Review/l-monninger/provisions-for-fixed-token-supply/MD/md-38/">MD-38: Provide for Fixed Token Supply when Using Native Bridge and Fast Finality Settlement (FFS)</a></li>
<li><a href="Review/l-monninger/just-reward/MD/md-49/">MD-49: Movement L2 Gas Fees</a></li>
<li><a href="Review/mip/relayer-bootstrap-and-reboot/MD/md-61/">MD-61: Relayer for the Lock/Mint Native Bridge</a></li>
<li><a href="Review/issue66/MDMIP-for-bridge-fees/MD/md-69/">MD-69: Bridge fees</a></li>
<li><a href="Review/mip/informer-lockmintbridge/MD/md-71/">MD-71: Informer service for the Lock/Mint-based Native Bridge</a></li>
<li><a href="Review/mip/rate-limiter-lock-mint-bridge/MD/md-74/">MD-74: Rate-Limiter for the Lock/Mint-type Native Bridge</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="md-1-minimize-risk-of-compromised-bridge-key-without-governance"><a class="header" href="#md-1-minimize-risk-of-compromised-bridge-key-without-governance">MD-1: Minimize Risk of Compromised Bridge Key without Governance</a></h1>
<ul>
<li><strong>Description</strong>: Provide a mechanism to minimize the risk of a compromised bridge key without relying on governance.</li>
<li><strong>Authors</strong>: <a href="mailto:liam@movementlabs.xyz">Liam Monninger</a></li>
</ul>
<h2 id="overview"><a class="header" href="#overview">Overview</a></h2>
<p>The Atomic Bridge service relies on trusted keys for relaying events between chains. Without governance or multisig contracts, the risk entailed by a compromised bridge key is significant. Even with logic safeguarding against direct mint operations, fraudulent events on either chain can still be synthesized.</p>
<p>The desiderata herein recognize standard governance as generally the best means of managing these kinds of risks in general. Specialized contracts can be used to accumulate votes and make it difficult for a single actor to compromise bridge security.</p>
<p>However, in the case of bridging, inactive or unreliable governance can be a significant risk as well. In effect, the changes represented by the in-flight message represent those already agreed upon by the destination chain’s governance. These are then subject to a smaller, potentially less-secure governance process before being relayed to the destination chain. The risk of DOS attacks on this governance process is thus high.</p>
<p>Until a robust design for relaying bridge messages based on votes is attained, bridge trust assumptions are offset by a presumed trustworthy bridge signing service which uses known keys that would be controlled by Movement Labs.</p>
<p>This desiderata requests a means to minimize the risk of a compromised bridge key without relying on on-chain governance.</p>
<h2 id="desiderata"><a class="header" href="#desiderata">Desiderata</a></h2>
<!--
  List out the specific desiderata. Each entry should consist of:

  1. Title: A concise name for the desideratum.
  2. User Journey: A one or two-sentence statement focusing on the "user" (could be a human, machine, software, etc.) and their interaction or experience.
  3. Description (optional): A more detailed explanation if needed.
  4. Justification: The reasoning behind the desideratum. Why is it necessary or desired?
  5. Recommendations (optional): Suggestions or guidance related to the desideratum.

  Format as:

  ### Desideratum Title

  **User Journey**: [user] can [action].

  **Description**: <More detailed explanation if needed (optional)>

  **Justification**: <Why this is a significant or required desideratum>

  **Recommendations**: <Any specific guidance or suggestions (optional)>

  TODO: Remove this comment before finalizing.
-->
<h3 id="d1-minimize-direct-access-to-bridge-keys-while-maintaining-use"><a class="header" href="#d1-minimize-direct-access-to-bridge-keys-while-maintaining-use">D1: Minimize Direct Access to Bridge Keys while Maintaining Use</a></h3>
<p><strong>User Journey</strong>: Movement Labs Atomic Bridge Service Operators (MLABSO) can run the service with appropriate signing keys without direct access to said keys.</p>
<p><strong>Justification</strong>: Without direct access to the keys, MLABSO are forced to use a more secure mechanism for signing messages which can be more easily secured audited such as an HSM or enclave.</p>
<h3 id="d2-only-allow-attested-usage-of-bridge-keys"><a class="header" href="#d2-only-allow-attested-usage-of-bridge-keys">D2: Only Allow Attested Usage of Bridge Keys</a></h3>
<p><strong>User Journey</strong>: Only attested software can use bridge keys.</p>
<p><strong>Justification</strong>: Even without direct access to the keys, MLABSO could still abuse bridge keys by abusing their access to the secure signing mechanism. Enforcing attestation of software using the keys can help mitigate this risk.</p>
<h3 id="d3-time-lock-key-usage"><a class="header" href="#d3-time-lock-key-usage">D3: Time-Lock Key Usage</a></h3>
<p><strong>User Journey</strong>: MLABSO can only reliably replace software using a key in a time-locked manner.</p>
<p><strong>Justification</strong>: The software using a given key may require updates or replacement. Time-locking can allow this to occur without diminishing the benefits of attestations.</p>
<h2 id="errata"><a class="header" href="#errata">Errata</a></h2>
<!--
  Errata should be maintained after publication.

  1. **Transparency and Clarity**: An erratum acknowledges any corrections made post-publication, ensuring that readers are not misled and are always equipped with the most accurate information.

  2. **Accountability**: By noting errors openly, we maintain a high level of responsibility and ownership over our content. It’s an affirmation that we value precision and are ready to correct oversights.

  Each erratum should briefly describe the discrepancy and the correction made, accompanied by a reference to the date and version of the desiderata in which the error was identified.

  TODO: Maintain this comment.
-->
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="md-3-mcr-under-network-partitions-and-asynchrony"><a class="header" href="#md-3-mcr-under-network-partitions-and-asynchrony">MD-3: MCR under Network Partitions and Asynchrony</a></h1>
<ul>
<li><strong>Description</strong>: Provide a model for MCR and suggest a mechanism for handling network partitions and asynchrony.</li>
<li><strong>Authors</strong>: <a href="mailto:liam@movementlabs.xyz">Liam Monninger</a></li>
</ul>
<h2 id="overview-1"><a class="header" href="#overview-1">Overview</a></h2>
<p>MCR provides a stake-based settlement mechanism used in Movement Lab’s Suzuka Network. In it’s current form, it does not take any steps to account for network partitions or, more generally, asynchrony.</p>
<p>Henceforth, we will simply refer to network partitions, as all forms of asynchrony with which we are concerned can be modeled as such. Even if a node is not technically offline, the remainder of this disiderata will be concerned with the case in which it is not able to commit meaningfully to the current block height.</p>
<p>It is important to account for network partitions in a manner consistent with the game theory of MCR. In the current implementation, a simple race is run to <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1901em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8451em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span> of the network’s stake. Currently, there is no model for slashing or rewarding. So, not participating in that race to <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1901em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8451em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span> of the network’s stake is not a meaningfully punished. Presuming there would be a reward for participating, this may create an incentive to run an unreliable node which may often fail to commit to the current block height.</p>
<p>The same condition could also be seen as an attack vector if rewards and punishments were in place. A malicious actor could aim to partition the network via generating conditions for fast commitment amongst certain nodes–perhaps via something similar to the <a href="https://github.com/movementlabsxyz/rfcs/pull/29">Peer Attack described in RFC-29</a>. This would allow their stake to increase via rewards while the targeted minority stake would be slashed. The attacker may be able to keep apply this attack until they have a majority of stake.</p>
<p>These and other phenomena are listed in the desiderata below.</p>
<h2 id="desiderata-1"><a class="header" href="#desiderata-1">Desiderata</a></h2>
<!--
  List out the specific desiderata. Each entry should consist of:

  1. Title: A concise name for the desideratum.
  2. User Journey: A one or two-sentence statement focusing on the "user" (could be a human, machine, software, etc.) and their interaction or experience.
  3. Description (optional): A more detailed explanation if needed.
  4. Justification: The reasoning behind the desideratum. Why is it necessary or desired?
  5. Recommendations (optional): Suggestions or guidance related to the desideratum.

  Format as:

  ### Desideratum Title

  **User Journey**: [user] can [action].

  **Description**: <More detailed explanation if needed (optional)>

  **Justification**: <Why this is a significant or required desideratum>

  **Recommendations**: <Any specific guidance or suggestions (optional)>

  TODO: Remove this comment before finalizing.
-->
<h3 id="d1-model-for-network-partitions-as-absent-commitments-to-mcr"><a class="header" href="#d1-model-for-network-partitions-as-absent-commitments-to-mcr">D1: Model for Network Partitions as Absent Commitments to MCR</a></h3>
<p><strong>User Journey</strong>: A researcher or protocol implementer can refer to a formal model for network partitions in MCR, ultimately deriving from it the logic necessary to implement slashing and rewarding.</p>
<p><strong>Justification</strong>: Network partitions effectively result in absent commitments to the current block height. While not changing the stake needing to agree on the current height, the slashing or rewarding based on this absent commitment should be expected to impact behavior in the repeated game of MCR.</p>
<p><strong>Recommendations</strong>:</p>
<ul>
<li>A simple way to approach would be to model the value of a node’s commitment or absenteeism to honest-agreeing, honest-disagreeing, dishonest-agreeing, and dishonest-disagreeing participants. This could then be adapted into a more complex model with shifting preferences.</li>
<li>The literature on absenteeism in repeated games is generally a bit sparse and particularly so–on first review–for topics in computer science.</li>
</ul>
<h3 id="d2-research-and-design-for-commitment-tolerance-window"><a class="header" href="#d2-research-and-design-for-commitment-tolerance-window">D2: Research and Design for Commitment Tolerance Window</a></h3>
<p><strong>User Journey</strong>: A researcher or protocol implementer can understand why or why not a commitment tolerance window is necessary for MCR and why a particular design for this window was chosen.</p>
<p><strong>Justification</strong>: It has been proposed that a commitment tolerance window would soften network partitions. That is, allowing participants to receive a reward or penalty after the needed stake has committed to the current block height could prevent the kind kind of stake drift and attacks described above.</p>
<p><strong>Recommendations</strong>:</p>
<ul>
<li>Consider the following parameters for the commitment tolerance window:
<ul>
<li>Reward decay: the function describing the diminishing returns of rewards later in the window.</li>
<li>Penalty decay: the function describing the increasing returns of penalties later in the window.</li>
<li>Vote decay: the function describing the diminishing returns of votes later in the window. This would only be useful if previous rounds of voting are considered in the current round.</li>
</ul>
</li>
</ul>
<h3 id="d3-address-asynchronous-upgrades-fork-creation-and-fork-stake-problems"><a class="header" href="#d3-address-asynchronous-upgrades-fork-creation-and-fork-stake-problems">D3: Address Asynchronous Upgrades, Fork Creation, and Fork Stake Problems</a></h3>
<p><strong>User Journey</strong>: A researcher or protocol implementer can understand the <a href="Approved/main/MD/md-3/./asychronous-upgrades-problem.html">Asynchronous Upgrades, Fork Creation, and Fork Stake Problems</a> and how they are addressed in MCR.</p>
<p><strong>Justification</strong>: These are problems encountered under asynchrony and systems addressing asynchrony which if not addressed would bring down the network.</p>
<p><strong>Recommendations</strong>:</p>
<ul>
<li>Start by reviewing the <a href="Approved/main/MD/md-3/./asychronous-upgrades-problem.html">Asynchronous Upgrades, Fork Creation, and Fork Stake Problems</a>.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="md-15-movement-glossary"><a class="header" href="#md-15-movement-glossary">MD-15: Movement Glossary</a></h1>
<ul>
<li><strong>Description</strong>: Provide a glossary for Movement Vocabulary.</li>
<li><strong>Authors</strong>: <a href="mailto:liam@movementlabs.xyz">Liam Monninger</a></li>
<li><strong>Reviewer</strong>: Andreas Penzkofer</li>
</ul>
<h2 id="overview-2"><a class="header" href="#overview-2">Overview</a></h2>
<p>In order to communicate with more specificity in all contexts, Movement Labs should introduce a glossary. This glossary should define terms both unique to Movement Labs and general terms that are used in a unique way, underspecified in the literature, or have a specific meaning in the context of Movement Labs.</p>
<h2 id="desiderata-2"><a class="header" href="#desiderata-2">Desiderata</a></h2>
<!--
  List out the specific desiderata. Each entry should consist of:

  1. Title: A concise name for the desideratum.
  2. User Journey: A one or two-sentence statement focusing on the "user" (could be a human, machine, software, etc.) and their interaction or experience.
  3. Description (optional): A more detailed explanation if needed.
  4. Justification: The reasoning behind the desideratum. Why is it necessary or desired?
  5. Recommendations (optional): Suggestions or guidance related to the desideratum.

  Format as:

  ### Desideratum Title

  **User Journey**: [user] can [action].

  **Description**: <More detailed explanation if needed (optional)>

  **Justification**: <Why this is a significant or required desideratum>

  **Recommendations**: <Any specific guidance or suggestions (optional)>

  TODO: Remove this comment before finalizing.
-->
<h3 id="d1-have-a-common-format-for-a-glossary-entry-gloss"><a class="header" href="#d1-have-a-common-format-for-a-glossary-entry-gloss">D1: Have a Common Format for a Glossary Entry (Gloss)</a></h3>
<p><strong>Justification</strong>: A common format for glossary entries will make it easier to maintain and update the glossary.</p>
<p><strong>Recommendations</strong>:</p>
<ul>
<li>Create a new formatted document for glossary entries in the MIP repository. Call this document an MG, short for Movement Gloss.</li>
<li>Include sections for (1) term, (2) authorship, (3) concise definition, (4) catalog of references to definitions or usages of the term in other contexts, (5) example usages, and (6) errata.</li>
<li>Encourage formalism where applicable.</li>
</ul>
<h3 id="d2-introduce-glossary-terms-via-an-mip"><a class="header" href="#d2-introduce-glossary-terms-via-an-mip">D2: Introduce Glossary Terms via an MIP</a></h3>
<p><strong>Justification</strong>: Introducing glossary terms via an MIP will allow for a more formal process for introducing new terms.</p>
<p><strong>Recommendations</strong>:</p>
<ul>
<li>MD can also introduce MG to further aid in clarity, but they will not be ratified until they have been supported in an MIP.</li>
</ul>
<h2 id="changelog-4"><a class="header" href="#changelog-4">Changelog</a></h2>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="welcome-to-the-movement-network-mip-book-3"><a class="header" href="#welcome-to-the-movement-network-mip-book-3">Welcome to the Movement Network MIP Book</a></h1>
<h2 id="approved-3"><a class="header" href="#approved-3">Approved</a></h2>
<h3 id="mips-6"><a class="header" href="#mips-6">MIPs</a></h3>
<ul>
<li><a href="Approved/main/MIP/mip-1/">MIP-1: ENTL (Enclave Nonce Time-lock)</a></li>
<li><a href="Approved/main/MIP/mip-15/">MIP-15: MG (Movement Gloss)</a></li>
<li><a href="Approved/main/MIP/mip-39/">MIP-39: MOVE Token – HTLC-based Native Bridge Design</a></li>
<li><a href="Approved/main/MIP/mip-53/">MIP-53: Conventions for Proposing Progressive L2 Models</a></li>
</ul>
<h3 id="mds-6"><a class="header" href="#mds-6">MDs</a></h3>
<ul>
<li><a href="Approved/main/MD/md-1/">MD-1: Minimize Risk of Compromised Bridge Key without Governance</a></li>
<li><a href="Approved/main/MD/md-3/">MD-3: MCR under Network Partitions and Asynchrony</a></li>
<li><a href="Approved/main/MD/md-15/">MD-15: Movement Glossary</a></li>
</ul>
<h3 id="mgs-3"><a class="header" href="#mgs-3">MGs</a></h3>
<ul>
<li><a href="Approved/main/MG/mg-39/">MG-39:  MOVE Token – Bridge Design</a></li>
</ul>
<h2 id="review-3"><a class="header" href="#review-3">Review</a></h2>
<h3 id="mips-7"><a class="header" href="#mips-7">MIPs</a></h3>
<ul>
<li><a href="Review/mikhail/suzuka-da-migrations/MIP/mip-13/">MIP-13:  Suzuka DA Migrations Format</a></li>
<li><a href="Review/primata/mip-18/MIP/mip-18/">MIP-18: Stage 0 Upgradeability and Multisigs</a></li>
<li><a href="Review/gas-fee-calculation/MIP/mip-19/">MIP-19: Calculation of gas fees</a></li>
<li><a href="Review/andyjsbell/unwanted-framework/MIP/mip-24/">MIP-24: Removal of redundant functionality from framework</a></li>
<li><a href="Review/andyjsbell/proxy-root/MIP/mip-25/">MIP-25: Proxy Aptos Framework for Stage 0 governance</a></li>
<li><a href="Review/primata/mip-27/MIP/mip-27/">MIP-27: Contract Pipeline</a></li>
<li><a href="Review/l-monninger/actor-naming-conventions/MIP/mip-28/">MIP-28: Naming Conventions for Movement Protocol Design</a></li>
<li><a href="Review/mip/FFS/MIP/mip-34/">MIP-34: Fast Finality Settlement</a></li>
<li><a href="Review/mip/gas-fees-incremental-additions/MIP/mip-47/">MIP-47: Improve Gas fee collection in phases</a></li>
<li><a href="Review/0xmovses/aptos-gov-pool/MIP/mip-48/">MIP-48: <code>aptos_governance</code> for Goverened Gas Pool</a></li>
<li><a href="Review/l-monninger/just-reward/MIP/mip-49/">MIP-49: NB-FFS Governed Fees and Rewards</a></li>
<li><a href="Review/l-monninger/insured-bridge/MIP/mip-50/">MIP-50: Insured Bridge</a></li>
<li><a href="Review/l-monninger/the-biarritz-model/MIP/mip-54/">MIP-54: The Biarritz Model</a></li>
<li><a href="Review/l-monninger/the-bilbao-model/MIP/mip-55/">MIP-55: The Bilbao Model</a></li>
<li><a href="Review/mip/informer/MIP/mip-57/">MIP-57: Informer for the Operation of the HTLC-based Native Bridge</a></li>
<li><a href="Review/mip-58/MIP/mip-58/">MIP-58: Lock/Mint-type Native Bridge with trusted Relayer</a></li>
<li><a href="Review/mip-crosschain-bridges-background/MIP/mip-60/">MIP-60: Cross-chain bridge architectures</a></li>
<li><a href="Review/mip/relayer-bootstrap-and-reboot/MIP/mip-61/">MIP-61: Relayer for the lock/mint Native Bridge - Algorithm and Bootstrapping</a></li>
<li><a href="Review/issue66/MDMIP-for-bridge-fees/MIP/mip-69/">MIP-69: Bridge Fees</a></li>
<li><a href="Review/mip/informer-lockmintbridge/MIP/mip-71/">MIP-71: Informer V1 for the Operation of the Lock/Mint Native Bridge</a></li>
<li><a href="Review/mip/rate-limiter-lock-mint-bridge/MIP/mip-74/">MIP-74: Rate limiter for the Lock/Mint-type Native Bridge</a></li>
</ul>
<h3 id="mds-7"><a class="header" href="#mds-7">MDs</a></h3>
<ul>
<li><a href="Review/l-monninger/enclave-crash-resistant-keys/MD/md-2/">MD-2: Enclave Crash-resistant Key Management</a></li>
<li><a href="Review/l-monninger/long-range-attacks/MD/md-5/">MD-4: Long Range Attacks</a></li>
<li><a href="Review/l-monninger/gas-offset/MD/md-4/">MD-4: MCR Offsetting Gas Costs</a></li>
<li><a href="Review/l-monninger/block-validation/MD/md-6/">MD-6: Suzuka Block Validation</a></li>
<li><a href="Review/l-monninger/block-validation/MD/md-7/">MD-7: Prevent Suzuka MEV Exploits and Censorship</a></li>
<li><a href="Review/mikhail/suzuka-da-migrations/MD/md-13/">MD-13: Suzuka DA Migrations Format</a></li>
<li><a href="Review/primata/md-17/MD/md-17/">MD-17: Bridge Fees</a></li>
<li><a href="Review/primata/bridge-attestors/MD/md-21/">MD-21: Native Bridge with Attesters</a></li>
<li><a href="Review/andygolay/md-26/MD/md-26/">MD-26: User-facing checks</a></li>
<li><a href="Review/primata/md-30/MD/md-30/">MD-30: Movement Name Service</a></li>
<li><a href="Review/mip/FFS/MD/md-34/">MD-34: Fast Finality Settlement</a></li>
<li><a href="Review/l-monninger/provisions-for-fixed-token-supply/MD/md-38/">MD-38: Provide for Fixed Token Supply when Using Native Bridge and Fast Finality Settlement (FFS)</a></li>
<li><a href="Review/l-monninger/just-reward/MD/md-49/">MD-49: Movement L2 Gas Fees</a></li>
<li><a href="Review/mip/relayer-bootstrap-and-reboot/MD/md-61/">MD-61: Relayer for the Lock/Mint Native Bridge</a></li>
<li><a href="Review/issue66/MDMIP-for-bridge-fees/MD/md-69/">MD-69: Bridge fees</a></li>
<li><a href="Review/mip/informer-lockmintbridge/MD/md-71/">MD-71: Informer service for the Lock/Mint-based Native Bridge</a></li>
<li><a href="Review/mip/rate-limiter-lock-mint-bridge/MD/md-74/">MD-74: Rate-Limiter for the Lock/Mint-type Native Bridge</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="mg-39--move-token--bridge-design"><a class="header" href="#mg-39--move-token--bridge-design">MG-39:  MOVE Token – Bridge Design</a></h1>
<ul>
<li><strong>Authors</strong>: <a href="mailto:franck.cassez@movementlabs.xyz">Franck Cassez</a></li>
</ul>
<h3 id="move"><a class="header" href="#move"><code>\$MOVE</code></a></h3>
<p>see <a href="Approved/main/MG/mg-39/../../MIP/mip-39/README.html">MIP-39</a></p>
<h3 id="l1move"><a class="header" href="#l1move"><code>\$L1MOVE</code></a></h3>
<p>see <a href="Approved/main/MG/mg-39/../../MIP/mip-39/README.html">MIP-39</a></p>
<h3 id="l2move"><a class="header" href="#l2move"><code>\$L2MOVE</code></a></h3>
<p>see <a href="Approved/main/MG/mg-39/../../MIP/mip-39/README.html">MIP-39</a></p>
<h3 id="native-bridge"><a class="header" href="#native-bridge">Native Bridge</a></h3>
<p>see <a href="Approved/main/MG/mg-39/../../MIP/mip-39/README.html">MIP-39</a></p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="welcome-to-the-movement-network-mip-book-4"><a class="header" href="#welcome-to-the-movement-network-mip-book-4">Welcome to the Movement Network MIP Book</a></h1>
<h2 id="approved-4"><a class="header" href="#approved-4">Approved</a></h2>
<h3 id="mips-8"><a class="header" href="#mips-8">MIPs</a></h3>
<ul>
<li><a href="Approved/main/MIP/mip-1/">MIP-1: ENTL (Enclave Nonce Time-lock)</a></li>
<li><a href="Approved/main/MIP/mip-15/">MIP-15: MG (Movement Gloss)</a></li>
<li><a href="Approved/main/MIP/mip-39/">MIP-39: MOVE Token – HTLC-based Native Bridge Design</a></li>
<li><a href="Approved/main/MIP/mip-53/">MIP-53: Conventions for Proposing Progressive L2 Models</a></li>
</ul>
<h3 id="mds-8"><a class="header" href="#mds-8">MDs</a></h3>
<ul>
<li><a href="Approved/main/MD/md-1/">MD-1: Minimize Risk of Compromised Bridge Key without Governance</a></li>
<li><a href="Approved/main/MD/md-3/">MD-3: MCR under Network Partitions and Asynchrony</a></li>
<li><a href="Approved/main/MD/md-15/">MD-15: Movement Glossary</a></li>
</ul>
<h3 id="mgs-4"><a class="header" href="#mgs-4">MGs</a></h3>
<ul>
<li><a href="Approved/main/MG/mg-39/">MG-39:  MOVE Token – Bridge Design</a></li>
</ul>
<h2 id="review-4"><a class="header" href="#review-4">Review</a></h2>
<h3 id="mips-9"><a class="header" href="#mips-9">MIPs</a></h3>
<ul>
<li><a href="Review/mikhail/suzuka-da-migrations/MIP/mip-13/">MIP-13:  Suzuka DA Migrations Format</a></li>
<li><a href="Review/primata/mip-18/MIP/mip-18/">MIP-18: Stage 0 Upgradeability and Multisigs</a></li>
<li><a href="Review/gas-fee-calculation/MIP/mip-19/">MIP-19: Calculation of gas fees</a></li>
<li><a href="Review/andyjsbell/unwanted-framework/MIP/mip-24/">MIP-24: Removal of redundant functionality from framework</a></li>
<li><a href="Review/andyjsbell/proxy-root/MIP/mip-25/">MIP-25: Proxy Aptos Framework for Stage 0 governance</a></li>
<li><a href="Review/primata/mip-27/MIP/mip-27/">MIP-27: Contract Pipeline</a></li>
<li><a href="Review/l-monninger/actor-naming-conventions/MIP/mip-28/">MIP-28: Naming Conventions for Movement Protocol Design</a></li>
<li><a href="Review/mip/FFS/MIP/mip-34/">MIP-34: Fast Finality Settlement</a></li>
<li><a href="Review/mip/gas-fees-incremental-additions/MIP/mip-47/">MIP-47: Improve Gas fee collection in phases</a></li>
<li><a href="Review/0xmovses/aptos-gov-pool/MIP/mip-48/">MIP-48: <code>aptos_governance</code> for Goverened Gas Pool</a></li>
<li><a href="Review/l-monninger/just-reward/MIP/mip-49/">MIP-49: NB-FFS Governed Fees and Rewards</a></li>
<li><a href="Review/l-monninger/insured-bridge/MIP/mip-50/">MIP-50: Insured Bridge</a></li>
<li><a href="Review/l-monninger/the-biarritz-model/MIP/mip-54/">MIP-54: The Biarritz Model</a></li>
<li><a href="Review/l-monninger/the-bilbao-model/MIP/mip-55/">MIP-55: The Bilbao Model</a></li>
<li><a href="Review/mip/informer/MIP/mip-57/">MIP-57: Informer for the Operation of the HTLC-based Native Bridge</a></li>
<li><a href="Review/mip-58/MIP/mip-58/">MIP-58: Lock/Mint-type Native Bridge with trusted Relayer</a></li>
<li><a href="Review/mip-crosschain-bridges-background/MIP/mip-60/">MIP-60: Cross-chain bridge architectures</a></li>
<li><a href="Review/mip/relayer-bootstrap-and-reboot/MIP/mip-61/">MIP-61: Relayer for the lock/mint Native Bridge - Algorithm and Bootstrapping</a></li>
<li><a href="Review/issue66/MDMIP-for-bridge-fees/MIP/mip-69/">MIP-69: Bridge Fees</a></li>
<li><a href="Review/mip/informer-lockmintbridge/MIP/mip-71/">MIP-71: Informer V1 for the Operation of the Lock/Mint Native Bridge</a></li>
<li><a href="Review/mip/rate-limiter-lock-mint-bridge/MIP/mip-74/">MIP-74: Rate limiter for the Lock/Mint-type Native Bridge</a></li>
</ul>
<h3 id="mds-9"><a class="header" href="#mds-9">MDs</a></h3>
<ul>
<li><a href="Review/l-monninger/enclave-crash-resistant-keys/MD/md-2/">MD-2: Enclave Crash-resistant Key Management</a></li>
<li><a href="Review/l-monninger/long-range-attacks/MD/md-5/">MD-4: Long Range Attacks</a></li>
<li><a href="Review/l-monninger/gas-offset/MD/md-4/">MD-4: MCR Offsetting Gas Costs</a></li>
<li><a href="Review/l-monninger/block-validation/MD/md-6/">MD-6: Suzuka Block Validation</a></li>
<li><a href="Review/l-monninger/block-validation/MD/md-7/">MD-7: Prevent Suzuka MEV Exploits and Censorship</a></li>
<li><a href="Review/mikhail/suzuka-da-migrations/MD/md-13/">MD-13: Suzuka DA Migrations Format</a></li>
<li><a href="Review/primata/md-17/MD/md-17/">MD-17: Bridge Fees</a></li>
<li><a href="Review/primata/bridge-attestors/MD/md-21/">MD-21: Native Bridge with Attesters</a></li>
<li><a href="Review/andygolay/md-26/MD/md-26/">MD-26: User-facing checks</a></li>
<li><a href="Review/primata/md-30/MD/md-30/">MD-30: Movement Name Service</a></li>
<li><a href="Review/mip/FFS/MD/md-34/">MD-34: Fast Finality Settlement</a></li>
<li><a href="Review/l-monninger/provisions-for-fixed-token-supply/MD/md-38/">MD-38: Provide for Fixed Token Supply when Using Native Bridge and Fast Finality Settlement (FFS)</a></li>
<li><a href="Review/l-monninger/just-reward/MD/md-49/">MD-49: Movement L2 Gas Fees</a></li>
<li><a href="Review/mip/relayer-bootstrap-and-reboot/MD/md-61/">MD-61: Relayer for the Lock/Mint Native Bridge</a></li>
<li><a href="Review/issue66/MDMIP-for-bridge-fees/MD/md-69/">MD-69: Bridge fees</a></li>
<li><a href="Review/mip/informer-lockmintbridge/MD/md-71/">MD-71: Informer service for the Lock/Mint-based Native Bridge</a></li>
<li><a href="Review/mip/rate-limiter-lock-mint-bridge/MD/md-74/">MD-74: Rate-Limiter for the Lock/Mint-type Native Bridge</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="welcome-to-the-movement-network-mip-book-5"><a class="header" href="#welcome-to-the-movement-network-mip-book-5">Welcome to the Movement Network MIP Book</a></h1>
<h2 id="approved-5"><a class="header" href="#approved-5">Approved</a></h2>
<h3 id="mips-10"><a class="header" href="#mips-10">MIPs</a></h3>
<ul>
<li><a href="Approved/main/MIP/mip-1/">MIP-1: ENTL (Enclave Nonce Time-lock)</a></li>
<li><a href="Approved/main/MIP/mip-15/">MIP-15: MG (Movement Gloss)</a></li>
<li><a href="Approved/main/MIP/mip-39/">MIP-39: MOVE Token – HTLC-based Native Bridge Design</a></li>
<li><a href="Approved/main/MIP/mip-53/">MIP-53: Conventions for Proposing Progressive L2 Models</a></li>
</ul>
<h3 id="mds-10"><a class="header" href="#mds-10">MDs</a></h3>
<ul>
<li><a href="Approved/main/MD/md-1/">MD-1: Minimize Risk of Compromised Bridge Key without Governance</a></li>
<li><a href="Approved/main/MD/md-3/">MD-3: MCR under Network Partitions and Asynchrony</a></li>
<li><a href="Approved/main/MD/md-15/">MD-15: Movement Glossary</a></li>
</ul>
<h3 id="mgs-5"><a class="header" href="#mgs-5">MGs</a></h3>
<ul>
<li><a href="Approved/main/MG/mg-39/">MG-39:  MOVE Token – Bridge Design</a></li>
</ul>
<h2 id="review-5"><a class="header" href="#review-5">Review</a></h2>
<h3 id="mips-11"><a class="header" href="#mips-11">MIPs</a></h3>
<ul>
<li><a href="Review/mikhail/suzuka-da-migrations/MIP/mip-13/">MIP-13:  Suzuka DA Migrations Format</a></li>
<li><a href="Review/primata/mip-18/MIP/mip-18/">MIP-18: Stage 0 Upgradeability and Multisigs</a></li>
<li><a href="Review/gas-fee-calculation/MIP/mip-19/">MIP-19: Calculation of gas fees</a></li>
<li><a href="Review/andyjsbell/unwanted-framework/MIP/mip-24/">MIP-24: Removal of redundant functionality from framework</a></li>
<li><a href="Review/andyjsbell/proxy-root/MIP/mip-25/">MIP-25: Proxy Aptos Framework for Stage 0 governance</a></li>
<li><a href="Review/primata/mip-27/MIP/mip-27/">MIP-27: Contract Pipeline</a></li>
<li><a href="Review/l-monninger/actor-naming-conventions/MIP/mip-28/">MIP-28: Naming Conventions for Movement Protocol Design</a></li>
<li><a href="Review/mip/FFS/MIP/mip-34/">MIP-34: Fast Finality Settlement</a></li>
<li><a href="Review/mip/gas-fees-incremental-additions/MIP/mip-47/">MIP-47: Improve Gas fee collection in phases</a></li>
<li><a href="Review/0xmovses/aptos-gov-pool/MIP/mip-48/">MIP-48: <code>aptos_governance</code> for Goverened Gas Pool</a></li>
<li><a href="Review/l-monninger/just-reward/MIP/mip-49/">MIP-49: NB-FFS Governed Fees and Rewards</a></li>
<li><a href="Review/l-monninger/insured-bridge/MIP/mip-50/">MIP-50: Insured Bridge</a></li>
<li><a href="Review/l-monninger/the-biarritz-model/MIP/mip-54/">MIP-54: The Biarritz Model</a></li>
<li><a href="Review/l-monninger/the-bilbao-model/MIP/mip-55/">MIP-55: The Bilbao Model</a></li>
<li><a href="Review/mip/informer/MIP/mip-57/">MIP-57: Informer for the Operation of the HTLC-based Native Bridge</a></li>
<li><a href="Review/mip-58/MIP/mip-58/">MIP-58: Lock/Mint-type Native Bridge with trusted Relayer</a></li>
<li><a href="Review/mip-crosschain-bridges-background/MIP/mip-60/">MIP-60: Cross-chain bridge architectures</a></li>
<li><a href="Review/mip/relayer-bootstrap-and-reboot/MIP/mip-61/">MIP-61: Relayer for the lock/mint Native Bridge - Algorithm and Bootstrapping</a></li>
<li><a href="Review/issue66/MDMIP-for-bridge-fees/MIP/mip-69/">MIP-69: Bridge Fees</a></li>
<li><a href="Review/mip/informer-lockmintbridge/MIP/mip-71/">MIP-71: Informer V1 for the Operation of the Lock/Mint Native Bridge</a></li>
<li><a href="Review/mip/rate-limiter-lock-mint-bridge/MIP/mip-74/">MIP-74: Rate limiter for the Lock/Mint-type Native Bridge</a></li>
</ul>
<h3 id="mds-11"><a class="header" href="#mds-11">MDs</a></h3>
<ul>
<li><a href="Review/l-monninger/enclave-crash-resistant-keys/MD/md-2/">MD-2: Enclave Crash-resistant Key Management</a></li>
<li><a href="Review/l-monninger/long-range-attacks/MD/md-5/">MD-4: Long Range Attacks</a></li>
<li><a href="Review/l-monninger/gas-offset/MD/md-4/">MD-4: MCR Offsetting Gas Costs</a></li>
<li><a href="Review/l-monninger/block-validation/MD/md-6/">MD-6: Suzuka Block Validation</a></li>
<li><a href="Review/l-monninger/block-validation/MD/md-7/">MD-7: Prevent Suzuka MEV Exploits and Censorship</a></li>
<li><a href="Review/mikhail/suzuka-da-migrations/MD/md-13/">MD-13: Suzuka DA Migrations Format</a></li>
<li><a href="Review/primata/md-17/MD/md-17/">MD-17: Bridge Fees</a></li>
<li><a href="Review/primata/bridge-attestors/MD/md-21/">MD-21: Native Bridge with Attesters</a></li>
<li><a href="Review/andygolay/md-26/MD/md-26/">MD-26: User-facing checks</a></li>
<li><a href="Review/primata/md-30/MD/md-30/">MD-30: Movement Name Service</a></li>
<li><a href="Review/mip/FFS/MD/md-34/">MD-34: Fast Finality Settlement</a></li>
<li><a href="Review/l-monninger/provisions-for-fixed-token-supply/MD/md-38/">MD-38: Provide for Fixed Token Supply when Using Native Bridge and Fast Finality Settlement (FFS)</a></li>
<li><a href="Review/l-monninger/just-reward/MD/md-49/">MD-49: Movement L2 Gas Fees</a></li>
<li><a href="Review/mip/relayer-bootstrap-and-reboot/MD/md-61/">MD-61: Relayer for the Lock/Mint Native Bridge</a></li>
<li><a href="Review/issue66/MDMIP-for-bridge-fees/MD/md-69/">MD-69: Bridge fees</a></li>
<li><a href="Review/mip/informer-lockmintbridge/MD/md-71/">MD-71: Informer service for the Lock/Mint-based Native Bridge</a></li>
<li><a href="Review/mip/rate-limiter-lock-mint-bridge/MD/md-74/">MD-74: Rate-Limiter for the Lock/Mint-type Native Bridge</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="mip-13--suzuka-da-migrations-format"><a class="header" href="#mip-13--suzuka-da-migrations-format">MIP-13:  Suzuka DA Migrations Format</a></h1>
<ul>
<li><strong>Description</strong>: Data format which describes migrations of the canonical state of the DA over time.</li>
<li><strong>Authors</strong>: <a href="mailto:mikhail.zabaluev@movementlabs.xyz">Mikhail Zabaluev</a></li>
<li><strong>Desiderata</strong>: <a href="Review/mikhail/suzuka-da-migrations/MIP/mip-13/../MD/md-13">MD-13</a></li>
</ul>
<h2 id="abstract-4"><a class="header" href="#abstract-4">Abstract</a></h2>
<p>The format of a well-known file defining migrations of the DA blob format enacted on specified
block heights.
This would be a hardfork or coordinated approach (TODO: clarify terminology) to upgrades, in that
each node participating in the network SHOULD be deployed with an up to date copy of the file
describing the migrations up to and above the current block height.</p>
<h2 id="motivation-4"><a class="header" href="#motivation-4">Motivation</a></h2>
<p>In order to allow for safe upgrades, data model changes, and DA migrations, it has been proposed that we provide a data format which describes the canonical state of the DA over time.</p>
<h2 id="specification-4"><a class="header" href="#specification-4">Specification</a></h2>
<p>The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”, “RECOMMENDED”, “NOT RECOMMENDED”, “MAY”, and “OPTIONAL” in this document are to be interpreted as described in RFC 2119 and RFC 8174.</p>
<h3 id="da-migration-configuration-format"><a class="header" href="#da-migration-configuration-format">DA Migration Configuration Format</a></h3>
<p>The format of a well-known file defining migrations is a JSON serialization of a map where keys
indicate the block height at which the configuration in the value starts applying. The values are
objects with named fields specifying the format settings. The top-level configuration envelope
specifies the current version of the format to permit breaking changes in the future.</p>
<pre><code class="language-json">{
  "version": 1,
  "migrations": {
    "123456": {
      "namespace": "deadbeef01234567890",
      "transaction_format": 1,
      "block_format": 2,
      "ordering_rule": 3,
      "node_version": "1.2"
    }
  }
}
</code></pre>
<p>the Rust definition of the value struct:</p>
<pre><code class="language-rust">#[derive(Serialize, Deserialize)]
pub struct DASettings {
    namespace: Namespace,
    transaction_format: TransactionFormatVersion,
    block_format: BlockFormatVersion,
    ordering_rule: OrderingRuleVersion,
    node_version: NodeVersionReq,
}</code></pre>
<p>Here, <code>Namespace</code> is the data type representing a Celestia namespace ID with the
human-readable serialization as a hex string.
The <code>*Version</code> types are enums initially defined with a single <code>V1</code> member each.
<code>NodeVersionReq</code> serializes into a SemVer-conforming version specification in the
<em>MAJOR</em><code>.</code><em>MINOR</em> format.</p>
<h3 id="principles-of-managing-migrations"><a class="header" href="#principles-of-managing-migrations">Principles of managing migrations</a></h3>
<p>Each new entry in the migration table SHALL use a unique Celestia namespace identifier to prevent
confusion and detect accidental misconfiguration early.</p>
<p>The configuration in all nodes in the network SHOULD be updated well in advance of the block height
at which a new change is introduced. The expected process in governance stage 0 is a coordinated
upgrade.</p>
<p>The <code>node_version</code> field gives the semver minimum version of the Suzuka full node software that is
REQUIRED to use these settings. A node that does not satisfy the version requirement for any of the
encountered entries MUST reject the configuration and report an error.</p>
<p>The producers and consumers of DA blobs MUST implement all versions encountered in the configuration
file and apply the settings accordingly to the block height of the data blobs. No mixing of
different DA formats between blobs submitted by correct nodes for the same block height is
supported by this specification.</p>
<h3 id="future-evolution-of-the-da-migration-configuration-format"><a class="header" href="#future-evolution-of-the-da-migration-configuration-format">Future evolution of the DA migration configuration format</a></h3>
<p>New fields can be added to the <code>DASettings</code> structures in future revisions
of this specifications without changing the value of the top-level
<code>version</code> field. Implementations SHALL ignore the fields not defined in
the revision of the specification they support. If interpretation of such newly
added field values in a specific migration requires behavior not supported
by older versions of the node software, this SHOULD be communicated to
non-compliant nodes with the compatibility requirement in the <code>node_version</code>
field.</p>
<p>Any values of known fields of <code>DASettings</code> that are not supported by the current
implementation SHALL result in rejecting the configuration and reporting an error.
The implementation MAY check the compatibility requirement given by <code>node_version</code>
before reporting errors on unsupported values.</p>
<h2 id="reference-implementation-3"><a class="header" href="#reference-implementation-3">Reference Implementation</a></h2>
<!--
  The Reference Implementation section should include links to and an overview of a minimal implementation that assists in understanding or implementing this specification. The reference implementation is not a replacement for the Specification section, and the proposal should still be understandable without it.

  TODO: Remove this comment before submitting
-->
<h2 id="verification-4"><a class="header" href="#verification-4">Verification</a></h2>
<!--

  All proposals must contain a section that discusses the various aspects of verification pertinent to the introduced changes. This section should address:

  1. **Correctness**: Ensure that the proposed changes behave as expected in all scenarios. Highlight any tests, simulations, or proofs done to validate the correctness of the changes.

  2. **Security Implications**: Address the potential security ramifications of the proposal. This includes discussing security-relevant design decisions, potential vulnerabilities, important discussions, implementation-specific guidance, and pitfalls. Mention any threats, risks, and mitigation strategies associated with the proposal.

  3. **Performance Impacts**: Outline any performance tests conducted and the impact of the proposal on system performance. This could be in terms of speed, resource consumption, or other relevant metrics.

  4. **Validation Procedures**: Describe any procedures, tools, or methodologies used to validate the proposal against its requirements or objectives. 

  5. **Peer Review and Community Feedback**: Highlight any feedback from peer reviews or the community that played a crucial role in refining the verification process or the proposal itself.


  TODO: Remove this comment before submitting
-->
<p>Needs discussion.</p>
<hr />
<h2 id="errata-1"><a class="header" href="#errata-1">Errata</a></h2>
<!--
  Errata should be maintained after publication.

  1. **Transparency and Clarity**: An erratum acknowledges any corrections made post-publication, ensuring that readers are not misled and are always equipped with the most accurate information.

  2. **Accountability**: By noting errors openly, we maintain a high level of responsibility and ownership over our content. It’s an affirmation that we value precision and are ready to correct oversights.

  Each erratum should briefly describe the discrepancy and the correction made, accompanied by a reference to the date and version of the proposal in which the error was identified.

  TODO: Maintain this comment.
-->
<hr />
<h2 id="appendix-4"><a class="header" href="#appendix-4">Appendix</a></h2>
<!--
  The Appendix should contain an enumerated list of reference materials and notes.

  When referenced elsewhere each appendix should be called out with [A<number>](#A<number>) and should have a matching header.

  TODO: Remove this comment before finalizing.

-->
<hr />
<h2 id="copyright-1"><a class="header" href="#copyright-1">Copyright</a></h2>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="mip-18-stage-0-upgradeability-and-multisigs"><a class="header" href="#mip-18-stage-0-upgradeability-and-multisigs">MIP-18: Stage 0 Upgradeability and Multisigs</a></h1>
<ul>
<li><strong>Description</strong>: Proposal to establish two multisigs, one for engineers and another for the foundation, to facilitate the deployment and upgrade of the Movement Token (MOVEToken) and other upgradeable contracts.</li>
<li><strong>Authors</strong>: <a href="mailto:primata@movementlabs.xyz">Primata</a></li>
<li><strong>Desiderata</strong>:</li>
</ul>
<h2 id="abstract-5"><a class="header" href="#abstract-5">Abstract</a></h2>
<p>MIP-18 advocates for the creation of two multisigs: one managed by Core Contributors engineers to propose contract upgrades and another managed by the Movement Foundation to execute them. This proposal enables testing of multisig services while ensuring secure and transparent upgrade processes for the Movement Token. The multisigs will be deployed on Ethereum, Sepolia, and Holesky (if available) networks.</p>
<h2 id="motivation-5"><a class="header" href="#motivation-5">Motivation</a></h2>
<p>There is an immediate need to deploy the Movement Token (MOVEToken) using a robust, secure, and auditable upgrade mechanism. By creating two multisigs—one for proposal and one for execution—we ensure a transparent and decentralized governance process over upgrades to critical contracts.</p>
<p>The first multisig allows Core Contributors engineers to propose upgrades via Safe’s multisig service. A remote key will automate the population of upgrade proposals. The second multisig, held by the Movement Foundation, will be responsible for executing the scheduled upgrades after a time delay, ensuring community trust and review.</p>
<p>Also, while developing an independent multisig, handling signature showed to be an issue that might be indicative of better letting signature to be handled by safe.global.</p>
<h2 id="specification-5"><a class="header" href="#specification-5">Specification</a></h2>
<h3 id="multisig-setup"><a class="header" href="#multisig-setup">Multisig Setup</a></h3>
<ol>
<li>
<p><strong>Core Contributors Multisig</strong> (4/5 signatures required):</p>
<ul>
<li>Role: Proposing upgrades.</li>
<li>Addresses: [redacted], sep:0x493516F6dB02c9b7f649E650c5de244646022Aa0.</li>
<li>Justification: We leave some wiggle room incase one of the engineers is away. We still need 3/4 engineers to sign.</li>
</ul>
</li>
<li>
<p><strong>Movement Foundation Multisig</strong> (3/5 signatures required, triggerable after 2-day timelock):</p>
<ul>
<li>Role: Executing upgrades.</li>
<li>Addresses: [redacted], sep:0x00db70A9e12537495C359581b7b3Bc3a69379A00.</li>
</ul>
</li>
<li>
<p><strong>Deployer Multisig</strong> (1/2 signatures required):</p>
<ul>
<li>Role: Deploy contracts.</li>
<li>Addresses: [redacted].</li>
</ul>
</li>
</ol>
<p>Both multisigs are part of a timelock mechanism to enforce a 2-day waiting period between the proposal and execution of upgrades. The engineers’ multisig schedules the upgrade, while the foundation multisig executes it after the timelock expires.</p>
<h3 id="workflow"><a class="header" href="#workflow">Workflow</a></h3>
<p><img src="Review/primata/mip-18/MIP/mip-18/workflow.png" alt="Workflow" /></p>
<ol>
<li>
<p><strong>Deployment</strong>:</p>
<ul>
<li>The Contract Pipeline deploys a new contract implementation and generates transaction data for the upgrade.</li>
</ul>
</li>
<li>
<p><strong>Proposal</strong>:</p>
<ul>
<li>The remote key automates the submission of a transaction proposal using SafeKit API’s <code>proposeTransaction</code>, populating the transaction for review by Core Contributors engineers.</li>
<li>The proposal includes the transaction for <code>timelock.schedule(proxyAdmin.upgradeAndCall(newContractImplementation))</code>.</li>
</ul>
</li>
<li>
<p><strong>Approval</strong>:</p>
<ul>
<li>The Core Contributors engineers review and gather 4/5 signatures to approve the proposal.</li>
<li>Once approved, the <code>timelock.schedule</code> transaction is enacted, holding the upgrade in a 2-day timelock.</li>
</ul>
</li>
<li>
<p><strong>Execution</strong>:</p>
<ul>
<li>After the timelock period, the Movement Foundation multisig gathers 3/5 signatures to execute the upgrade.</li>
<li>This triggers the <code>timelock.execute</code> transaction, allowing the upgrade to be applied to the ProxyAdmin, which will perform the contract upgrade.</li>
</ul>
</li>
</ol>
<h3 id="multisig-security-considerations"><a class="header" href="#multisig-security-considerations">Multisig Security Considerations</a></h3>
<ul>
<li>Believe it is best practice to rely on a service that is fully dedicated to multisigs. Eventual exploits found might open us up to exploits while safe.global could’ve prevent the exploit for us.</li>
<li>Having full control of our multisig deployments is dangerous and more engineering debt.</li>
<li>Having manual verification might stop us from automating a exploit that we did not notice.</li>
<li>Both multisigs serve as a dual signing authorities, ensuring a strict separation between proposing and executing transactions.</li>
<li>The timelock ensures a sufficient review window for all parties, with the ability for either multisig to cancel the transaction during the delay period.</li>
<li>Multisig can fully transition to a fully automated KMS setup once we have that in place. MOVE Token deployment did not follow all procedures, dependency contracts were deployed by an EOA.</li>
<li>Movement Foundation Safe will have ownership of Token Upgradeability - as far as I understood, please correct me if I’m wrong.</li>
</ul>
<h2 id="reference-implementation-4"><a class="header" href="#reference-implementation-4">Reference Implementation</a></h2>
<p>The multisigs will be deployed using the Safe global multisig service, with contracts interacting through the SafeKit API. The remote key will automate transaction proposals for review by Core Contributors engineers.</p>
<h2 id="verification-5"><a class="header" href="#verification-5">Verification</a></h2>
<ol>
<li>
<p><strong>Correctness</strong>:<br />
This MIP follows the Safe multisig architecture, which has been extensively vetted in decentralized governance.</p>
</li>
<li>
<p><strong>Security Implications</strong>:</p>
<ul>
<li>A remote key introduces automation but requires careful monitoring to prevent unauthorized transactions.</li>
<li>The separation of proposal and execution roles reduces the risk of unilateral decision-making.</li>
<li>If any of the keys part of each multisig are compromised, we must quickly remove it and substitute it with another key.</li>
</ul>
</li>
<li>
<p><strong>Performance Impacts</strong>:</p>
<ul>
<li>The additional timelock delay adds a slight performance lag but is necessary to enhance the security and transparency of upgrades.</li>
<li>Upgrades should not be periodic. This means that manual procedures might be more interesting than full automation.</li>
</ul>
</li>
<li>
<p><strong>Validation Procedures</strong>:</p>
<ul>
<li>The Safe multisig service and timelock mechanisms have been validated by various communities in the Ethereum ecosystem.</li>
<li>It’s not possible to fully automate this service because Movement Founadtion will always require the final signatures.</li>
</ul>
</li>
<li>
<p><strong>Peer Review and Community Feedback</strong>:<br />
Current Governance proposals have indicated that we should have full automation and no access to signing keys. Currently we are a bit far from achieving full automation.</p>
</li>
</ol>
<h2 id="errata-2"><a class="header" href="#errata-2">Errata</a></h2>
<p>Any post-publication corrections or updates to this MIP will be documented here to maintain transparency and accuracy.</p>
<h2 id="appendix-5"><a class="header" href="#appendix-5">Appendix</a></h2>
<ul>
<li>[R1] Safe Multisig: https://safe.global/</li>
<li>[R2] SafeKit API Documentation: https://docs.safe.global/sdk/api-kit</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="mip-19-calculation-of-gas-fees"><a class="header" href="#mip-19-calculation-of-gas-fees">MIP-19: Calculation of gas fees</a></h1>
<ul>
<li><strong>Description</strong>: How to calculate gas fees for transactions on Movement L2.</li>
<li><strong>Authors</strong>: <a href="mailto:franck.cassez@movementlabs.xyz">Franck Cassez</a></li>
</ul>
<h2 id="abstract-6"><a class="header" href="#abstract-6">Abstract</a></h2>
<p>This MIP describes the structure of the gas fees and overall resource consumption needed to execute, and post a transaction to the DA/L1.</p>
<h2 id="motivation-6"><a class="header" href="#motivation-6">Motivation</a></h2>
<p>The transaction fees on L2s are multi-dimensional [<a href="Review/gas-fee-calculation/MIP/mip-19/index.html#ref-9">9</a>, <a href="Review/gas-fee-calculation/MIP/mip-19/index.html#ref-10">10</a>]. They comprise of <em>execution fees</em>, <em>settlement fees</em> and <em>data availability fees</em>.
This MIP describes what the different types of fees are, and how the transaction fees can be computed.</p>
<h2 id="scope-of-this-mip"><a class="header" href="#scope-of-this-mip">Scope of this MIP</a></h2>
<p>This MIP applies to costs/fees <strong>related to executing Move bytecode</strong>.</p>
<blockquote>
<p>[!WARNING]
It does not cover the extended future framework where EVM bytecode can be executed on a Movement chain.</p>
</blockquote>
<p>Although the costs (in terms of resources consumption) are expressed in gas units when executing Move and EVM bytecode, the gas units are <strong>not comparable</strong>, e.g. the minimum gas for an EVM transaction is 21000 gas units, whereas for Move-Aptos it is 700 gas units. As a result designing a fee mechanism for Movement chains that support Move and EVM bytecodes will require some careful adjustments and analysis of the different fee structures (Move and EVM).</p>
<blockquote>
<p>[!WARNING]
This MIP does not cover <em>staking</em> (and slashing and rewards) for validators.</p>
</blockquote>
<h2 id="fee-structure"><a class="header" href="#fee-structure">Fee structure</a></h2>
<p>The processing costs on rollups [<a href="Review/gas-fee-calculation/MIP/mip-19/index.html#ref-1">1</a> - <a href="Review/gas-fee-calculation/MIP/mip-19/index.html#ref-6">6</a>] are  <a href="https://medium.com/offchainlabs/understanding-arbitrum-2-dimensional-fees-fd1d582596c9">multi-dimensional</a>. The cost of processing a transaction on a Movement chain consists of:</p>
<ol>
<li><strong>execution</strong> fees: the costs that correspond to resources usage, CPU and permanent storage.</li>
<li><strong>data availability</strong> fees: the costs of publishing transactions/blocks data to a <em>data availability layer</em>.</li>
<li><strong>settlement</strong> fees: the costs of <em>validating</em> a transaction (e.g. zk-proof generation and verification, validators attestations.)</li>
</ol>
<p>Overall the transaction fees are defined by the sum of three types of fees:</p>
<p><span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mord mathnormal">x</span><span class="mord mathnormal">ec</span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mord mathnormal">ees</span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mord mathnormal">ees</span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.13889em;">tlF</span><span class="mord mathnormal">ees</span></span><span class="mpunct"><span class="mord">.</span></span></span></span></span></span></p>
<p>The fees should be expressed in a single (crypto)-currency, e.g. USD, or a token <code>$APT</code>, <code>$MOVE</code>, <code>$ETH</code>.</p>
<h3 id="execution"><a class="header" href="#execution">Execution</a></h3>
<h4 id="movevm-execution-fees"><a class="header" href="#movevm-execution-fees">MoveVM execution fees</a></h4>
<p>To execute a transaction and store the result, the operator of the chain uses some hardware: CPU and disk storage. The <strong>execution</strong> fees represent the compensation of the operator for executing a transaction.</p>
<p>Movement Network uses Aptos-Move as the execution layer and the execution fees for Aptos-Move are defined in the Aptos documentation <a href="https://aptos.dev/en/network/blockchain/gas-txn-fee">Gas and storage fees</a>.
The Aptos-Move fee mechanism splits the execution fees in two parts:</p>
<ul>
<li>CPU and IO operations, expressed in gas units;</li>
<li>permanent storage, expressed in <code>$APT</code>.</li>
</ul>
<p>CPU and IO operations for a transaction <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">t</span><span class="mord mathnormal">x</span></span></span></span> result in a number of gas units <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">Cp</span><span class="mord mathnormal">u</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord mathnormal">o</span><span class="mord mathnormal">G</span><span class="mord mathnormal">a</span><span class="mord mathnormal">s</span><span class="mopen">(</span><span class="mord mathnormal">t</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span>, and the corresponding fees are computing using a <em>gas price</em> <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">G</span><span class="mord mathnormal">a</span><span class="mord mathnormal">s</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">i</span><span class="mord mathnormal">ce</span></span></span></span> expressed in the gas token (<code>$APT</code> for Aptos-Move). A transaction specifies the value <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">G</span><span class="mord mathnormal">a</span><span class="mord mathnormal">s</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">i</span><span class="mord mathnormal">ce</span><span class="mopen">(</span><span class="mord mathnormal">t</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span> it is willing to pay.<br />
The value <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">G</span><span class="mord mathnormal">a</span><span class="mord mathnormal">s</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">i</span><span class="mord mathnormal">ce</span><span class="mopen">(</span><span class="mord mathnormal">t</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span> must not be lower than a minimum <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">G</span><span class="mord mathnormal">a</span><span class="mord mathnormal">s</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">i</span><span class="mord mathnormal">ce</span></span></span></span>, which may fluctuate depending on network contention, and may be updated frequently (e.g. after each block).</p>
<p>In contrast, the permanent storage fees are designed to be stable and are updated infrequently. The reasoning is that they depend on how much storage costs (hardware, disks) and with advancement in technology this should go down in the future. The storage fees for <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">t</span><span class="mord mathnormal">x</span></span></span></span> are denoted <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">St</span><span class="mord mathnormal">ore</span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mord mathnormal">ees</span><span class="mopen">(</span><span class="mord mathnormal">t</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span> and expressed in <code>$APT</code><sup class="footnote-reference"><a href="#3">1</a></sup>.</p>
<p>The fees that correspond to the permanent storage are <strong>converted to gas units</strong> using the  <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">G</span><span class="mord mathnormal">a</span><span class="mord mathnormal">s</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">i</span><span class="mord mathnormal">ce</span></span></span></span> and the <code>$APT</code> price.</p>
<p>The <em>total charge in gas units</em> for a transaction is the defined by:</p>
<p><span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mord mathnormal">o</span><span class="mord mathnormal">t</span><span class="mord mathnormal">a</span><span class="mord mathnormal">lG</span><span class="mord mathnormal">a</span><span class="mord mathnormal">s</span><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="mord mathnormal">ni</span><span class="mord mathnormal">t</span><span class="mord mathnormal">s</span><span class="mopen">(</span><span class="mord mathnormal">t</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">Cp</span><span class="mord mathnormal">u</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord mathnormal">o</span><span class="mord mathnormal">G</span><span class="mord mathnormal">a</span><span class="mord mathnormal">s</span><span class="mopen">(</span><span class="mord mathnormal">t</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">St</span><span class="mord mathnormal">ore</span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mord mathnormal">ees</span><span class="mopen">(</span><span class="mord mathnormal">t</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mord">/</span><span class="mord mathnormal">G</span><span class="mord mathnormal">a</span><span class="mord mathnormal">s</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">i</span><span class="mord mathnormal">ce</span><span class="mopen">(</span><span class="mord mathnormal">t</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span></span></p>
<p>and the total transaction fees are approximately<sup class="footnote-reference"><a href="#1">2</a></sup>:</p>
<p><span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mord mathnormal">x</span><span class="mord mathnormal">ec</span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mord mathnormal">ees</span><span class="mopen">(</span><span class="mord mathnormal">t</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mord mathnormal">o</span><span class="mord mathnormal">t</span><span class="mord mathnormal">a</span><span class="mord mathnormal">lG</span><span class="mord mathnormal">a</span><span class="mord mathnormal">s</span><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="mord mathnormal">ni</span><span class="mord mathnormal">t</span><span class="mord mathnormal">s</span><span class="mopen">(</span><span class="mord mathnormal">t</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">G</span><span class="mord mathnormal">a</span><span class="mord mathnormal">s</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">i</span><span class="mord mathnormal">ce</span><span class="mopen">(</span><span class="mord mathnormal">t</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mpunct"><span class="mord">.</span></span></span></span></span></span></p>
<blockquote>
<p>[!WARNING]
We may not use the <code>$APT</code> token value to compute the fees on Movement. If we do so the <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mord mathnormal">x</span><span class="mord mathnormal">ec</span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mord mathnormal">ees</span></span></span></span> will be identical to processing fees on Aptos-Move, and the total fees including <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mord mathnormal">ees</span></span></span></span> and <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.13889em;">tlF</span><span class="mord mathnormal">ees</span></span></span></span> will be higher than the processing fees on Aptos-Move, which may not be desirable.</p>
</blockquote>
<blockquote>
<p>[!TIP]
<strong>Proposal 1</strong>: use the <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mord mathnormal">o</span><span class="mord mathnormal">t</span><span class="mord mathnormal">a</span><span class="mord mathnormal">lG</span><span class="mord mathnormal">a</span><span class="mord mathnormal">s</span><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="mord mathnormal">ni</span><span class="mord mathnormal">t</span><span class="mord mathnormal">s</span><span class="mopen">(</span><span class="mord mathnormal">t</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span> and a <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">G</span><span class="mord mathnormal">a</span><span class="mord mathnormal">s</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">i</span><span class="mord mathnormal">ce</span></span></span></span> in <code>$MOVE</code> to compute the execution fees on a Movement chain.
This may require an oracle to get the exchange rate for <code>$APT</code>/<code>$MOVE</code>.</p>
</blockquote>
<h4 id="gas-price-adjustments"><a class="header" href="#gas-price-adjustments">Gas price adjustments</a></h4>
<p>We may also want to adjust the <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">G</span><span class="mord mathnormal">a</span><span class="mord mathnormal">s</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">i</span><span class="mord mathnormal">ce</span></span></span></span> (in <code>$MOVE</code>) to reflect our network load. There are many ways the <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">G</span><span class="mord mathnormal">a</span><span class="mord mathnormal">s</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">i</span><span class="mord mathnormal">ce</span></span></span></span> can be updated. On Ethereum it is governed by rules in <a href="https://eips.ethereum.org/EIPS/eip-1559">EIP-1559</a>. zkSync, Arbitrum and OP Mainnet use different strategies [<a href="Review/gas-fee-calculation/MIP/mip-19/index.html#ref-1">1</a>, <a href="Review/gas-fee-calculation/MIP/mip-19/index.html#ref-4">4</a>, <a href="Review/gas-fee-calculation/MIP/mip-19/index.html#ref-6">6</a>] to update the gas price.</p>
<blockquote>
<p>[!TIP]
<strong>Proposal 2</strong>: The OP Mainet [<a href="Review/gas-fee-calculation/MIP/mip-19/index.html#ref-1">1</a>] strategy seems to be the simplest one so we may implement this strategy first.</p>
</blockquote>
<h3 id="data-availability-fees"><a class="header" href="#data-availability-fees">Data Availability fees</a></h3>
<p>On a rollup (L2), transactions are grouped in <em>batches</em>. Processing a batch result in a new <em>state</em>. Both the transactions data and the new state are published to the <em>data availability</em> (DA) layer. The reason is that they should be available for third-parties to retrieve and verify the correctness of the state transitions (and blocks).</p>
<p>We assume that the agreement with the DA provider is such that we pay a <strong>fixed</strong> amount, <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord mathnormal" style="margin-right:0.02778em;">er</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">i</span><span class="mord mathnormal">ce</span></span></span></span>, in USD, per bytes we publish to the DA layer.
This can be updated infrequently e.g. every 6 months or year.</p>
<blockquote>
<p>[!NOTE]
To reduce the costs, the data published to the DA layer can be compressed. This reduces the overall costs of publishing a batch (and a state) to the DA layer but makes it harder to identify the contribution of each transaction to the overall costs. OP Mainnet Ecotone has a <a href="https://docs.optimism.io/stack/transactions/fees#formula">formula</a> to try and weight the contribution of each transaction to the compressed data. It is unclear how well it works in practice.</p>
</blockquote>
<blockquote>
<p>[!TIP]
<strong>Proposal 3</strong>: If the cost of publishing a batch <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">b</span></span></span></span> to the DA is <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mord mathnormal">ees</span><span class="mopen">(</span><span class="mord mathnormal">b</span><span class="mclose">)</span></span></span></span>, and <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span> transactions are in the batch, the DA fees for each transaction are <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mord mathnormal">ees</span><span class="mopen">(</span><span class="mord mathnormal">b</span><span class="mclose">)</span><span class="mord">/</span><span class="mord mathnormal">n</span></span></span></span>. This is simple to implement and can be refined later if needed.</p>
</blockquote>
<h3 id="settlement-fees"><a class="header" href="#settlement-fees">Settlement Fees</a></h3>
<p>The settlement fees depend on a number of factors, and on the settlement mechanism used by a given Move Stack chain.
There is a common feature though: some data are posted to Ethereum mainnet, and the price of a transaction on Mainnet may fluctuate.</p>
<p>The difficulty is that we charge our users when we process a transaction on a Move Stack chain. At that time we don’t know the price of an Ethereum transaction to post our data because it will happen in the future when the transaction is included in a block. As a result we may have to use an oracle to provide an estimate of the (gas) price on Ethereum when our transaction is processed.</p>
<p>Another thing that is common to all the settlement mechanisms is that we have to publish a <em>commitment</em> to the states/blocks we produce.
This is usually done by publishing <em>state roots</em> (hashes of states).
There are two interfaces to publish data on Ethereum:</p>
<ul>
<li>transaction data, and</li>
<li>blobs.</li>
</ul>
<p>Blobs were introduced to lower the cost of L2s and offer temporary (18 days) data storage at low cost.
Blobs are limited in size to 128KB, and a maximum of 6 blobs per (Ethereum) block.</p>
<h4 id="fraud-proof-settlement"><a class="header" href="#fraud-proof-settlement">Fraud-proof settlement</a></h4>
<p>For a fraud-proof settlement mechanism, we have to publish the <em>state roots</em> of the blocks we produce, or the change sets (they may be smaller).<br />
The size of the state roots of change sets roots is known when we create a (l2) block, so we can determine the expected cost of publishing to Ethereum mainnet using an oracle for the Ethereum gas price.</p>
<h4 id="validity-proof-settlement"><a class="header" href="#validity-proof-settlement">Validity proof settlement</a></h4>
<p>In a validity proof settlement we have two sources of costs:</p>
<ol>
<li>the <em>proving</em> part, which is a task dedicated to provers (or a market thereof),</li>
<li>the <em>verification</em> part which is a transaction in Ethereum Mainnet.</li>
</ol>
<p>The second part is usually predicatable as the sizes of proofs are known for each zk-proof system, and the verification step is <em>efficient</em>.
The proving part is more complex to evaluate. The <a href="https://docs.zksync.io/zk-stack/concepts/fee-mechanism">zkSync –– Fee mechanism</a> [<a href="Review/gas-fee-calculation/MIP/mip-19/index.html#ref-4">4</a>] may be a useful reference to design an equivalent mechanism for Movement chains.</p>
<blockquote>
<p>[!WARNING]
Note that we first need a zkMoveVM to develop this approach.</p>
</blockquote>
<h4 id="fast-finality-settlement"><a class="header" href="#fast-finality-settlement">Fast-finality settlement</a></h4>
<p>In our network, we will offer <em>fast-finality settlement</em> (FFS) where <em>validators</em> verify state transitions (and blocks) and interact with a contract, <code>StakingK</code>, that may live<sup class="footnote-reference"><a href="#2">3</a></sup> on Ethereum mainnet.</p>
<p>The costs incurred by the validators plus the cost of posting the attestations to Ethereum mainnet have to be factored in into the <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.13889em;">tlF</span><span class="mord mathnormal">ees</span></span></span></span></span>.</p>
<blockquote>
<p>[!WARNING]
We have not finalised the FFS details yet so it may be premature to try and define fees for this mechanism. It also pertains to <em>staking</em> which is not fully fledged yet.</p>
</blockquote>
<blockquote>
<p>[!TIP]
<strong>Proposal 4</strong>: The simplest approach seems to implement a fraud-proof fee mechanism and publish state roots to Ethereum mainnet.</p>
</blockquote>
<h2 id="references"><a class="header" href="#references">References</a></h2>
<p><a id="ref-1">[1]</a> <a href="https://docs.optimism.io/stack/transactions/fees">Transaction fees on OP Mainnet</a>. Optimism Documentation.</p>
<p><a id="ref-2">[2]</a>   <a href="https://docs.sui.io/concepts/tokenomics/gas-pricing">Sui –– Gas Pricing</a>. Sui Documentation.</p>
<p><a id="ref-3">[3]</a>  <a href="https://aptos.dev/en/network/blockchain/gas-txn-fee">Gas and storage fees</a>. Aptos documentation.</p>
<p><a id="ref-4">[4]</a>  <a href="https://docs.zksync.io/zk-stack/concepts/fee-mechanism">zkSync –– Fee mechanism</a>. zkSync documentation.</p>
<p><a id="ref-1">[5]</a>  <a href="https://docs-v2.mantle.xyz/devs/concepts/tx-fee/overviews">Transaction fees on Mantle</a>. Mantle documentation.</p>
<p><a id="ref-6">[6]</a>   <a href="https://docs.arbitrum.io/how-arbitrum-works/gas-fees">Gas and Fees</a>. Arbitrum documentation.</p>
<!-- \[4\] Arbitrum. [L1 Pricing.](https://developer.arbitrum.io/arbos/l1-pricing)

\[5\] D. Goldman. Medium, July 1st, 2022. [Understanding Arbitrum 2-Dimensional Fees.](https://medium.com/offchainlabs/understanding-arbitrum-2-dimensional-fees-fd1d582596c9) -->
<!-- \[6\] DZack23. July 2022. [L1 calldata data pricing / Sequencer reimbursement, "Fee Pool" Model.](https://research.arbitrum.io/t/l1-calldata-data-pricing-sequencer-reimbursement-fee-pool-model/107)
 -->
<p><a id="ref-7">[7]</a>  <a href="https://eips.ethereum.org/EIPS/eip-1559">EIP-1559.</a></p>
<p><a id="ref-8">[8]</a>  Ethereum. <a href="https://ethereum.org/en/developers/docs/gas/#eip-1559">Gas and Fees.</a></p>
<p><a id="ref-9">[9]</a>  <a href="https://ethresear.ch/t/multidimensional-eip-1559/11651">Multi-dimensional EIP-1559.</a></p>
<p><a id="ref-10">[10]</a>  <a href="https://youtu.be/QbR4MTgnCko">Notes on multi-dimensional EIP-1559.</a></p>
<!-- \[11\] Optimism. [Bedrock Fees Dashboard.](https://dune.com/oplabspbc/optimism-bedrock-migration-impact-dashboard.) -->
<!-- \[12\] Arbitrum Nitro. [Fees Dashboard.](https://dune.com/taem/arbitrum-gas-fee)

\[13\] [EigenLayer.](https://www.eigenlayer.xyz)

\[14\] Ethereum. [Scaling.](https://ethereum.org/pt/roadmap/scaling/)
 -->
<hr />
<div class="footnote-definition" id="1"><sup class="footnote-definition-label">2</sup>
<p>There is another <em>refund</em> component in the Aptos-Move fee statement that we ignore here.</p>
</div>
<div class="footnote-definition" id="2"><sup class="footnote-definition-label">3</sup>
<p>We may be able to have the quorum verification function in a Movement contract which would reduce the costs.</p>
</div>
<div class="footnote-definition" id="3"><sup class="footnote-definition-label">1</sup>
<p>It looks like the actual currency used to express this fee is a stable currency like USD. It can be converted to <code>$APT</code> using an oracle.</p>
</div>
<hr />
<h2 id="copyright-2"><a class="header" href="#copyright-2">Copyright</a></h2>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="mip-24-removal-of-redundant-functionality-from-framework"><a class="header" href="#mip-24-removal-of-redundant-functionality-from-framework">MIP-24: Removal of redundant functionality from framework</a></h1>
<ul>
<li><strong>Description</strong>: The removal of redundant modules from the movement branch of the aptos-core fork</li>
<li><strong>Authors</strong>: <a href="mailto:andy.bell@movementlabs.xyz">Andy Bell</a></li>
<li><strong>Desiderata</strong>: <a href="Review/andyjsbell/unwanted-framework/MIP/mip-24/../MD/md-0">MD-0</a></li>
</ul>
<h2 id="abstract-7"><a class="header" href="#abstract-7">Abstract</a></h2>
<p>The use of Movement’s fork of aptos core for the Movement Network is a subset of its total.  There are significant areas in this repository which are not used from a node, tooling and framework perspective.  Due to the size of the repository this MIP will only consider the redundancy inherited from the aptos framework.</p>
<h2 id="motivation-7"><a class="header" href="#motivation-7">Motivation</a></h2>
<p>With the Movement network only using a subset Movement’s fork of aptos core we are introducing technical debt and opening the framework to attack vectors for functionality not used in the context of Movement’s network fork.  Large areas of code can be removed to alleviate this issue and provide more security assurances</p>
<h2 id="specification-6"><a class="header" href="#specification-6">Specification</a></h2>
<p>With closer inspection of the Movement fork of aptos core we are able to quickly identify areas of functionality that are not required in the context of the Movement network.  The following would be modules which would be strong candidates to be removed.</p>
<ul>
<li>
<p><code>aptos_governance.move</code> https://github.com/movementlabsxyz/aptos-core/blob/70be3926ff79ff4cdb0cee928f717fafcd41ecdd/aptos-move/framework/aptos-framework/sources/aptos_governance.move</p>
</li>
<li>
<p><code>aptos_governance.spec.move</code> https://github.com/movementlabsxyz/aptos-core/blob/70be3926ff79ff4cdb0cee928f717fafcd41ecdd/aptos-move/framework/aptos-framework/sources/aptos_governance.spec.move</p>
</li>
<li>
<p><code>governance_proposal.move</code> https://github.com/movementlabsxyz/aptos-core/blob/70be3926ff79ff4cdb0cee928f717fafcd41ecdd/aptos-move/framework/aptos-framework/sources/governance_proposal.move</p>
</li>
<li>
<p><code>governance_proposal.spec.move</code> https://github.com/movementlabsxyz/aptos-core/blob/70be3926ff79ff4cdb0cee928f717fafcd41ecdd/aptos-move/framework/aptos-framework/sources/governance_proposal.spec.move</p>
</li>
<li>
<p><code>delegation_pool.move</code> https://github.com/movementlabsxyz/aptos-core/blob/70be3926ff79ff4cdb0cee928f717fafcd41ecdd/aptos-move/framework/aptos-framework/sources/delegation_pool.move</p>
</li>
<li>
<p><code>delegation_pool.spec.move</code> https://github.com/movementlabsxyz/aptos-core/blob/70be3926ff79ff4cdb0cee928f717fafcd41ecdd/aptos-move/framework/aptos-framework/sources/delegation_pool.spec.move</p>
</li>
<li>
<p><code>stake.move</code> https://github.com/movementlabsxyz/aptos-core/blob/70be3926ff79ff4cdb0cee928f717fafcd41ecdd/aptos-move/framework/aptos-framework/sources/stake.move</p>
</li>
<li>
<p><code>stake.spec.move</code> https://github.com/movementlabsxyz/aptos-core/blob/70be3926ff79ff4cdb0cee928f717fafcd41ecdd/aptos-move/framework/aptos-framework/sources/stake.spec.move</p>
</li>
<li>
<p><code>staking_contract.move</code> https://github.com/movementlabsxyz/aptos-core/blob/70be3926ff79ff4cdb0cee928f717fafcd41ecdd/aptos-move/framework/aptos-framework/sources/staking_contract.move</p>
</li>
<li>
<p><code>staking_contract.spec.move</code> https://github.com/movementlabsxyz/aptos-core/blob/70be3926ff79ff4cdb0cee928f717fafcd41ecdd/aptos-move/framework/aptos-framework/sources/staking_contract.spec.move</p>
</li>
<li>
<p><code>staking_proxy.move</code> https://github.com/movementlabsxyz/aptos-core/blob/70be3926ff79ff4cdb0cee928f717fafcd41ecdd/aptos-move/framework/aptos-framework/sources/staking_proxy.move</p>
</li>
<li>
<p><code>staking_proxy.spec.move</code> https://github.com/movementlabsxyz/aptos-core/blob/70be3926ff79ff4cdb0cee928f717fafcd41ecdd/aptos-move/framework/aptos-framework/sources/staking_proxy.spec.move</p>
</li>
<li>
<p><code>validator_consensus_info.move</code> https://github.com/movementlabsxyz/aptos-core/blob/70be3926ff79ff4cdb0cee928f717fafcd41ecdd/aptos-move/framework/aptos-framework/sources/validator_consensus_info.move</p>
</li>
<li>
<p><code>validator_consensus_info.spec.move</code> https://github.com/movementlabsxyz/aptos-core/blob/70be3926ff79ff4cdb0cee928f717fafcd41ecdd/aptos-move/framework/aptos-framework/sources/validator_consensus_info.spec.move</p>
</li>
<li>
<p><code>vesting.move</code> https://github.com/movementlabsxyz/aptos-core/blob/70be3926ff79ff4cdb0cee928f717fafcd41ecdd/aptos-move/framework/aptos-framework/sources/vesting.move</p>
</li>
<li>
<p><code>vesting.spec.move</code> https://github.com/movementlabsxyz/aptos-core/blob/70be3926ff79ff4cdb0cee928f717fafcd41ecdd/aptos-move/framework/aptos-framework/sources/vesting.spec.move</p>
</li>
<li>
<p><code>sources/voting.move</code> https://github.com/movementlabsxyz/aptos-core/blob/70be3926ff79ff4cdb0cee928f717fafcd41ecdd/aptos-move/framework/aptos-framework/sources/voting.move</p>
</li>
<li>
<p><code>voting.spec.move</code> https://github.com/movementlabsxyz/aptos-core/blob/70be3926ff79ff4cdb0cee928f717fafcd41ecdd/aptos-move/framework/aptos-framework/sources/voting.spec.move</p>
</li>
</ul>
<p>The initialisation and functioning of these modules are coupled with the VM directly and hence would require decoupling of this functionality at the VM level.</p>
<h2 id="reference-implementation-5"><a class="header" href="#reference-implementation-5">Reference Implementation</a></h2>
<h2 id="verification-6"><a class="header" href="#verification-6">Verification</a></h2>
<p>With the removal of these modules we would expect the tests for Node, VM and framework would pass</p>
<h2 id="errata-3"><a class="header" href="#errata-3">Errata</a></h2>
<h2 id="appendix-6"><a class="header" href="#appendix-6">Appendix</a></h2>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="mip-25-proxy-aptos-framework-for-stage-0-governance"><a class="header" href="#mip-25-proxy-aptos-framework-for-stage-0-governance">MIP-25: Proxy Aptos Framework for Stage 0 governance</a></h1>
<ul>
<li><strong>Description</strong>: Proxy Aptos Framework signing for stage 0 of the Movement network governance</li>
<li><strong>Authors</strong>: <a href="mailto:andy.bell@movementlabs.xyz">Andy Bell</a></li>
<li><strong>Desiderata</strong>: <a href="Review/andyjsbell/proxy-root/MIP/mip-25/../MD/md-0">MD-0</a></li>
</ul>
<h2 id="abstract-8"><a class="header" href="#abstract-8">Abstract</a></h2>
<p>This MIP describes a means by which during Stage 0 of the Movement network a signing key, single or multi, is able to manage the Aptos Framework without relying on the governance module included in the Aptos Framework.  This facilitating a more agile method in which Aptos Framework updates and modifications can be executed rapidly during this stage of the network.  This method would be deprecated in favour of decentralized governance in the future.</p>
<h2 id="motivation-8"><a class="header" href="#motivation-8">Motivation</a></h2>
<p>During Stage 0 of the Movement network Movement Labs would hold centralized control of the node and Aptos Framework.  In order to update or modify the Aptos Framework this would involve the deployment of new node binaries to operators in the network who would then upgrade.  One option to facilitate Aptos Framework upgrades is the use of the governance module which forms part of the Aptos Framework.  This, however, is not optimal for stage 0 of the network and the proposal here is to include a new module in the framework which proxies functions executed with the priviledges of the Aptos Framework.  Following a similiar strategy as the governance module but allowing voting to be circumvented with the use of a trusted multisig wallet held and managed by Movement Labs.</p>
<h2 id="specification-7"><a class="header" href="#specification-7">Specification</a></h2>
<ol>
<li>The Proxy module MUST be made available as part of the Aptos Framework.</li>
<li>A single or multi-signature MUST be required to temporarily acquire the signing privileges of the Aptos Framework.</li>
<li>Only one authorized key MUST be able to operate the Proxy module and acquire the signing privileges.</li>
<li>The controller key MUST be rotated, and the Proxy module MUST provide functionality to support key rotation.</li>
<li>Updates to the framework MUST use a Move script signed by the controller account to acquire the signing privileges of the Aptos Framework during the script’s execution.</li>
<li>The controller account SHOULD be multisig, and this MUST be a strict requirement for the Proxy module. For testing purposes, this requirement MAY be relaxed to allow a single account.</li>
<li>The Proxy module MUST allow the controller to remove the signing capabilities and render the module inoperable.  This MUST allow an upgrade path to a new governance like module.  This MUST be an irreversible action.</li>
</ol>
<h2 id="reference-implementation-6"><a class="header" href="#reference-implementation-6">Reference Implementation</a></h2>
<pre><code class="language-rust">module aptos_framework::proxy {
    use std::hash::sha3_256;
    use std::signer;
    use std::vector;
    use aptos_std::smart_table;
    use aptos_std::smart_table::SmartTable;
    use aptos_framework::account::{create_signer_with_capability, SignerCapability};
    use aptos_framework::aptos_coin::AptosCoin;
    use aptos_framework::coin;
    use aptos_framework::coin::Coin;
    use aptos_framework::event;
    use aptos_framework::system_addresses;
    use aptos_framework::transaction_context;
    use aptos_std::ed25519;
    use aptos_std::from_bcs;
    use aptos_framework::timestamp::now_seconds;

    friend aptos_framework::genesis;

    struct ProxyController has key {
        controller: address,
        next_proposal_id: u64,
        proposals: SmartTable&lt;u64, Proposal&gt;,
        nonce: u64,
    }

    struct ProxySignerCapabilities has key {
        aptos_framework_signer_cap: SignerCapability,
    }

    struct Proposal has store {
        creator: address,
        execution_hash: vector&lt;u8&gt;,
        stake: Coin&lt;AptosCoin&gt;,
        approved: bool,
        expiration: u64,
    }

    #[event]
    struct ProposalCreated has store, drop {
        creator: address,
        proposal_id: u64
    }

    #[event]
    struct ProposalRejected has store, drop {
        proposal_id: u64,
    }

    #[event]
    struct ProposalApproved has store, drop {
        proposal_id: u64,
    }

    #[event]
    struct ProposalRemoved has store, drop {
        proposal_id: u64,
    }

    const EINVALID_CONTROLLER : u64 = 0x1;
    const ENOT_APPROVED : u64 = 0x2;
    const EEXECUTION_HASH_INVALID : u64 = 0x3;
    const ENONCE_MISMATCH : u64 = 0x4;
    const EINVALID_SIGNATURE : u64 = 0x5;
    const EINVALID_CHALLENGE : u64 = 0x5;
    const EPROPOSAL_TIMEOUT : u64 = 0x6;
    const ENOT_CREATOR : u64 = 0x7;
    const EAPPROVED : u64 = 0x8;

    const PROPOSAL_LENGTH_IN_SECS : u64 = 2 * 24 * 60 * 60;

    #[event]
    /// An event triggered when the controller is updated
    struct ControllerUpdated has store, drop {
        old_controller: address,
        new_controller: address,
    }

    /// Only called during genesis.
    public(friend) fun initialize(aptos_framework: &amp;signer, aptos_framework_signer_cap: SignerCapability) {
        system_addresses::assert_aptos_framework(aptos_framework);

        move_to(
            aptos_framework,
            ProxyController {
                controller: @aptos_framework,
                next_proposal_id: 1,
                proposals: smart_table::new(),
                nonce: 0,
            }
        );

        move_to(
            aptos_framework,
            ProxySignerCapabilities {
                aptos_framework_signer_cap,
            }
        )
    }

    /// Destroy the proxy and release SignerCapability to the caller
    /// The controller is voided with 0xdead as the new controlling address.
    /// Warning from this point the proxy module will be inoperable
    public fun destroy(caller: &amp;signer) : SignerCapability acquires ProxySignerCapabilities, ProxyController {
        let proxy_controller = borrow_global_mut&lt;ProxyController&gt;(@aptos_framework);
        assert!(signer::address_of(caller) == proxy_controller.controller, EINVALID_CONTROLLER);
        proxy_controller.controller = @0xdead;

        let ProxySignerCapabilities {
            aptos_framework_signer_cap
        } = move_from&lt;ProxySignerCapabilities&gt;(@aptos_framework);

        aptos_framework_signer_cap
    }

    /// Update the controller of the proxy. Requires signature over challenge which is at the moment an abitrary vector
    /// of bytes with a length of 32
    /// Aborts if signed by anyone else except the controller or @aptos_framework
    /// Aborts if nonce invalid
    /// Aborts etc
    /// Emits an event on updating the controller
    public fun update_controller(signer: &amp;signer,
                                 new_controller_pubkey: vector&lt;u8&gt;,
                                 new_controller_signature: vector&lt;u8&gt;,
                                 challenge: vector&lt;u8&gt;,
                                 provided_nonce: u64
    ) acquires ProxyController {
        let proxy_controller = borrow_global_mut&lt;ProxyController&gt;(@aptos_framework);

        assert!(
            proxy_controller.controller == signer::address_of(signer),
            EINVALID_CONTROLLER
        );

        assert!(
            provided_nonce == proxy_controller.nonce,
            ENONCE_MISMATCH
        );

        let new_controller = sha3_256(new_controller_pubkey);

        let public_key = ed25519::new_unvalidated_public_key_from_bytes(new_controller_pubkey);
        let signature = ed25519::new_signature_from_bytes(new_controller_signature);
        assert!(
            ed25519::signature_verify_strict_t(&amp;signature, &amp;public_key, challenge),
            EINVALID_SIGNATURE
        );

        assert!(
            vector::length(&amp;challenge) == 32,
            EINVALID_CHALLENGE
        );

        let new_controller = from_bcs::to_address(new_controller);
        let old_controller = proxy_controller.controller;
        proxy_controller.controller = new_controller;

        proxy_controller.nonce = proxy_controller.nonce + 1;

        event::emit(
            ControllerUpdated {
                old_controller,
                new_controller,
            },
        );
    }

    /// Propose a script to be executed providing its hash and a stake
    /// Stake is returned on approval and execution or rejection
    public entry fun propose(caller: &amp;signer, execution_hash: vector&lt;u8&gt;) acquires ProxyController {
        let proxy_controller = borrow_global_mut&lt;ProxyController&gt;(@aptos_framework);
        let stake: Coin&lt;AptosCoin&gt; = coin::withdraw&lt;AptosCoin&gt;(caller, 10_000_000);

        let creator = signer::address_of(caller);
        let proposal_id = proxy_controller.next_proposal_id;
        let proposal = Proposal {
            creator,
            execution_hash,
            stake,
            approved: false,
            expiration: now_seconds() + PROPOSAL_LENGTH_IN_SECS,
        };

        proxy_controller.next_proposal_id = proxy_controller.next_proposal_id + 1;

        smart_table::add(&amp;mut proxy_controller.proposals, proposal_id, proposal);

        event::emit(ProposalCreated {
            creator,
            proposal_id,
        });
    }

    /// Approve proposal
    public entry fun approve(caller: &amp;signer, proposal_id: u64) acquires ProxyController {
        let proxy_controller = borrow_global_mut&lt;ProxyController&gt;(@aptos_framework);
        assert!(signer::address_of(caller) == proxy_controller.controller, EINVALID_CONTROLLER);
        let proposal = smart_table::borrow_mut(&amp;mut proxy_controller.proposals, proposal_id);
        assert!(now_seconds() &lt; proposal.expiration, EPROPOSAL_TIMEOUT);
        proposal.approved = true;

        event::emit(ProposalApproved {
            proposal_id,
        });
    }

    /// Remove proposal to be called by the creator of the proposal and only after the proposal has expired and has not
    /// been approved
    public entry fun remove(caller: &amp;signer, proposal_id: u64) acquires ProxyController {
        let proxy_controller = borrow_global_mut&lt;ProxyController&gt;(@aptos_framework);
        let Proposal {
            creator,
            execution_hash: _,
            stake,
            approved,
            expiration,
        } = smart_table::remove(&amp;mut proxy_controller.proposals, proposal_id);

        assert!(creator == signer::address_of(caller), ENOT_CREATOR);
        assert!(approved == false, EAPPROVED);
        assert!(expiration &lt; now_seconds(), EPROPOSAL_TIMEOUT);

        coin::deposit(creator, stake);
        event::emit(ProposalRemoved {
            proposal_id,
        });
    }

    /// Reject proposal
    public entry fun reject(caller: &amp;signer, proposal_id: u64) acquires ProxyController {
        let proxy_controller = borrow_global_mut&lt;ProxyController&gt;(@aptos_framework);
        assert!(signer::address_of(caller) == proxy_controller.controller, EINVALID_CONTROLLER);

        let Proposal {
            creator,
            execution_hash: _,
            stake,
            approved,
            expiration,
        } = smart_table::remove(&amp;mut proxy_controller.proposals, proposal_id);

        assert!(approved == false, EAPPROVED);
        assert!(expiration &lt; now_seconds(), EPROPOSAL_TIMEOUT);

        coin::deposit(creator, stake);
        event::emit(ProposalRejected {
            proposal_id,
        });
    }

    /// Delegate Aptos Framework's signing cap to proxy providing proposal id for approved proposal and calling from
    /// the proposed script
    public fun delegate_to_proxy(proposal_id: u64) : signer acquires ProxyController, ProxySignerCapabilities {
        let proxy_controller = borrow_global_mut&lt;ProxyController&gt;(@aptos_framework);

        let Proposal {
            creator,
            execution_hash,
            stake,
            approved,
            expiration: _,
        } = smart_table::remove(&amp;mut proxy_controller.proposals, proposal_id);

        assert!(approved, ENOT_APPROVED);
        assert!(transaction_context::get_script_hash() == execution_hash, EEXECUTION_HASH_INVALID);

        let aptos_framework_signer_cap = &amp;borrow_global&lt;ProxySignerCapabilities&gt;(@aptos_framework).aptos_framework_signer_cap;
        coin::deposit(creator, stake);
        create_signer_with_capability(aptos_framework_signer_cap)
    }

    #[view]
    /// Return the controller of the proxy
    public fun get_controller(): address acquires ProxyController {
        borrow_global&lt;ProxyController&gt;(@aptos_framework).controller
    }
}</code></pre>
<p><strong>Steps:</strong></p>
<ol>
<li>Create the Move script you want to execute.  An example can be found below.</li>
<li>With the hash of the script call <code>proxy::propose(execution_hash)</code> to initiate the request to proxy the script providing a refundable stake.  An off chain mechanism would track the newly created <code>proposal_id</code></li>
<li>The controller would call <code>proxy::approve(proposal_id)</code> which would approve the proposal</li>
<li>Alternatively the controller would call <code>proxy::reject(proposal_id)</code> to reject the proposal resulting in the return of the stake to the <code>creator</code></li>
<li>With a proposal being approved the proposed script can now be executed and will be delegated proxy, <code>proxy::delegate_to_proxy</code> to the signing capabilities of the Aptos Framework.</li>
<li>On receiving the proxy the proposal is removed with the stake being returned to the <code>creator</code></li>
</ol>
<pre><code class="language-rust">script {
    use aptos_framework::proxy;
    use aptos_framework::atomic_bridge_configuration;

    // Called by anyone with an approved proposal id to be delegated proxy to the framework to 
    // update the bridge operator
    fun main(proposal_id: u64, new_operator: address) {
        let framework_signer = proxy::delegate_to_proxy(proposal_id);
        atomic_bridge_configuration::update_bridge_operator(&amp;framework_signer, new_operator);
    }
}</code></pre>
<p><strong>Proposals</strong></p>
<p>Proposals expire 2 days after creation, after which they can no longer be approved or rejected. Only the creator of the proposal can remove it using the <code>remove(caller, proposal_id)</code> function.</p>
<p><strong>Key Rotation</strong></p>
<p>The controlling key can be rotated using <code>update_controller()</code> by providing the new controller’s public key along with a signed challenge, which proves ownership of the private key corresponding to the new public key.</p>
<p><strong>Genesis</strong></p>
<p>At Genesis, the <code>genesis.move</code> module is invoked to initialize a series of modules, including the <code>proxy</code> module. At this stage, the <code>core_resources_key</code> account would serve as the initial controller of the Proxy.</p>
<p>The following patch outlines an approach to side-load the proxy module alongside Aptos Governance, enabling a pathway for transitioning to Aptos Governance and deprecating the Proxy module after Genesis.</p>
<pre><code class="language-patch">Index: aptos-move/framework/aptos-framework/sources/genesis.move
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
&lt;+&gt;UTF-8
===================================================================
diff --git a/aptos-move/framework/aptos-framework/sources/genesis.move b/aptos-move/framework/aptos-framework/sources/genesis.move
--- a/aptos-move/framework/aptos-framework/sources/genesis.move	(revision 70be3926ff79ff4cdb0cee928f717fafcd41ecdd)
+++ b/aptos-move/framework/aptos-framework/sources/genesis.move	(date 1729089687774)
@@ -19,6 +19,7 @@
     use aptos_framework::execution_config;
     use aptos_framework::create_signer::create_signer;
     use aptos_framework::gas_schedule;
+    use aptos_framework::proxy;
     use aptos_framework::reconfiguration;
     use aptos_framework::stake;
     use aptos_framework::staking_contract;
@@ -95,8 +96,8 @@
             b"epilogue",
         );
 
-        // Give the decentralized on-chain governance control over the core framework account.
-        aptos_governance::store_signer_cap(&amp;aptos_framework_account, @aptos_framework, aptos_framework_signer_cap);
+        // Give the proxy module the core framework account.
+        proxy::initialize(&amp;aptos_framework_account, aptos_framework_signer_cap);
 
         // put reserved framework reserved accounts under aptos governance
         let framework_reserved_addresses = vector&lt;address&gt;[@0x2, @0x3, @0x4, @0x5, @0x6, @0x7, @0x8, @0x9, @0xa];
@@ -150,6 +151,14 @@
         transaction_fee::store_aptos_coin_mint_cap(aptos_framework, mint_cap);
     }
 
+    /// Genesis step 3: Initialize Proxy
+    fun update_proxy_controller_to_core_resources(
+        aptos_framework: &amp;signer,
+        core_resources_auth_key: vector&lt;u8&gt;,
+    ) {
+        proxy::update_controller_unvalidated(aptos_framework, core_resources_auth_key);
+    }
+
     /// Only called for testnets and e2e tests.
     fun initialize_core_resources_and_aptos_coin(
         aptos_framework: &amp;signer,
Index: aptos-move/vm-genesis/src/lib.rs
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
&lt;+&gt;UTF-8
===================================================================
diff --git a/aptos-move/vm-genesis/src/lib.rs b/aptos-move/vm-genesis/src/lib.rs
--- a/aptos-move/vm-genesis/src/lib.rs	(revision 70be3926ff79ff4cdb0cee928f717fafcd41ecdd)
+++ b/aptos-move/vm-genesis/src/lib.rs	(date 1729089624756)
@@ -260,6 +260,8 @@
     } else {
         initialize_aptos_coin(&amp;mut session);
     }
+    initialize_proxy(&amp;mut session, core_resources_key);
+
     initialize_config_buffer(&amp;mut session);
     initialize_dkg(&amp;mut session);
     initialize_reconfiguration_state(&amp;mut session);
@@ -606,6 +608,23 @@
         ]),
     );
 }
+
+fn initialize_proxy(
+    session: &amp;mut SessionExt,
+    core_resources_key: &amp;Ed25519PublicKey,
+) {
+    let core_resources_auth_key = AuthenticationKey::ed25519(core_resources_key);
+    exec_function(
+        session,
+        GENESIS_MODULE_NAME,
+        "update_proxy_controller_to_core_resources",
+        vec![],
+        serialize_values(&amp;vec![
+            MoveValue::Signer(CORE_CODE_ADDRESS),
+            MoveValue::vector_u8(core_resources_auth_key.to_vec()),
+        ]),
+    );
+}
 
 /// Create and initialize Association and Core Code accounts.
 fn initialize_on_chain_governance(session: &amp;mut SessionExt, genesis_config: &amp;GenesisConfiguration) {
</code></pre>
<p><strong>Post Genesis</strong><br />
Ideally, the <code>proxy</code> module would eventually be replaced by Aptos Governance. To facilitate this transition, the following Move script would deactivate the <code>proxy</code> module and transfer the <code>SignerCapability</code> from the proxy to Aptos Governance. This process can also be applied to upgrade to any other governance module if needed.</p>
<pre><code class="language-rust">script {
    use aptos_framework::proxy;
    use aptos_framework::aptos_governance;

    fun main(proposal_id: u64) {
        // Request proxy
        let core_signer = proxy::delegate_to_proxy(proposal_id);
        let framework_signer = &amp;core_signer;
        // Pass `SignerCapability` over to Aptos Governance
        let aptos_framework_signer_cap = proxy::destroy(framework_signer);
        aptos_governance::store_signer_cap(framework_signer, @aptos_framework, aptos_framework_signer_cap);
        // Proxy is now inactive
    }
}</code></pre>
<h2 id="verification-7"><a class="header" href="#verification-7">Verification</a></h2>
<h3 id="1-correctness"><a class="header" href="#1-correctness">1. Correctness:</a></h3>
<p>The reference implementation has been integrated with the Aptos Framework. The <code>multisig_account.move</code> module has been verified as a mechanism to allow the proxy controller to be managed by a predefined set of signers. A review of <code>aptos_governance.move</code> provided a useful framework for validating and executing approved scripts based on their script hash. Further testing, including integration tests, will be conducted to validate the reference implementation presented here, and this will be supported by specification files for formal verification.</p>
<h3 id="2-security-implications"><a class="header" href="#2-security-implications">2. Security Implications:</a></h3>
<p>The controller’s ability to approve proposals that proxy the signing capabilities of the Aptos Framework introduces certain security risks. These risks are mitigated by ensuring that only the controller can approve or reject proposals. Additionally, cryptographic methods are employed to verify key rotations using a signed challenge, along with a nonce to prevent replay attacks. Malicious scripts are further safeguarded by validating their hash at the time of execution, ensuring that only approved scripts can be executed.
Changes will be required at Genesis to initialize the module, which will involve providing the <code>SignerCapability</code> to the module. A potential area of concern is the scope of control the proxy has during script execution. This could be addressed with more granular access control over the modules, but such a solution is beyond the scope of this MIP and would warrant its own proposal. Since this module is designed for upgrading the framework during Stage 0, it is expected to be superseded and made inoperative once the network transitions to a later stage of governance, potentially using Aptos Governance.</p>
<h3 id="3-performance-impacts"><a class="header" href="#3-performance-impacts">3. Performance Impacts:</a></h3>
<p>The proxy model offers an efficient way to govern the Aptos Framework through a multisig setup, bypassing the delays and staking requirements typically involved when using the Aptos Governance system.</p>
<h3 id="4-validation-procedures"><a class="header" href="#4-validation-procedures">4. Validation Procedures:</a></h3>
<p>Tests were conducted using Move scripts to confirm that they can successfully acquire the <code>SignerCapability</code> for the Aptos Framework. These tests were aligned with the existing capabilities provided by the Aptos Governance system.</p>
<h3 id="5-peer-review-and-community-feedback"><a class="header" href="#5-peer-review-and-community-feedback">5. Peer Review and Community Feedback:</a></h3>
<p>The proposal is subject to review and feedback from the Movement Labs team and the wider community to ensure that it meets the needs of the ecosystem.</p>
<h2 id="errata-4"><a class="header" href="#errata-4">Errata</a></h2>
<h2 id="appendix-7"><a class="header" href="#appendix-7">Appendix</a></h2>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="mip-27-contract-pipeline"><a class="header" href="#mip-27-contract-pipeline">MIP-27: Contract Pipeline</a></h1>
<ul>
<li><strong>Description</strong>: Proposal to establish a structured pipeline for new contract deployments, aligning with the infrastructure outlined in MIP-23 while maintaining the existing Movement Token under MIP-18.</li>
<li><strong>Authors</strong>: <a href="mailto:primata@movementlabs.xyz">Primata</a></li>
</ul>
<h2 id="abstract-9"><a class="header" href="#abstract-9">Abstract</a></h2>
<p>MIP-27 proposes a Contract Pipeline that leverages a timelock-based infrastructure, ensuring security and decentralization for new contract deployments. While the Movement Token (MOVEToken) continues to operate under the provisions of MIP-18, future deployments should adhere to the structure set forth by MIP-23. The pipeline includes components such as a KMS multisig for transaction proposals, off-chain voting for stakers and token holders, and a timelock mechanism for executing transactions, providing transparency and decentralized control.</p>
<h2 id="motivation-9"><a class="header" href="#motivation-9">Motivation</a></h2>
<p>Currently, Movement Token operates under the governance outlined in <a href="https://github.com/movementlabsxyz/MIP/blob/primata/mip-2/MIP/mip-18/README.md">MIP-18</a>, and we may wish to maintain this setup for the time being. However, for future deployments and upgrades, we should transition to a more robust infrastructure which includes the release conventions as described in MIP-23. This approach provides decentralized control, security, and accountability through multisig setups, timelocks, and community voting mechanisms. By establishing a structured pipeline, we ensure that the development process remains transparent, auditable, and aligned with the community’s interests.</p>
<h2 id="specification-8"><a class="header" href="#specification-8">Specification</a></h2>
<p>The Contract Pipeline includes the following components:</p>
<h3 id="1-timelock"><a class="header" href="#1-timelock">1. <strong>Timelock</strong></a></h3>
<ul>
<li><strong>Role</strong>: The timelock holds ownership of all upgradeable contracts.</li>
<li><strong>Purpose</strong>: Ensures that contract upgrades are executed only after a specified delay, allowing time for review and potential cancellation by stakeholders.</li>
</ul>
<h3 id="2-kms-multisig-setup"><a class="header" href="#2-kms-multisig-setup">2. <strong>KMS Multisig Setup</strong></a></h3>
<ul>
<li><strong>Role</strong>: Proposes transactions to the timelock.</li>
<li><strong>Components</strong>:
<ul>
<li><strong>1 KMS Key</strong>: Proposes transactions based on accepted tags.</li>
<li><strong>3 KMS Keys</strong>: Accept transactions only if the transaction hash is contained in a GitHub release.</li>
<li><strong>1 KMS Key</strong>: Schedules the timelock transaction.</li>
</ul>
</li>
</ul>
<h3 id="3-off-chain-voting-mechanism"><a class="header" href="#3-off-chain-voting-mechanism">3. <strong>Off-Chain Voting Mechanism</strong></a></h3>
<ul>
<li><strong>Role</strong>: Allows stakers and token holders to participate in “heat-checking” decisions, where off-chain voting provides feedback before finalizing transaction proposals.</li>
<li><strong>Purpose</strong>: Increases community involvement and allows for decentralized input into key governance decisions.</li>
</ul>
<h3 id="4-engineering-crew"><a class="header" href="#4-engineering-crew">4. <strong>Engineering Crew</strong></a></h3>
<ul>
<li><strong>Role</strong>: The engineering team has the ability to push new contract versions for upgrades.</li>
<li><strong>Interaction</strong>: The engineering team collaborates with the multisig setup to ensure proposed transactions align with the accepted development standards.</li>
</ul>
<h3 id="5-mcr-domain"><a class="header" href="#5-mcr-domain">5. <strong>MCR Domain</strong></a></h3>
<ul>
<li><strong>Role</strong>: This domain is composed of network stakers who can execute timelocked transactions.</li>
<li><strong>Purpose</strong>: Provides an additional layer of decentralized control by allowing stakers to be responsible for executing transactions after the timelock period has elapsed.</li>
</ul>
<h3 id="6-contracts"><a class="header" href="#6-contracts">6. <strong>Contracts</strong></a></h3>
<ul>
<li><strong>Role</strong>: The functional component of the protocol.</li>
<li><strong>Purpose</strong>: Allow users to interact with Movement as a protocol.</li>
</ul>
<h2 id="workflow-for-releases"><a class="header" href="#workflow-for-releases">Workflow for Releases</a></h2>
<ol>
<li>
<p><strong>Engineers Push Releases</strong>:</p>
<ul>
<li>Engineers push new releases containing the necessary deployment data and transaction details. Each release tag initializes the workflow.</li>
<li>Engineers release a new implementation contract on the network. The old contract is versioned and a new iterable contract is created. E.g. MOVEToken is deployed. It currently contains MOVETokenV1 (current implementation) and MOVEToken. ALL work is to be done on MOVEToken. Once a new upgrade occurs, the deployed MOVEToken version is renamed MOVETokenV2 and a new iterable contract is created and named MOVEToken.</li>
</ul>
</li>
<li>
<p><strong>Deployment JSON Files</strong>:</p>
<ul>
<li>The release includes deployment JSON files following the standard proposed in MIP-23. These files include:
<ul>
<li>Broadcast data.</li>
<li>Transaction hash for signatures.</li>
<li>Bytecode reference.</li>
<li>Current deployment addresses.</li>
<li>Configuration details.</li>
</ul>
</li>
</ul>
<p>These JSON files are the output generated by deployment scripts and provide the essential data for the release.</p>
<p>When a broadcast occurs using <a href="https://book.getfoundry.sh/">Foundry</a>, it generates a <strong>run file</strong> that captures all transactions and state changes made during the execution of a script. This run file can be extremely useful for tracing deployed contracts, transaction data, and any modifications to on-chain state. These run files serve as a key integration artifact and fallback data source, ensuring transparency and auditability. Following the <strong>Release Conventions</strong> specified in MIP-23, these run files should be included in each release to provide a complete trace of the deployment or upgrade process.</p>
<p>Once the implementation contract is deployed, a JSON file is generated under the path <code>protocol-units/settlement/mcr/contracts/script/helpers/upgrade/{contract}.json</code>. This file contains all the critical data required for the continuity of the upgrade process, including transaction details, contract addresses, and other metadata. The file is continuously updated during contract upgrades to reflect the latest data, making it a live reference document that tracks the state of the system over time.</p>
<p>e.g.</p>
<pre><code class="language-json">{
   "chainId": environmentChainId,
   "implementation": implementationAddress,
   "data": deploymentBytecode,
   "operation": Call || DelegateCall,
   "safeAddress": safeToPerformCall,
   "to": timeLockAddress,
   "value": ethValue
}
</code></pre>
<p>Additionally, during deployments, the files <code>protocol-units/settlement/mcr/contracts/script/helpers/config.json</code> and <code>protocol-units/settlement/mcr/contracts/script/helpers/deployments.json</code> are used to store configuration data and reference previous deployments. These files are essential for ensuring consistency across deployments, as some contract deployments depend on the addresses or states of previously deployed contracts. Both files are considered live documents, updated during upgrades to maintain the most recent deployment and configuration data.</p>
<p>This structured approach ensures that the entire deployment and upgrade lifecycle is well-documented, traceable, and consistent with the release process, allowing for seamless integration and upgrades across the system.</p>
</li>
<li>
<p><strong>GitHub Release</strong>:</p>
<ul>
<li>The deployment JSON files are bundled into a GitHub release, which serves as the source of truth for the multisig setup. The release verifies the transaction hash and other deployment details before initiating the next step in the workflow.</li>
</ul>
</li>
<li>
<p><strong>Proposal</strong>:</p>
<ul>
<li>The KMS multisig, based on accepted GitHub release tags, proposes a transaction to the timelock. This is initiated by a KMS key responsible for proposing the transaction based on the tagged release.</li>
</ul>
</li>
<li>
<p><strong>Signatures</strong>:</p>
<ul>
<li>Three KMS keys approve the transaction if it matches the transaction hash contained in the GitHub release. These signatures are required to confirm the validity of the transaction.</li>
</ul>
</li>
<li>
<p><strong>Scheduling</strong>:</p>
<ul>
<li>Once consensus is reached, a separate KMS key schedules the timelock transaction. This step locks the transaction for a predefined period, allowing for review.</li>
</ul>
</li>
<li>
<p><strong>Voting and Heat Checking</strong>:</p>
<ul>
<li>During the timelock period, stakers and token holders participate in off-chain voting to provide feedback on the proposed transaction. This allows the community to give input before the final execution.</li>
</ul>
</li>
<li>
<p><strong>Execution</strong>:</p>
<ul>
<li>After the timelock period, the MCR domain composed of network stakers is responsible for executing the transaction, completing the deployment or upgrade process.</li>
</ul>
</li>
</ol>
<p>This combined workflow ensures transparency, security, and decentralized control over contract deployments and upgrades by integrating GitHub releases, KMS multisig, and timelock mechanisms with off-chain community feedback.</p>
<h2 id="reference-implementation-7"><a class="header" href="#reference-implementation-7">Reference Implementation</a></h2>
<p>The pipeline will leverage KMS multisig setups and GitHub releases as a mechanism for secure and auditable transaction proposals. Off-chain voting mechanisms for stakers and token holders can be implemented using existing decentralized governance platforms.</p>
<h2 id="verification-8"><a class="header" href="#verification-8">Verification</a></h2>
<h3 id="1-correctness-1"><a class="header" href="#1-correctness-1">1. <strong>Correctness</strong></a></h3>
<p>The pipeline’s correctness relies on the successful integration of KMS multisig, timelocks, GitHub releases, and off-chain voting mechanisms. Each component’s role must be clearly defined and enforced.</p>
<h3 id="2-security-implications-1"><a class="header" href="#2-security-implications-1">2. <strong>Security Implications</strong></a></h3>
<ul>
<li>The timelock ensures that transactions are not executed immediately, allowing time for review and cancellation.</li>
<li>The KMS multisig setup adds an additional layer of security by requiring multiple approvals from trusted parties.</li>
<li>The use of GitHub releases ensures transparency and verifiability for each deployment.</li>
</ul>
<h3 id="3-performance-impacts-1"><a class="header" href="#3-performance-impacts-1">3. <strong>Performance Impacts</strong></a></h3>
<ul>
<li>The timelock may introduce slight delays in contract upgrades, but this is a necessary tradeoff for increased security and transparency.</li>
</ul>
<h3 id="4-validation-procedures-1"><a class="header" href="#4-validation-procedures-1">4. <strong>Validation Procedures</strong></a></h3>
<ul>
<li>Formal testing of the KMS multisig setup, timelock mechanisms, and GitHub release workflows should be conducted to ensure proper functionality.</li>
</ul>
<h3 id="5-peer-review-and-community-feedback-1"><a class="header" href="#5-peer-review-and-community-feedback-1">5. <strong>Peer Review and Community Feedback</strong></a></h3>
<p>The proposal will be reviewed by Movement Labs engineers and the broader community for feedback before final implementation.</p>
<h2 id="errata-5"><a class="header" href="#errata-5">Errata</a></h2>
<p>Any post-publication corrections or updates will be documented here to ensure transparency and accuracy.</p>
<h2 id="appendix-8"><a class="header" href="#appendix-8">Appendix</a></h2>
<ul>
<li>[R1] MIP-18: <a href="https://github.com/movementlabsxyz/MIP/blob/primata/mip-2/MIP/mip-18/README.md">Stage 0 Upgradeability and Multisigs</a></li>
<li>[R2] MIP-23: <a href="https://github.com/movementlabsxyz/MIP/blob/l-monninger/releases/MIP/mip-n/README.md">Release Convetions for Movement Technologies</a></li>
</ul>
<hr />
<p>This proposal establishes a Contract Pipeline that adheres to the decentralized governance principles set forth in MIP-23 while maintaining compatibility with the existing Movement Token governance under MIP-18.</p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="mip-28-naming-conventions-for-movement-protocol-design"><a class="header" href="#mip-28-naming-conventions-for-movement-protocol-design">MIP-28: Naming Conventions for Movement Protocol Design</a></h1>
<ul>
<li><strong>Description</strong>: Naming conventions for actors in Movement protocol design, tests, and documentation.</li>
<li><strong>Authors</strong>: <a href="mailto:liam@movementlabs.xyz">Liam Monninger</a></li>
</ul>
<h2 id="abstract-10"><a class="header" href="#abstract-10">Abstract</a></h2>
<p>This MIP outlines the naming conventions for actors in Movement protocol design, tests, and documentation. By standardizing the naming conventions, we aim to ensure that the Movement community can easily understand and navigate the Movement protocol ecosystem.</p>
<h2 id="motivation-10"><a class="header" href="#motivation-10">Motivation</a></h2>
<p>Movement protocols are complex systems that involve multiple actors, such as users, developers, and validators. By establishing naming conventions for these actors, we can create a common language that simplifies communication and collaboration within the Movement community. Standardized naming conventions also make it easier for new participants to understand the Movement protocol ecosystem and contribute effectively.</p>
<h2 id="specification-9"><a class="header" href="#specification-9">Specification</a></h2>
<h3 id="generic-names"><a class="header" href="#generic-names">Generic Names</a></h3>
<ul>
<li>Alice: a generic user who interacts with a Movement protocol. The first user in a generic setup SHOULD be named Alice.</li>
<li>Bob: a generic user who interacts with a Movement protocol. The second user in a generic setup SHOULD be named Bob.</li>
<li>Charlie: a generic user who interacts with a Movement protocol. The third user in a generic setup SHOULD be named Charlie.</li>
</ul>
<h3 id="specific-names"><a class="header" href="#specific-names">Specific Names</a></h3>
<ul>
<li>(Malicious) Richard: a user who acts maliciously in a Movement protocol. The first malicious user in a generic setup SHOULD be named Richard.
<ul>
<li>An alternative My Boy Richard can also be used to refer to a user who acts unnecessarily outside of their own interests, perhaps for the greater good. This usage was introduced to avoid being too univocal; Malicious Richard originally and endearingly referred to an early team member at Movement Labs. When specifying My Boy Richard, the usage of Richard should be prefixed.</li>
</ul>
</li>
<li>(Naive) Eve: a user who acts naively in a Movement protocol. The first naive user in a generic setup SHOULD be named Eve.</li>
<li>(Lazy) Liam: a user who acts lazily in a Movement protocol. The first lazy user in a generic setup SHOULD be named Liam.
<ul>
<li>(Latent) Liam is also acceptable to refer to a user who acts lazily but with the potential to act otherwise. This usage was introduced to avoid being too univocal; Lazy Liam originally and endearingly referred to an early team member at Movement Labs. When specifying Latent Liam, the usage of Liam should be prefixed.</li>
</ul>
</li>
</ul>
<h2 id="reference-implementation-8"><a class="header" href="#reference-implementation-8">Reference Implementation</a></h2>
<h2 id="verification-9"><a class="header" href="#verification-9">Verification</a></h2>
<h2 id="errata-6"><a class="header" href="#errata-6">Errata</a></h2>
<h2 id="appendix-9"><a class="header" href="#appendix-9">Appendix</a></h2>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="mip-34-fast-finality-settlement"><a class="header" href="#mip-34-fast-finality-settlement">MIP-34: Fast Finality Settlement</a></h1>
<ul>
<li><strong>Description</strong>: Establish the scope and components that are part of the Fast Finality Settlement mechanism.</li>
<li><strong>Authors</strong>: <a href="Review/mip/FFS/MIP/mip-34/">Franck Cassez</a>, <a href="mailto:andreas.penzkofer@movementlabs.xyz">Andreas Penzkofer</a></li>
</ul>
<h2 id="abstract-11"><a class="header" href="#abstract-11">Abstract</a></h2>
<p>Fast Finality Settlement (FFS) is a mechanism that allows for fast <em>confirmation</em> of transactions backed by crypto-economic security. Moreover it capitalizes on the economic security from the L1. This MIP outlines the high-level specifications and architecture of FFS.</p>
<p>FFS is divided into</p>
<ul>
<li><strong>Postconfirmation</strong>: a mechanism to confirm the validity of a block on L1</li>
<li><strong>Fastconfirmation</strong>: a mechanism to confirm the validity of a block on L2</li>
</ul>
<h2 id="definitions-1"><a class="header" href="#definitions-1">Definitions</a></h2>
<p>We make a note for the following terms:</p>
<p><strong>Batch</strong> (not recommended)
Less clean, but more common term for sequencer batch. May be mixed up with the batch of transactions sent to the sequencer, or with the batch of L2Blocks (superBlocks) that should be processed for postconfirmations. Use with care.</p>
<p><strong>Attester</strong> (not recommended)
The term attester has been deprecated in favor of validator.</p>
<p><strong>Quorum certificate</strong> (not recommended)
The term quorum certificate has been deprecated in favor of fastconfirmation certificate.</p>
<h2 id="motivation-11"><a class="header" href="#motivation-11">Motivation</a></h2>
<p>Two chains are present in our architecture: a base chain (or L1) and a second chain (or L2). We refer to L2 as a chain that is not the base chain.Rollups and other types of chains may publish or secure transaction data in a data availability (DA) layer or at Ethereum mainnet (L1).</p>
<p>Validity and optimistic rollups can finalize transactions within approximately 30 minutes and ~1 week, respectively. Until a transaction is finalized, there is no assurance about its validity and result (success or failure). This can be a limiting factor for certain types of DeFi applications.</p>
<p>Our objective is to enable transaction issuers to quickly get some guarantees that their transactions are correctly and successfully included in a block. The crypto-economic security is provided by a Proof-of-Stake (PoS) protocol. This mechanism can be deployed independently for a chain, or used in combination with existing settlement mechanisms, such as ZK and optimistic settlements.</p>
<p>As a result, users can rely and trust the <strong>fastconfirmation</strong> (sometimes also described as L2-finality) to use as confirmation, or if the chain is configured to do so, wait for L1-finality, such as through <strong>postconfirmation</strong>, end of challenge window for fraud proofs (optimistic rollup), or verification of a ZK-proof (validity rollup).</p>
<p>A introduction to FFS can be found in <a href="https://blog.movementlabs.xyz/article/security-and-fast-finality-settlement">this blog post on Fast Finality Settlement</a>. A more detailed description of a (partial) implementation of the mechanism is available at <a href="https://blog.movementlabs.xyz/article/postconfirmations-L2s-rollups-blockchain-movement">this blog post on postconfirmations</a>.</p>
<p>This MIP provides an overview of an architecture of FFS, and its main components.</p>
<h2 id="specification-10"><a class="header" href="#specification-10">Specification</a></h2>
<h3 id="overview-3"><a class="header" href="#overview-3">Overview</a></h3>
<p><strong>FFS</strong>. The objective of Fast Finality Settlement (FFS) is to confirm that transactions are <em>processed</em> correctly and that the node has <em>read</em> the transactions in the correct order. It does not impact the already established order of transactions by the sequencer.</p>
<p>At an abstract level, the L2 chain increases by a new block in each (L2) round, and this block is the successor of the block in the previous round, the <em>predecessor</em>. Initially, there is a <em>genesis</em> block with no predecessor.</p>
<p><strong>ProtoBlock</strong>. Each round corresponds to the processing of a batch of transactions, called <em>protoBlock</em>, which is proposed by the <em>sequencer</em> (can be centralized, decentralized, shared).</p>
<p><strong>L2Block</strong>. A node with execution capability is in charge of validating the transactions in a protoBlock and calculates the new state. This results in a block with state commitments, and we call this block L2Block. For the vast majority of cases when we refer to blocks we mean L2Blocks, thus we will omit the “L2-” prefix. Since protoBlocks are provided by the sequencer, the new state and the state roots for a block are deterministic. For a protoBlock <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">b</span></span></span></span> the state is <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">b</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> and the state root is <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">b</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>. From the protoBlock <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">b</span></span></span></span> and the state <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">b</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> the block <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span></span></span></span> is computed (which contains the information of the protoBlock and the state root).</p>
<p><strong>SuperBlock</strong>. L2Blocks can be constructed and confirmed on L2 at a higher rate than is feasible for L1. We group L2Blocks into a <em>superBlock</em> that is confirmed together.</p>
<p><strong>Local validation</strong>. Since a block is deterministically calculated we say that a block (and the associated new state) is <em>validated locally</em> once the execution engine calculates it from the protoBlock.</p>
<p>The validity judgement to be made is:</p>
<blockquote>
<p>[!NOTE]
Given a block <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span></span></span></span> (predecessor), a protoBlock of transactions <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">t</span><span class="mord mathnormal">x</span><span class="mord mathnormal">s</span></span></span></span> and a successor block <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7519em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span>, is <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7519em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span> the^[the MoveVM is deterministic and there can be only valid successor.] <em>correct</em> successor of <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span></span></span></span> after executing the sequence of transactions <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">t</span><span class="mord mathnormal">x</span><span class="mord mathnormal">s</span></span></span></span>?</p>
</blockquote>
<p>The term <em>correct</em> means that the successor block <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7519em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span> (and the state it represents) has been computed in accordance with the semantics of the MoveVM, which we denote  <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0636em;vertical-align:-0.011em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel x-arrow"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0526em;"><span style="top:-3.322em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight x-arrow-pad"><span class="mord mtight"><span class="mspace mtight"><span class="mtight"> </span></span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">x</span><span class="mord mathnormal mtight">s</span><span class="mspace mtight"><span class="mtight"> </span></span></span></span></span><span class="svg-align" style="top:-2.689em;"><span class="pstrut" style="height:2.7em;"></span><span class="hide-tail" style="height:0.522em;min-width:1.469em;"><svg xmlns="http://www.w3.org/2000/svg" width='400em' height='0.522em' viewBox='0 0 400000 522' preserveAspectRatio='xMaxYMin slice'><path d='M0 241v40h399891c-47.3 35.3-84 78-110 128 -16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20  11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7  39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85 -40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5 -12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67  151.7 139 205zm0 0v40h399900v-40z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.011em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7519em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span>.</p>
<p><strong>Validator</strong>. A node that is responsible for validating transactions and confirming L2Blocks. To guarantee the validity of a new block <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7519em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span>, we use a set of <em>validators</em> who are in charge of verifying the transition <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0636em;vertical-align:-0.011em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel x-arrow"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0526em;"><span style="top:-3.322em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight x-arrow-pad"><span class="mord mtight"><span class="mspace mtight"><span class="mtight"> </span></span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">x</span><span class="mord mathnormal mtight">s</span><span class="mspace mtight"><span class="mtight"> </span></span></span></span></span><span class="svg-align" style="top:-2.689em;"><span class="pstrut" style="height:2.7em;"></span><span class="hide-tail" style="height:0.522em;min-width:1.469em;"><svg xmlns="http://www.w3.org/2000/svg" width='400em' height='0.522em' viewBox='0 0 400000 522' preserveAspectRatio='xMaxYMin slice'><path d='M0 241v40h399891c-47.3 35.3-84 78-110 128 -16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20  11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7  39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85 -40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5 -12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67  151.7 139 205zm0 0v40h399900v-40z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.011em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7519em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span>.</p>
<p><strong>Attestation</strong>. A validator <em>attests</em> for a new block <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7519em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span>. This can be done, for example, by casting a vote :white_check_mark: (true) or :x: (false) for a proposal by a leader validator. Or by each validator sending the hash of the block they have validated.</p>
<p><strong>Fastconfirmation certificate</strong>. When enough validators have attested for a new block <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7519em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span>, the block is <em>L2-confirmed</em> (sometimes referred to as <em>L2-final</em>). The accumulation of enough votes is aggregated in a fastconfirmation certificate. A naive implementation of the fastconfirmation certificate is a list of votes.</p>
<blockquote>
<p>[!NOTE]
Until a better definition arises we consider <em><strong>confirmation</strong></em> to be defined as <em>L2-finality</em> (i.e. <em>fastconfirmation</em>).</p>
</blockquote>
<p><strong>Fastconfirmation</strong>. FFS aims to <em>confirm</em> the validity of each produced L2Block, at every L2Block height.</p>
<blockquote>
<p>[!IMPORTANT]
If we confirm each successor block before adding it to the (confirmed) part of the ledger, there cannot be any fork, except if the sequencer would provide equivocating protoBlocks for a given height AND there is a sufficiently strong Byzantine attack on the confirmation process.</p>
</blockquote>
<p>If the validators can attest blocks quickly and make their attestations available to third-parties, we have a fast confirmation mechanism supported by crypto-economic security, the  level of which depends on what is at stake for the confirmation of a block.</p>
<p><strong>Postconfirmation</strong>. At certain intervals confirmation will also be achieved on L1. The L1 contract will verify the satisfaction of the super-majority criteria. This provides an L1-protected <em>postconfirmation</em> that the block (or a batch of blocks, which we call <em>block range</em>) is confirmed. This additional anchoring mechanism increases the security of the fastconfirmation as it locks in the fastconfirmation, reduces the risk of long range attacks and provides a way to slash validators that have attested for invalid blocks.</p>
<p><strong>Slashing</strong>. The security of the mechanism relies on a PoS protocol. Each validator has to stake some assets, and if they are malicious they <em>should</em> be slashed.
The condition for slashing may be met by several criteria, and not all slashing conditions may be used:</p>
<ul>
<li>equivocate (send a different vote to different validators or users)</li>
<li>vote for an invalid block</li>
<li>(if possible) vote against a valid block</li>
</ul>
<h3 id="main-challenges"><a class="header" href="#main-challenges">Main challenges</a></h3>
<p>See also <a href="Review/mip/FFS/MIP/mip-34/../../MD/md-34/README.html">MD-34</a>.</p>
<p>To achieve crypto-economically secured fast finality, we need to solve the following problems:</p>
<p><strong>Postconfirmation</strong></p>
<ol>
<li>design a <em>staking</em> mechanism for the validators to stake assets, distribute rewards and manage slashing</li>
<li><em>define and verify</em> the threshold (e.g. 2/3 of validators attest)  for postconfirmation.</li>
</ol>
<p><strong>Fastconfirmation</strong></p>
<ol start="3">
<li>design a <em>staking</em> mechanism for the validators to stake assets, distribute rewards and manage slashing</li>
<li><em>define and verify</em> the threshold (e.g. 2/3 of validators attest) for fastconfirmation.</li>
<li><em>communicate</em> the fastconfirmation status and compare to the postconfirmation status.</li>
</ol>
<h3 id="components"><a class="header" href="#components">Components</a></h3>
<h4 id="staking-for-postconfirmations-addresses-1"><a class="header" href="#staking-for-postconfirmations-addresses-1">Staking for postconfirmations (addresses 1.)</a></h4>
<p>For postconfirmation a staking mechanism is implemented in a contract on L1.
This contract provides the following functionalities:</p>
<ul>
<li>join: a new validator can join the set of validators by staking some assets</li>
<li>exit: a validator exits and  get their stakes back</li>
</ul>
<h4 id="handle-postconfirmations-addresses-2"><a class="header" href="#handle-postconfirmations-addresses-2">Handle postconfirmations (addresses 2.)</a></h4>
<p>For postconfirmation, the following steps are implemented in a contract on L1:</p>
<ul>
<li>vote: receive a vote or a set of votes, verify the integrity of the votes (signatures) and the minimum threshold (e.g. 2/3)</li>
<li>confirm: once the threshold is reached, confirm the block (or sequence of blocks) on L1</li>
</ul>
<h4 id="staking-for-fastconfirmations-addresses-3"><a class="header" href="#staking-for-fastconfirmations-addresses-3">Staking for fastconfirmations (addresses 3.)</a></h4>
<p>For fastconfirmation a staking mechanism is implemented in a contract on L2.</p>
<p>This contract provides the following functionalities:</p>
<ul>
<li>join: a new validator can join the set of validators by staking some assets</li>
<li>exit: a validator exits and  get their stakes back</li>
</ul>
<h4 id="handle-fastconfirmation-addresses-4"><a class="header" href="#handle-fastconfirmation-addresses-4">Handle fastconfirmation (addresses 4.)</a></h4>
<p>For fastconfirmation, the following steps are implemented in a contract on L2:</p>
<ul>
<li>vote: receive a vote or a set of votes, verify the integrity of the votes (signatures) and the minimum threshold (e.g. 2/3)</li>
<li>confirm: once the threshold is reached, confirm the block (or sequence of blocks) on L2</li>
</ul>
<h4 id="communication-of-fastconfirmation-status-addresses-5"><a class="header" href="#communication-of-fastconfirmation-status-addresses-5">Communication of fastconfirmation status (addresses 5.)</a></h4>
<p>This step synchronizes the fastconfirmation with the postconfirmation. The postconfirmation is the final confirmation of the block on L1, and the fastconfirmation is the fast confirmation of the block on L2.</p>
<p>To ensure that the fastconfirmation status is made available to third-parties, we may publish our <em>proof</em>  (2/3 of attestations) to a data availability layer and get a <em>certificate</em> that the proof is available.<br />
This DA layer should offer a reliable <em>mempool</em> for example as described <a href="https://arxiv.org/pdf/2105.11827">in this paper</a>.</p>
<h2 id="implementation-details"><a class="header" href="#implementation-details">Implementation Details</a></h2>
<p>To simplify we assume that each validator stakes the same amount. The set of validators is in charge of validating sequenced batches and producing blocks that also commit to the state root of the sequenced batch.</p>
<p>There may be different protocols for the postconfirmation and the fastconfirmation.</p>
<h4 id="postconfirmation-with-deterministic-blocks"><a class="header" href="#postconfirmation-with-deterministic-blocks">Postconfirmation with deterministic blocks</a></h4>
<p>L2Blocks are deterministically derived from the protoBlock, and consequently the superBlock <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9989em;vertical-align:-0.247em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-2.453em;margin-left:-0.0502em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span></span></span></span> is deterministic. Validators then attest for the next transition directly:  <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2026em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0502em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel x-arrow"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0526em;"><span style="top:-3.322em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight x-arrow-pad"><span class="mord mtight"><span class="mspace mtight"><span class="mtight"> </span></span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">x</span><span class="mord mathnormal mtight">s</span><span class="mspace mtight"><span class="mtight"> </span></span></span></span></span><span class="svg-align" style="top:-2.689em;"><span class="pstrut" style="height:2.7em;"></span><span class="hide-tail" style="height:0.522em;min-width:1.469em;"><svg xmlns="http://www.w3.org/2000/svg" width='400em' height='0.522em' viewBox='0 0 400000 522' preserveAspectRatio='xMaxYMin slice'><path d='M0 241v40h399891c-47.3 35.3-84 78-110 128 -16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20  11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7  39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85 -40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5 -12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67  151.7 139 205zm0 0v40h399900v-40z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.011em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.9989em;vertical-align:-0.247em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-2.453em;margin-left:-0.0502em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span></span></span></span>. E.g. by committing to the the hash of <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9989em;vertical-align:-0.247em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-2.453em;margin-left:-0.0502em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span></span></span></span>.</p>
<p>An additional actor - the <code>acceptor</code> - is introduced that initiates the postconfirmation process. This is necessary, as this step requires additional gas costs on L1 and thus this role requires additional rewards. We also don’t want to burden regular validators with additional gas costs, as we would like the gas costs for validators to be predictable. The <code>acceptor</code> serves for a specified period and is then replaced by another validator.</p>
<blockquote>
<p>[!NOTE]
Since the block derivation is deterministic, <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span> may be sufficient to confirm the block. (However, we require <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord">2</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span> to cover potential edge cases, such as that the sequencer cannot be trusted.)</p>
</blockquote>
<p><strong>Direct L1 commitments</strong>. In the scenario where validators commit individually they send the block hashes of the calculated blocks directly to the L1 contract.</p>
<p><strong>Acceptor collects commitments</strong>. In a more optimized scenario, the acceptor could also send the super-majority proof to the L1 contract.</p>
<p><img src="Review/mip/FFS/MIP/mip-34/postconfirmationV2.png" alt="Diagram 2" />
<em>Figure 2: <strong>Postconfirmation</strong>: Leader-independent (deterministic) L2Block generation process.</em></p>
<h4 id="fastconfirmation-with-deterministic-blocks"><a class="header" href="#fastconfirmation-with-deterministic-blocks">Fastconfirmation with deterministic blocks</a></h4>
<p>A p2p layer is established between validators. Validators communicate to aggregate a threshold of votes on each deterministically determined L2Block. This provides fastconfirmations in the order of seconds.</p>
<p>Since this approach already collects commitments off-L1, an acceptor could collect commitments and send the super-majority proof to the L1 contract. This would provide postconfirmations in the order of minutes.</p>
<p><img src="Review/mip/FFS/MIP/mip-34/fullDesign.png" alt="Diagram 3" />
<em>Figure 3: <strong>Postconfirmation + fastconfirmation</strong>: Leader-independent (deterministic) L2Block generation process. Validators co-operate to create a fastconfirmation certificate before L1 is involved.</em></p>
<h4 id="alternative-version-not-implemented-postconfirmation-with-leader-dependent-blocks"><a class="header" href="#alternative-version-not-implemented-postconfirmation-with-leader-dependent-blocks">Alternative Version (not implemented): Postconfirmation with leader-dependent blocks</a></h4>
<p>A leader validator is elected for a certain interval. The leader proposes the next transition (superBlock <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9989em;vertical-align:-0.247em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-2.453em;margin-left:-0.0502em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span></span></span></span>):  <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2026em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0502em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel x-arrow"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0526em;"><span style="top:-3.322em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight x-arrow-pad"><span class="mord mtight"><span class="mspace mtight"><span class="mtight"> </span></span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">x</span><span class="mord mathnormal mtight">s</span><span class="mspace mtight"><span class="mtight"> </span></span></span></span></span><span class="svg-align" style="top:-2.689em;"><span class="pstrut" style="height:2.7em;"></span><span class="hide-tail" style="height:0.522em;min-width:1.469em;"><svg xmlns="http://www.w3.org/2000/svg" width='400em' height='0.522em' viewBox='0 0 400000 522' preserveAspectRatio='xMaxYMin slice'><path d='M0 241v40h399891c-47.3 35.3-84 78-110 128 -16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20  11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7  39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85 -40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5 -12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67  151.7 139 205zm0 0v40h399900v-40z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.011em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.9989em;vertical-align:-0.247em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-2.453em;margin-left:-0.0502em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span></span></span></span>. The leader can do so by sending a digest of <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">t</span><span class="mord mathnormal">x</span><span class="mord mathnormal">s</span></span></span></span> (Merkle root) and a digest of <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9989em;vertical-align:-0.247em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-2.453em;margin-left:-0.0502em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span></span></span></span> (Merkle root hash of <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9989em;vertical-align:-0.247em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-2.453em;margin-left:-0.0502em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span></span></span></span>), or a <em>change set</em>. The leader commits on L1 to <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9989em;vertical-align:-0.247em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-2.453em;margin-left:-0.0502em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span></span></span></span>. Every validator checks the validity of <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9989em;vertical-align:-0.247em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-2.453em;margin-left:-0.0502em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span></span></span></span> and prepares a vote message.</p>
<p><strong>Direct L1 commitments</strong>. The vote messages of each validator are directly sent to the L1 contract. Once enough votes are available on L1, the leader initiates the postconfirmation process.</p>
<p><strong>Leader collects votes</strong>. The vote messages of each validator are directly sent to the L1 contract. Once the votes reach the required threshold for <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9989em;vertical-align:-0.247em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-2.453em;margin-left:-0.0502em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span></span></span></span>, the leader initiates the postconfirmation process with the proof of the votes.</p>
<p><img src="Review/mip/FFS/MIP/mip-34/postconfirmationV1.png" alt="Version A Diagram" />
<em>Figure 1: <strong>Postconfirmation</strong>: Leader-dependent L2Block generation process.</em></p>
<h2 id="verification-10"><a class="header" href="#verification-10">Verification</a></h2>
<h3 id="correctness-and-security"><a class="header" href="#correctness-and-security">Correctness and Security</a></h3>
<p>A more detailed discussion on the correctness and security is discussed in <a href="https://blog.movementlabs.xyz/article/security-and-fast-finality-settlement">this blog post on FFS</a>.</p>
<p>The level of security depends on the total stake of the L2 validators. The higher the more secure.</p>
<p>The correctness of the mechanism relies on a few trust assumptions.</p>
<p><strong>Byzantine assumption</strong>.
We assume that at most <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span></span></span></span> of the total <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord">3</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span> (L2) validators can be malicious.
This implies that if more than <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord">2</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span> attest for a new block, at least <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span> honest validators have attested, so at least one honest validator has attested to <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7519em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span>. Thus, we request that &gt;<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1901em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8451em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord mathnormal">n</span></span></span></span> (super-majority)  validators have attest for <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7519em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span>.</p>
<p><strong>Postconfirmations</strong>. We assume that the contract that validates the proof of super-majority is correct (there are no bugs in the implementation of the contract). As a result, when the contract verification step is confirmed on L1 (L1-finality), the super-majority proof verification is L1-secure.</p>
<p>Combining the two results above we have: confirmation (L1 contract) that &gt;2/3 of validators have attested to a certain superBlock and if &gt;2/3 have attested then <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7519em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span> is valid. So overall, if the &gt;2/3 super-majority is verified by the L1 contract, <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7519em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span> is valid.</p>
<p><strong>Fastconfirmation</strong>. The same applies as for Postconfirmations.</p>
<p>In addition the L2 validators also publish the proofs to a DA layer and once the proof is available it cannot be tampered with. Thus, we can provide some guarantees about the irreversibility of transactions when the availability certificate (of the fastconfirmation certificate) is delivered, and before the actual proof is verified on L1. If validators misbehave, they <em>will</em> be slashed on L1, which provides strong incentives for validators not to act malicious.</p>
<p>This is conditional to:</p>
<ul>
<li>ensuring that the validators send the same proof to the L1 staking contract and to the DA.</li>
<li>validators cannot exit too early (not before the proof they are committed to are confirmed on L1).</li>
</ul>
<h2 id="optimizations"><a class="header" href="#optimizations">Optimizations</a></h2>
<p>There are several aspects that could be optimized and refined:</p>
<ul>
<li><strong>super-majority proof</strong>: it can be a list of votes, but could also be a zk-proof (more compact). The super-majority proof is not a proof of correct execution (as in zkVM) but simply of super-majority and this is cheaper to compute.</li>
<li><strong>signatures aggregation</strong>: we want to avoid sending large transactions to the L1 as it increases operational costs. How to aggregate signatures to send more compact messages/transactions?</li>
<li><strong>delegation/weighted stakes</strong>: a mechanism for validators to delegate their voting power to other validators. Ability for validators to stake different amounts (and use weighted stakes super-majority).</li>
<li><strong>commit to a sequence of L2Blocks</strong>. The fastconfirmation certificate could be per block. However, on L1 we want to commit to a sequence of blocks (a superBlock). This can be done by committing to the state root of the last block in the sequence or more complicated approaches using Merkle roots.</li>
<li><strong>involvement of DA layer</strong>. Validators sent their votes or commitments to a DA layer off-L1. This ensures that votes remain available and can be used for potential slashing. This step should take O(1) second if we use a fast reliable mempool.</li>
</ul>
<h2 id="errata-7"><a class="header" href="#errata-7">Errata</a></h2>
<h2 id="appendix-10"><a class="header" href="#appendix-10">Appendix</a></h2>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="mip-47-improve-gas-fee-collection-in-phases"><a class="header" href="#mip-47-improve-gas-fee-collection-in-phases">MIP-47: Improve Gas fee collection in phases</a></h1>
<ul>
<li><strong>Description</strong>: Transition from a “gas fees are burned” model to paying out of the gas fees to a governed token pool.</li>
<li><strong>Authors</strong>: <a href="mailto:andreas.penzkofer@movementlabs.xyz">Author</a></li>
</ul>
<!--
  READ MIP-1 BEFORE USING THIS TEMPLATE!

  This is the suggested template for new MIPs. After you have filled in the requisite fields, please delete these comments.

  Note that an MIP number will be assigned by an editor. When opening a pull request to submit your MIP, please use an abbreviated title in the filename, `mip-draft_title_abbrev.md`.

  The title should be 44 characters or less. It should not repeat the MIP number in title, irrespective of the category.

  The author should add himself as a code owner in the `.github/CODEOWNERS` file for the MIP.

  TODO: Remove this comment before finalizing.
-->
<h2 id="abstract-12"><a class="header" href="#abstract-12">Abstract</a></h2>
<p>Currently gas fees are burned. Eventually gas fees should be redirected to a gas pool. This MIP provides a step-by-step guide how to get there.</p>
<!--
  The Abstract is a multi-sentence (short paragraph) technical summary. This should be a very terse and human-readable version of the specification section. Someone should be able to read only the abstract to get the gist of what this specification does.

  TODO: Remove this comment before finalizing.
-->
<h2 id="motivation-12"><a class="header" href="#motivation-12">Motivation</a></h2>
<p>Gas fees should be used to pay for services that are required to operate the chain, provide for grants or other. Therefore, they should be captured in a governed pool.</p>
<!--
  The motivation section should include a description of any nontrivial problems the MIP solves. It should not describe how the MIP solves those problems.

  TODO: Remove this comment before finalizing.
-->
<h2 id="specification-11"><a class="header" href="#specification-11">Specification</a></h2>
<p>In the following a step-by-step guide to transition from the current model to the target step is provided:</p>
<ol>
<li>The gas token <code>\</code> is burned</li>
</ol>
<p>Instruction: Figure out where and how the gas token is burned in the current model.</p>
<ol start="2">
<li>Redirect gas fees to Movement Labs controlled address</li>
</ol>
<p>Instruction: Modify the code, such that the gas-fees go an address that is controlled by Movement Labs instead of burning the gas-fees.</p>
<ol start="3">
<li>Governed gas pool goes live.</li>
</ol>
<p>Instruction: Get a gas pool that has governance, see MIP-???.</p>
<ol start="4">
<li>Redirect gas payout address to governed gas pools.</li>
</ol>
<p>Instruction: Same as step 2, but change the target address.</p>
<ol start="5">
<li>Movement collected gas fees go to governed gas pools.</li>
</ol>
<p>At this point the Movement Labs controlled address would have collected some <code>\</code>, which should be handed over to the Government for redistribution. This wraps up the above procedures.</p>
<p>Instruction: Transfer the collected <code>\</code> on the Movement Labs address into the gas pool.</p>
<!--
  The Specification section should describe the syntax and semantics of any new feature. The specification should be detailed enough to allow competing, interoperable implementations.

  It is recommended to follow RFC 2119 and RFC 8170. Do not remove the key word definitions if RFC 2119 and RFC 8170 are followed.

  TODO: Remove this comment before finalizing
-->
<p>The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”, “RECOMMENDED”, “NOT RECOMMENDED”, “MAY”, and “OPTIONAL” in this document are to be interpreted as described in RFC 2119 and RFC 8174.</p>
<h2 id="reference-implementation-9"><a class="header" href="#reference-implementation-9">Reference Implementation</a></h2>
<!--
  The Reference Implementation section should include links to and an overview of a minimal implementation that assists in understanding or implementing this specification. The reference implementation is not a replacement for the Specification section, and the proposal should still be understandable without it.

  TODO: Remove this comment before submitting
-->
<h2 id="verification-11"><a class="header" href="#verification-11">Verification</a></h2>
<!--

  All proposals must contain a section that discusses the various aspects of verification pertinent to the introduced changes. This section should address:

  1. **Correctness**: Ensure that the proposed changes behave as expected in all scenarios. Highlight any tests, simulations, or proofs done to validate the correctness of the changes.

  2. **Security Implications**: Address the potential security ramifications of the proposal. This includes discussing security-relevant design decisions, potential vulnerabilities, important discussions, implementation-specific guidance, and pitfalls. Mention any threats, risks, and mitigation strategies associated with the proposal.

  3. **Performance Impacts**: Outline any performance tests conducted and the impact of the proposal on system performance. This could be in terms of speed, resource consumption, or other relevant metrics.

  4. **Validation Procedures**: Describe any procedures, tools, or methodologies used to validate the proposal against its requirements or objectives. 

  5. **Peer Review and Community Feedback**: Highlight any feedback from peer reviews or the community that played a crucial role in refining the verification process or the proposal itself.


  TODO: Remove this comment before submitting
-->
<p>Needs discussion.</p>
<hr />
<h2 id="errata-8"><a class="header" href="#errata-8">Errata</a></h2>
<!--
  Errata should be maintained after publication.

  1. **Transparency and Clarity**: An erratum acknowledges any corrections made post-publication, ensuring that readers are not misled and are always equipped with the most accurate information.

  2. **Accountability**: By noting errors openly, we maintain a high level of responsibility and ownership over our content. It’s an affirmation that we value precision and are ready to correct oversights.

  Each erratum should briefly describe the discrepancy and the correction made, accompanied by a reference to the date and version of the proposal in which the error was identified.

  TODO: Maintain this comment.
-->
<hr />
<h2 id="appendix-11"><a class="header" href="#appendix-11">Appendix</a></h2>
<!--
  The Appendix should contain an enumerated list of reference materials and notes.

  When referenced elsewhere each appendix should be called out with [A<number>](#A<number>) and should have a matching header.

  TODO: Remove this comment before finalizing.

-->
<h3 id="a1"><a class="header" href="#a1">A1</a></h3>
<p>Nothing important here.</p>
<hr />
<h2 id="copyright-3"><a class="header" href="#copyright-3">Copyright</a></h2>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="mip-48-aptos_governance-for-goverened-gas-pool"><a class="header" href="#mip-48-aptos_governance-for-goverened-gas-pool">MIP-48: <code>aptos_governance</code> for Goverened Gas Pool</a></h1>
<ul>
<li><strong>Description</strong>: Use the <code>aptos_governance</code> framework for the Governed Gas Pool</li>
<li><strong>Authors</strong>: <a href="mailto:richard@movementlabs.xyz">Richard Melkonian</a></li>
</ul>
<h2 id="abstract-13"><a class="header" href="#abstract-13">Abstract</a></h2>
<p>The Goverened Gas Pool design presented in <a href="Review/0xmovses/aptos-gov-pool/MIP/mip-48/../mip-44/">MIP-44</a> is required to be subject to onchain governance by a governing body that holds the
<code>$L2-MOVE</code> token. In [MIP-44] governance mechanisms and roles are proposed, such as <code>Proposers</code> and <code>Executors</code> so that the collected gas can be used
for the good of the network.</p>
<p>The Governed Gas Pool may be used to provide liquidity for different network needs, such as L1 Reward Tokens, or to enable the “Trickle-back”, where the <code>$L2-MOVE</code> would be paid
directly to attestors as <code>$L1-MOVE</code> for rewards. For all these activities a dispersal of funds is required, this MIP proposes concrete ways to manage dispersal events
in a safe immutable and secure manner.</p>
<p>To decide on how acrued <code>$L2-MOVE</code> in the Governed Gas Pool should be used, a robust and thorough implementation of governance should be proposed.</p>
<h2 id="motivation-13"><a class="header" href="#motivation-13">Motivation</a></h2>
<p>This MIP proposes an implementation of the governance mechanism proposed in [MIP-44] by using the <code>aptos_governance.move</code> module. We think this has several benefits.</p>
<ol>
<li><code>aptos_governance.move</code> is fully audited and battle tested.</li>
<li><code>aptos_governance.move</code> is currently in use on the Aptos Blockchain.</li>
<li>Using aptos governance prepares us for extendeding it and using it for future proposals to upgrade or migrate the network, this will be a fairly common necessity post-mainnet.</li>
<li>It strenghtens the utility of <code>$L2-MOVE</code> as this becomes the governance token.</li>
</ol>
<h2 id="specification-12"><a class="header" href="#specification-12">Specification</a></h2>
<p>The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”, “RECOMMENDED”, “NOT RECOMMENDED”, “MAY”, and “OPTIONAL” in this document are to be interpreted as described in RFC 2119 and RFC 8174.</p>
<h2 id="reference-implementation-10"><a class="header" href="#reference-implementation-10">Reference Implementation</a></h2>
<p>The <code>governed_gas_pool.move</code> would interact with <code>aptos_framework.move</code>, seperating the roles of actual governance, voting and storing of gas and dispersing those funds.</p>
<pre><code class="language-rust">//pseudocode
module GovernedGasPool::goverened_gas_pool {
    use aptos_framework::aptos_coin::AptosCoin;
    use aptos_framework::coin;
    use aptos_framework::signer;
    use aptos_framework::aptos_governance;
    use aptos_framework::aptos_governance::{self, GovernanceProposal};
    use aptos_std::vector;
    use aptos_std::option::{self, Option};

    // Address of the governance framework module
    const GOVERNANCE_ADDRESS: address = @0x1;

    struct GovernedPool has key {
        funds: coin::Coin&lt;AptosCoin&gt;,                // holds the pool of funds in AptosCoin
        passed_proposals: vector::Vector&lt;Proposal&gt;,  // list of proposals that passed governance
        admin: address                               // address with permission to execute proposals
    }

    struct DispersalAction has copy, drop, store {
        recipient: address,
        amount: u64
    }

    struct Proposal has key {
        id: u64,
        dispersal_action: Option&lt;DispersalAction&gt;, // Only one type of action at a time
        executed: bool,
    }

    /// Initialize the Governed Pool
    public fun initialize_governed_pool(admin: &amp;signer, authorized_admin: address): address {
        let governed_pool = GovernedPool {
            funds: coin::zero&lt;AptosCoin&gt;(),
            passed_proposals: vector::empty&lt;Proposal&gt;(),
            admin: authorized_admin
        };
        let addr = signer::address_of(admin);
        move_to(admin, governed_pool);
        addr
    }

    /// Add a proposal that has passed governance
    /// Only callable by the governance module at address 0x1
    public fun add_passed_proposal(
        pool: &amp;mut GovernedPool,
        governance_signer: &amp;signer,
        id: u64,
        dispersal_action: DispersalAction
    ) {
        // Ensure only the governance framework can call this function
        assert!(signer::address_of(governance_signer) == GOVERNANCE_ADDRESS, 1);

        // Verify that the proposal is approved in aptos_governance
        assert!(aptos_governance::is_proposal_approved&lt;GovernanceProposal&gt;(id), 2);

        let proposal = Proposal {
            id,
            dispersal_action: option::some(dispersal_action),
            executed: false,
        };
        vector::push_back(&amp;mut pool.passed_proposals, proposal);
    }

    /// Execute a proposal that has been approved by governance
    /// Only callable by the designated admin
    public fun execute_passed_proposal(pool: &amp;mut GovernedPool, executor: &amp;signer, proposal_id: u64) {
        // Ensure only the authorized admin can call this function
        assert!(signer::address_of(executor) == pool.admin, 2);

        let proposal_index = find_proposal(&amp;pool.passed_proposals, proposal_id);
        let proposal = &amp;mut vector::borrow_mut(&amp;mut pool.passed_proposals, proposal_index);

        // Ensure the proposal hasn't already been executed
        assert!(!proposal.executed, 3);

        // Execute the dispersal action if present
        if (option::is_some(&amp;proposal.dispersal_action)) {
            let action = option::borrow(&amp;proposal.dispersal_action).unwrap();
            let amount = action.amount;
            assert!(amount &lt;= coin::value(&amp;pool.funds), 4); // Ensure pool has sufficient funds
            coin::withdraw(&amp;mut pool.funds, amount);
            coin::deposit(&amp;signer::create(action.recipient), amount);
        };

        proposal.executed = true;
    }
}</code></pre>
<p>Notice the call :
<code>assert!(aptos_governance::is_proposal_approved&lt;GovernanceProposal&gt;(id), 2);</code></p>
<h2 id="verification-12"><a class="header" href="#verification-12">Verification</a></h2>
<h2 id="errata-9"><a class="header" href="#errata-9">Errata</a></h2>
<h2 id="appendix-12"><a class="header" href="#appendix-12">Appendix</a></h2>
<hr />
<h2 id="copyright-4"><a class="header" href="#copyright-4">Copyright</a></h2>
<p>Copyright and related rights waived via <a href="Review/0xmovses/aptos-gov-pool/MIP/mip-48/../LICENSE.html">CC0</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="mip-49-nb-ffs-governed-fees-and-rewards"><a class="header" href="#mip-49-nb-ffs-governed-fees-and-rewards">MIP-49: NB-FFS Governed Fees and Rewards</a></h1>
<ul>
<li><strong>Description</strong>: Proposes a fee model which prioritizes using governance to adjust FFS rewards in an NB-FFS L2 system.</li>
<li><strong>Authors</strong>: <a href="mailto:liam@movementlabs.xyz">Liam Monninger</a></li>
<li><strong>Reviewer</strong>: Andreas Penzkofer</li>
<li><strong>Desiderata</strong>: <a href="Review/l-monninger/just-reward/MIP/mip-49/../MD/md-49/README.html">MD-49</a></li>
</ul>
<h2 id="abstract-14"><a class="header" href="#abstract-14">Abstract</a></h2>
<p>In response to <a href="Review/l-monninger/just-reward/MIP/mip-49/../MD/md-n/README.html">MD-49</a>, we propose a fee model for an NB-FFS L2 system which interprets all fees as compensated for in gas fees, bridge fees, or FFS rewards which are adjusted by a governing body. We argue that this approach avoids many of the security and fairness issues that arise in more complex fee models, and is analogous to fee models used in traditional L1 systems. We provide an account of the complexity of other fee models and the limitations from which even theses models suffer. We exemplify these limitations by describing an NB-FFS system which uses Celestia as DA and Ethereum as the Settlement Layer.</p>
<h2 id="motivation-14"><a class="header" href="#motivation-14">Motivation</a></h2>
<p><a href="Review/l-monninger/just-reward/MIP/mip-49/../MD/md-n/README.html">MD-49</a> requests a means of computing, charging, and distributing gas fees for the Movement L2s which rely on a separate DA and Settlement Layer. We provide such means for an NB-FFS system.</p>
<h2 id="specification-13"><a class="header" href="#specification-13">Specification</a></h2>
<p><img src="Review/l-monninger/just-reward/MIP/mip-49/governed-fees-and-rewards.png" alt="NB-FFS Governed Fees and Rewards" /></p>
<h3 id="definitions-2"><a class="header" href="#definitions-2">Definitions</a></h3>
<ul>
<li><strong>FFS reward</strong>: a reward paid to a node operator in either the separate <code>L1RewardToken</code> or the <code>L1StakingToken</code> for participating in the network.</li>
<li><strong>L2 client</strong>: the end user of the L2 network who pays gas fees from their L2 wallet.</li>
<li><strong>validator</strong>: a node operator who runs a node participating in Execution, DA, and Settlement.</li>
<li><strong>delegator</strong>: a staking participant who delegates their stake to a validator.</li>
<li><strong>bridge client</strong>: the user of the bridge service who issues transactions on a source chain to be transferred to a destination chain.</li>
<li><strong>bridge operator</strong>: the operator of the bridge service who charges fees for transferring assets between chains.</li>
</ul>
<h3 id="requirements"><a class="header" href="#requirements">Requirements</a></h3>
<p>An NB-FFS <strong>Governed Reward system</strong> will meet the following requirements for fees:</p>
<ol>
<li>An NB-FFS Governed Reward system SHALL idenitfy to whom fees may be charged: L2 clients, Operator</li>
<li>An NB-FFS Governed Reward system MUST provide a means for the governing body to adjust the gas fees charged to L2 clients according to a vote. This is intended to ensure that the cost of using the L2 system is competitive with other systems.</li>
<li>An NB-FFS Governed Reward system MUST provide a means for the governing body to adjust the fees charged to bridge clients according to a vote. This is intended to ensure that the cost of using the bridge service is competitive with other systems.</li>
<li>An NB-FFS Governed Reward system MUST transfer gas fees into a <a href="https://github.com/movementlabsxyz/MIP/pulls">Governed Gas Pool</a> which SHALL be used to add additional rewards to the FFS rewards pool when needed.</li>
</ol>
<p>An NB-FFS <strong>Governed Reward system</strong> will meet the following requirements for rewards</p>
<ol>
<li>An NB-FFS Governed Rewards system SHALL idenitfy 3 operators to whom fees rewards may be paid: validators, delegators, and bridge operators.</li>
<li>An NB-FFS Governed Rewards system MUST provide a means for the governing body, e.g., Movement Labs to adjust FFS reward parameters according to a vote. This is intended to ensure the value of the FFS rewards exceeds difficult to compute costs of operating as a participant in the L2 system.</li>
<li>An NB-FFS Governed Rewards system SHALL compensate validators as a function of expected settlement and DA costs with FFS rewards, but does not need to recompute this expectations.</li>
<li>An NB-FFS Governed Rewards system SHALL compensate bridge operators with collected gas fees, but does not need to recompute these fees.</li>
</ol>
<h3 id="costs-and-computability"><a class="header" href="#costs-and-computability">Costs and Computability</a></h3>
<h4 id="execution-costs"><a class="header" href="#execution-costs">Execution Costs</a></h4>
<p>Execution costs MAY be computed using a VM gas algebra similar to those used in L1 protocols. These costs are intrinsic to the L2 system and are naturally paid by clients.</p>
<p>For example, under NB-FFS Governed Fees and Rewards, the <a href="https://aptos.dev/en/network/blockchain/base-gas">Aptos Gas Algebra</a> should be used to compute execution costs.</p>
<p><strong>Proportionality of Execution Costs to DA Costs</strong>:
In the event that the gas algebra renders a cost proportional to the byte size of the transaction, this cost can be seen as accounting for some of the DA costs. For example, the “payload” summands in the Aptos Gas Algebra can be seen as accounting for some of the DA costs.</p>
<p>Since gas fees are then paid into the Governed Gas Pool which is eventually used to fund the FFS Rewards Pool, we identify that proper adjustment of the FFS rewards for operators can partially be accounting for by execution gas fees. However, we suggest this as a reliable means of ensuring the availability of proportional funds for the FFS rewards pool, not as a means of directly compensating operators.</p>
<p><strong>Proportionality of Execution Costs to Settlement Costs</strong>:
We do not expect the gas algebra to account for settlement costs. Under FFS, settlement costs proportional to the number of validators. The size of an individual attestation is fixed and rendered for a <strong>block range</strong>. Thus, larger transactions will not incur larger settlement costs than smaller transactions.</p>
<h4 id="da-costs"><a class="header" href="#da-costs">DA Costs</a></h4>
<p>Under NB-FFS Governed Fees and Rewards, DA fee computation MUST not actively use an oracle or other live pricing model to introduce DA fees directly as <strong>L2 client</strong> gas fees. The security concerns of using an oracle to compute DA are commented on below. Instead, NB-FFS Governed Fees and Rewards recommends regarding the DA fee passed to <strong>L2 clients</strong> as 0, and the DA fee passed to <strong>validators</strong> as whatever the extrinsic system charges.</p>
<p>As idenitfied in <a href="https://github.com/movementlabsxyz/MIP/pulls">MIP-19</a>, in general, DA costs will be proportional to the byte size of a transaction. However, many DAs implement a gas priority system that effectively introduces additional fees for network congestion. These fees are difficutl to anticiptate and are often unbounded.</p>
<p>For example, in Celestia, fees take the following <a href="https://docs.celestia.org/how-to-guides/submit-data">form</a>:</p>
<pre><code class="language-math">\text{Total Fee} = \text{Gas Limit} * \text{Gas Price}
</code></pre>
<p>where:</p>
<ul>
<li><code>Gas Limit</code> is the maximum amount of gas that can be used for the transaction and is proportional to the byte size of the transaction.</li>
<li><code>Gas Price</code> is a price set by the user to incentivize validators to include the transaction in the next block.</li>
</ul>
<h4 id="settlement-costs"><a class="header" href="#settlement-costs">Settlement Costs</a></h4>
<p>Under NB-FFS Governed Fees and Rewards, settlement fee computation MUST not actively use an oracle or other live pricing model to introduce settlement fees directly as <strong>L2 client</strong> gas fees. The security concerns of using an oracle to compute settlement fees are commented on below. Instead, NB-FFS Governed Fees and Rewards recommends regarding the settlement fee passed to <strong>L2 clients</strong> as 0, and the settlement fee passed to <strong>validators</strong> as whatever the extrinsic system charges.</p>
<p>In general, settlement costs can be modeled in the following form:</p>
<pre><code class="language-math">\text{Settlement Cost} = \text{Number of Validators} * \text{L1 Gas Fee} 
</code></pre>
<pre><code class="language-math">+ \text{Postconfirmation L1 Gas fee}
</code></pre>
<p>where:</p>
<ul>
<li><code>Number of Validators</code> is the number of validators participating in the settlement.</li>
<li><code>L1 Gas Fee</code> is the gas fee charged by the Settlement Layer for commitments of validators.</li>
<li><code>Postconfirmation L1 Gas fee</code> is the gas fee charged by the Settlement Layer for the Postconfirmation process and other functionality like rollover of epochs.</li>
</ul>
<p>While the size of an FFS attestion is constant for any transaction. <code>L1 Gas Fee</code> and <code>Postconfirmation L1 Gas fee</code> is not. Most L1s including, ETH, have implemented either gas priority systems or dynamic gas fees.</p>
<h3 id="comparisons-to-other-fee-models"><a class="header" href="#comparisons-to-other-fee-models">Comparisons to Other Fee Models</a></h3>
<h4 id="oracle-based-fee-models"><a class="header" href="#oracle-based-fee-models">Oracle-Based Fee Models</a></h4>
<p>In contrast to NB-FFS Governed Fees and Rewards, oracle-based fee models attempt to actively price <strong>L2 client</strong> gas fees according to the costs of operating the L2 system via both (1) the estimation or computation of DA and Settlement costs and (2) the computation of the value of the L2 gas token in terms of the DA and Settlement Layer gas tokens.</p>
<p>Above, we discussed why it is difficult to anticipate DA and Settlement costs. While the former can be forgone in the event that the DA is always finalized before execution, the latter cannot as execution must occur before settlement.</p>
<p>Additionally, however, using an oracle model introduces complexity and ultimately set of security risks.</p>
<p>If the oracle model is trusted to appropriately account for the conversion rate between the L2 gas token and the DA and Settlement Layer gas tokens, then the oracle model is a single point of failure. If the oracle model is trusted, then the system is vulnerable to manipulation by the oracle.</p>
<h4 id="wrapped-token-fee-models"><a class="header" href="#wrapped-token-fee-models">Wrapped Token Fee Models</a></h4>
<p>In contrast to NB-FFS Governed Fees and Rewards, wrapped token fee models attempt to wrap L2 transactions with corresponding DA and Settlement transactions, or else require native inclusion of requisite gas tokens in the L2 system.</p>
<p>However, while DA fees can be known at execution, Settlement fees cannot. Thus, the wrapped token model would only account for tight bound on DA costs and would need to adopt a pessimistic model for Settlement costs. This would result in overcharging for Settlement costs.</p>
<h2 id="reference-implementation-11"><a class="header" href="#reference-implementation-11">Reference Implementation</a></h2>
<h2 id="verification-13"><a class="header" href="#verification-13">Verification</a></h2>
<h2 id="errata-10"><a class="header" href="#errata-10">Errata</a></h2>
<h2 id="appendix-13"><a class="header" href="#appendix-13">Appendix</a></h2>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="mip-50-insured-bridge"><a class="header" href="#mip-50-insured-bridge">MIP-50: Insured Bridge</a></h1>
<ul>
<li><strong>Description</strong>: Introduces an Insurance Fund for the bridge which can be used to cover losses.</li>
<li><strong>Authors</strong>: <a href="mailto:liam@movementlabs.xyz">Liam Monninger</a></li>
<li><strong>Reviewer</strong>: <a href="mailto:andreas.penzkofer@movementlabs.xyz">Andreas Penzkofer</a></li>
<li><strong>Desiderata</strong>: <a href="https://github.com/movementlabsxyz/MIP/pull/38">MD-38</a></li>
</ul>
<h2 id="abstract-15"><a class="header" href="#abstract-15">Abstract</a></h2>
<p>This MIP introduces an Insurance Fund for the bridge which can be used to cover losses. The Insurance Fund will be used to cover losses in the event of a hack or other catastrophic event and can insure a fixed supply of token is maintained.</p>
<h2 id="motivation-15"><a class="header" href="#motivation-15">Motivation</a></h2>
<p><a href="https://github.com/movementlabsxyz/MIP/pull/38">MD-38</a> requests provisions for use of AB-FFS that enable a fixed supply of token. This MIP introduces an Insurance Fund for the bridge which can be used to cover losses. The Insurance Fund will be used to cover losses in the event of a hack or other catastrophic event and can insure a fixed supply of token is maintained.</p>
<h2 id="specification-14"><a class="header" href="#specification-14">Specification</a></h2>
<p><img src="Review/l-monninger/insured-bridge/MIP/mip-50/./insured-bridge.png" alt="Insured Bridge" /></p>
<ol>
<li>The Insurance Fund MUST store a supply of token greater than the sum of all transfer value which can flow over the bridge between during the Risk Period.</li>
<li>The Risk Period MUST reflect the time it takes for an informer to recognize the loss between the two chains and the time it takes for the Insurance Fund Governor to trigger the Insurance Fund to burn token.</li>
<li>The Insurance Fund Governor MUST trigger the Insurance Fund to burn token in proportion to the surplus of value recorded between the two chains.</li>
<li>An Informer SHALL be expected to report to the Insurance Fund Governor that the circulation exceeds the supply of token.</li>
<li>The Insurance Fund Governor MUST account for some error on the value that is recorded on L1 and L2 by the informer. More specifically, due to the asynchrony of the bridge transfer steps as well the asynchrony in finality between L1 and L2, total circulating supply could and will vary at times, within some bounds.</li>
<li>The Bridge Pool Governor SHALL be expected to purchase token from the market to recover the loss and replenish the Insurance Fund.</li>
</ol>
<h2 id="verification-14"><a class="header" href="#verification-14">Verification</a></h2>
<h2 id="errata-11"><a class="header" href="#errata-11">Errata</a></h2>
<h2 id="appendix-14"><a class="header" href="#appendix-14">Appendix</a></h2>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="mip-54-the-biarritz-model"><a class="header" href="#mip-54-the-biarritz-model">MIP-54: The Biarritz Model</a></h1>
<ul>
<li><strong>Description</strong>: Proposes an AB-FFS L2 model that features on a Governed Gas Pool, Bridge Insurance Fund, and moderate operational assumptions.</li>
<li><strong>Authors</strong>: <a href="mailto:liam@movementlabs.xyz">Liam Monninger</a></li>
<li><strong>Reviewer</strong>: Andreas Penzkofer</li>
<li><strong>Desiderata</strong>: <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8056em;vertical-align:-0.0556em;"></span><span class="mord">∅</span></span></span></span></li>
</ul>
<h2 id="abstract-16"><a class="header" href="#abstract-16">Abstract</a></h2>
<p>We defined the Biarritz Model as an AB-FFS L2 model that features on a Governed Gas Pool, Bridge Insurance Fund, and moderate operational assumptions. At the core of this model is the progressive use of governance to safely perform liquidity operations which are difficult to synchronize in an early AB-FFS L2.</p>
<h2 id="motivation-16"><a class="header" href="#motivation-16">Motivation</a></h2>
<p>The Biarritz Model is motivated by the need for a progressive L2 model that can safely perform liquidity operations which are difficult to synchronize in an early AB-FFS L2. This model is intended to be a stepping stone towards more complex L2 models that require more sophisticated governance and operational assumptions.</p>
<p>The Biarritz Model is a intended as a complete response to <a href="https://github.com/movementlabsxyz/MIP/pulls">MD-38</a>.</p>
<h2 id="specification-15"><a class="header" href="#specification-15">Specification</a></h2>
<p><img src="Review/l-monninger/the-biarritz-model/MIP/mip-54/the-biarritz-model.png" alt="The Biarritz Model" /></p>
<p>We acknowledge and apply the conventions of <a href="https://github.com/movementlabsxyz/MIP/pull/53">MIP-53: Conventions for Proposing Progressive L2 Models</a>.</p>
<div class="table-wrapper"><table><thead><tr><th>Category</th><th>Criterion</th><th>Evaluation</th></tr></thead><tbody>
<tr><td><strong>General</strong></td><td></td><td></td></tr>
<tr><td></td><td>When to use</td><td>When a transition between a genesis or centralized phase form of the L2 system is apt but when security and safeness of design and implementation are still contested.</td></tr>
<tr><td></td><td></td><td>When a secondary centralized phase of the L2 system is desired alongside increasing transparency of centralized operations.</td></tr>
<tr><td></td><td>Suitable preceding models</td><td><a href="https://github.com/movementlabsxyz/MIP/pull/53">MIP-55: The Bilbao Model</a></td></tr>
<tr><td></td><td>Suitable succeeding models</td><td><a href="https://github.com/movementlabsxyz/MIP/pull/40">MIP-40: AB-FFS Decoupled</a> INCOMPLETE</td></tr>
<tr><td></td><td>Technological motivations</td><td>Contends with bridge fallibility under operational assumptions.</td></tr>
<tr><td></td><td></td><td>Begins formal governance, but continues to allow for manual flexibility and recovery.</td></tr>
<tr><td></td><td>Usership motivations</td><td>Provides network which is more open than <a href="https://github.com/movementlabsxyz/MIP/pull/53">MIP-55: The Bilbao Model</a>, potentially encouraging adoption.</td></tr>
<tr><td><strong>Components</strong></td><td></td><td></td></tr>
<tr><td></td><td><a href="https://github.com/movementlabsxyz/MIP/pulls">MIP-44: AB-FFS Governed Gas Pool</a></td><td>The Governed Gas Pool into which gas fees are deposited and from which the governing body disperses.</td></tr>
<tr><td></td><td><a href="https://github.com/movementlabsxyz/MIP/pull/49">MIP-49: AB-FFS Governed Rewards and Fees</a></td><td>The means by which gas fees and rewards are adjusted by the governing body. Rewards are migrated manually from the L2 to the L1 by the governing body.</td></tr>
<tr><td></td><td><a href="https://github.com/movementlabsxyz/MIP/pull/50">MIP-50: Insured Bridge</a></td><td>The Bridge Insurance Fund which is used to cover the cost of failed bridge operations. Insures atomically and synchronously that all losses from bridge failures can be covered.</td></tr>
<tr><td></td><td>L1-L2 Token Correlation</td><td>The L1 staking and L2 gas token are bridge 1:1.</td></tr>
<tr><td><strong>Operational Assumptions</strong></td><td></td><td></td></tr>
<tr><td></td><td><strong>Bridge Liveness</strong></td><td>Operators can be relied upon to meet bridge liveness requirements.</td></tr>
<tr><td></td><td><strong>Security of Governance</strong></td><td>Governing body’s powers cannot be exploited.</td></tr>
<tr><td></td><td><strong>Trust of Governance</strong></td><td>Users are willing to trust governing body.</td></tr>
</tbody></table>
</div>
<h3 id="pros"><a class="header" href="#pros">Pros</a></h3>
<ol>
<li><strong>Delayed calculation of rewards to cover centralized expenses</strong>: because fees are held in the gas pool, the governing body need not calculate rewards which would be used to cover their own operating expenses until control of the governance is transferred to the community. The governing body can, for example, decide to use a percentage of captured gas to pay the centralized operators when a more stable token price is known some time after the L2 has been operational.</li>
<li><strong>On-chain safety of bridge</strong>: the insurance of the bridge makes on-chain guarantees that all losses from bridge failures can be covered. This is a significant improvement over the Bilbao Model which requires off-chain coordination to cover losses.</li>
<li><strong>Ease of migration</strong>: the model is designed to be easily migrated to a more decentralized model. The governing body can be replaced by a DAO or other decentralized governance model with minimal changes to the operational assumptions.</li>
<li><strong>Delayed migration of rewards</strong>: the model allows for the governing body to manually migrate rewards from the L2 to the L1. This allows for a more gradual transition to a decentralized model and can avoid attacks available in more tightly integrated models.</li>
</ol>
<h3 id="cons"><a class="header" href="#cons">Cons</a></h3>
<ol>
<li><strong>High trust in governance</strong>: the model requires a high level of trust in the governing body. When the governing body is narrowly defined, this may not be significantly more open than the Bilbao Model.</li>
<li><strong>1:1 token correlation</strong>: the model asserts a 1:1 token correlation between the L1 staking and L2 gas tokens. This may not be desirable in all cases as exploits on the bridge may compromise the security of staking on the L1 or sybil resistance on the L2.</li>
</ol>
<h2 id="verification-15"><a class="header" href="#verification-15">Verification</a></h2>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="mip-55-the-bilbao-model"><a class="header" href="#mip-55-the-bilbao-model">MIP-55: The Bilbao Model</a></h1>
<ul>
<li><strong>Description</strong>: Proposes an AB-FFS L2 model that features a Gas Deficit Minter, Bridge Insurance Account, low-cost DA and settlement, high centralized control, and ultimately high operational assumptions.</li>
<li><strong>Authors</strong>: <a href="mailto:liam@movementlabs.xyz">Liam Monninger</a></li>
<li><strong>Reviewer</strong>: Andreas Penzkofer</li>
<li><strong>Desiderata</strong>: <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8056em;vertical-align:-0.0556em;"></span><span class="mord">∅</span></span></span></span></li>
</ul>
<h2 id="abstract-17"><a class="header" href="#abstract-17">Abstract</a></h2>
<p>We define the Bilbao Model as an AB-FFS L2 model that features a Gas Deficit Minter, Bridge Insurance Account, low-cost DA, high centralized control, and ultimately high operational assumptions. At the core of this model is the highly-controlled use of trusted signers with high liquidity to replace components proposed in the <a href="https://github.com/movementlabsxyz/MIP/pull/54">Biarritz Model</a>.</p>
<h2 id="motivation-17"><a class="header" href="#motivation-17">Motivation</a></h2>
<p>The Bilbao Model is a intended as a complete response to <a href="https://github.com/movementlabsxyz/MIP/pulls">MD-38</a> and a reduction of the <a href="https://github.com/movementlabsxyz/MIP/pull/54">Biarritz Model</a>.</p>
<h2 id="specification-16"><a class="header" href="#specification-16">Specification</a></h2>
<p>We acknowledge and apply the conventions of <a href="https://github.com/movementlabsxyz/MIP/pull/53">MIP-53: Conventions for Proposing Progressive L2 Models</a>.</p>
<div class="table-wrapper"><table><thead><tr><th>Category</th><th>Criterion</th><th>Evaluation</th></tr></thead><tbody>
<tr><td><strong>General</strong></td><td></td><td></td></tr>
<tr><td></td><td>When to use</td><td>During a genesis period after which the resulting state is intended to be accepted as canonical by a more decentralized network</td></tr>
<tr><td></td><td></td><td>The benefits to the network of an immediate release against early technology outstrip the potential costs of failing to correctly resolve vulnerabilities introduce in genesis state.</td></tr>
<tr><td></td><td>Suitable preceding models.<br></td><td>NONE</td></tr>
<tr><td></td><td>Suitable succeeding models</td><td><a href="https://github.com/movementlabsxyz/MIP/pull/54">MIP-54: The Biarritz Model</a></td></tr>
<tr><td></td><td>Technological motivations</td><td>Contends with bridge fallibility under high operational assumptions.</td></tr>
<tr><td></td><td></td><td>Allows for building genesis state which can be altered prior to open launch.</td></tr>
<tr><td></td><td>Usership motivations</td><td>Allows for early release of network.</td></tr>
<tr><td><strong>Components</strong></td><td></td><td></td></tr>
<tr><td></td><td>Gas Deficit Minter</td><td>We recognize the role of the Governed Gas Pool as one which can be replaced by simply computing and minting the burned gas to a governed account ex post facto. The Gas Deficit Minter thus takes on the role of allowing for the manual capture of gas fees.</td></tr>
<tr><td></td><td>Bridge Insurance Account</td><td>We recognize the role of the Bridge Insurance Fund as similar to that of a singular account which can replace bridge losses. While the guarantees are weaker than those proposed under <a href="https://github.com/movementlabsxyz/MIP/pull/54">MIP-54: The Biarritz Model</a>, this can be sufficient to insure safe liquidity invariance under the presumed Right to Rollback or Right to Invalidate and Migrate</td></tr>
<tr><td></td><td>Right to Rollback</td><td>Operators may revert or roll back ledger versions prior to the Bilbao Model concluding its role as a genesis stage</td></tr>
<tr><td></td><td>Right to Invalidate and Migrate</td><td>Operators may invalidate or migrate elements of state prior to the Bilbao Model concluding its role as a genesis stage.</td></tr>
<tr><td></td><td>Low-cost DA</td><td>The model assumes that the cost of the DA is low, for example that in internal or testnet environment is used for the genesis DA. This allows for concerns about gas fees to be deferred until the network is more stable, i.e., for immediate financial risks to the network to be regarded as negligible.</td></tr>
<tr><td></td><td>Low-cost Settlement</td><td>The model assumes that the cost of settlement is low, for example that in internal or testnet environment is used for the genesis settlement. This allows for concerns about gas fees to be deferred until the network is more stable, i.e., for immediate financial risks to the network to be regarded as negligible.</td></tr>
<tr><td></td><td>Signers Whitelist (Optional)</td><td>The model assumes that the signers are whitelisted and that the whitelist can be updated by the governing body. This increases the trustedness of the genesis ceremony and can be used to ensure that the network is not compromised by a malicious actor.</td></tr>
<tr><td><strong>Operational Assumptions</strong></td><td></td><td></td></tr>
<tr><td></td><td><strong>Low Availability Requirements</strong></td><td>Crashes are allowed to occur frequently. The state of the network is critical; its liveness is not.</td></tr>
<tr><td></td><td><strong>Fixes Can be Introduced Prior to Relinquishing Rights</strong></td><td>Once the Right to Rollback and the Right to Invalidate and Migrate are relinquished, all ability to fix vulnerabilities introduced in genesis state will be lost. To this end, it is assumed that outstanding concerns at the time of transition to the next stage, or else the network would forever remain under the Bilbao Model.</td></tr>
<tr><td></td><td><strong>Trust of Governance</strong></td><td>Users are willing to trust governing body with the operations described.</td></tr>
</tbody></table>
</div>
<h3 id="pros-1"><a class="header" href="#pros-1">Pros</a></h3>
<ol>
<li><strong>Delayed calculation of rewards to cover centralized expenses</strong>: because fees are held in the gas pool, the governing body need not calculate rewards which would be used to cover their own operating expenses until control of the governance is transferred to the community. The governing body can, for example, decide to use a percentage of captured gas to pay the centralized operators when a more stable token price is known some time after the L2 has been operational.</li>
<li><strong>Usable but recoverable period of network liveness</strong>: the model allows for an early-stage network to be introduced with a high level of control over the network’s state. This allows for the network to be introduced with the potential for long-term implications which is critical to network utility, while at the same time minimizing the implication of early misuse.</li>
</ol>
<h3 id="cons-1"><a class="header" href="#cons-1">Cons</a></h3>
<ol>
<li><strong>Highest trust in governance</strong>: the model requires complete trust in the governing body.</li>
<li><strong>1:1 token correlation</strong>: the model asserts a 1:1 token correlation between the L1 staking and L2 gas tokens. This may not be desirable in all cases as exploits on the bridge may compromise the security of staking on the L1 or sybil resistance on the L2.</li>
</ol>
<h2 id="verification-16"><a class="header" href="#verification-16">Verification</a></h2>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="mip-57-informer-for-the-operation-of-the-htlc-based-native-bridge"><a class="header" href="#mip-57-informer-for-the-operation-of-the-htlc-based-native-bridge">MIP-57: Informer for the Operation of the HTLC-based Native Bridge</a></h1>
<ul>
<li><strong>Description</strong>: The Informer collects data from L1 and L2 about the circulating supply of \ tokens, which is critical for the safe operation of the HTLC-based Native Bridge.</li>
<li><strong>Authors</strong>: <a href="mailto:andreas.penzkofer@movementlabs.xyz">Andreas Penzkofer</a></li>
</ul>
<h2 id="abstract-18"><a class="header" href="#abstract-18">Abstract</a></h2>
<p>The Informer for the HTLC-based Native Bridge (in the following called simply the Native Bridge) is introduced to collect information about the state from L1 and L2 and provide this information to components of the Native Bridge. The provided information is critical to the safe operation of bridge components such as the Rate-Limiter, the Security Fund, and the Bridge Operator.</p>
<h2 id="motivation-18"><a class="header" href="#motivation-18">Motivation</a></h2>
<p>Several components should react if the bridge is under attack. However these components require knowledge about the states of L1 and L2. In particular, the considered components are the insurance fund, see <a href="https://github.com/movementlabsxyz/MIP/pull/50">MIP-50</a> and the Rate-Limiter, see <a href="https://github.com/movementlabsxyz/MIP/pull/56">MIP-56</a>. In addition the operation of these components may be handled via a governance, which could also rely on state information.</p>
<p>The Informer is a trusted component that provides this information.</p>
<h2 id="specification-17"><a class="header" href="#specification-17">Specification</a></h2>
<p>The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”, “RECOMMENDED”, “NOT RECOMMENDED”, “MAY”, and “OPTIONAL” in this document are to be interpreted as described in RFC 2119 and RFC 8174.</p>
<p><img src="Review/mip/informer/MIP/mip-57/overview.png" alt="Overview" />
<em>Figure 1: Dependencies of components on the Informer mechanism in the Native Bridge.</em></p>
<p>The informer collects information about the state of liquid $L1MOVE and $L2MOVE and provides this information to components of the Native Bridge. The Informer is a trusted component that is critical to the safe operation of the Native Bridge.</p>
<ol>
<li>The Informer is a component that MUST run a node or client on L1 and on L2.</li>
<li>On L1 the Informer SHOULD read the liquid supply <code>L1MOVE_circulating</code> of $L1MOVE token at the <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span>-confirmed state. The definition of <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.0833em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">co</span><span class="mord mathnormal">n</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal">i</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">m</span><span class="mord mathnormal">e</span><span class="mord mathnormal">d</span></span></span></span> is given in <a href="https://github.com/movementlabsxyz/movement/issues/838">Issue-838</a>.</li>
<li>On L2 the Informer SHOULD read the liquid supply <code>L2MOVE_circulating</code> of $L2MOVE token at the <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">m</span></span></span></span>-confirmed state.</li>
<li>The values for <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span> and <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">m</span></span></span></span> MUST be the same as the value of <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span> and <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">m</span></span></span></span> in the bridge parameters.</li>
<li>Since L1 blocks have timestamps we say the Informer reads <code>L1MOVE_circulating(t_L1)</code>.</li>
<li>We assume that L2 blocks acquire timestamps from the sequencing protocol, e.g. Celestia. Thus the Informer reads <code>L2MOVE_circulating(t_L2)</code>.</li>
</ol>
<p><strong>TLDR: Informer Information and Warnings</strong></p>
<p>The Informer SHOULD provide the information about the circulating $L1MOVE and $L2MOVE supply <code>MOVE_circulating(t)</code>, <a href="Review/mip/informer/MIP/mip-57/index.html#measuring-circulating-supply">see here</a>. The circulating supply is lowered from the desired maximum circulating supply <code>MOVE_Max</code> by the inflight tokens, <a href="Review/mip/informer/MIP/mip-57/index.html#inflight-tokens">see here</a>. The inflight-token can be over-approximated.</p>
<p>The Informer SHOULD provide a warning if the circulating supply exceeds the maximum circulating supply <code>MOVE_Max</code>. However, due difference in clocks between layers, <a href="Review/mip/informer/MIP/mip-57/index.html#difference-in-layer-timestamps">see here</a>, and the over-approximation of inflight-token, the measured circulating supply could be above <code>MOVE_Max</code>.</p>
<h4 id="measuring-circulating-supply"><a class="header" href="#measuring-circulating-supply">Measuring circulating supply</a></h4>
<p>The circulating supply of \ token <code>MOVE_circulating(t) = L1MOVE_circulating(t) + L2MOVE_circulating(t)</code>.</p>
<blockquote>
<p>[!WARNING] If we do not want to run into the risk that measured circulating supply may become invalidated through reorgs we COULD consider finalized states only, i.e. we would require <code>t_now - t &gt; max{t_L1finality,t_L2finality}</code>.</p>
</blockquote>
<h4 id="inflight-tokens"><a class="header" href="#inflight-tokens">Inflight tokens</a></h4>
<p>Inflight tokens are tokens that are locked (burned) on L1 (L2) but that are not yet minted (unlocked) on L2 (L1).</p>
<p>We refer to the following illustration for a bridge transfer from L1 to L2, which is taken from <a href="https://github.com/movementlabsxyz/MIP/pull/39">MIP-39</a>.</p>
<p><img src="Review/mip/informer/MIP/mip-57/L1ToL2.png" alt="L1 to L2 Transfer" />
<em>Figure 2: Illustration of L1 to L2 token transfer process. Both the good path (transfer succeeds) and the bad path (transfer fails due to timeout) is shown.</em></p>
<p>Assume some $L1MOVE is locked (with finalization) at time <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7651em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>.</p>
<ul>
<li>On the <strong>good path</strong> the equivalent $L2MOVE token is minted on L2 at time <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7651em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>, where <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord">Δ</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7651em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7651em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span></span></span></span><code>[2 * t_L2finality, t_L2finality + timelock2]</code>. In other words the total circulating supply of $MOVE is decreased by the amount of locked $L1MOVE tokens for <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord">Δ</span><span class="mord mathnormal">t</span></span></span></span>.</li>
<li>On the <strong>bad path</strong> there is no equivalent minted $L2MOVE token on L2 minted. Instead, after <code>timelock1</code> the locked $L1MOVE token is unlocked on L1. The total circulating supply of $MOVE is decreased by the amount of locked $L1MOVE tokens for <code>timelock1</code>.</li>
</ul>
<p>For the inverse transfer from L2 to L1 the same arguments hold.</p>
<p>The rate limit is determined by the reaction time of the bridge operator <code>risk_period</code>, and the value <code>security_fund</code> locked in the <strong>Security Fund</strong>, see <a href="https://github.com/movementlabsxyz/MIP/pull/50">MIP-50</a>. We assume that L1-&gt;L2 is rate limited by <code>rate_limit_L1L2</code> and L2-&gt;L1 is rate limited by <code>rate_limit_L2L1</code>.</p>
<p>Then the maximum amount of tokens that can be inflight is determined by the bad path:</p>
<ul>
<li><code>inflight_L1L2 = ratelimit_L1L2 * risk_period * inflight_factor</code> for L1-&gt;L2, and</li>
<li><code>inflight_L2L1 = ratelimit_L2L1 * risk_period * inflight_factor</code> for L2-&gt;L1.</li>
</ul>
<p>where <code>inflight_factor = 1 + timelock / risk_period</code>. If we consider only the good path then the maximum amount of tokens that can be inflight is</p>
<ul>
<li><code>inflight_L1L2 = ratelimit_L1L2 * risk_period * 2</code> for L1-&gt;L2, and</li>
<li><code>inflight_L2L1 = ratelimit_L2L1 * risk_period * 2</code> for L2-&gt;L1.</li>
</ul>
<p><strong>Measurement of inflight tokens</strong>
The Informer can provide an estimate on the inflight tokens. In particular it is aware how many tokens are inflight on L1 <code>token_inflight_L1</code> and also on L2 <code>token_inflight_L2</code>. The sum of which provides an upper, but much preciser bound on the inflight tokens. Note however that</p>
<p><code>MOVE_circulating(t) = L1MOVE_circulating(t) + L2MOVE_circulating(t) + token_inflight_L1 + token_inflight_L2 &gt;= MOVE_max</code>.</p>
<p>I.e. this measurement could overestimate the token supply.</p>
<h4 id="difference-in-layer-timestamps"><a class="header" href="#difference-in-layer-timestamps">Difference in Layer Timestamps</a></h4>
<p>The timestamps of the two layers are not synchronized. We assume that the difference is negligible, however, for correctness, the implications of a drift between the L1 and L2 clocks should be considered. Moreover, the clocks of the layers progress discretely. This means that the Informer has to read at slightly different times on L1 and L2.</p>
<p>This error in the calculation of circulating token <code>error_token_circulating</code> due to difference in timestamps between L1 and L2 can be net positive. Thus the measured circulating supply of \ could be above <code>MOVE_max</code>.</p>
<p>Since the time difference should be small the error should be no more than the rate budget of two intervals, i.e. <code>error_token_circulating &lt;= (ratelimit_L1L2 + ratelimit_L2L1 ) * risk_period * 2</code>.</p>
<h3 id="recommendations"><a class="header" href="#recommendations">Recommendations</a></h3>
<ol>
<li>It is recommended that <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7335em;vertical-align:-0.0391em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">32</span></span></span></span>, i.e. at least one epoch.</li>
<li>It is recommended that <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">3</span></span></span></span>.
On L2 we assume a pBFT-like algorithm for the consensus on transaction-blocks, If the protocol is pipelined, this would indicate that 3 blocks are required to finalize. If all phases of the BFT consensus algorithm are handled within one block, then <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span> is sufficient.
With Celestia this would be approximately after <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">36</span><span class="mord mathnormal">sec</span></span></span></span>. (The block time of <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">12</span><span class="mord mathnormal">sec</span></span></span></span> is taken from the <a href="https://docs.celestia.org/tutorials/integrate-celestia">Celestia documentation</a> and the <a href="https://celestia.explorers.guru/">Celestia explorer</a>).</li>
</ol>
<h3 id="optimizations-1"><a class="header" href="#optimizations-1">Optimizations</a></h3>
<ol>
<li>Instead of reading the <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span>-confirmed state, the Informer COULD consider the finalized state. The finalized state is achieved approximately after two epochs (one epoch holds 32 blocks if no blocks are missed), see <a href="https://x.com/LogarithmicRex/status/1578540111930699778">this tweet</a> and <a href="https://ethos.dev/beacon-chain">this article</a>.</li>
<li>For security purposes the Informer COULD consider only the state produced by L2 blocks that have been <a href="https://github.com/movementlabsxyz/MIP/pull/37">postconfirmed</a> on L1.</li>
</ol>
<h2 id="reference-implementation-12"><a class="header" href="#reference-implementation-12">Reference Implementation</a></h2>
<!--
  The Reference Implementation section should include links to and an overview of a minimal implementation that assists in understanding or implementing this specification. The reference implementation is not a replacement for the Specification section, and the proposal should still be understandable without it.

  TODO: Remove this comment before submitting
-->
<h2 id="verification-17"><a class="header" href="#verification-17">Verification</a></h2>
<!--

  All proposals must contain a section that discusses the various aspects of verification pertinent to the introduced changes. This section should address:

  1. **Correctness**: Ensure that the proposed changes behave as expected in all scenarios. Highlight any tests, simulations, or proofs done to validate the correctness of the changes.

  2. **Security Implications**: Address the potential security ramifications of the proposal. This includes discussing security-relevant design decisions, potential vulnerabilities, important discussions, implementation-specific guidance, and pitfalls. Mention any threats, risks, and mitigation strategies associated with the proposal.

  3. **Performance Impacts**: Outline any performance tests conducted and the impact of the proposal on system performance. This could be in terms of speed, resource consumption, or other relevant metrics.

  4. **Validation Procedures**: Describe any procedures, tools, or methodologies used to validate the proposal against its requirements or objectives. 

  5. **Peer Review and Community Feedback**: Highlight any feedback from peer reviews or the community that played a crucial role in refining the verification process or the proposal itself.

  TODO: Remove this comment before submitting
-->
<p>Needs discussion.</p>
<hr />
<h2 id="errata-12"><a class="header" href="#errata-12">Errata</a></h2>
<!--
  Errata should be maintained after publication.

  1. **Transparency and Clarity**: An erratum acknowledges any corrections made post-publication, ensuring that readers are not misled and are always equipped with the most accurate information.

  2. **Accountability**: By noting errors openly, we maintain a high level of responsibility and ownership over our content. It’s an affirmation that we value precision and are ready to correct oversights.

  Each erratum should briefly describe the discrepancy and the correction made, accompanied by a reference to the date and version of the proposal in which the error was identified.

  TODO: Maintain this comment.
-->
<h2 id="copyright-5"><a class="header" href="#copyright-5">Copyright</a></h2>
<p>Copyright and related rights waived via <a href="Review/mip/informer/MIP/mip-57/../LICENSE.html">CC0</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="mip-58-lockmint-type-native-bridge-with-trusted-relayer"><a class="header" href="#mip-58-lockmint-type-native-bridge-with-trusted-relayer">MIP-58: Lock/Mint-type Native Bridge with trusted Relayer</a></h1>
<ul>
<li><strong>Description</strong>: Proposes a lock/mint-type Native Bridge that capitalizes on the trust-assumption on the Relayer.</li>
<li><strong>Authors</strong>: <a href="mailto:primata@movementlabs.xyz">Primata</a>, Andreas Penzkofer</li>
</ul>
<h2 id="abstract-19"><a class="header" href="#abstract-19">Abstract</a></h2>
<p>We propose a lock/mint-type Native Bridge. The lock/mint bridge design streamlines operations, enhances security, and improves user experience (compared to the previously employed HTLC-based Native Bridge) making it easier to bridge assets between chains.</p>
<h2 id="motivation-19"><a class="header" href="#motivation-19">Motivation</a></h2>
<p>Different types of bridges have been considered for the Native Bridge, see <a href="https://github.com/movementlabsxyz/MIP/pull/60">MIP-60</a>. The initial design employed a HTLC-based bridge, which has been found to lead to bad UX, requires four transactions, and a complex design.</p>
<p>This proposal advocates for replacing the current HTLC-based bridge design, with a lock/mint-type bridge with a simpler and more efficient two-transaction mechanism. The proposed design reduces costs, enhances security, minimizes user friction, and avoids potential exploits caused by refund logic. It addresses long-standing issues such as reliance on sponsored transactions, outdated audits, and unimplemented fee mechanisms speeding the process to achieve a fully functional bridge that movement yet has been unable to complete, and lots of under issues raised and still pending.</p>
<p><strong>Reminder: HTLC-based bridge</strong></p>
<p>The HTLC-type Native Bridge design poses numerous challenges, including inefficiency, cost, and user frustration:</p>
<ol>
<li><strong>Transaction complexity</strong>
Requires four interactions:
<ul>
<li>Two by the user (initiate the transfer and finalize the transfer).</li>
<li>One by the Relayer to complete the transfer.</li>
<li>One by a third party (tasked to the Relayer) to finalize refunds in case of failure.</li>
<li>If any of these fails, users and the operator face losses.</li>
</ul>
</li>
<li><strong>High cost</strong>
<ul>
<li>The multi-transaction setup is expensive for both users and the operator.</li>
<li>Estimations in fee calculation that are too far off can result in significant losses.</li>
<li>If fees are miscalculated by 25%, this leads to a 25% loss. When L1 fees increase, the loss can escalate dramatically in absolute terms.</li>
</ul>
</li>
<li><strong>Unfriendly user experience</strong>
<ul>
<li>The current design requires users to have funds on the target chain for finalization. This increases friction and discourages adoption.</li>
<li>Sponsored transactions are essential to the current implementation but remain unimplemented, leaving users stranded without funds.</li>
</ul>
</li>
<li><strong>Security risks</strong>
<ul>
<li>Relayer keys are a critical point of failure. This assumption cannot be avoided.</li>
<li>Refund logic introduces vulnerabilities where attackers could exploit the rate limit and Relayer downtime.</li>
<li>For instance, if the Relayer fails to finalize on the initiator, a malicious actor could:
<ul>
<li>Take over the refund keys.</li>
<li>Exploit both directions of the bridge (e.g., $L1MOVE→$L2MOVE and $L2MOVE→$L1MOVE) repeatedly, draining funds.</li>
</ul>
</li>
</ul>
</li>
<li><strong>Maintenance burden</strong>
<ul>
<li>The current design requires a complete UI/UX overhaul, adding complexity and delay.</li>
</ul>
</li>
<li><strong>Unnecessary complexity</strong>
<ul>
<li>HTLC-based bridges are largely abandoned in favor of simpler, more effective designs.</li>
<li>Examples like the <a href="https://github.com/Consensys/htlc-bridge">Consensys HTLC</a> bridge demonstrate the <a href="https://entethalliance.org/crosschain-bridges-overview-where-we-are-now/">pitfalls of such approaches</a>.</li>
</ul>
</li>
<li><strong>Infrastructure simplification</strong>
<ul>
<li>Infrastructure is still incomplete for the current HTLC bridge design and we are struggling to find sound solutions that balance UI/UX and security. For example, <a href="https://github.com/movementlabsxyz/movement/issues/838">this issue</a> regarding UX vs number of confirmations to require on the Ethereum side, is still under debate.</li>
<li>Because of the over-engineered design, infrastructure is prone to error and we might end up being damaged by the amount of infrastructure we have not built yet and has to be built for the Relayer to fully function.</li>
<li>We could strip down the Relayer code and achieve a final design much more quickly.</li>
</ul>
</li>
</ol>
<p><strong>Protocol simplification (compared to HTLC-based Native Bridge)</strong></p>
<p>The proposed lock/mint bridge design mitigates these issues, creating a safer, faster, and user-friendly bridge while maintaining operational reliability.</p>
<ul>
<li>Combine lock and completion functionality on the counterparty contract.</li>
<li>Remove refund logic to streamline operations and improve security.</li>
<li>Cheaper transactions because of reduction of logic.</li>
<li>Consolidate Initiator and Counterparty into a single contract (this might be the most dangerous thing proposed but it has already been proposed for HTLC Native Bridge implementation).</li>
</ul>
<h2 id="specification-18"><a class="header" href="#specification-18">Specification</a></h2>
<p>The lock/mint bridge design focuses on minimizing complexity and maximizing security. It also leverages the trust assumption on the Relayer to streamline operations and enhance user experience.</p>
<h3 id="components-1"><a class="header" href="#components-1">Components</a></h3>
<p>The following components are involved</p>
<p><strong>L1 Native Bridge contract</strong>
The contract to which a user can request a bridge transfer L1→L2 and through which the Relayer completes transfers L2→L1.</p>
<p><strong>L2 Native Bridge contract</strong>
The contract to which a user can request a bridge transfer L2→L1 and through which the Relayer completes transfers L1→L2.</p>
<p><strong>L1 token pool</strong>
An address which collects \ that are transferred L1→L2 and from which tokens are released when transferred L2→L1.</p>
<p><strong>L2 Mint contract</strong>
A contract capable of minting \.</p>
<p><strong>Governance operator</strong>
An entity that can set the bridge fee and adjust the rate limit.</p>
<p><strong>Rate limiter</strong>
A mechanism that limits the number of tokens that can be transferred. The rate limitation is discussed in <a href="https://github.com/movementlabsxyz/MIP/pull/74">MIP-74</a>.</p>
<p><strong>(Partially Trusted) Relayer</strong>
An off-chain partially trusted component (except for bugs or theft of keys) that can read relevant events from either chain and processes transfer requests by completing them on the target chain. It MAY operate nodes on both chains to learn about the finalization of <code>complete_transfer</code> transactions. The operation of the Relayer, including the bootstrapping process, is detailed in <a href="https://github.com/movementlabsxyz/MIP/pull/61">MIP-61</a>.</p>
<h3 id="storage-fields"><a class="header" href="#storage-fields">Storage fields</a></h3>
<p>The storage fields are directional, hence we need to mirror the mapping for L1→L2, as well as L2→L1. Hence, we will talk about source and target chain.</p>
<h4 id="source-bridge-contract"><a class="header" href="#source-bridge-contract">Source bridge contract</a></h4>
<pre><code class="language-rust">struct SourceBridgeTransfers {
    /// A list of unique bridge transfer IDs.
    bridge_transfer_ids: Vec&lt;u64&gt;,
    /// A mapping of `bridge_transfer_id` to the bridge details.
    bridge_transfer: HashMap&lt;u64, SourceBridgeDetails&gt;,
}

/// Details of a bridge transfer on the source chain.
struct SourceBridgeDetails {
    /// The address of the user initiating the bridge transfer.
    originator: Address,
    /// The address of the user receiving the bridge transfer.
    recipient: Address,
    /// The amount of tokens being transferred.
    amount: u128,
    /// A unique identifier for each bridge transfer, incremented by the contract.
    nonce: u64,
}</code></pre>
<h4 id="target-bridge-contract"><a class="header" href="#target-bridge-contract">Target bridge contract</a></h4>
<pre><code class="language-rust">struct TargetBridgeTransfers {
    /// A list of unique bridge transfer IDs.
    bridge_transfer_ids: Vec&lt;u64&gt;,
    /// A mapping of `bridge_transfer_id` to the bridge details.
    bridge_transfer: HashMap&lt;u64, TargetBridgeDetails&gt;,
}

/// Details of a bridge transfer on the target chain.
struct TargetBridgeDetails {
    /// The address of the user initiating the bridge transfer.
    originator: String, // or `Address` if using an Ethereum-compatible type
    /// The address of the user receiving the bridge transfer.
    recipient: String,
    /// The amount of tokens being transferred.
    amount: u128,
    /// A unique identifier for each bridge transfer, incremented by the contract.
    nonce: u64,
}</code></pre>
<h3 id="transaction-flow"><a class="header" href="#transaction-flow">Transaction flow</a></h3>
<blockquote>
<p>[!NOTE]
This bridge design is a simpler version compared to the previous HTLC-based implementation, thus less steps are required to complete a bridge transfer.</p>
</blockquote>
<p>The bridge is initiated by the user and completed by the Relayer. The Relayer is a trusted party that finalizes the bridge transfer on the target chain. The user is not required to have funds on the target chain to complete the transfer. The Relayer is responsible for completing the transfer on the target chain.</p>
<ul>
<li>There are two possible states, <code>transfer_initiated</code> or <code>transfer_completed</code>.</li>
<li>User initiates the transfer.</li>
<li>Relayer completes the transfer with parameter validation.</li>
<li>Current HasuraDB built internally can provide enough infrastructure for users to know if their transaction has been completed. It does not differ from the current (HTLC-based) design in any way since user is not able to see if their transaction is in-flight. We could introduce this by notifying the user if the Relayer has been ordered to complete the transaction.</li>
</ul>
<pre><code class="language-mermaid">sequenceDiagram
    participant User
    participant Source_Contract as Source Chain Contract
    participant Relayer
    participant Target_Contract as Target Chain Contract

    User -&gt;&gt; Source_Contract: Initiate Transfer
    Source_Contract --&gt;&gt; Relayer: Emit Transfer Event
    Relayer -&gt;&gt; Target_Contract: Complete Transfer
    Target_Contract --&gt;&gt; User: Tokens Delivered
</code></pre>
<p><em>Figure: Interaction flow diagram.</em></p>
<p><img src="Review/mip-58/MIP/mip-58/tx-history.png" alt="Transaction History" />
<em>Figure: Users would be able to see if the bridge has been completed. It’s either pending or completed.</em></p>
<h3 id="protocol-description-1"><a class="header" href="#protocol-description-1">Protocol description</a></h3>
<h4 id="l1--l2"><a class="header" href="#l1--l2">L1 → L2</a></h4>
<ol>
<li>User initiates a bridge transfer on L1 via a <code>initiate_transfer</code> transaction. Contract stores a mapping of the user <code>bridgeTransferId</code> for easy access. It transfers from the user \ to the contract. The transaction emits <code>originator</code>, <code>recipient</code>, <code>amount</code> and a <code>nonce</code>.</li>
<li>Relayer awaits for finalization of the <code>initiate_transfer</code> transaction on L1.</li>
<li>Relayer sends a <code>complete_transfer</code> transaction on L2 to complete the transfer.</li>
<li>The contract verifies that the transaction is correct by comparing the provided <code>bridgeTransferId</code> hash and the emitted values of <code>originator</code>, <code>recipient</code>, <code>amount</code> and <code>nonce</code>. Finally, it mints \ and sends it to the recipient address.</li>
<li>User is notified on the frontend that their transaction has been completed.</li>
<li>The time to finality for the complete transaction on the L2 should be considered after the postconfirmation, see <a href="https://github.com/movementlabsxyz/MIP/pull/37">MIP-37</a>, to provide strong finality guarantees.</li>
</ol>
<blockquote>
<p>[!NOTE]
Postconfirmation is an anchoring mechanism for the L2 to the L1. It provides additional reorg protection. We MAY consider Fastconfirmation instead of Postconfirmation, see <a href="https://github.com/movementlabsxyz/MIP/pull/65">MIP-65</a>. This assumes the L2 is extremely unlikely to reorg AND the committee is considered to be safe.</p>
</blockquote>
<p><img src="Review/mip-58/MIP/mip-58/L1ToL2.png" alt="L1-L2" /></p>
<h4 id="l2--l1"><a class="header" href="#l2--l1">L2 → L1</a></h4>
<ol>
<li>User initiates a bridge transfer on L2. Contract stores a mapping of the user <code>nonce</code> to bridge details for easy access. User transfers \ amount to the contract which burns it. The transaction emits originator, recipient, amount and <code>nonce</code>.</li>
<li>Relayer awaits for finalization of the transaction on L2. Finality COULD be considered the postconfirmation, see <a href="https://github.com/movementlabsxyz/MIP/pull/37">MIP-37</a>, to provide strong finality guarantees. However, we suggest the Relayer SHOULD consider fastconfirmation, see <a href="https://github.com/movementlabsxyz/MIP/pull/65">MIP-65</a> instead, due to high fluctuation of gas prices on L1 within time that is required for postconfirmation. Nevertheless, this introduces dependency on that the L2 is extremely unlikely to reorg AND the committee is considered to be safe.</li>
<li>Relayer completes the transfer on L1 by sending a <code>complete_transfer</code> transaction.</li>
<li>L1 contract verifies that <code>complete_transfer</code> is correct by comparing the provided <code>bridgeTransferId</code> hash and the emitted values of initiator, recipient, amount and <code>nonce</code>. Also <code>nonce</code> must not be used yet. Finally, it transfers \ to the recipient address from the locked token pool.</li>
<li>User is notified on the frontend that their transaction has been completed.</li>
</ol>
<p><img src="Review/mip-58/MIP/mip-58/L2ToL1.png" alt="L2-L1" /></p>
<h3 id="key-features"><a class="header" href="#key-features">Key features</a></h3>
<p>We discuss the key features also in relation to the HTLC-based bridge to provide a comparison with the previous design.</p>
<ol>
<li>
<p><strong>Lock/Mint mechanism</strong></p>
<ul>
<li><strong>Initiation</strong>: User sends a transaction to initiate the bridge containing recipient and amount.</li>
<li><strong>Completion</strong>: A Relayer or multi-signature group completes the transfer on the counterparty contract with the originator, recipient, amount and <code>nonce</code> for hash verification.</li>
<li><strong>No funds requirement</strong>: User is not required to have funds on target chain and we do not have to build sponsored transactions.</li>
<li><strong>Delivery by Relayer</strong>: Because the Relayer delivers the funds, there is no requirement for the user to complete the transaction on target chain, therefore simplifying the user experience and allowing a smooth onboarding on the network for transfers from L1 to L2. User only has to await for the finalization on the source chain and for the Relayer to perform the completion on target chain. This is standard practice for every major bridge in the ecosystem.</li>
<li><strong>Less parameters</strong>: Because there is no exchange of secrets between the user and Relayer, we have a substantial reduction of logic.</li>
<li><strong>Must complete transfers</strong>: Previously we reserve a refunder role to revert transactions. In this approach this is different as we guarantee delivery of funds through the same party that would guarantee funds being refunded, because transfers MUST be completed.</li>
</ul>
</li>
<li>
<p><strong>Consolidation of logic</strong></p>
<ul>
<li>Merge lock and completion functionality on the counterparty contract. Once lock is called, funds are already in the control of the user. In the HTLC implementation, once the timelock is over and complete on initiator has not been called, both the initiator and counterparty funds are available to the user, opening up for an exploit.</li>
<li>Removes the refund functionality entirely to eliminate associated exploits.</li>
</ul>
</li>
<li>
<p><strong>Parameter validation</strong></p>
<ul>
<li>Ensure parameter validation on the counterparty to prevent invalid transactions.</li>
</ul>
</li>
<li>
<p><strong>Relayer redundancy</strong></p>
<ul>
<li>Use two types of Relayers:
<ul>
<li><strong>Automated relayer</strong>: Operated with minimal human involvement; its private key is highly secured.</li>
<li><strong>Multi-signature Relayer</strong>: Managed by the team to guarantee transaction completion in case of failures.</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>Cost efficiency</strong></p>
<ul>
<li>Minimize gas costs by reducing the number of interactions and simplifying fee calculations.</li>
</ul>
</li>
<li>
<p><strong>Enhanced security</strong></p>
<ul>
<li>Avoid refund logic to close exploit windows.</li>
<li>Protect against key compromise through key isolation or known by no parties and multi-signature Relayer setups.</li>
<li>There is no scenario where a bridge could lead to double-spending. It’s either completed by Relayer or not.</li>
<li>In the HTLC bridge the user can loose its bridge <code>preImage</code> which could lead to them being unable to complete the bridge. By not relying on a <code>preImage</code> from the user, it minimizes issues. It is not a loss in security because the purpose of the <code>preImage</code> is solely for refunding.</li>
</ul>
</li>
<li>
<p><strong>Batch processing for downtime</strong></p>
<ul>
<li>Multi-signature Relayers can process multiple pending transactions in a single batch to compensate for downtime.</li>
</ul>
</li>
<li>
<p><strong>BridgeTransferId</strong></p>
<ul>
<li>Continue using unique identifier to prevent double-spending and track transactions securely.</li>
</ul>
</li>
<li>
<p><strong>Initial bridge fee proposals</strong></p>
<ul>
<li>On the L1 to L2 bridge, do not charge fees.</li>
<li>On the L2 to L1 bridge, charge a fee estimated by admin. It’s set to the gas spent in ethereum in move. This requires an oracle and can only be implemented after oracles are live and we are able to have a maintainer that is able to set the fees on L2.</li>
</ul>
<pre><code>entry fun set_fee(caller: &amp;signer, fee: u64) {
   assert_is_maintainer(caller);
   borrow_global&lt;BridgeConfig&gt;(@aptos_framework).fee = fee;
}
</code></pre>
</li>
<li>
<p><strong>Best practices</strong></p>
</li>
</ol>
<ul>
<li>Adopt currently used bridge designs from established designs like Arbitrum, LayerZero and Blast bridges, which use a Relayer to finalize the bridge.</li>
<li>User is not required to have funds on counterparty contract to finalize the bridge.</li>
</ul>
<h2 id="exploits-and-potential-losses"><a class="header" href="#exploits-and-potential-losses">Exploits and potential losses</a></h2>
<ol>
<li><strong>Key compromise</strong>
<ul>
<li>The compromise of the Relayer keys would lead to unauthorized transactions, putting the protocol at risk of unlimited value exploit.  The protocol must absorb the losses and rotate Relayers. To minimize this risk <a href="https://github.com/movementlabsxyz/MIP/pull/74">MIP-74</a> proposes a rate limitation even for the Relayer.</li>
</ul>
</li>
<li><strong>Fee wrong estimation</strong>
<ul>
<li>Incorrect fee calculations (e.g., underestimating gas) can cause significant financial losses for the operator.</li>
</ul>
</li>
</ol>
<h2 id="reference-implementation-13"><a class="header" href="#reference-implementation-13">Reference implementation</a></h2>
<p><a href="https://github.com/movementlabsxyz/movement/tree/primata/simple-native-bridge">Solidity Implementation</a></p>
<p><a href="https://github.com/movementlabsxyz/aptos-core/tree/andygolay/simplified-bridge">Move Implementation</a></p>
<h3 id="optional-recommendations"><a class="header" href="#optional-recommendations">(Optional) Recommendations</a></h3>
<h4 id="batch-completion-for-multisig-relayer"><a class="header" href="#batch-completion-for-multisig-relayer">Batch completion for multisig Relayer**</a></h4>
<p>Multisig Relayers could process pending transactions in batches during downtime of the standard Relayer, ensuring timely resolution.</p>
<h2 id="verification-18"><a class="header" href="#verification-18">Verification</a></h2>
<ol>
<li>
<p><strong>Correctness</strong></p>
<ul>
<li>Simulate multiple transaction scenarios to ensure robustness.</li>
<li>Test edge cases, including Relayer downtime and batch processing.</li>
</ul>
</li>
<li>
<p><strong>Security implications</strong></p>
<ul>
<li>Conduct audits focused on the simplified design.</li>
<li>Implement rate-limiting safeguards and validate parameters in contracts.</li>
</ul>
</li>
<li>
<p><strong>Performance impacts</strong></p>
<ul>
<li>Benchmark gas costs and transaction throughput.</li>
</ul>
</li>
<li>
<p><strong>Validation procedures</strong></p>
<ul>
<li>Perform an audit and thorough testing, alongside an open invite to the community to verify the bridge.</li>
<li>Seek community feedback and incorporate suggestions.</li>
</ul>
</li>
</ol>
<h2 id="appendix-15"><a class="header" href="#appendix-15">Appendix</a></h2>
<h3 id="a1-related-issues"><a class="header" href="#a1-related-issues">A1: Related issues</a></h3>
<ul>
<li><a href="https://github.com/movementlabsxyz/movement/issues/838">Movement Issue #838</a></li>
<li><a href="https://github.com/movementlabsxyz/movement/issues/842">Movement Issue #842</a></li>
</ul>
<h3 id="a2-gas-cost-comparison"><a class="header" href="#a2-gas-cost-comparison">A2: Gas cost comparison</a></h3>
<ul>
<li><strong>Current Design</strong>: ~400k gas per bridge round trip.</li>
<li><strong>Simplified Design</strong>: ~200k gas per bridge round trip.</li>
</ul>
<h3 id="a3-referenced-designs"><a class="header" href="#a3-referenced-designs">A3: Referenced designs</a></h3>
<ul>
<li><a href="https://bridge.arbitrum.io/?destinationChain=arbitrum-one&amp;sourceChain=ethereum">Arbitrum Bridge</a></li>
<li><a href="https://docs.blast.io/building/bridges/mainnet">Blast Bridge</a></li>
</ul>
<hr />
<h2 id="copyright-6"><a class="header" href="#copyright-6">Copyright</a></h2>
<p>Copyright and related rights waived via <a href="Review/mip-58/MIP/mip-58/../LICENSE.html">CC0</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="mip-60-cross-chain-bridge-architectures"><a class="header" href="#mip-60-cross-chain-bridge-architectures">MIP-60: Cross-chain bridge architectures</a></h1>
<ul>
<li><strong>Description</strong>: This MIP provides some background on cross-chain bridges designs and trade-offs related to security, decentralization, and performance.</li>
<li><strong>Authors</strong>: <a href="mailto:franck.cassez@movementlabs.xyz">Franck Cassez</a>, Andreas Penzkofer</li>
</ul>
<h2 id="abstract-20"><a class="header" href="#abstract-20">Abstract</a></h2>
<p>Cross-chain bridges allow assets to be transferred between different blockchains. This MIP provides some background on cross-chain bridge designs and the trade-offs related to security, decentralization, and performance.</p>
<h2 id="motivation-20"><a class="header" href="#motivation-20">Motivation</a></h2>
<p>To transfer assets from Ethereum to the chain (and back), we have to employ a <em>bridge</em>. Ideally we would re-use an existing bridge, but there is no available bridge template from Ethereum to Move-based chains, so we have to design one.
Designing a bridge between two blockchains is a complex task. As pointed out in <a href="https://ethereum.org/en/developers/docs/bridges/#integrating-bridges">Bridges – Ethereum Foundation</a>:</p>
<blockquote>
<ol>
<li><strong>Building your own bridge</strong> – Building a secure and reliable bridge is not easy, especially if you take a more trust-minimized route. Moreover, it requires years of experience and technical expertise related to scalability and interoperability studies. Additionally, it would require a hands-on team to maintain a bridge and attract sufficient liquidity to make it feasible.</li>
</ol>
</blockquote>
<p>To design our bridge, it may be useful to understand the main types of architectures, their strengths and weaknesses. It can also help us reflect on the different discussions and proposals (MIPs, MDs) and how they relate to the different architectures.</p>
<h2 id="definitions-and-bridge-introduction"><a class="header" href="#definitions-and-bridge-introduction">Definitions and Bridge introduction</a></h2>
<p>Bridge terminology is frequently ambiguous as the following shows but we attempt to clarify the terms used in this MIP.</p>
<p><strong>Base classes of bridges</strong> <a href="https://ieeexplore.ieee.org/document/10634379">[5]</a></p>
<p>There are several base classes of bridges to apply to our setting. We select <strong>Native Bridge</strong> as the most appropriate for our use case.</p>
<ul>
<li><strong>Native Bridges</strong> bootstrap liquidity from a base chain into a different chain, e.g. to onboard users and move value into a chain.</li>
<li><strong>Canonical Bridges</strong> is a term typically used to refer to L1 to L2 bridges, and have a similar meaning to Native Bridges. They typically take a longer period of time to bridge assets than liquidity networks as they require a time period for finality to be established, such as the challenge period for optimistic
rollups.</li>
<li><strong>Validating Bridges</strong> are bridges between Ethereum and another chain, where the bridge contract verifies the state updates proposed by the off-chain system.</li>
<li><strong>Validator or Oracle-based Bridges</strong> rely on a set of external validators or oracles to validate cross-chain transfers.</li>
</ul>
<blockquote>
<p>[!NOTE]
The term <strong>Native Bridge</strong> is used to refer to a bridge that transfers the native ERC-20 <code>$L1MOVE</code> token from a base chain (L1) to the <code>$L2MOVE</code> token on a different chain (L2).</p>
</blockquote>
<p><strong>Liquidity Networks</strong> <a href="https://ieeexplore.ieee.org/document/10634379">[5]</a></p>
<p>The term of Liquidity Networks is associated with</p>
<ul>
<li><strong>Continuous Liquidity Pools</strong> The majority of Liquidity Networks consist of two liquidity pools of assets - one on the source and the other on the destination chain. In this structure, an intermediary token can act as an exchange medium allowing accurate amounts of the final token to be transferred to the user and to rebalance the pools once a transaction has occurred, e.g. RUNE in Thorchain, or stablecoins such as USDC in Stargate.</li>
</ul>
<p>In our setting the intermediary IS the final token, and this could be interpreted as a <strong>lock/unlock</strong> bridge.</p>
<ul>
<li><strong>Continuous Liquidity Pools (CLP) with AMMs</strong> are a subset of Continuous Liquidity Pools that use Automated Market Makers (AMMs) in series. <a href="https://github.com/movementlabsxyz/MIP/pull/40">MIP-40</a> has proposed such a design.</li>
</ul>
<p><strong>Types of bridge mechanisms</strong></p>
<p>There are three types of cross-chain bridges. They differ in the way they handle the native assets (source chain) and the representation of the assets (wrapped asset) on the target chain.</p>
<ol>
<li><strong>burn/mint</strong>: the asset is burned on the source chain and an asset is minted on the target chain.
<em>Supply: The bridge operator is in control of creating supply on both chains.</em></li>
<li><strong>lock/mint</strong>: the native asset (minted e.g. in an ERC20 contract) is locked on the source chain and a wrapped asset is minted on the target chain.
<em>Supply: The bridge operator is only in control of minting supply on the target chain (L2). On L1 the bridge operator holds a token pool into/from which tokens get locked/unlocked.</em></li>
<li><strong>lock/unlock</strong>: although difficult to classify in literature, this variant naturally completes the above two types. It may be classified as a subcategory of a swap, a <strong>liquidity network</strong> (see above), or it could be interpreted as a trusted <a href="https://medium.com/@0xmirai77/curve-v1-the-stableswap-invariant-f87ad7641aa0">Automated Market Maker (AMM) with a constant sum invariant</a>. The asset is locked on the source chain and unlocked on the target chain.
<em>Supply: The bridge operator is neither in control of creating new supply on the source chain nor on the target chain. The bridge operator only holds token pools into/from which tokens get locked/unlocked.</em></li>
</ol>
<blockquote>
<p>[!NOTE]
A lock/mint that is capped may be considered effectively a lock/unlock mechanism. However, it differs in that in the lock/mint assets are burned and minted, whereas in the lock/unlock assets are locked and unlocked.</p>
</blockquote>
<p>To complete the lingo, we also mention the definition of swaps:</p>
<ol start="4">
<li><strong>swap (atomic)</strong>: A swap is a generic mechanism and allows to swap any asset for any other asset. As a result it can be used to implement a bridge. Assets are swapped from the source chain against, potentially non-equivalent tokens on the target chain. A swap involves two parties, Alice on chain A and Bob on chain B. Both Alice and Bob can withdraw from the swap deals at any time and have a time window to accept the swap deal <a href="https://dl.acm.org/doi/10.1145/3212734.3212736">[1]</a>,<a href="https://dl.acm.org/doi/10.1007/s00778-021-00686-1">[2]</a>. A swap mechanism usually requires an <em>escrow</em> and a <em>time lock</em> mechanism.</li>
</ol>
<blockquote>
<p>[!WARNING]
As both parties can decide to withdraw or accept the swap, a swap requires each party to independently issue a transaction on their chain.</p>
</blockquote>
<blockquote>
<p>[!NOTE]
Source and target imply direction: e.g. for a swap, burn/mint and lock/unlock between a user1 on chain A and a user2 on chain B, the source chain of user1 is chain A and the target chain is chain B. For these three bridge mechanisms the transfer in opposite direction would be called the same. In contrast, <strong>lock/mint</strong> implies that the source chain is the chain where the native asset lives. But the bridge also operates in the opposite direction - however a more correct term for the opposite direction would be a <strong>burn/unlock</strong> mechanism instead.</p>
</blockquote>
<h2 id="specification-19"><a class="header" href="#specification-19">Specification</a></h2>
<p>The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”, “RECOMMENDED”, “NOT RECOMMENDED”, “MAY”, and “OPTIONAL” in this document are to be interpreted as described in RFC 2119 and RFC 8174.</p>
<h3 id="cross-chain-communication-and-the-relayer"><a class="header" href="#cross-chain-communication-and-the-relayer">Cross-chain communication and the Relayer</a></h3>
<p>The transfer of assets between two chains requires a mechanism to communicate between the two chains. This mechanism is necessarily off-chain: a chain can emit events/messages to a channel but cannot receive event from a channel (they need to be converted to transactions).</p>
<blockquote>
<p>[!TIP]
Cross-chain communications can be implemented using different strategies. For a bridge the most common is to use a <em>relayer</em> or <em>messenger</em> that listens to events on one chain and emits corresponding transactions on the other chain.</p>
</blockquote>
<p>The <em>relayer</em> can be <em>trusted</em> or <em>untrusted</em>. Trusted relayers are usually run by the bridge operator and users must trust the operator. Untrusted relayers (trustless bridges) rely on the trust assumptions on the source chain (e.g., Ethereum) and the target chain (e.g., Movement Network) and the bridge operator is not required to be trusted.</p>
<blockquote>
<p>[!TIP]
Trusted relayers are usually faster and more cost-effective, but not decentralized so not censorship resistant. Untrusted relayers (trustless bridges) offer greater security and decentralization but are usually slower and more expensive.</p>
</blockquote>
<p>There are several MIPs and MDs that discuss the relayer mechanism: <a href="https://github.com/movementlabsxyz/MIP/tree/primata/bridge-attestors/MD/md-21">MD-21</a>, <a href="https://github.com/movementlabsxyz/MIP/pull/46">MIP-46</a>, <a href="https://github.com/movementlabsxyz/MIP/pull/56">MIP-56</a>, <a href="https://github.com/movementlabsxyz/MIP/pull/57">MIP-57</a>, <a href="https://github.com/movementlabsxyz/MIP/pull/58">MIP-58</a>.</p>
<h3 id="what-is-communicated"><a class="header" href="#what-is-communicated">What is communicated?</a></h3>
<p>The relayer mechanism is used to relay information about the <em>state</em> of one chain to the other chain. The relayer monitors the logs of a chain and relays event emitted to the logs. The logs are part of the <em>state</em> of the chain.</p>
<blockquote>
<p>[!WARNING]
The information relayed by the relayer should be reliable and ideally immutable.</p>
</blockquote>
<p>If the relayer relays incorrect information, the bridge can be <em>hacked</em> and assets <em>duplicated</em> or <em>stolen</em> (see <a href="https://github.com/movementlabsxyz/MIP/blob/mip-move-bridge-architecture/MIP/mip-39/README.md">MIP-39</a>, <a href="https://github.com/movementlabsxyz/MIP/tree/mip/security_falliblity/MIP/mip-46">MIP-46</a>) This problem is addressed in <a href="https://github.com/movementlabsxyz/movement/issues/838">issue-838</a>.</p>
<p>On Ethereum, a block is immutable when it is declared <em>final</em>. Until is is final, a block can be <em>reverted</em> (i.e., the transactions in the block are not executed).
Other criteria can be used to accept a block as <em>almost-final</em> with a risk that it is reverted, e.g. k-confirmations, where k is the number of blocks that have been added to the chain since the block was added, see also <a href="https://github.com/movementlabsxyz/movement/issues/838">issue-838</a>.</p>
<blockquote>
<p>[!IMPORTANT]
Since the introduction on blobs on Ethereum, the <a href="https://ethresear.ch/t/big-blocks-blobs-and-reorgs/19674">probability of a 1-confirmed block being reverted is approximately 0.3%</a>, so 3 out of 1000, approximately once every hour. In contrast if a block is final, the probability of it being reverted is negligible as it is protected by the fully economic security of the Ethereum finality mechanism.</p>
</blockquote>
<h3 id="trusted-relayer"><a class="header" href="#trusted-relayer">Trusted Relayer</a></h3>
<p>Using a trusted relayer is a popular choice. The trust assumption on the relayer are:</p>
<ul>
<li><strong>[safety]</strong> it relays  only final states of the chain (source or target).</li>
<li><strong>[liveness]</strong> it relays the states in a timely manner.</li>
</ul>
<p><strong>[safety]</strong>
In the lock/mint design with a trusted relayer, the relayer can mint assets on the target chain. If the relayer is compromised, the assets can be duplicated or stolen. Special care should be taken to ensure that the relayer is not compromised (multisig?).</p>
<p><strong>[liveness]</strong>
Even if the relayer is not compromised, it is hard to guarantee that the relayer will relay each event within a fixed time bound.</p>
<ol>
<li>The message delivery network can be slow or congested.</li>
<li>The relayer submits a transaction (to mint the assets on the target chain) to the mempool of the target chain. But the target chain may be down, congested or slow, or the relayer’s transaction may be low priority.</li>
<li>The relayer must cover the cost of submitting transactions on the target chain. If the relayer’s funds are low (or gas price is high), the relayer may not be able to submit the transaction.</li>
</ol>
<h3 id="considered-designs-in-our-setting"><a class="header" href="#considered-designs-in-our-setting">Considered Designs in our setting</a></h3>
<p><strong>HTLC-based design</strong>
Our initial bridge design, <a href="https://github.com/movementlabsxyz/rfcs/blob/main/0040-atomic-bridge/rfc-0040-atomic-bridge.md">RFC-40</a>, is based on an <em>atomic swap</em> (4. above).  The current architecture of our bridge, <a href="https://github.com/movementlabsxyz/MIP/blob/mip-move-bridge-architecture/MIP/mip-39/README.md">MIP-39</a>, borrows ideas from <em>lock/mint</em> and <em>swap</em> (<a href="https://en.bitcoin.it/wiki/Hash_Time_Locked_Contracts">HTLC</a>):</p>
<ul>
<li>if a user wants to bridge from Ethereum to Movement Network, they have to submit two independent transactions: one on Ethereum (lock) and one on Movement Network (mint). This is not user friendly and may be a barrier to adoption.</li>
</ul>
<!-- A bridge is slightly different to a swap in the sense that the two transactions (lock and mint) are not meant to be decoupled.-->
<ul>
<li>another issue is that the first transfer of MOVE tokens requires a user to have some <em>gas tokens</em> (the token used to pay execution fees on the Movement Network). If the gas token is the <code>\</code> token, we have to implement a mechanism to sponsor the first transfer of MOVE tokens.</li>
</ul>
<p><strong>Lock/Mint design</strong>
A simple design that is adopted by many L2 chains is the <em>lock/mint</em> design. A user initiates a transfer on the source chain and the bridge operator is responsible for completing the transfer on the target chain. In this design, the trust assumptions are that the contracts on the source chain and the target chain are <em>correct</em> and implement the lock and mint operations correctly (respectively burn and unlock for the opposite direction).</p>
<blockquote>
<p>[!TIP]
A simple <em>lock/mint</em>, <em>burn/mint</em> or <em>lock/unlock</em> mechanism requires only one transaction from the user and is probably more user friendly than the HTLC-based design.</p>
</blockquote>
<p><a href="https://github.com/movementlabsxyz/MIP/pull/58/files">MIP-58</a> is an instance of a <em>lock/mint</em> bridge. Once initiated on the source chain, the user does not need to interact with the target chain to complete the transfer. The bridge operator is responsible for coupling the lock/mint transactions for L1-&gt;L2 transfers. Similarly for L2-&gt;L1 transfers, the bridge operator is responsible for the coupling of the burn/unlock transactions.</p>
<h2 id="security"><a class="header" href="#security">Security</a></h2>
<h3 id="security---htlc-based-design"><a class="header" href="#security---htlc-based-design">Security - HTLC-based design</a></h3>
<p>See <a href="https://github.com/movementlabsxyz/MIP/blob/mip-move-bridge-architecture/MIP/mip-39/README.md">MIP-39</a> for a complete discussion of the security of this type of design.</p>
<h3 id="security---trusted-relayer-design"><a class="header" href="#security---trusted-relayer-design">Security - Trusted-Relayer design</a></h3>
<p>See <a href="Review/mip-crosschain-bridges-background/MIP/mip-60/index.html#58">Trusted Relayer design</a>.</p>
<p>Assuming we have a <em>correct</em> implementation of the lock/mint contracts on the source and target chains, and a trusted relayer, we may still have to deal with the following issues:</p>
<ul>
<li>Relayer is down (or network is slow): how do we detect that the relayer is down? And what measurements are taken.</li>
<li>How long does it take to complete a transfer? After what time can we consider the transfer as unsuccessful?</li>
<li>How do we cancel transfers? Is it a manual process or do we have a mechanism to automatically cancel transfers and refund users?</li>
<li>We have to accurately estimate the cost of the transfer to charge the user for the relayer transaction on the target chain.</li>
<li>How do we mitigate the risk of gas fees manipulation? For example, if gas fees are low on the L2 chain (which is the expectation), users can submit thousands of transfer transactions. If at the same time, the gas fees are high on the L1, the relayer will incur some large costs to unlock the locked assets.</li>
<li>How do we ensure that for a given (successful) transfer initiation on the source chain, the relayer does not accidentally mint (or unlock) tokens twice.</li>
</ul>
<p>The bridging mechanisms on Arbitrum and Optimism use a <a href="https://docs.arbitrum.io/build-decentralized-apps/cross-chain-messaging">generic message passing framework</a> to communicate between chains. This relies on <em>retryable transactions</em> up to a certain number of retries or deadline.</p>
<blockquote>
<p>[!TIP]
The <a href="https://cross-chainriskframework.github.io/framework/01intro/introduction/">cross-chain risk framework</a> provides some guidelines and criteria for evaluating cross-chain protocols security. Risk mitigation strategies are also discussed in <a href="https://arxiv.org/abs/2410.02029">XChainWatcher</a> and  this <a href="https://doi.org/10.48550/arXiv.2403.00405">SoK on Cross-Chain Bridging Architectural Design Flaws and Mitigations</a>.</p>
</blockquote>
<h2 id="reference-implementation-14"><a class="header" href="#reference-implementation-14">Reference Implementation</a></h2>
<h2 id="verification-19"><a class="header" href="#verification-19">Verification</a></h2>
<p>Needs discussion.</p>
<hr />
<h2 id="errata-13"><a class="header" href="#errata-13">Errata</a></h2>
<h2 id="references-1"><a class="header" href="#references-1">References</a></h2>
<p>[1] Maurice Herlihy: “Atomic Cross-Chain Swaps”. PODC 2018: 245-254 <a href="https://dl.acm.org/doi/10.1145/3212734.3212736">DOI</a></p>
<p>[2] Maurice Herlihy, Barbara Liskov, Liuba Shrira: “Cross-chain deals and adversarial commerce”. VLDB J. 31(6): 1291-1309 (2022) <a href="https://dl.acm.org/doi/10.1007/s00778-021-00686-1">DOI</a></p>
<p>[3] André Augusto, Rafael Belchior, Jonas Pfannschmidt, André Vasconcelos, Miguel Correia: “XChainWatcher: Monitoring and Identifying Attacks in Cross-Chain Bridges”. (2024) <a href="https://arxiv.org/abs/2410.02029">CoRR abs/2410.02029</a></p>
<p>[4] Jakob Svennevik Notland, Jinguye Li, Mariusz Nowostawski, Peter Halland Haro: “SoK: Cross-Chain Bridging Architectural Design Flaws and Mitigations”. (2024) <a href="https://doi.org/10.48550/arXiv.2403.00405">CoRR abs/2403.00405</a></p>
<p>[5] “SoK: Cross-chain Token Bridges and Risk”, 2024 IEEE International Conference on Blockchain and Cryptocurrency (ICBC), Dublin, Ireland, 2024, pp. 696-711. <a href="https://ieeexplore.ieee.org/document/10634379">IEEE Xplore</a></p>
<h2 id="appendix-16"><a class="header" href="#appendix-16">Appendix</a></h2>
<h2 id="copyright-7"><a class="header" href="#copyright-7">Copyright</a></h2>
<p>Copyright and related rights waived via <a href="Review/mip-crosschain-bridges-background/MIP/mip-60/../LICENSE.html">CC0</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="mip-61-relayer-for-the-lockmint-native-bridge---algorithm-and-bootstrapping"><a class="header" href="#mip-61-relayer-for-the-lockmint-native-bridge---algorithm-and-bootstrapping">MIP-61: Relayer for the lock/mint Native Bridge - Algorithm and Bootstrapping</a></h1>
<ul>
<li><strong>Description</strong>: This MIP describes the process for continuous operation as well as the bootstrapping of the relayer in the lock/mint bridge.</li>
<li><strong>Authors</strong>: Andreas Penzkofer, Philippe</li>
</ul>
<h2 id="abstract-21"><a class="header" href="#abstract-21">Abstract</a></h2>
<p>We describe an algorithm that</p>
<ul>
<li>Continuously checks for <code>initiate_transfer</code> events on the source chain.</li>
<li>Issues a <code>complete_transfer</code> transaction on the target chain if not done so far.</li>
<li>Checks the completion of transfers on the target chain.</li>
<li>Records the source chain block height, below which all transfers are completed on the target chain.</li>
<li>Provides a bootstrap algorithm for the relayer.</li>
</ul>
<p>In this algorithm the target chain contract offers a <code>complete_transfer</code> function that records transfer by <code>nonce</code> and protects against re-issuance as any nonce can be only mapped to one transfer.</p>
<h2 id="motivation-21"><a class="header" href="#motivation-21">Motivation</a></h2>
<p>We would like to minimize the number of trusted components. In a minimal solution the relayer should only trust the source chain, the target chain and itself. Other trusted sources can be proposed optionally, but ideally no other trust assumptions should be utilized.</p>
<p>Several complications:</p>
<ul>
<li>The <code>complete_transfer</code> transaction to the target chain for bridge transfers may fail, get lost, or other. Hence we cannot rely on delivery.</li>
<li>The relayer may loose local memory.</li>
<li>The relayer may have to be replaced.</li>
<li>The relayer (or its replacement) MUST not ignore a single transfer.</li>
<li>The relayer (or its replacement) MUST deliver eventually all transfers.</li>
<li>The finality criteria on the source chain and target chain MUST be considered.</li>
</ul>
<p><strong>Bootstrapping</strong>
Currently, when the relayer starts, it doesn’t reload the state that it has when it shuts down. If transfers are processed when the relayer stops, the transfers are lost and the relayer is not able to continue the transfer.</p>
<p>Moreover, even if the data would be stored on where to continue, the relayer may crash for a variety of reasons. The relayer can go offline or crash. It needs to automatically understand which <code>complete_transfer</code> transactions it still needs to send to the target chain.</p>
<h2 id="context"><a class="header" href="#context">Context</a></h2>
<p>This algo is defined using the lock/mint-type Native Bridge protocol, described in <a href="https://github.com/movementlabsxyz/MIP/pull/58">MIP-58</a>.This bridge protocol has two function calls :</p>
<ul>
<li><code>initiate_transfer</code> on the source chain (called by user)</li>
<li><code>complete_transfer</code> on the target chain (called by relayer)</li>
</ul>
<p>This algorithm is compatible with using finalized blocks (see the remark on L2 complete verification). By pulling only finalized source blocks, the nonce are always updated on finalization.</p>
<p>In this MIP we consider the lock/mint Native Bridge, see <a href="https://github.com/movementlabsxyz/MIP/pull/60">MIP-60</a>. We will discuss a single direction of transfer - from <strong>source chain</strong> to <strong>target chain</strong>.</p>
<h2 id="specification-20"><a class="header" href="#specification-20">Specification</a></h2>
<blockquote>
<p><em>The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”, “RECOMMENDED”, “NOT RECOMMENDED”, “MAY”, and “OPTIONAL” in this document are to be interpreted as described in RFC 2119 and RFC 8174.</em></p>
</blockquote>
<p>!!! . The algorithm is the same in both directions. Hence each algorithm has to be implemented twice. Once for the transfer direction L1 –&gt; L2, and once for the L2 –&gt; L1 direction.</p>
<p>The relayer can get its state from the source chain and target chain. The relayer operates two processes - potentially in parallel:</p>
<p><strong>1. CONTINUOUS_BLOCK_PROCESSING</strong>: The relayer pulls transfer events from new finalized blocks from the source chain and processes them. Since we consider finalized blocks and this is a blockchain, new blocks are processed in order. For each transfer the relayer has to check if the transfer is completed on the target chain, and if not it has to complete the transfer.</p>
<p><strong>2. BOOTSTRAPPING:</strong> The relayer initiate the event polling at some point in the past. This point is either the genesis, some configurable source block height, or some checkpoint (possibly set on-chain)</p>
<h3 id="assumptions-on-the-bridge-protocol"><a class="header" href="#assumptions-on-the-bridge-protocol">Assumptions on the Bridge Protocol</a></h3>
<p><strong>Nonce</strong>:
We assume the Native Bridge protocol MUST implement the assignment of an incrementing <code>nonce</code> on the source chain. Since there are two directions there MUST be two types of counters (<code>nonces</code>) - one for each transfer direction. The <code>nonce</code> is used to order the transfers.</p>
<p><strong>Initiate Transfer</strong>:
The <code>initiate_transfer</code> function on the source chain is called by the user. It emits an event <code>initiate_transfer</code> with the following properties:</p>
<pre><code class="language-javascript">{
    nonce: Number,          // Unique incrementing value for ordering transfers
    recipient: String,  // Address of the recipient on the target chain
    initiator: String,   // Address of the initiator on the source chain
    amount: Number          // Amount being transferred
}
</code></pre>
<p>This structure is used to record the transfer on the source chain.</p>
<p><strong>Complete Transfer</strong>:
The <code>complete_transfer</code> function on the target chain is called by the relayer. It emits an event <code>complete_transfer</code> with the following properties:</p>
<pre><code class="language-javascript">{
    nonce: Number,         // Matching nonce from the source chain
    transferUID: String,   // Unique identifier for the transfer
    recipient: String,     // Address of the recipient
    initiator: String,      // Address of the initiator
    amount: Number         // Amount that was transferred
}
</code></pre>
<p>This structure is used to record the transfer on the target chain.</p>
<h3 id="relayer-structures"><a class="header" href="#relayer-structures">Relayer Structures</a></h3>
<p>Locally the relayer stores the following structure:</p>
<pre><code class="language-javascript">// Relayer Local Structure
{
    nonces: {                          // Object keyed by nonce (integer)
        [nonce: Number]: {             // Nonce as the integer key
            blockHeight: Number,       // Height of the block containing the nonce
            status: String,            // Status of the event
            eventUID: String           // Unique identifier for the event
        }
    }
}
</code></pre>
<p>The relayer differentiates three status types:</p>
<ul>
<li><code>transfer_initiated</code>: the event has been received but not processed and the <code>complete_transfer</code> transaction has not been sent to the target chain.</li>
<li><code>transfer_pending</code>: the <code>complete_transfer</code> transaction has been sent to the target chain but is not yet finalized.</li>
<li><code>transfer_completed</code>: we received the (finalized) complete event.</li>
</ul>
<p><strong>Optimization</strong>: There’s another substate for pending when the <code>complete_transfer</code> transaction failed. In this case we should retry earlier than if the <code>complete_transfer</code> transaction was successful. We MAY differentiate the state <code>transfer_pending_executed</code> and <code>transfer_pending_failed</code>.</p>
<h3 id="initiate_transfer-events"><a class="header" href="#initiate_transfer-events">initiate_transfer events</a></h3>
<h4 id="1-init_event_processing-algorithm"><a class="header" href="#1-init_event_processing-algorithm">1. INIT_EVENT_PROCESSING algorithm</a></h4>
<p>For each <code>initiate_transfer</code> event do the following:</p>
<p><img src="Review/mip/relayer-bootstrap-and-reboot/MIP/mip-61/init_event_processing.png" alt="event_processing" /></p>
<pre><code class="language-javascript">INIT_EVENT_PROCESSING:
// Input: initiate_transfer event from source chain
// Input: target_chain_state - current state of the target chain
SET `nonce` = `initiate_transfer_event.nonce` 
    with nonce.status_transfer = `transfer_initiated`
SET `transfer_uid` = `initiate_transfer_event.transfer_uid`

// Check if the `nonce` is already recorded
IF `nonce` is recorded THEN:
    IF `nonce.status_transfer` is `transfer_completed` THEN:
        RETURN.
ELSE: 
    CREATE new `nonce` entry locally and save it in ORDERED_SET.

// note this is not the final state as is the case for most other state reads in this algorithm
QUERY target chain contract for `nonce` in non-final and final state
        
// If `complete_transfer` transaction was sent previously to target chain
IF `nonce` is found on target chain THEN:
    IF `transfer_uid` does not match THEN:
        REPORT error and EXIT

    IF `nonce` transfer is final THEN:
        SET `nonce.status_transfer` to `transfer_completed`
        CLEAR cached data for `nonce` to free up memory
    ELSE:
        // the status should be `transfer_pending`
        IF `nonce.status_transfer` is NOT `transfer_pending` THEN:
            LOG "error: nonce.status_transfer is not transfer_pending"
        SET `nonce.status_transfer` to `transfer_pending`
        SET timeout for relayer to re-check later
// If no `complete_transfer` transaction was sent 
ELSE:
    SEND `complete_transfer` transaction to target chain
    SET `nonce.status_transfer` to `transfer_pending`
    SET timeout for relayer to re-check later
</code></pre>
<blockquote>
<p>[!NOTE]
The relayer may send a transaction <code>complete_transfer</code> to the target chain for an entry that has the status <code>transfer_pending</code>. This status exists during the time between the sending and the finalized success of the <code>complete_transfer</code> transaction on the target chain.</p>
</blockquote>
<h4 id="2-continuous_block_processing-algorithm"><a class="header" href="#2-continuous_block_processing-algorithm">2. CONTINUOUS_BLOCK_PROCESSING algorithm</a></h4>
<p>Next we describe the processing of source blocks and the completion of a transfer on the target chain, assuming the relayer is always online. Since this is a strong assumption, we reduce this requirement in the next section.</p>
<p><img src="Review/mip/relayer-bootstrap-and-reboot/MIP/mip-61/continuous_processing.png" alt="continuous_processing" /></p>
<pre><code class="language-javascript">CONTINUOUS_BLOCK_PROCESSING: 
// Input: source_block - newly finalized block from source chain
NEW `block` with blockHeight `source_block.height` in `blocks`

// Process each initiate_transfer event
FOR EACH `event` IN `source_block.initiate_transfer_events` DO:
    RUN INIT_EVENT_PROCESSING(`event`)

// Mark the block as processed, this 
SET `block.status` as `block_processed`
</code></pre>
<blockquote>
<p>[!NOTE]
Setting the source_block.status as processed and storing that information in a file, or similar, could help with bootstrapping the relayer in the future.</p>
</blockquote>
<h4 id="3-process_finished_nonce_height-algorithm"><a class="header" href="#3-process_finished_nonce_height-algorithm">3. PROCESS_FINISHED_NONCE_HEIGHT algorithm</a></h4>
<p>In this section the process is defined to calculate the completed part of the source chain <code>completed_block_height</code> and <code>completed_nonce_height</code>.</p>
<p><img src="Review/mip/relayer-bootstrap-and-reboot/MIP/mip-61/complete_block_height.png" alt="complete_block_height" /></p>
<p>Replace</p>
<pre><code class="language-javascript">IF `nonce.status_transfer` is `transfer_completed` THEN:
    RETURN
</code></pre>
<p>with</p>
<pre><code class="language-javascript">PROCESS_FINISHED_NONCE_HEIGHT:
IF `nonce.status_transfer` is `transfer_completed` THEN:
    IF `nonce` is not `completed_nonce_height + 1` THEN: 
        RETURN
    ELSE:
        SET `completed_nonce_height += 1`
        // the following pruning is required to keep the memory sane.
        DELETE every `nonce` with `nonce` &lt; `completed_nonce_height`
        IF this `nonce` is the last nonce in the source block THEN:
            SET `completed_block_height += 1`
        IF the next `nonce.status_transfer` is `transfer_completed` THEN:
            GOTO PROCESS_FINISHED_NONCE_HEIGHT
        ELSE:
            RETURN
</code></pre>
<h4 id="4-timeout-algorithm"><a class="header" href="#4-timeout-algorithm">4. TIMEOUT algorithm</a></h4>
<p>Whenever the timeout of a transfer (which has <code>transfer_pending</code> status) is triggered. Start the event processing.</p>
<pre><code class="language-javascript">TIMEOUT:
// Input: timeoutTriggeredEvent - Event whose timeout has been triggered

ON timeoutTriggered(`timeoutTriggeredEvent`) DO:
    // Check if the transfer has a pending status
    IF `timeoutTriggeredEvent.status` is `transfer_pending` THEN:
        // Start the event processing for the triggered event
        RUN EVENT_PROCESSING(`timeoutTriggeredEvent`).
    ELSE:
        // If status is not pending, ignore or log
        LOG "Timeout triggered for a non-pending transfer.";
</code></pre>
<p><img src="Review/mip/relayer-bootstrap-and-reboot/MIP/mip-61/timeout.png" alt="alt text" /></p>
<h3 id="complete_transfer-events"><a class="header" href="#complete_transfer-events">complete_transfer events</a></h3>
<h4 id="1-complete_event_processing-algorithm"><a class="header" href="#1-complete_event_processing-algorithm">1. COMPLETE_EVENT_PROCESSING algorithm</a></h4>
<p>Similar to the INIT_EVENT_PROCESSING algorithm, the COMPLETE_EVENT_PROCESSING algorithm processes the finalized <code>complete_transfer</code> events on the target chain.</p>
<p>We can apply a similar algorithm as for the INIT_EVENT_PROCESSING algorithm.</p>
<pre><code class="language-javascript">COMPLETE_EVENT_PROCESSING:
// Input: complete_transfer event from target chain
SET `nonce` = `complete_transfer_event.nonce` 
    with nonce.status_transfer = `transfer_completed`
SET `transfer_uid` = `complete_transfer_event.transfer_uid`

// Check if the `nonce` is already recorded
IF `nonce` is recorded THEN:
    SET `nonce.status_transfer = transfer_completed` 
ELSE: 
    CREATE new `nonce` entry locally and save it in ORDERED_SET.

RETURN.
</code></pre>
<p>As can be seen, the algorithm is simpler than the INIT_EVENT_PROCESSING algorithm.</p>
<h4 id="2-process_finished_nonce_height-algorithm"><a class="header" href="#2-process_finished_nonce_height-algorithm">2. PROCESS_FINISHED_NONCE_HEIGHT algorithm</a></h4>
<p>Similar to Section <a href="Review/mip/relayer-bootstrap-and-reboot/MIP/mip-61/index.html#PROCESS_FINISHED_NONCE_HEIGHT_algorithm">PROCESS_FINISHED_NONCE_HEIGHT</a>, we also utilize the <code>complete_transfer</code> events to calculate the <code>completed_block_height</code> and <code>completed_nonce_height</code> for the target chain.</p>
<p>For this we replace the <code>RETURN</code> above with <code>PROCESS_FINISHED_NONCE_HEIGHT</code>.</p>
<p><img src="Review/mip/relayer-bootstrap-and-reboot/MIP/mip-61/complete_event_processing.png" alt="alt text" /></p>
<h3 id="bootstrap-algorithm"><a class="header" href="#bootstrap-algorithm">BOOTSTRAP algorithm</a></h3>
<p>Next we describe how the bootstrap algorithm works and differs from the above.</p>
<blockquote>
<p>[!NOTE]
A node that is bootstrapping SHOULD start the CONTINUOUS_BLOCK_PROCESSING algorithm in parallel. This allows to immediately assume normal operation while attempting to catch up with what has been missed.</p>
</blockquote>
<p><img src="Review/mip/relayer-bootstrap-and-reboot/MIP/mip-61/bootstrap.png" alt="alt text" /></p>
<p>The Algorithm differs from the CONTINUOUS_BLOCK_PROCESSING in that it runs in parallel and will catch up with missing transfers eventually. While not hindering the continuous operation of the Relayer.</p>
<pre><code class="language-javascript">BOOTSTRAPPING
// Start the continuous block pocessing protocol in parrallel to this algorithm
START CONTINUOUS_BLOCK_PROCESSING protocol 
SET `first_CP_block` = first processed block by CONTINUOUS_BLOCK_PROCESSING

// Set initial processed block parameters
SET `end_source_block` = `first_CP_block` - 1
SET `start_source_block` = some INPUT value

// Process source blocks in the specified range
FOR `current_block` = `start_source_block` TO `end_source_block` DO:
    RUN CONTINUOUS_BLOCK_PROCESSING using `current_block` as the source block.
</code></pre>
<h4 id="bootstrap-input-types"><a class="header" href="#bootstrap-input-types">Bootstrap input types</a></h4>
<p><strong>Manual input</strong>
Based on knowledge of when the relayer stopped, we can inject a parameter about the source block height from which the relayer should start to bootstrap. Default is the genesis or some arbitrary long interval in the past, e.g. 2 weeks.</p>
<p><strong>Reading from local memory</strong>
In the CONTINUOUS_BLOCK_PROCESSING Algorithm the Relayer can record the height of the source block <code>completed_block_height</code> as described in the Calculation-Completed-Block-Height algorithm. When rebooting or bootstrapping the node, the relayer can start from the last point it left.</p>
<p><strong>Reading from chain</strong>
The relayer records on the source or target chain (whichever is cheaper) the <code>completed_block_height</code> (see <a href="Review/mip/relayer-bootstrap-and-reboot/MIP/mip-61/index.html#calculation-of-completed-source-block-height">PROCESS_FINISHED_NONCE_HEIGHT</a>. This can happen infrequent. A separate algorithm needs to be spelled out which records the highest source block, below which all source blocks with transfers are completed.</p>
<h2 id="considered-alternatives"><a class="header" href="#considered-alternatives">Considered Alternatives</a></h2>
<ol>
<li>Use of indexer DB.</li>
</ol>
<p>This creates a dependency to another component. For example, if the postgres db has an issue, the relayer has an issue. Even thought the relayer doesn’t need the db to process.</p>
<h2 id="reference-implementation-15"><a class="header" href="#reference-implementation-15">Reference Implementation</a></h2>
<h2 id="verification-20"><a class="header" href="#verification-20">Verification</a></h2>
<h2 id="changelog-5"><a class="header" href="#changelog-5">Changelog</a></h2>
<h2 id="appendix-17"><a class="header" href="#appendix-17">Appendix</a></h2>
<h2 id="copyright-8"><a class="header" href="#copyright-8">Copyright</a></h2>
<p>Copyright and related rights waived via <a href="Review/mip/relayer-bootstrap-and-reboot/MIP/mip-61/../LICENSE.html">CC0</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="mip-69-bridge-fees"><a class="header" href="#mip-69-bridge-fees">MIP-69: Bridge Fees</a></h1>
<ul>
<li><strong>Description</strong>: How to charge bridges fees when bridging $L2MOVE to $L1MOVE.</li>
<li><strong>Authors</strong>: <a href="mailto:franck.cassez@movementlabs.xyz">Franck Cassez</a></li>
<li><strong>Desiderata</strong>: <a href="Review/issue66/MDMIP-for-bridge-fees/MIP/mip-69/../../MD/md-69/README.html">MD-69</a></li>
</ul>
<h2 id="abstract-22"><a class="header" href="#abstract-22">Abstract</a></h2>
<p>As pointed out in <a href="Review/issue66/MDMIP-for-bridge-fees/MIP/mip-69/../../MD/md-69/README.html">MD-69</a>, bridging \ tokens from Movement Chain to Ethereum (L1) requires the <em>relayer</em> to pay for Ethereum (L1) part of bridge transaction, the <em>L1 fees</em>.
Ethereum’s transaction fees are substantially higher than Move Chain fees, and we may not sponsor the L1 fees but instead charge the user
for the L1 fees.
As a result the operator has to charge some transfer fees on top pf the Move Chain <em>initiate</em> transaction fees.</p>
<p>The requirements for the bridge fees from Move Chain to L1 are gathered in  <a href="Review/issue66/MDMIP-for-bridge-fees/MIP/mip-69/../../MD/md-69/README.html">MD-69</a> and this
MIP proposes some strategies to satisfy these requirements.</p>
<p>More specifically, this MIP covers the following topics:</p>
<ul>
<li>adjusting bridge fees dynamically,</li>
<li>sources of uncertainty in fees,</li>
<li>using oracles to collect trustworthy and recent estimates of prices,</li>
<li>possible strategies to avoid/reduce deficit.</li>
</ul>
<h2 id="motivation-22"><a class="header" href="#motivation-22">Motivation</a></h2>
<h3 id="bridging-mechanism"><a class="header" href="#bridging-mechanism">Bridging mechanism</a></h3>
<p>Bridging $L2MOVE to $L1MOVE involves the 4 following steps (Figure 1):</p>
<ol>
<li>User request a transfer of <code>n</code> \, which initiates a <em>burn</em> transaction on Move Chain. D1 in <a href="Review/issue66/MDMIP-for-bridge-fees/MIP/mip-69/../../MD/md-69/README.html">MD-69</a>.</li>
<li>the <em>burn</em> transaction executes and completes and an event <code>FundsBurnt!</code> is appended to the Move Chain logs. <code>n</code> tokens are burnt on Move Chain.</li>
<li>The relayer <em>relays</em> the <code>FundsBurnt!</code> event to the L1 by submitting a <em>unlock</em> transaction.</li>
<li>The <em>unlock</em> transaction executes and completes and an event  <code>FundsUnlocked!</code>. <code>n</code> tokens are transferred from the L1 Bridge to the user (on L1).</li>
</ol>
<hr />
<h2 id=""><a class="header" href="#"><img src="Review/issue66/MDMIP-for-bridge-fees/MIP/mip-69/steps.png" alt="alt text" /></a></h2>
<p><strong>Figure 1.</strong> The 4 steps to bridge funds from Move Chain to Ethereum (L1)</p>
<hr />
<h3 id="fees"><a class="header" href="#fees">Fees</a></h3>
<p>The relayer pays the L1 fees (D2, <a href="Review/issue66/MDMIP-for-bridge-fees/MIP/mip-69/../../MD/md-69/README.html">MD-69</a>) and it is hard to predict them <em>at the time</em> the user requests the funds transfer. Indeed the fees depend on the L1 <em>gas price</em> that evolves dynamically according to rules that take into account the network congestion (how full blocks are, gas-wise), which is described in <a href="https://github.com/ethereum/EIPs/blob/master/EIPS/eip-1559.md">EIP-1559</a>. On top of that, the L1 fees are paid in $ETH by the relayer and the price of $ETH is also time-dependent.</p>
<p>Figure 2 below examplifies the changes in gas price, \ price and their effect on the L1 fees paid by the relayer.</p>
<hr />
<p><img src="Review/issue66/MDMIP-for-bridge-fees/MIP/mip-69/timediag.png" alt="alt text" /></p>
<hr />
<p><strong>Figure 2</strong>: L1 fees fluctuate per block according to <a href="https://github.com/ethereum/EIPs/blob/master/EIPS/eip-1559.md">EIP-1559</a></p>
<hr />
<blockquote>
<p>[!WARNING]
To cover the L1 fees, we need to collect some fees from the user (D3, <a href="Review/issue66/MDMIP-for-bridge-fees/MIP/mip-69/../../MD/md-69/README.html">MD-69</a>), and adjust the fees to 1) cover the costs incurred by the relayer to submit the <em>unlock</em> transaction (D4, <a href="Review/issue66/MDMIP-for-bridge-fees/MIP/mip-69/../../MD/md-69/README.html">MD-69</a>), and 2) minimise the difference between what we charge the user and what we actually pay (D5, <a href="Review/issue66/MDMIP-for-bridge-fees/MIP/mip-69/../../MD/md-69/README.html">MD-69</a>).</p>
</blockquote>
<p>This MIP proposes strategies to satisfy the requirements D1-D5, <a href="Review/issue66/MDMIP-for-bridge-fees/MIP/mip-69/../../MD/md-69/README.html">MD-69</a>.</p>
<h2 id="specification-21"><a class="header" href="#specification-21">Specification</a></h2>
<blockquote>
<p>[!NOTE]
We charge the user some bridging fees to cover the cost of the (relayer) L1 fees. This section reviews some possible solutions.</p>
</blockquote>
<p>As the fees are charged in $MOVE but the transaction on the L1 are paid in $ETH, we need to track the ratio <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">$ETH price</span></span><span class="mord">/</span><span class="mord text"><span class="mord">$MOVE price</span></span></span></span></span>.
Assuming we have two pools of tokens for the Move to L1 bridge, <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">A</span></span></span></span> ($MOVE) and <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span></span></span></span> $ETH, we pay with the tokens in <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span></span></span></span> and get revenues in <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">A</span></span></span></span>.
We should try to ensure that</p>
<p><span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">an</span><span class="mord mathnormal">ce</span><span class="mopen">(</span><span class="mord mathnormal">A</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.9444em;vertical-align:-0.1944em;"></span><span class="mord text"><span class="mord">$MOVE price</span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.4831em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">an</span><span class="mord mathnormal">ce</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.9444em;vertical-align:-0.1944em;"></span><span class="mord text"><span class="mord">$ETH price</span></span></span></span></span></span>
to balance the funds in the two pools.</p>
<p>More precisely we may try to bound the difference in value in the two pools by a given constant:</p>
<p><span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">∣</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">an</span><span class="mord mathnormal">ce</span><span class="mopen">(</span><span class="mord mathnormal">A</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.9444em;vertical-align:-0.1944em;"></span><span class="mord text"><span class="mord">$MOVE price</span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">an</span><span class="mord mathnormal">ce</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">$ETH price</span></span><span class="mord">∣</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord text"><span class="mord">MaxDeficit</span></span><span class="mpunct"><span class="mord">.</span></span></span></span></span></span></p>
<h3 id="request-to-transfer-l2move-move-chain"><a class="header" href="#request-to-transfer-l2move-move-chain">Request to transfer \$L2MOVE (Move Chain)</a></h3>
<ol>
<li>The user pays for the Move Chain request transaction fees, <code>ReqTxFees</code> in \,</li>
<li>The user MUST be able to request the transfer of <code>n</code> \ provided their account balance is larger or equal to <code>n</code> (after taking into the <code>ReqTxFees</code>).</li>
<li>The user SHOULD be charged some <em>bridging fees</em> and MUST be able to provide a maximum fee bound, <code>MaxBridgeFee</code>, they agree to be charged.</li>
<li><code>n</code> MUST be larger than <code>MaxBridgeFee</code></li>
<li>The bridging fees MUST be charged in \ and deducted from the user initial amount <code>n</code> during the transfer of assets.</li>
</ol>
<h3 id="completion-of-transfer-l1"><a class="header" href="#completion-of-transfer-l1">Completion of transfer (L1)</a></h3>
<ol start="6">
<li>The relayer MUST pay the L1 fees, <code>L1Fees</code>, in \.</li>
<li>The user MUST get at least <code>n - MaxBridgeFee</code> \.</li>
<li>The relayer (operator) gets <code>L1BridgeFees</code> \, and <code>L1BridgeFees</code> MUST be at most <code>MaxBridgeFee</code>.</li>
<li>The L1 fees <code>L1Fees</code> (in $ETH) paid by the relayer SHOULD be <em>covered</em> by the equivalent bridge fees <code>L1BridgeFees</code> in $MOVE.</li>
</ol>
<p>The previous requirements imply:</p>
<ol start="10">
<li>We MUST track or estimate the \ price and the L1 gas price.</li>
<li>We MUST track or estimate the $MOVE/$ETH ratio.</li>
</ol>
<p>The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”, “RECOMMENDED”, “NOT RECOMMENDED”, “MAY”, and “OPTIONAL” in this document are to be interpreted as described in RFC 2119 and RFC 8174.</p>
<h2 id="reference-implementation-16"><a class="header" href="#reference-implementation-16">Reference Implementation</a></h2>
<h3 id="request-to-transfer-l2move-move-chain-1"><a class="header" href="#request-to-transfer-l2move-move-chain-1">Request to transfer \$L2MOVE (Move Chain)</a></h3>
<p>The user (or a dedicated front-end) submits a transaction to request the transfer of <code>n</code> $L2MOVE with a maximum bridge fees expressed in $MOVE.
As a result we expect the <code>initialize</code> (bridge transfer) on the Move Chain to have the following signature:</p>
<pre><code class="language-Rust">/// Provides MOVE native bridge 
module native_bridge {

/// User submits a transfer request
///
/// @param user         The initiator on Move Chain of the transfer
/// @param recipient    The recipient on L1 of the transfer
/// @param amount       The amount (\\) to be transferred
/// @param max_fess     The maximum amount the `user` agrees to be charged for bridging fees.
///
/// Aborts if (not exhaustive): max_fees &gt; amount, user balance is less than `amount`.
public entry initialize(user: &amp;signer, recipient: ethereum_address, amount: u64, max_fees: u64) 
{
    assert!(max_fees &lt;= amount&gt;);
    ...
    // 3 in Figure 1, FundsBurnt
    event::emit_event(user, recipient, actual_amount, max_fees,...);
    
}
...
}
</code></pre>
<p>To compute the bridge (and charge) fees we have three options:</p>
<ul>
<li><strong>[Option 1]</strong>: compute the bridge fees at the time of the request. In that case the <code>actual_amount</code> takes into account the bridge fees.  <strong>The contract on the Move Chain must keep track of the L1 gas price and the $ETH/$MOVE prices.</strong></li>
<li><strong>[Option 2]</strong>: the bridging fees are computed at the time of the <code>unlock</code> transaction, and the fees are a parameter of the <code>unlock</code> (Figure 1). The Relayer computes the fees and relays the <code>actual_amount</code>. <strong>The relayer must track the L1 gas price and the $ETH/$MOVE prices.</strong></li>
<li><strong>[Option 3]</strong>: the bridging fees are computed and <strong>charged in the L1</strong> contract that executes the <code>unlock</code> (Figure 1). <strong>The L1 contract  must track the L1 gas price and the $ETH/$MOVE prices.</strong></li>
</ul>
<blockquote>
<p>[!IMPORTANT]
Overall, the bridging fees can be computed at different times, but we charge them in the L1 <code>unlock</code> (complete transfer) transaction.
We also need an oracle to provide a trustworthy estimate of the \ price and L1 gas price.</p>
</blockquote>
<blockquote>
<p>[!NOTE]
The resource consumption of the <code>unlock</code> transaction is <strong>fixed</strong> and depends on the <em>size</em> of the <code>calldata</code> (fixed for unlock`). The computation of the L1 transaction fees is explained in <a href="https://github.com/movementlabsxyz/MIP/tree/gas-fee-calculation/MIP/mip-16">MIP-16</a>.</p>
</blockquote>
<h3 id="comparisons"><a class="header" href="#comparisons">Comparisons</a></h3>
<h4 id="quality-of-the-estimates"><a class="header" href="#quality-of-the-estimates">Quality of the estimates</a></h4>
<p>The quality of the estimates for \ price ad L1 gas price depends on two main factors:</p>
<ul>
<li>how and where we get the estimates. We can assume that we use trusted <em>oracles</em> or an average on many oracles to solve this issue.</li>
<li>the <em>age</em> of the estimates. The older the estimates the less accurate they may be.</li>
</ul>
<p>As a result, if we use the same oracle device for the three options, the quality of the estimates solely depends on the <em>age</em> and:</p>
<p>Option 3 &gt; Option 2 &gt; Option 1.</p>
<h4 id="flexibility-in-implementation"><a class="header" href="#flexibility-in-implementation">Flexibility in implementation</a></h4>
<p>Options 1 and 3 require the contracts to query the oracle. This is doable to query <em>on-chain</em> oracles as explained in this <a href="https://ethereum.org/en/developers/docs/oracles/">Ethereum developers section</a>.
These options are <em>trusted</em> provided the oracle is trusted too.</p>
<p>Option 2 is an <em>off-chain</em> solution and may provide more flexibility but probably requires that <strong>the relayer</strong> can query the estimates and <strong>is trusted</strong>.</p>
<h3 id="completion-and-adjustment-of-bridge-fees"><a class="header" href="#completion-and-adjustment-of-bridge-fees">Completion and adjustment of bridge fees</a></h3>
<p>If we follow Options 1 (resp. 3), the bridging fees are adjusted either in the Move (resp. Solidity) contract that provides the <code>initialize</code> (resp. <code>unlock</code>) function.
For option 2, the Relayer keeps track of the estimates and implements the adjustment.</p>
<h3 id="when-do-we-make-an-adjustment"><a class="header" href="#when-do-we-make-an-adjustment">When do we make an adjustment?</a></h3>
<p>There are several options:</p>
<ul>
<li>at each request (every transaction), or every $k$ transactions,</li>
<li>at time intervals (to be defined).</li>
</ul>
<blockquote>
<p>[!IMPORTANT]
In between two adjustments, the fees remain constant. We refer to the <strong>adjustment window</strong> as the intervals in which the fees are constant.</p>
</blockquote>
<p>The choice may depend on the frequency of bridging requests: if bridging are rare, we may update at every request at most.
If they are frequent and we cannot afford to query oracles too frequently, we may decide on a time interval.</p>
<h3 id="strategies-to-adjust-the-bridge-fees"><a class="header" href="#strategies-to-adjust-the-bridge-fees">Strategies to adjust the bridge fees</a></h3>
<p>To adjust the bridge fees dynamically, we may want to ensure:</p>
<p>$$
| Balance(A) \times \text{$MOVE price} \times r - Balance(B) \times \text{$ETH price} | &lt; \text{MaxDeficit} \mathpunct.
$$</p>
<p>We need to design a <em>strategy</em> (in the sense of a two-player game) that guarantees the above safety property.</p>
<blockquote>
<p>[!WARNING]
Ideally, our solution should be better with recent estimates rather than older ones, but it may not be easy to guarantee.</p>
</blockquote>
<p>The most powerful state-based strategy can be obtained by recording the values of the L1 gas price, $ETH and $MOVE prices since the genesis.
It also depends on the funds in both pools $A$ and $B$.
However, we cannot reasonably store all these data, and we have to base our strategy on a smaller quantity of information.</p>
<p>To start with we may use:</p>
<ul>
<li>the estimated max gas price, $ETH/$MOVE prices when the next <code>unlock</code> transaction will be processed,</li>
<li>the current difference between the revenues (in $MOVE) and expenses (in $ETH), i.e. the gap surplus or deficit in our pools,</li>
<li>the time (seconds or blocks or transactions) we would like to cover a deficit.</li>
</ul>
<p>As discussed during the co-location we may start with a simple strategy limited to increasing the fees by a constant factor. The decision to increase or decrease can be taken using oracles or simply based on the funds in pools $A$ and $B$.</p>
<h3 id="simple-strategies"><a class="header" href="#simple-strategies">Simple strategies</a></h3>
<p>Denote $Balance(A, B)$ the difference of the balances, in USD, of pools $A$ and $B$.</p>
<p>$$ Balance(A, B) = Balance(A).USD - Balance(B).USD \mathpunct. $$</p>
<p>If $Balance(A, B) \geq 0$ we are running a <em>surplus</em>, otherwise a <em>deficit</em>.</p>
<h4 id="balance-based-strategy"><a class="header" href="#balance-based-strategy">Balance based strategy</a></h4>
<p>A simple strategy is to increase/decrease the bridge fees by a $K$ ($MOVE) tokens every time we update the fees.
If $Balance(A, B) == 0$, we keep the fees as they are, if $Balance(A, B) &gt; 0$, we increase and otherwise decrease.</p>
<p>Assume we want to adjust the fees according to:</p>
<ul>
<li>the most recent value of $Balance(A, B)$,</li>
<li>estimates of L1 gas price, $ETH/$MOVE prices in the next window.</li>
</ul>
<p>If we run a deficit we want to cover it by the next time window, and if we run a surplus, we may keep the fees unchanged or decrease them.</p>
<h4 id="estimate-and-balance-based-strategies"><a class="header" href="#estimate-and-balance-based-strategies">Estimate and balance based strategies</a></h4>
<h2 id="verification-21"><a class="header" href="#verification-21">Verification</a></h2>
<p>Needs discussion.</p>
<hr />
<h2 id="change-log"><a class="header" href="#change-log">Change Log</a></h2>
<hr />
<h2 id="appendix-18"><a class="header" href="#appendix-18">Appendix</a></h2>
<h3 id="a1-notes-from-mip-58"><a class="header" href="#a1-notes-from-mip-58">A1: Notes from <a href="https://github.com/movementlabsxyz/MIP/pull/58">MIP-58</a></a></h3>
<p>!!! warning These notes were present in MIP-58. However they do belong here instead. Please consider how to incorporate these.</p>
<ul>
<li>When bridging from L1 to L2, the protocol, through the Relayer, sponsors the gas cost on Movement. We do not need to make any modification on contracts or Relayer to support it.</li>
<li>When bridging from L2 to L1, we have a few viable solutions but it’s preferable to highlight two.
<ol>
<li>Relayer sets a fee on L2, a global variable that can be set at any given time. Considering that block validation time on L1 is bigger than on L2, it becomes a viable approach since L2 can rapidly adjust the fee according to the current block and always charge an above L1 gas cost fee to attempt that the bridge is net positive. \ is deducted from the amount of tokens that are currently being bridged and transferred to a funds manager. This gives the protocol a very reliable way to estimate how much MOVE will be charged and feed to the user a precise amount of tokens. However, bridge transfers cannot always immediately be initiated on the L1, e.g. if there is a surge in transactions.</li>
<li>Enable the Relayer to specify on the L1 <code>completeBridgeTransfer</code> transaction, the bridge fee per transaction. The amount is deducted from the total amount of tokens that were bridged and transferred to a funds manager. The dangerous situation is that we expect is this takes much more than 10 minutes before the transfer can occur, and this could lead to a big disparity between the expected amount of funds and the actual amount of tokens received.</li>
</ol>
</li>
</ul>
<hr />
<h2 id="copyright-9"><a class="header" href="#copyright-9">Copyright</a></h2>
<p>Copyright and related rights waived via <a href="Review/issue66/MDMIP-for-bridge-fees/MIP/mip-69/../LICENSE.html">CC0</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="mip-71-informer-v1-for-the-operation-of-the-lockmint-native-bridge"><a class="header" href="#mip-71-informer-v1-for-the-operation-of-the-lockmint-native-bridge">MIP-71: Informer V1 for the Operation of the Lock/Mint Native Bridge</a></h1>
<ul>
<li><strong>Description</strong>: The Informer collects data from L1 and L2 about the supply of \ tokens and forwards the information to relevant parties, which is critical for the safe operation of the Native Bridge.</li>
<li><strong>Authors</strong>: <a href="mailto:andreas.penzkofer@movementlabs.xyz">Andreas Penzkofer</a></li>
<li><strong>Desiderata</strong>: <a href="Review/mip/informer-lockmintbridge/MIP/mip-71/../../MD/md-71">MD-71</a></li>
</ul>
<h2 id="abstract-23"><a class="header" href="#abstract-23">Abstract</a></h2>
<p>The Informer V1 (hereafter simply called Informer) for the Lock/Mint-Native Bridge (in the following simply referred to as Native Bridge) is introduced to collect information about the state from L1 and L2 and provide this information to components of the <strong>Governance</strong> or the <strong>Governance Operator</strong>. The information is not based on the total supply but rather circulating supply on L2 and locked supply on L1. The provided information is critical for the safe operation of bridge components such as the Rate Limiter, the Security Fund, and the Bridge Operator.</p>
<p>The Informer V1 is limited in scope and capabilities with the intention that future releases will expand its monitoring capabilities. For example the calculation of inflight tokens is optional in this version, and is listed for future versions.</p>
<h2 id="motivation-23"><a class="header" href="#motivation-23">Motivation</a></h2>
<p>Several components should react if the bridge is under attack or faulty. In particular, the considered components are the Insurance Fund, see <a href="https://github.com/movementlabsxyz/MIP/pull/50">MIP-50</a> and the Rate Limiter, see <a href="https://github.com/movementlabsxyz/MIP/pull/56">MIP-56</a>.</p>
<p>The Operator that controls these components requires knowledge about the states of minted or locked tokens on L1 and L2. The Operator is an entity (e.g. multisig human) that has the ability to sign transactions and send funds from the Security Fund. Moreover, the operation of the components may also be handled via a governance, which could also rely on state information.</p>
<h2 id="context-1"><a class="header" href="#context-1">Context</a></h2>
<p>We refer to the following illustration for a bridge transfer from L1 to L2, which is taken from <a href="https://github.com/movementlabsxyz/MIP/pull/58">MIP-58</a>.</p>
<p><img src="Review/mip/informer-lockmintbridge/MIP/mip-71/L1ToL2.png" alt="L1 to L2 Transfer" />
<em>Figure 1: Illustration of L1 to L2 token transfer process.</em></p>
<h2 id="specification-22"><a class="header" href="#specification-22">Specification</a></h2>
<p>The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”, “RECOMMENDED”, “NOT RECOMMENDED”, “MAY”, and “OPTIONAL” in this document are to be interpreted as described in RFC 2119 and RFC 8174.</p>
<p><img src="Review/mip/informer-lockmintbridge/MIP/mip-71/overview.png" alt="Overview" />
<em>Figure 1: Dependencies of components on the Informer mechanism in the Native Bridge.</em></p>
<p>The Informer collects information about the state of $L1MOVE and $L2MOVE and provides this information to the Governance Operator who controls relevant components of the Native Bridge. The Informer is a trusted component that is critical to the safe operation of the Native Bridge.</p>
<ol>
<li>The Informer is a component that MUST run a node or client on L1 and on L2 to be able to extract information about the states of the chains.</li>
<li>On L1 the Informer SHOULD read the supply <code>L1MOVE_locked</code> of \ token at the finalized state.</li>
<li>On L2 the Informer SHOULD read the circulating supply <code>L2MOVE_minted</code> of $L2MOVE token at the finalized state. The <code>L2MOVE_minted</code> value MUST consider the amount of burned tokens through transfers from L2 to L1 (<code>initiate_transfer</code> calls on L2), such that the <code>L2MOVE_minted</code> represents the circulating supply of $L2MOVE on L2.</li>
<li>Since L1 blocks have timestamps we say the Informer reads <code>L1MOVE_locked</code> at time <code>t_L1</code>.</li>
<li>We assume that L2 blocks acquire timestamps from the sequencing protocol, e.g. Celestia. Thus the Informer reads <code>L2MOVE_minted</code> at time <code>t_L2</code>.</li>
</ol>
<blockquote>
<p>[!NOTE]
Instead of the finalized state we could also consider the <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span>-confirmed state for the L1. The definition of <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span>-confirmed is given in <a href="https://github.com/movementlabsxyz/movement/issues/838">Issue-838</a>. Similarly, for the L2, we could assume some different confirmation level like the fast-confirmation, see <a href="https://github.com/movementlabsxyz/MIP/pull/65">MIP-65</a>.</p>
</blockquote>
<p>Since the Relayer may use a confirmation level that is not the finalization, we add the following requirement:</p>
<ol start="6">
<li>The confirmation levels for the Informer MUST be the same as for the Relayer.</li>
</ol>
<h4 id="dissemination-of-information"><a class="header" href="#dissemination-of-information">Dissemination of information</a></h4>
<p>We do not prescribe a particular dissemination method.  In case the Informer detects possible threat, the Informer MAY provide the information to the Governance Operator via publishing a notification and which then alerts the Operator via a PagerDuty service to relevant personal.</p>
<h4 id="locked-and-minted-supply-difference"><a class="header" href="#locked-and-minted-supply-difference">Locked and minted supply difference</a></h4>
<p>The Informer MUST provide the information about the difference of locked $L1MOVE and minted $L2MOVE supply <code>MOVE_diff</code>. This indirectly informs, whether there is an issue with the total circulating supply of $MOVE across the L1 and L2. The Informer provides this information at time <code>t'</code>, where <code>t' ~ max{t_L1,t_L2}</code>). It is approximate, since the local time of the informer may differ from the chain clocks. However, it can only provide guarantees for <code>t = min {t_L1,t_L2}</code>, which is discrete block time.</p>
<p>The Informer MUST measure <code>MOVE_diff(t) = L1MOVE_locked(t_L1) - L2MOVE_mint(t_L2)</code> and the condition <code>is_MOVE_diff_safe = (MOVE_diff &lt; 0)</code>.</p>
<blockquote>
<p>[!NOTE]
<code>CONDITION_1</code> :  The Informer warns if <code>is_MOVE_DIFF</code> is false. This is because in this scenario the circulating supply exceeds the maximum circulating supply <code>MOVE_Max</code>.</p>
</blockquote>
<h4 id="optional-inflight-tokens"><a class="header" href="#optional-inflight-tokens">(Optional:) Inflight tokens</a></h4>
<p>The Informer MAY calculate the in-flight tokens. Inflight tokens are tokens that are locked (burned) on L1 (L2) but that are not yet minted (unlocked) on L2 (L1) with a <strong>finalized state</strong>. With respect to finalized states it should be <code>MOVE_inflight = MOVE_diff</code>.</p>
<p>We can further differentiate the inflight tokens, however this considers non-finalized events and thus results may not be precise or may even revert.</p>
<p>We can differentiate the following types of inflight tokens:</p>
<ol>
<li>transfer is processed by the Relayer and the <code>complete_transfer</code> transaction is recorded on the target chain but not finalized. This includes the sets <code>L1MOVE_inflight_processing</code> and <code>L2MOVE_inflight_processing</code>.</li>
<li>transfer is initiated on source chain but the Relayer has not yet processed the transfer. This includes the sets <code>L1MOVE_inflight_init</code> and <code>L2MOVE_inflight_init</code>.</li>
</ol>
<p>The Informer can measure <code>L1MOVE_inflight_processing</code> and <code>L2MOVE_inflight_processing</code> by reading the non-finalized state of the respective chain.</p>
<h2 id="recommendations-1"><a class="header" href="#recommendations-1">Recommendations</a></h2>
<h4 id="possible-measurement-errors"><a class="header" href="#possible-measurement-errors">Possible measurement errors</a></h4>
<p>The timestamps of the two layers are not synchronized. We assume that the difference is negligible, however, for correctness, the implications of a drift between the L1 and L2 clocks should be considered. Moreover, the clocks of the layers progress discretely. This means that the Informer reads events from L1 and L2 with slightly different time stamps. This timestamp difference can introduce errors in the calculation of circulating token.</p>
<h4 id="slow-chain"><a class="header" href="#slow-chain">Slow chain</a></h4>
<p>The Informer may receive block events delayed from one of the chains. Consequently, finalized <code>complete_transfer</code> transactions on the target chain could be read before their respective <code>initiate_transfer</code> counterpart from the source chain. In this case the <code>MOVE_diff</code> could trigger <code>CONDITION_1</code> albeit the chains are safe. To improve on this, the Informer SHOULD only consider transfers for which the <code>initiate_transfer</code> is on the target chain.</p>
<p>We currently have a counter called <code>nonce</code> implemented. Since this counter strictly increases on the source chain, we could improve the Informer by keeping two types of lists locally off-chain: <code>LtargetMOVE_completed_but_init_missing</code> and <code>LtargetMOVE_completed_with_init</code>. The Informer SHOULD only consider <code>LtargetMOVE_completed_with_init</code> and updates the list when the corresponding <code>initiate_transfer</code> becomes available.</p>
<h4 id="unsafe-relayer-operation-and-reorg-protection"><a class="header" href="#unsafe-relayer-operation-and-reorg-protection">UNSAFE Relayer operation and reorg protection</a></h4>
<p>The postconfirmation process is a synchronization mechanism for L2 to L1, see <a href="https://github.com/movementlabsxyz/MIP/pull/37">MIP-37</a>. It is also an anchoring mechanism that protects against reorgs. If the Relayer only processes postconfirmed states, this forces synchronization between L2 to L1.</p>
<p>If the Relayer is set up to operate in an UNSAFE mode and completes transfers based on only fast-confirmations, see <a href="https://github.com/movementlabsxyz/MIP/pull/65">MIP-65</a>, or even simply based on states computed from protoBlocks that are issued by the sequencer, the Relayer SHOULD warn about this or the operator MUST at least be aware of this.</p>
<h2 id="reference-implementation-17"><a class="header" href="#reference-implementation-17">Reference Implementation</a></h2>
<h2 id="verification-22"><a class="header" href="#verification-22">Verification</a></h2>
<p>Needs discussion.</p>
<hr />
<h2 id="errata-14"><a class="header" href="#errata-14">Errata</a></h2>
<h2 id="copyright-10"><a class="header" href="#copyright-10">Copyright</a></h2>
<p>Copyright and related rights waived via <a href="Review/mip/informer-lockmintbridge/MIP/mip-71/../LICENSE.html">CC0</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="mip-74-rate-limiter-for-the-lockmint-type-native-bridge"><a class="header" href="#mip-74-rate-limiter-for-the-lockmint-type-native-bridge">MIP-74: Rate limiter for the Lock/Mint-type Native Bridge</a></h1>
<ul>
<li><strong>Description</strong>: A rate limitation mechanism for the Lock/Mint-type Native Bridge.</li>
<li><strong>Authors</strong>: Andreas Penzkofer, Primata</li>
<li><strong>Desiderata</strong>: <a href="Review/mip/rate-limiter-lock-mint-bridge/MIP/mip-74/../../MD/md-74/README.html">MD-74</a></li>
</ul>
<h2 id="abstract-24"><a class="header" href="#abstract-24">Abstract</a></h2>
<p>We propose a rate limitation mechanism to protect the Lock/Mint-type Native Bridge, hereafter called the <em>Native Bridge</em>, see <a href="https://github.com/movementlabsxyz/MIP/pull/58">MIP-58</a>, against faulty or compromised behavior of the Native Bridge components. It limits the volume of assets that can be transferred within a time window. This MIP proposes a solution to mitigate attacks and limit damages, and if paired with an insurance fund it may cover the potential losses incurred by our users.</p>
<h2 id="motivation-24"><a class="header" href="#motivation-24">Motivation</a></h2>
<p>There are several components and actors in control of the behavior of the Native Bridge including contracts (we may assume they are trusted), our Relayer and of course the network. If an attacker can control one these components they can potentially mint and transfer assets thereby compromising the Native Bridge.</p>
<p>The Rate Limiter can help to protect the Native Bridge against faulty components (Relayer or network) or attacks. It can limit the volume of transferred value per time interval, the maximum value transferred with a given transfer, or the number of transactions within a time window.</p>
<p><strong>Background</strong>
In order to protect the protocol from exploits and potential losses, rate limiting is essential. For comparison the white paper <a href="https://docs.eigenlayer.xyz/assets/files/EigenLayer_WhitePaper-88c47923ca0319870c611decd6e562ad.pdf">EigenLayer: The Restaking Collective</a> proposes that AVS (Actively Validated Services) can run for a bridge and the stake of validators protects the transferred value crypto-economically through slashing conditions. More specifically section <code>3.4 Risk Management</code> mentions</p>
<blockquote>
<p>[…] to restrict the Profit from Corruption of any particular AVS […] a bridge can restrict the value flow within the period of slashing.</p>
</blockquote>
<p>In essence this boils down to rate limit the bridge by considering</p>
<ul>
<li>how long does it take to finalize transfers (ZK, optimistic)</li>
<li>how much value can be protected economically</li>
</ul>
<p>In our setting we trust the bridge operator, and thus we replace</p>
<ul>
<li>finalization by the reaction time of the operator</li>
<li>the staked value by the insurance fund</li>
</ul>
<h2 id="specification-23"><a class="header" href="#specification-23">Specification</a></h2>
<p><em>The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”, “RECOMMENDED”, “NOT RECOMMENDED”, “MAY”, and “OPTIONAL” in this document are to be interpreted as described in RFC 2119 and RFC 8174.</em></p>
<h3 id="actors-and-components"><a class="header" href="#actors-and-components">Actors and components</a></h3>
<p>The Native Bridge is operated via contracts, key holders and a relayer. More precisely the following actors and components are involved:</p>
<ol>
<li><strong>User</strong>: this is the entity that interacts with the Native Bridge. The user can be a contract or an external account.</li>
<li><strong>L1 Native Bridge contract</strong>: this is the contract that is deployed on the L1 chain. It is responsible for locking and releasing (unlocking) assets on the L1 chain.</li>
<li><strong>L2 Native Bridge contract</strong>: this is the contract that is deployed on the L2 chain. It is responsible for minting and burning assets on the L2 chain.</li>
<li><strong>Governance contract</strong>: this is an L2 contract on L2 that is used to adjust the parameters of the Native Bridge components on L2.</li>
<li><strong>Governance Operator</strong>: this is the entity that can adjust the parameters of the Native Bridge via the governance contract or directly.</li>
<li><strong>Relayer</strong>: this is the software component that is responsible for transferring assets between the L1 and L2 Native Bridge contracts by completing transfers initiated by the user.</li>
</ol>
<p>In addition to protect the Native Bridge against faulty components, the Rate Limiter and the Insurance Fund are introduced. Figure 1 shows the architecture of the Native Bridge including the following components:</p>
<ol>
<li><strong>Insurance Fund</strong>: The Insurance Fund is a pool of tokens held in a contract that is used to cover potential losses in case of a faulty component, see <a href="https://github.com/movementlabsxyz/MIP/pull/50">MIP-50</a>.</li>
<li><strong>Rate Limiter</strong>: The Rate Limiter is a set of contracts (one on the L1 and one on the L2) that is used to limit the volume of transferred value per time window.</li>
</ol>
<p><img src="Review/mip/rate-limiter-lock-mint-bridge/MIP/mip-74/overview.png" alt="alt text" />
<em>Figure 1: Architecture of the Rate Limitation system</em></p>
<h3 id="trust-assumptions"><a class="header" href="#trust-assumptions">Trust assumptions</a></h3>
<p>We assume the following <em>trust assumptions</em>:</p>
<p>Contracts:</p>
<ol>
<li>The Governance contract is implemented correctly.</li>
<li>The Native Bridge contracts (L1 and L2) are implemented correctly.</li>
<li>The Insurance Fund is implemented correctly.</li>
<li>The Rate Limiter contract parts are implemented correctly.</li>
</ol>
<p>Other:</p>
<ol>
<li>The Governance Operator is trusted. For example, it COULD be a multisig human.</li>
<li>The Relayer is a partially trusted software component. We trust it to a certain extent, but we want to limit its power to mint or release assets.</li>
</ol>
<h3 id="risks-and-mitigation-strategies"><a class="header" href="#risks-and-mitigation-strategies">Risks and mitigation strategies</a></h3>
<p>The following attack vectors are considered:</p>
<ol>
<li>The trusted Relayer is compromised or faulty. We thus want to ensure that the Relayer has not unlimited power to release or mint assets. For this we MUST implement the Rate Limiter on the target chain.</li>
<li>In order to rate-limit the Native Bridge (e.g. stop the Native Bridge transfers entirely) there should be a higher instance than the Relayer in setting rate limits. Thus the rate limit on the target chain SHOULD be set by the Governance Operator.</li>
<li>If the target chain is rate limited but the source chain is not, users could request for more transfers on the source chain than the Relayer could complete on the target chain. This could lead to a situation where the Relayer is not able to process all transactions. To mitigate this the Relayer or the Governance Operator MUST rate limit the source chain as well. The rate limits on both chains SHOULD be consistent.</li>
<li>The Relayer may go down, while the number of transactions and requested transfer value across the Native Bridge still increases on the source chain. Due to the rate limit on the target chain the Relayer may struggle or be incapable to process all initiated transfers. Thus the Relayer or the Governance Operator MUST be able to rate limit the source chain temporarily or permanently lower than the target chain rate limit.</li>
</ol>
<p>To elaborate on the last point, consider that the Native Bridge operates at the maximum rate continuously and both source and target chain have the same rate limit. Then, if the Relayer goes down for some time <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord">Δ</span></span></span></span>, the Relayer will start to process transactions at the maximum rate. Consequently, all transactions would be delayed by <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord">Δ</span></span></span></span> time units as long as the rate limit on the target chain is entirely exhausted.</p>
<h3 id="expected-properties-of-the-rate-limiter"><a class="header" href="#expected-properties-of-the-rate-limiter">Expected Properties of the Rate Limiter</a></h3>
<p>The objectives of the Rate Limiter are to guarantee the following properties:</p>
<ol>
<li>the value of assets being transferred across the Native Bridge, within a configurable time window <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord">Δ</span></span></span></span>, MUST always be less than the insurance funds.</li>
<li>the Governance Operator MUST be able to adjust the rate limit on the source and target chain.</li>
<li>the Relayer MUST be able to catch up with the transfers in case it has been down for some time.</li>
<li>the Relayer MAY adjust the rate limit on the source chain.</li>
</ol>
<p>The guiding principles of the design of the Rate Limiter are:</p>
<ol>
<li>The Governance Operator monitors the Native Bridge, and in case of an attack or fault, it SHOULD take at most <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord">Δ</span></span></span></span> time units to detect the issue and pause the Native Bridge.</li>
<li>We want to make sure that the total amount that is transferred within <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord">Δ</span></span></span></span> time units (and that could potentially result from malicious behaviors) is ALWAYS covered by the insurance fund.</li>
</ol>
<h3 id="rate-limitation"><a class="header" href="#rate-limitation">Rate limitation</a></h3>
<p>The Rate Limiter limits the volume of assets that can be transferred within a time window. The assets are managed by the smart contracts on L2 and L1, and we MAY build the rate limiter logics directly as part of the L1 Native Bridge contract and the L2 Native Bridge contract.</p>
<h4 id="insurance-funds"><a class="header" href="#insurance-funds">Insurance funds</a></h4>
<p>We assume there is a Insurance Fund on both L1 and L2, with values <code>insurance_fund_L1</code> and <code>insurance_fund_L2</code>, respectively.</p>
<p>!!! warning These values are considered constant in the sequel. There may be updated if needed or if new funds are added to the pools.</p>
<p>The Insurance Fund indirectly rate-limits the transfers i.e., for a given transfer from source chain to target chain the Insurance Fund on the <em>target chain</em> is responsible for the rate limit, and thus we will refer to the <code>insurance_fund_target</code>.
For a transfer from L1 (L2) to L2 (L1) the <code>insurance_fund_target = insurance_fund_L2</code> (<code>insurance_fund_L1</code>) is responsible for the rate limit.</p>
<h4 id="rate-limit-on-the-target-chain"><a class="header" href="#rate-limit-on-the-target-chain">Rate limit on the target chain</a></h4>
<p>The rate limit is dependent on the fund size in the Insurance Fund. In particular the maximum rate limit is defined by</p>
<p><code>max_rate_limit_target = insurance_fund_target / reaction_time</code>,</p>
<p>where the <code>reaction_time</code> is the time it takes for the Governance Operator to react to a faulty or compromised component. The <code>reaction_time</code> is a parameter that is set by the Governance Operator.</p>
<p><em>Implementation recommendation #1</em>: The default value is 24h. In the initial implementation this value is fixed to avoid complications in gas.</p>
<p><em>Implementation recommendation #2</em>: The target Native Bridge contract checks at every transfer first, whether the relevant Insurance Fund size has changed before calculating the current rate limit and whether the budget is exceeded.</p>
<p><strong>(Optional) Direct adjustment of rate limit by Governance Operator</strong>
The rate limit MAY also be adjusted by the Governance Operator directly by a parameter <code>rate_reduction_target</code>. However the Rate Limiter MUST NOT set the rate limit higher than the <code>max_rate_limit_target</code>. In equation</p>
<p><code>rate_limit_target = rate_reduction_target * max_rate_limit_target</code>,</p>
<p>where <code>rate_reduction_target</code> <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mrel">∈</span></span></span></span> <code>[0,1]</code> is a parameter that is set by the Governance Operator. As mentioned the <code>rate_limit_target</code> MUST not be larger than <code>max_rate_limit_target</code>.</p>
<p><strong>Summary of Adjustment mechanisms</strong>
The following are possible ways to adjust the rate limit:</p>
<ol>
<li>The Governance Operator indirectly adjusts the rate limit by adding or removing funds from the Insurance Fund.</li>
<li>The Governance Operator indirectly MAY adjust the rate limit by changing the <code>reaction_time</code>.</li>
<li>The Governance Operator MAY adjust the rate limit by changing the <code>rate_reduction_target</code>.</li>
</ol>
<h4 id="rate-limit-on-the-source-chain"><a class="header" href="#rate-limit-on-the-source-chain">Rate limit on the source chain</a></h4>
<p>On the source chain the rate limit MUST be limited by the Governance Operator to match the rate limit on the target chain. if only the target chain would be rate limited users could successfully continue to request transfers on the source chain while the budget on the target chain is already consumed. Consequently the  Relayer would not be capable to complete the transfers.</p>
<p>On the source chain the rate limit MAY be lowered by the Relayer. This is to ensure that the rate limit on the target chain is not exceeded. It also permits the Relayer to catch up in case of the Relayer has been down for some time.</p>
<p><code>rate_limit_source = min{rate_reduction_source * rate_limit_target, rate_limit_operator_source}</code>,</p>
<p>where <code>rate_reduction_source</code> <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mrel">∈</span></span></span></span> <code>[0,1]</code> is a parameter that is set by the Relayer. <code>rate_limit_operator_source</code> is a parameter that is set by the Governance Operator. Note the <code>rate_limit_source</code> SHOULD not be larger than <code>rate_limit_operator_source</code>.</p>
<h3 id="rate-limitation-adjustment-algorithm"><a class="header" href="#rate-limitation-adjustment-algorithm">Rate limitation adjustment algorithm</a></h3>
<p>The rate limitation works as follows:</p>
<p>!!! warning I can convert the following into pseudo code, after we have discussed the algorithm and it makes sense.</p>
<p><strong>Algorithm for the Native Bridge contract on the source chain</strong></p>
<ol>
<li>A user wants to transfer value from source to target chain.</li>
<li>The user sends a transaction to the source chain Native Bridge contract.</li>
<li>The source chain Native Bridge contract checks if the rate limit <code>rate_limit_source</code> is exceeded if it would apply the transaction.
<ol>
<li>If the rate limit is exceeded the transaction is rejected.</li>
<li>Else the transaction is accepted.</li>
</ol>
</li>
</ol>
<p><strong>Algorithm for the Native Bridge contract on the target chain</strong></p>
<ol>
<li>The target chain Native Bridge contract checks if the rate limit <code>rate_limit_target</code> is exceeded if it would apply the transaction.
<ol>
<li>If the rate limit is exceeded the transaction is rejected.</li>
<li>If the rate limit is not exceeded the transaction is accepted.</li>
</ol>
</li>
</ol>
<p>The following algorithm is a recommendation for the operation of the Relayer:</p>
<h2 id="reference-implementation-18"><a class="header" href="#reference-implementation-18">Reference Implementation</a></h2>
<h2 id="verification-23"><a class="header" href="#verification-23">Verification</a></h2>
<p>Needs discussion.</p>
<p>We may add a formal model?</p>
<hr />
<h2 id="changelog-6"><a class="header" href="#changelog-6">Changelog</a></h2>
<h2 id="appendix-19"><a class="header" href="#appendix-19">Appendix</a></h2>
<h3 id="a1-alternative-designs"><a class="header" href="#a1-alternative-designs">A1: Alternative designs</a></h3>
<p>This MIP proposes a rate limiting mechanism for the Lock/Mint-type Native Bridge with symmetrical design. Below we discuss how we got here and which alternatives exist. The version discussed in this MIP is option C.</p>
<p>A. <strong>Single-sided rate limiting (on source chain)</strong></p>
<ul>
<li>Rate limiting should be implemented on the L1 and maps each day to a budget, for each direction. Once the budget is reached on one of the directions, no more tokens can be transferred on that direction.</li>
<li>The bridge is financially secured by an Insurance Fund, see <a href="https://github.com/movementlabsxyz/MIP/pull/50">MIP-50</a>, which determines  the maximum amount of tokens to be transferred per day, called the budget. The insurance fund is maintained by Movement Labs.</li>
<li>The budget is one quarter of the Insurance Fund balance. This is meant to account for the insurance fund to be able to insure all current funds already transferred and all tokens inflight, per direction.</li>
<li>The Insurance Fund maintains the rate limit budget by adjusting its own \ balance. It should be either the Movement Labs multisig or a new multisig 1/3 if we choose to adopt an approach that requires more direct ability by the personnel.</li>
<li>Once the rate limit budget is reached, if no issues have been observed, operators should simply wait for the next day.</li>
<li>If an issue has been observed, an operator should simply transfer to the bridge contract the sum of the exploit size, being the result of additional supply on L1, outside of the bridge address, and the additional supply on L2. This action covers both cases where tokens were extracted from the bridge contract on L1 or over-minted on L2. Movement Foundation should evaluate the amount of tokens that should be held by the Insurance Fund after the incident and transfer to it the amount to reach that amount.</li>
<li>This approach is open to exploits where the Relayer key is compromised. It would enable the exploiter to freely mint on L2.</li>
</ul>
<p>B. <strong>Two-sided partial rate limiting (target chain only)</strong></p>
<ul>
<li>Rate limiting should be implemented on both L1 and L2 for inbound transactions only. It maps a daily budget of inbound transactions and once it’s reached, the Relayer cannot complete more transactions. The bridge is financially secured by two Insurance Funds, one on each side, maintained by Movement Labs, and the maximum amount of tokens to be transferred per day, per direction is half of each of its Insurance Funds balances. This is meant to account for all tokens already transferred and inflight, per direction.</li>
<li>The Insurance Funds determine the rate limit budgets. Thus the rate limit can be adjusted by changing the \ balance. They should be either Movement Labs multisigs or new multisigs 1/3 if we choose to adopt an approach that requires more direct ability by the personnel.</li>
<li>Once the rate limit budget is reached, if no issues have been observed, operators should simply wait for the next day.</li>
<li>If an issue has been observed, operators should transfer to the bridge address the exploit amount on the L1 and burn the exploit amount on the L2. Movement Foundation should evaluate the amount of tokens that should be held by the Insurance Funds and operators should receive those tokens and bridge tokens if an exploit occurred on L2.</li>
<li>This approach is more susceptible to issues on the frontend because the frontend has to acknowledge rate limit budget and inflight tokens and inform users if the rate limit is about to be reached, not only if it has been reached.</li>
</ul>
<p>C. <strong>Two sided full rate limiting</strong></p>
<p>This proposal is discussed in this MIP.</p>
<ul>
<li>The previous approaches may break the rate limit if users can directly initiate the bridge transfer via the bridge contracts. Since we MUST guarantee the completion of transfers the rate limit on the source chain could get exceeded, leading to ever increasing backlog of transfers.</li>
<li>Therefore, rate limiting should be implemented on both L1 and L2 for inbound and outbound transactions.</li>
<li>This approach extends the previous approach.</li>
<li>It protects against exploits of the Relayer.</li>
<li>Initiating transfers get rejected on the source chain, which improves safety and fulfills rate limit requirements on the source chain.</li>
<li>On the source chain the rate limit is not related to the Insurance Fund. This opens the question who sets the rate limit on the source chain. We answer this in this MIP.</li>
</ul>
<hr />
<h2 id="copyright-11"><a class="header" href="#copyright-11">Copyright</a></h2>
<p>Copyright and related rights waived via <a href="Review/mip/rate-limiter-lock-mint-bridge/MIP/mip-74/../LICENSE.html">CC0</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="welcome-to-the-movement-network-mip-book-6"><a class="header" href="#welcome-to-the-movement-network-mip-book-6">Welcome to the Movement Network MIP Book</a></h1>
<h2 id="approved-6"><a class="header" href="#approved-6">Approved</a></h2>
<h3 id="mips-12"><a class="header" href="#mips-12">MIPs</a></h3>
<ul>
<li><a href="Approved/main/MIP/mip-1/">MIP-1: ENTL (Enclave Nonce Time-lock)</a></li>
<li><a href="Approved/main/MIP/mip-15/">MIP-15: MG (Movement Gloss)</a></li>
<li><a href="Approved/main/MIP/mip-39/">MIP-39: MOVE Token – HTLC-based Native Bridge Design</a></li>
<li><a href="Approved/main/MIP/mip-53/">MIP-53: Conventions for Proposing Progressive L2 Models</a></li>
</ul>
<h3 id="mds-12"><a class="header" href="#mds-12">MDs</a></h3>
<ul>
<li><a href="Approved/main/MD/md-1/">MD-1: Minimize Risk of Compromised Bridge Key without Governance</a></li>
<li><a href="Approved/main/MD/md-3/">MD-3: MCR under Network Partitions and Asynchrony</a></li>
<li><a href="Approved/main/MD/md-15/">MD-15: Movement Glossary</a></li>
</ul>
<h3 id="mgs-6"><a class="header" href="#mgs-6">MGs</a></h3>
<ul>
<li><a href="Approved/main/MG/mg-39/">MG-39:  MOVE Token – Bridge Design</a></li>
</ul>
<h2 id="review-6"><a class="header" href="#review-6">Review</a></h2>
<h3 id="mips-13"><a class="header" href="#mips-13">MIPs</a></h3>
<ul>
<li><a href="Review/mikhail/suzuka-da-migrations/MIP/mip-13/">MIP-13:  Suzuka DA Migrations Format</a></li>
<li><a href="Review/primata/mip-18/MIP/mip-18/">MIP-18: Stage 0 Upgradeability and Multisigs</a></li>
<li><a href="Review/gas-fee-calculation/MIP/mip-19/">MIP-19: Calculation of gas fees</a></li>
<li><a href="Review/andyjsbell/unwanted-framework/MIP/mip-24/">MIP-24: Removal of redundant functionality from framework</a></li>
<li><a href="Review/andyjsbell/proxy-root/MIP/mip-25/">MIP-25: Proxy Aptos Framework for Stage 0 governance</a></li>
<li><a href="Review/primata/mip-27/MIP/mip-27/">MIP-27: Contract Pipeline</a></li>
<li><a href="Review/l-monninger/actor-naming-conventions/MIP/mip-28/">MIP-28: Naming Conventions for Movement Protocol Design</a></li>
<li><a href="Review/mip/FFS/MIP/mip-34/">MIP-34: Fast Finality Settlement</a></li>
<li><a href="Review/mip/gas-fees-incremental-additions/MIP/mip-47/">MIP-47: Improve Gas fee collection in phases</a></li>
<li><a href="Review/0xmovses/aptos-gov-pool/MIP/mip-48/">MIP-48: <code>aptos_governance</code> for Goverened Gas Pool</a></li>
<li><a href="Review/l-monninger/just-reward/MIP/mip-49/">MIP-49: NB-FFS Governed Fees and Rewards</a></li>
<li><a href="Review/l-monninger/insured-bridge/MIP/mip-50/">MIP-50: Insured Bridge</a></li>
<li><a href="Review/l-monninger/the-biarritz-model/MIP/mip-54/">MIP-54: The Biarritz Model</a></li>
<li><a href="Review/l-monninger/the-bilbao-model/MIP/mip-55/">MIP-55: The Bilbao Model</a></li>
<li><a href="Review/mip/informer/MIP/mip-57/">MIP-57: Informer for the Operation of the HTLC-based Native Bridge</a></li>
<li><a href="Review/mip-58/MIP/mip-58/">MIP-58: Lock/Mint-type Native Bridge with trusted Relayer</a></li>
<li><a href="Review/mip-crosschain-bridges-background/MIP/mip-60/">MIP-60: Cross-chain bridge architectures</a></li>
<li><a href="Review/mip/relayer-bootstrap-and-reboot/MIP/mip-61/">MIP-61: Relayer for the lock/mint Native Bridge - Algorithm and Bootstrapping</a></li>
<li><a href="Review/issue66/MDMIP-for-bridge-fees/MIP/mip-69/">MIP-69: Bridge Fees</a></li>
<li><a href="Review/mip/informer-lockmintbridge/MIP/mip-71/">MIP-71: Informer V1 for the Operation of the Lock/Mint Native Bridge</a></li>
<li><a href="Review/mip/rate-limiter-lock-mint-bridge/MIP/mip-74/">MIP-74: Rate limiter for the Lock/Mint-type Native Bridge</a></li>
</ul>
<h3 id="mds-13"><a class="header" href="#mds-13">MDs</a></h3>
<ul>
<li><a href="Review/l-monninger/enclave-crash-resistant-keys/MD/md-2/">MD-2: Enclave Crash-resistant Key Management</a></li>
<li><a href="Review/l-monninger/long-range-attacks/MD/md-5/">MD-4: Long Range Attacks</a></li>
<li><a href="Review/l-monninger/gas-offset/MD/md-4/">MD-4: MCR Offsetting Gas Costs</a></li>
<li><a href="Review/l-monninger/block-validation/MD/md-6/">MD-6: Suzuka Block Validation</a></li>
<li><a href="Review/l-monninger/block-validation/MD/md-7/">MD-7: Prevent Suzuka MEV Exploits and Censorship</a></li>
<li><a href="Review/mikhail/suzuka-da-migrations/MD/md-13/">MD-13: Suzuka DA Migrations Format</a></li>
<li><a href="Review/primata/md-17/MD/md-17/">MD-17: Bridge Fees</a></li>
<li><a href="Review/primata/bridge-attestors/MD/md-21/">MD-21: Native Bridge with Attesters</a></li>
<li><a href="Review/andygolay/md-26/MD/md-26/">MD-26: User-facing checks</a></li>
<li><a href="Review/primata/md-30/MD/md-30/">MD-30: Movement Name Service</a></li>
<li><a href="Review/mip/FFS/MD/md-34/">MD-34: Fast Finality Settlement</a></li>
<li><a href="Review/l-monninger/provisions-for-fixed-token-supply/MD/md-38/">MD-38: Provide for Fixed Token Supply when Using Native Bridge and Fast Finality Settlement (FFS)</a></li>
<li><a href="Review/l-monninger/just-reward/MD/md-49/">MD-49: Movement L2 Gas Fees</a></li>
<li><a href="Review/mip/relayer-bootstrap-and-reboot/MD/md-61/">MD-61: Relayer for the Lock/Mint Native Bridge</a></li>
<li><a href="Review/issue66/MDMIP-for-bridge-fees/MD/md-69/">MD-69: Bridge fees</a></li>
<li><a href="Review/mip/informer-lockmintbridge/MD/md-71/">MD-71: Informer service for the Lock/Mint-based Native Bridge</a></li>
<li><a href="Review/mip/rate-limiter-lock-mint-bridge/MD/md-74/">MD-74: Rate-Limiter for the Lock/Mint-type Native Bridge</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="md-2-enclave-crash-resistant-key-management"><a class="header" href="#md-2-enclave-crash-resistant-key-management">MD-2: Enclave Crash-resistant Key Management</a></h1>
<ul>
<li><strong>Description</strong>: Provide a mechanism for allowing the use of keys in an enclave that can be recovered after crashes without breaking encapsulation.</li>
<li><strong>Authors</strong>: <a href="mailto:liam@movementlabs.xyz">Liam Monninger</a></li>
</ul>
<h2 id="overview-4"><a class="header" href="#overview-4">Overview</a></h2>
<h2 id="desiderata-3"><a class="header" href="#desiderata-3">Desiderata</a></h2>
<!--
  List out the specific desiderata. Each entry should consist of:

  1. Title: A concise name for the desideratum.
  2. User Journey: A one or two-sentence statement focusing on the "user" (could be a human, machine, software, etc.) and their interaction or experience.
  3. Description (optional): A more detailed explanation if needed.
  4. Justification: The reasoning behind the desideratum. Why is it necessary or desired?
  5. Recommendations (optional): Suggestions or guidance related to the desideratum.

  Format as:

  ### Desideratum Title

  **User Journey**: [user] can [action].

  **Description**: <More detailed explanation if needed (optional)>

  **Justification**: <Why this is a significant or required desideratum>

  **Recommendations**: <Any specific guidance or suggestions (optional)>

  TODO: Remove this comment before finalizing.
-->
<h3 id="d1-minimize-direct-access-to-bridge-keys-while-maintaining-use-1"><a class="header" href="#d1-minimize-direct-access-to-bridge-keys-while-maintaining-use-1">D1: Minimize Direct Access to Bridge Keys while Maintaining Use</a></h3>
<p><strong>User Journey</strong>: Movement Labs Atomic Bridge Service Operators (MLABSO) can run the service with appropriate signing keys without direct access to said keys.</p>
<p><strong>Justification</strong>: Without direct access to the keys, MLABSO are forced to use a more secure mechanism for signing messages which can be more easily secured audited such as an HSM or enclave.</p>
<h3 id="d2-only-allow-attested-usage-of-bridge-keys-1"><a class="header" href="#d2-only-allow-attested-usage-of-bridge-keys-1">D2: Only Allow Attested Usage of Bridge Keys</a></h3>
<p><strong>User Journey</strong>: Only attested software can use bridge keys.</p>
<p><strong>Justification</strong>: Even without direct access to the keys, MLABSO could still abuse bridge keys by abusing their access to the secure signing mechanism. Enforcing attestation of software using the keys can help mitigate this risk.</p>
<h3 id="d3-time-lock-key-usage-1"><a class="header" href="#d3-time-lock-key-usage-1">D3: Time-Lock Key Usage</a></h3>
<p><strong>User Journey</strong>: MLABSO can only reliably replace software using a key in a time-locked manner.</p>
<p><strong>Justification</strong>: The software using a given key may require updates or replacement. Time-locking can allow this to occur without diminishing the benefits of attestations.</p>
<h2 id="errata-15"><a class="header" href="#errata-15">Errata</a></h2>
<!--
  Errata should be maintained after publication.

  1. **Transparency and Clarity**: An erratum acknowledges any corrections made post-publication, ensuring that readers are not misled and are always equipped with the most accurate information.

  2. **Accountability**: By noting errors openly, we maintain a high level of responsibility and ownership over our content. It’s an affirmation that we value precision and are ready to correct oversights.

  Each erratum should briefly describe the discrepancy and the correction made, accompanied by a reference to the date and version of the desiderata in which the error was identified.

  TODO: Maintain this comment.
-->
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="md-4-long-range-attacks"><a class="header" href="#md-4-long-range-attacks">MD-4: Long Range Attacks</a></h1>
<ul>
<li><strong>Description</strong>: Provide models for the game theory of long-range attacks in MCR.</li>
<li><strong>Authors</strong>: <a href="mailto:liam@movementlabs.xyz">Liam Monninger</a></li>
</ul>
<h2 id="overview-5"><a class="header" href="#overview-5">Overview</a></h2>
<p>Long-range attacks are an inherent vulnerability to PoS networks and a subject of prescient research. We request that the relevance of these attacks to MCR be formally modeled and considered.</p>
<h3 id="introduction"><a class="header" href="#introduction">Introduction</a></h3>
<p><a href="https://blog.positive.com/rewriting-history-a-brief-introduction-to-long-range-attacks-54e473acdba9">This reference</a> categorises Long-Range Attacks into</p>
<ol>
<li>Simple Attack:
The attacker forges an alternative blockchain branch from the genesis block, bypassing timestamp checks to produce blocks ahead of time and overtake the main chain.</li>
<li>Posterior Corruption:
A retired validator is bribed or hacked to sign blocks on an alternate chain, allowing the attacker to increase their block production and potentially surpass the main chain.</li>
<li>Stake Bleeding:
The attacker stalls the main chain by skipping block production while accumulating stake and rewards on a hidden branch, eventually overtaking the main chain.</li>
</ol>
<h2 id="desiderata-4"><a class="header" href="#desiderata-4">Desiderata</a></h2>
<h3 id="d1-evaluate-the-opportunity-for-simple-long-range-attacks-and-detection-thereof"><a class="header" href="#d1-evaluate-the-opportunity-for-simple-long-range-attacks-and-detection-thereof">D1: Evaluate the Opportunity for “Simple” Long-range Attacks and Detection Thereof</a></h3>
<p><strong>User Journey</strong>: A researcher or protocol implementer can understand how a simple long-range attack could be executed and detected in MCR.</p>
<p><strong>Justification</strong>: Long-range attacks are a known vulnerability to PoS networks. Providing a model which demonstrates how a simple long-range attack could be executed and detected in MCR could enable us to derive preventative measures.</p>
<h3 id="d2-evaluate-the-opportunity-for-posterior-corruption-long-range-attacks-and-detection-thereof"><a class="header" href="#d2-evaluate-the-opportunity-for-posterior-corruption-long-range-attacks-and-detection-thereof">D2: Evaluate the Opportunity for Posterior Corruption Long-range Attacks and Detection Thereof</a></h3>
<p><strong>User Journey</strong>: A researcher or protocol implementer can understand how a posterior corruption long-range attack could be executed and detected in MCR.</p>
<p><strong>Justification</strong>: Posterior corruption long-range attacks are a known vulnerability to PoS networks. Providing a model which demonstrates how a posterior corruption long-range attack could be executed and detected in MCR could enable us to derive preventative measures.</p>
<h3 id="d3-evaluate-the-opportunity-for-stake-bleeding-long-range-attacks-and-detection-thereof"><a class="header" href="#d3-evaluate-the-opportunity-for-stake-bleeding-long-range-attacks-and-detection-thereof">D3: Evaluate the Opportunity for Stake-bleeding Long-range Attacks and Detection Thereof</a></h3>
<p><strong>User Journey</strong>: A researcher or protocol implementer can understand how a stake-bleeding long-range attack could be executed and detected in MCR.</p>
<p><strong>Justification</strong>: Stake-bleeding long-range attacks are a known vulnerability to PoS networks. Providing a model which demonstrates how a stake-bleeding long-range attack could be executed and detected in MCR could enable us to derive preventative measures.</p>
<h2 id="errata-16"><a class="header" href="#errata-16">Errata</a></h2>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="md-4-mcr-offsetting-gas-costs"><a class="header" href="#md-4-mcr-offsetting-gas-costs">MD-4: MCR Offsetting Gas Costs</a></h1>
<ul>
<li><strong>Description</strong>: Provide models for the game theory of offsetting gas costs in MCR.</li>
<li><strong>Authors</strong>: <a href="mailto:liam@movementlabs.xyz">Liam Monninger</a></li>
</ul>
<h2 id="overview-6"><a class="header" href="#overview-6">Overview</a></h2>
<p>In the current MCR implementation, the last attester which trips the <code>rollOverEpoch</code> function may pay large gas fees, as they perform roll-over work for previous participants. This would create a disincentive for the last attester to participate in the game, potentially not doing so at all. It has been presumed that the implementation would be updated s.t. the last attester would be specially rewarded for their work. This also creates a game-theoretic problem, as the last attester could be incentivized to wait until the last moment to participate.</p>
<p>To combat this, round-robin rewarding and commitment schemes such as Pedersen Commitments have been suggested. However, these have not been formalized.</p>
<h2 id="desiderata-5"><a class="header" href="#desiderata-5">Desiderata</a></h2>
<!--
  List out the specific desiderata. Each entry should consist of:

  1. Title: A concise name for the desideratum.
  2. User Journey: A one or two-sentence statement focusing on the "user" (could be a human, machine, software, etc.) and their interaction or experience.
  3. Description (optional): A more detailed explanation if needed.
  4. Justification: The reasoning behind the desideratum. Why is it necessary or desired?
  5. Recommendations (optional): Suggestions or guidance related to the desideratum.

  Format as:

  ### Desideratum Title

  **User Journey**: [user] can [action].

  **Description**: <More detailed explanation if needed (optional)>

  **Justification**: <Why this is a significant or required desideratum>

  **Recommendations**: <Any specific guidance or suggestions (optional)>

  TODO: Remove this comment before finalizing.
-->
<h3 id="d1-model-for-gas-costs-in-mcr-without-offset"><a class="header" href="#d1-model-for-gas-costs-in-mcr-without-offset">D1: Model for Gas Costs in MCR without Offset</a></h3>
<p><strong>User Journey</strong>: A researcher or protocol implementer can understand the game theory of gas costs in MCR without offsetting.</p>
<p><strong>Justification</strong>: The current implementation of MCR does not offset gas costs for the last attester. This could lead to a disincentive to participate in the game, provide a model which clearly shows this.</p>
<p><strong>Recommendations</strong>:</p>
<ul>
<li>Start with <a href="Review/l-monninger/gas-offset/MD/md-4/./rollover-gas.html">Rollover Gas</a> to understand the current state of the problem.</li>
</ul>
<h3 id="d2-model-for-gas-costs-in-mcr-with-offset"><a class="header" href="#d2-model-for-gas-costs-in-mcr-with-offset">D2: Model for Gas Costs in MCR with Offset</a></h3>
<p><strong>User Journey</strong>: A researcher or protocol implementer can understand the game theory of gas costs in MCR with offsetting.</p>
<p><strong>Justification</strong>: Naive proposals suggest simply offsetting the gas cost by rewarding the last attester transparently. Provide a model which demonstrates the game theory of this.</p>
<h3 id="d3-models-for-information-incomplete-gas-cost-offset"><a class="header" href="#d3-models-for-information-incomplete-gas-cost-offset">D3: Models for Information Incomplete Gas Cost Offset</a></h3>
<p><strong>User Journey</strong>: A researcher or protocol implementer can understand the game theory of gas costs in MCR with incomplete information.</p>
<p><strong>Justification</strong>: Information incompleteness may improve the game theory of offsetting gas costs. Provide models which demonstrate this for incompleteness derived from (1) general network latency, (2) a round-robin rewarding scheme, and (3) a Pedersen Commitment scheme.</p>
<h2 id="errata-17"><a class="header" href="#errata-17">Errata</a></h2>
<!--
  Errata should be maintained after publication.

  1. **Transparency and Clarity**: An erratum acknowledges any corrections made post-publication, ensuring that readers are not misled and are always equipped with the most accurate information.

  2. **Accountability**: By noting errors openly, we maintain a high level of responsibility and ownership over our content. It’s an affirmation that we value precision and are ready to correct oversights.

  Each erratum should briefly describe the discrepancy and the correction made, accompanied by a reference to the date and version of the desiderata in which the error was identified.

  TODO: Maintain this comment.
-->
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="md-6-suzuka-block-validation"><a class="header" href="#md-6-suzuka-block-validation">MD-6: Suzuka Block Validation</a></h1>
<ul>
<li><strong>Description</strong>: Provide means to validate blocks to prevent public DA DOS attacks.</li>
<li><strong>Authors</strong>: <a href="mailto:liam@movementlabs.xyz">Liam Monninger</a></li>
</ul>
<h2 id="overview-7"><a class="header" href="#overview-7">Overview</a></h2>
<p>The current implementation of the Suzuka Network relies on a public and permissionless DA. The blocks are further not validated besides their correctness w.r.t. the Aptos executor.</p>
<p>This could lead to an unsophisticated DOS attack wherein the attacker simply spams the network with low gas fee–both on the DA and in the execution layer–blocks. A slightly more sophisticated attack would see the attack DOS the DA namespace itself in a <a href="https://forum.celestia.org/t/woods-attack-on-celestia/59">Woods Attack</a>.</p>
<p>While we cannot prevent latter, providing solutions to the former may prove vital to fairness amongst genuine network participants.</p>
<h2 id="desiderata-6"><a class="header" href="#desiderata-6">Desiderata</a></h2>
<p>Transaction fairness (general term) : A fair block proposal of a node follows a random selection of the transactions among the set of pending transactions the node is aware of. This is also called <em>transaction fairness</em>.</p>
<!--
  List out the specific desiderata. Each entry should consist of:

  1. Title: A concise name for the desideratum.
  2. User Journey: A one or two-sentence statement focusing on the "user" (could be a human, machine, software, etc.) and their interaction or experience.
  3. Description (optional): A more detailed explanation if needed.
  4. Justification: The reasoning behind the desideratum. Why is it necessary or desired?
  5. Recommendations (optional): Suggestions or guidance related to the desideratum.

  Format as:

  ### Desideratum Title

  **User Journey**: [user] can [action].

  **Description**: <More detailed explanation if needed (optional)>

  **Justification**: <Why this is a significant or required desideratum>

  **Recommendations**: <Any specific guidance or suggestions (optional)>

  TODO: Remove this comment before finalizing.
-->
<h3 id="d1-model-transaction-fairness-in-suzuka-network"><a class="header" href="#d1-model-transaction-fairness-in-suzuka-network">D1: Model Transaction Fairness in Suzuka Network</a></h3>
<p><strong>User Journey</strong>: A researcher or protocol implementer can understand what transaction fairness means in the Suzuka Network.</p>
<p><strong>Justification</strong>: Transaction fairness is a key component of any blockchain network. It is important to understand what it means in the context of the Suzuka Network.</p>
<p><strong>Recommendations</strong>:</p>
<ul>
<li>The strongest form of formally defined fairness is currently <a href="https://link.springer.com/chapter/10.1007/978-3-030-56877-1_16">batch-order-fairness</a>. What would it mean for the Suzuka Network to achieve this.</li>
<li>Transaction fairness should consider:
<ul>
<li>Time in flight</li>
<li>Congestion</li>
<li>Ingress node</li>
<li>Causality</li>
</ul>
</li>
</ul>
<h3 id="d2-accept-only-blocks-signed-by-staked-validators"><a class="header" href="#d2-accept-only-blocks-signed-by-staked-validators">D2: Accept Only Blocks Signed by Staked Validators</a></h3>
<p><strong>User Journey</strong>: A staked Suzuka Validator is the only entity that can submit blocks to the network which will later be processed by the Aptos executor.</p>
<p><strong>Justification</strong>: This will prevent DOS attacks on the network by requiring a stake to submit blocks.</p>
<p><strong>Recommendations</strong>:</p>
<ul>
<li>Be sure to consider what is lost in this approach. For example, currently, a developer could bypass a Suzuka Full Node an submit directly to the DA–allowing them to avoid any potential censorship. This would be lost in a naive implementation of this approach, as they would be required to either (a) submit via a full-node or (b) stake themselves.</li>
</ul>
<h3 id="d3-invalidation-or-validator-slashing-for-producing-unfair-blocks"><a class="header" href="#d3-invalidation-or-validator-slashing-for-producing-unfair-blocks">D3: Invalidation or Validator-slashing for Producing Unfair Blocks</a></h3>
<p><strong>User Journey</strong>: Validators can be slashed for producing unfair blocks.</p>
<p><strong>Justification</strong>: This will disincentivize validators from producing unfair blocks.</p>
<p><strong>Recommendations</strong>:</p>
<ul>
<li>This would be a highly experimental feature and should be researched and implemented with caution.</li>
<li>Deterministic transaction and block ordering should cover most of the cases of unfairness. These are discussed in <a href="Review/l-monninger/block-validation/MD/md-6/../md-7/README.html">MD-7</a>. However, in theory you could also slash on conditions like including too many transactions from one user, sending too many blocks at a given time, sending too few blocks at a given time, sending blocks of unequal size when transactions are available, etc.</li>
</ul>
<h2 id="errata-18"><a class="header" href="#errata-18">Errata</a></h2>
<!--
  Errata should be maintained after publication.

  1. **Transparency and Clarity**: An erratum acknowledges any corrections made post-publication, ensuring that readers are not misled and are always equipped with the most accurate information.

  2. **Accountability**: By noting errors openly, we maintain a high level of responsibility and ownership over our content. It’s an affirmation that we value precision and are ready to correct oversights.

  Each erratum should briefly describe the discrepancy and the correction made, accompanied by a reference to the date and version of the desiderata in which the error was identified.

  TODO: Maintain this comment.
-->
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="md-7-prevent-suzuka-mev-exploits-and-censorship"><a class="header" href="#md-7-prevent-suzuka-mev-exploits-and-censorship">MD-7: Prevent Suzuka MEV Exploits and Censorship</a></h1>
<ul>
<li><strong>Description</strong>: Provide an account of possible Suzuka MEV attacks and censorship vulnerabilities, and propose solutions to mitigate these risks.</li>
<li><strong>Authors</strong>: <a href="mailto:liam@movementlabs.xyz">Liam Monninger</a></li>
</ul>
<h2 id="overview-8"><a class="header" href="#overview-8">Overview</a></h2>
<p>The Suzuka Network is known to be subject to MEV exploits in the form of manipulating block size and order. That is, while transactions within a block are ordered deterministically, full nodes are currently given freedom to chose which transactions to include in a block and when to send those blocks to the network. Execution-level validation will only assert that the sequence numbers are appropriate and other dApp-specific logic. There are no penalties for being to have withheld a transaction.</p>
<p>The desiderata presented herein request a complete model of MEV in the Suzuka Network. They also make some provisional requests based on surmised ways to prevent certain MEV attacks.</p>
<p>Most of the account of MEV attacks should be based on the model of transaction fairness given in <a href="Review/l-monninger/block-validation/MD/md-7/../md-6/README.html">MD-6</a>.</p>
<p>Many of MEV attacks addressed can also be classed as censorship attacks. That is, a miner can choose to not include a transaction in a block. This is a form of censorship. As such, the desiderata herein also address censorship attacks.</p>
<h2 id="desiderata-7"><a class="header" href="#desiderata-7">Desiderata</a></h2>
<!--
  List out the specific desiderata. Each entry should consist of:

  1. Title: A concise name for the desideratum.
  2. User Journey: A one or two-sentence statement focusing on the "user" (could be a human, machine, software, etc.) and their interaction or experience.
  3. Description (optional): A more detailed explanation if needed.
  4. Justification: The reasoning behind the desideratum. Why is it necessary or desired?
  5. Recommendations (optional): Suggestions or guidance related to the desideratum.

  Format as:

  ### Desideratum Title

  **User Journey**: [user] can [action].

  **Description**: <More detailed explanation if needed (optional)>

  **Justification**: <Why this is a significant or required desideratum>

  **Recommendations**: <Any specific guidance or suggestions (optional)>

  TODO: Remove this comment before finalizing.
-->
<h3 id="d1-model-suzuka-mev-attacks"><a class="header" href="#d1-model-suzuka-mev-attacks">D1: Model Suzuka MEV Attacks</a></h3>
<p><strong>User Journey</strong>: A researcher or protocol implementer can understand the game theory of MEV attacks in the Suzuka Network.</p>
<p><strong>Justification</strong>: Suzuka MEV attacks are a significant risk to the network. Understanding them is the first step to preventing them.</p>
<p><strong>Recommendations</strong>:</p>
<ul>
<li>Begin be enumerating all of placers where a single entity has control over transaction inclusion or ordering.</li>
<li>Assess how transaction provenance can be formed.</li>
</ul>
<h3 id="d2-merge-blocks-and-assign-deterministic-cut-points"><a class="header" href="#d2-merge-blocks-and-assign-deterministic-cut-points">D2: Merge Blocks and Assign Deterministic Cut-points</a></h3>
<p><strong>User Journey</strong>: An honest Suzuka Full Node can only form the final blocks needed for execution by (a) merging blocks in a given DA height range, (b) ordering transactions deterministically, and (c) assigning deterministic cut-points for block formation.</p>
<p><strong>Justification</strong>: If the blocks from a given DA height range are merged and then split with deterministic cut-points, a Suzuka Proposer would only be able to manipulate the inclusion or exclusion of a transaction in a given DA height range–no longer the order of blocks therein. This limitation of the action space could render most MEV attacks implausible–particularly if it increases the latency of an attack held across two block height ranges beyond the window in which the client would notice the failure and submit a transaction to an honest Suzuka Full Node.</p>
<h3 id="d3-induced-proposer-races-for-fair-provenance"><a class="header" href="#d3-induced-proposer-races-for-fair-provenance">D3: Induced Proposer Races for Fair Provenance</a></h3>
<p><strong>User Journey</strong>: Suzuka Proposers are subject to a potentially race on each transaction whereby if each</p>
<p><strong>Justification</strong>: This will disincentivize validators from producing unfair blocks.</p>
<p><strong>Recommendations</strong>:</p>
<ul>
<li>This involves two primary innovations (1) making the transaction dataflow amenable to duplicate transactions and (2) providing reward or penalization controls applicable to the Proposer function similar to those referenced in <a href="Review/l-monninger/block-validation/MD/md-7/../md-6/README.html">MD-6</a>.</li>
<li>A simple protocol could provide a provocative start:
<ol>
<li>The Client submits a signed transaction to a Suzuka Full Node.</li>
<li>The Suzuka Full Node signs this transaction and sends it back as confirmation to the Client.</li>
<li>The Client MAY optionally have submitted the same transaction to another Suzuka Full Node.</li>
<li>The DA records where the transaction was included and by which Proposer. The first propose to have submitted wins the race. Subsequent duplicates are ignored.</li>
<li>The state computed by the transactions in a block is eventually settled along with a set of signers who won their respective races.</li>
<li>The settlement contract rewards the winning Proposer.</li>
</ol>
</li>
</ul>
<h2 id="errata-19"><a class="header" href="#errata-19">Errata</a></h2>
<!--
  Errata should be maintained after publication.

  1. **Transparency and Clarity**: An erratum acknowledges any corrections made post-publication, ensuring that readers are not misled and are always equipped with the most accurate information.

  2. **Accountability**: By noting errors openly, we maintain a high level of responsibility and ownership over our content. It’s an affirmation that we value precision and are ready to correct oversights.

  Each erratum should briefly describe the discrepancy and the correction made, accompanied by a reference to the date and version of the desiderata in which the error was identified.

  TODO: Maintain this comment.
-->
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="md-13-suzuka-da-migrations-format"><a class="header" href="#md-13-suzuka-da-migrations-format">MD-13: Suzuka DA Migrations Format</a></h1>
<ul>
<li><strong>Description</strong>: Data format which describes migrations of the canonical state of the DA over time.</li>
<li><strong>Authors</strong>: <a href="mailto:mikhail.zabaluev@movementlabs.xyz">Mikhail Zabaluev</a></li>
</ul>
<h2 id="overview-9"><a class="header" href="#overview-9">Overview</a></h2>
<p>In order to allow for safe upgrades, data model changes, and DA migrations, it has been proposed
that we provide a configuration data format which describes the canonical state of the DA over time.
This would be a hardfork or coordinated approach (TODO: clarify terminology) to upgrades, in that
each node participating in the network SHOULD be deployed with an up to date copy describing
the migrations up to and above the current block height.</p>
<h2 id="desiderata-8"><a class="header" href="#desiderata-8">Desiderata</a></h2>
<h3 id="d1-produce-da-blobs-accordingly-to-migrations-config"><a class="header" href="#d1-produce-da-blobs-accordingly-to-migrations-config">D1: Produce DA Blobs Accordingly To Migrations Config</a></h3>
<p><strong>User Journey</strong>: Producer of DA blobs (DA light node in current architecture)
should encode using the formats defined by migration settings for the current block height.</p>
<p><strong>Description</strong>: At the current height, the node should apply the corresponding DA configuration
that is deployed on the node by the operator in a timely fashion, to format blobs for the DA layer.</p>
<p><strong>Justification</strong>: We may need to evolve the data format and organization of the DA blobs
in the future. Migrations should be performed on the live chain so that
by the designated height, all sequenced transaction data is submitted to the DA in uniform format
to be aggregated by the consumer.</p>
<h3 id="d2-decode-da-blobs-accordingly-to-migrations-config"><a class="header" href="#d2-decode-da-blobs-accordingly-to-migrations-config">D2: Decode DA Blobs Accordingly To Migrations Config</a></h3>
<p><strong>User Journey</strong>: Consumer of DA blobs (DA light node in current architecture)
should decode using the formats defined by migration settings for the current block height.</p>
<p><strong>Description</strong>: At the current height, the node should apply the corresponding DA configuration
that is deployed on the node by the operator in a timely fashion, to read blobs from the DA layer.</p>
<p><strong>Justification</strong>: We may need to evolve the data format and organization of the DA blobs
in the future. Migrations should be performed on the live chain so that
by the designated height, all sequenced transaction data that has been submitted by compliant
nodes is available on the DA in uniform format.</p>
<h2 id="errata-20"><a class="header" href="#errata-20">Errata</a></h2>
<!--
  Errata should be maintained after publication.

  1. **Transparency and Clarity**: An erratum acknowledges any corrections made post-publication, ensuring that readers are not misled and are always equipped with the most accurate information.

  2. **Accountability**: By noting errors openly, we maintain a high level of responsibility and ownership over our content. It’s an affirmation that we value precision and are ready to correct oversights.

  Each erratum should briefly describe the discrepancy and the correction made, accompanied by a reference to the date and version of the desiderata in which the error was identified.

  TODO: Maintain this comment.
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="md-17-bridge-fees"><a class="header" href="#md-17-bridge-fees">MD-17: Bridge Fees</a></h1>
<p>Description: Bridges requires fees to assure it’s not drained and can self-sustain its operations.</p>
<h2 id="overview-10"><a class="header" href="#overview-10">Overview</a></h2>
<p>Bridges require a sustainable fee mechanism to prevent abuse and ensure they can self-sustain operations. This proposal outlines a dynamic fee structure for both the Ethereum and Movement chains. On the Ethereum side, fees will adjust according to gas price volatility, while on the Movement side, an oracle service will monitor and update gas prices in real time. The only external component that we are reliant on are RPC nodes.</p>
<h2 id="definitions-3"><a class="header" href="#definitions-3">Definitions</a></h2>
<ul>
<li><strong>Bridge Relayer</strong>: Infrastructure used to maintain the synchronicity of bridge request states. A single point of failure.</li>
<li><strong>Initiator Contract</strong>: Contract that a user uses to initiate a bridge transfer, with the Bridge Relayer either completing or refunding the transfer.</li>
<li><strong>Counterparty Contract</strong>: Contract on the opposite chain used to complete a bridge transfer, with the Bridge Relayer locking or canceling the bridge transfer.</li>
<li><strong>Gas</strong>: The fee required to execute a transaction on the Ethereum or Movement network.</li>
<li><strong>Priority Gas</strong>: Additional gas fee paid to prioritize a transaction for faster processing on the Ethereum or Movement network.</li>
</ul>
<h2 id="desiderata-9"><a class="header" href="#desiderata-9">Desiderata</a></h2>
<h3 id="1-dynamic-fee-adjustment-on-ethereum"><a class="header" href="#1-dynamic-fee-adjustment-on-ethereum">1. Dynamic Fee Adjustment on Ethereum</a></h3>
<ul>
<li><strong>User Journey</strong>: The Bridge Relayer checks the base gas cost on Movement every 30 seconds. If the cost increases by 20%, the fee will increase by an additional 20% of the current price. If the cost decreases, it either decreases to the current price by an additional 20% of current price or reverts to the base cost.</li>
<li><strong>Justification</strong>: A dynamic adjustment mechanism is crucial for handling gas volatility on Ethereum, ensuring the fee structure remains fair while avoiding undercharging during high gas periods.</li>
</ul>
<h3 id="2-oracle-based-fee-system-on-movement"><a class="header" href="#2-oracle-based-fee-system-on-movement">2. Oracle-Based Fee System on Movement</a></h3>
<ul>
<li><strong>User Journey</strong>: Movement will include an oracle service that checks gas prices on Ethereum every 5 seconds and updates the fee structure accordingly. The system should read from multiple node RPCs to ensure accurate and reliable data, with a fallback mechanism in case of node failure.</li>
<li><strong>Justification</strong>: Movement gas fees are expected to be relatively stable, but an oracle ensures that changes in gas prices on Ethereum are reflected promptly, preventing undercharging or overcharging.</li>
</ul>
<h3 id="3-fallback-mechanism-for-oracle-data"><a class="header" href="#3-fallback-mechanism-for-oracle-data">3. Fallback Mechanism for Oracle Data</a></h3>
<ul>
<li><strong>User Journey</strong>: The oracle service will query a batch of nodes to get the current gas price. If a primary node fails, the system will automatically switch to a fallback node to maintain continuity in fee updates.</li>
<li><strong>Justification</strong>: Reducing reliance on a single node prevents potential disruptions in fee updates, enhancing the system’s robustness and reliability.</li>
</ul>
<h3 id="4-gas-and-priority-gas-property-exposure-in-movement-blocks"><a class="header" href="#4-gas-and-priority-gas-property-exposure-in-movement-blocks">4. Gas and Priority Gas Property Exposure in Movement Blocks</a></h3>
<ul>
<li><strong>User Journey</strong>: The oracle will expose <code>eth_gas</code> and <code>eth_priority_gas</code> in Movement blocks as part of the block properties.</li>
<li><strong>Justification</strong>: Including gas properties in the block allows for easier tracking and adjustment of gas fees by other modules or smart contracts, ensuring transparency and real-time fee updates.</li>
</ul>
<h2 id="guidance-and-suggestions"><a class="header" href="#guidance-and-suggestions">Guidance and Suggestions</a></h2>
<h3 id="ethereum-contracts"><a class="header" href="#ethereum-contracts">Ethereum Contracts</a></h3>
<pre><code class="language-solidity">uint256 public bridgeFee;
uint256 public baseFee;

function initiateBridge(uint256 currentBridgeFee) external onlyOwner {
    if (currentBridgeFee &lt; baseFee) {
        bridgeFee = baseFee;
    } else {
        bridgeFee = currentBridgeFee * 12 /10;
    }
}
</code></pre>
<h3 id="movement-modules"><a class="header" href="#movement-modules">Movement Modules</a></h3>
<pre><code class="language-move">struct BridgeConfig has key {
    moveth_minter: address,
    bridge_module_deployer: address,
    signer_cap: account::SignerCapability,
    timelock: u64,
    base_eth_gas: u64,
    base_eth_priority_gas: u64,
}

move_to(resource, BridgeConfig {
    moveth_minter: signer::address_of(resource),
    bridge_module_deployer: signer::address_of(resource),
    signer_cap: resource_signer_cap,
    timelock: 12 hours,
    eth_gas: base_eth_gas,
    eth_priority_gas: base_eth_priority_gas
});

// initiate bridge calls charge the user based on the fee using block data
block.eth_gas
block.eth_priority_gas
</code></pre>
<h2 id="errata-21"><a class="header" href="#errata-21">Errata</a></h2>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="md-21-native-bridge-with-attesters"><a class="header" href="#md-21-native-bridge-with-attesters">MD-21: Native Bridge with Attesters</a></h1>
<ul>
<li><strong>Description</strong>: Proposal for simplifying the native bridge mechanism using an attester-based approach and drawing inspiration from USDC’s CCTP. The goal is to reducing friction, cost, and complexity for Layer 2 onboarding.</li>
<li><strong>Authors</strong>: <a href="mailto:primata@movementlabs.xyz">Primata</a></li>
</ul>
<h2 id="overview-11"><a class="header" href="#overview-11">Overview</a></h2>
<p>This MD lays out steps to introduce and leverage an <strong>attester-based bridge model</strong> to create a frictionless, efficient, and secure cross-chain experience for Movement technologies.</p>
<p>A bridge mechanism is essential for any Layer 2 solution, serving as the user’s first interaction with the network. This process must be smooth and frictionless, ensuring that dealing with tokens on L1 and bridging to native gas tokens on L2 does not overcomplicate the user experience. The bridge must balance user onboarding, cost-efficiency, and simplicity, while minimizing transaction complexity.</p>
<p>We request to</p>
<ol>
<li>draw inspiration from the <a href="https://developers.circle.com/stablecoins/cctp-getting-started">Cross-Chain Transfer Protocol</a> (CCTP) protocol by USDC, which offers an elegant solution to these challenges.</li>
<li>Apply an attester based model to the native bridge.</li>
<li>Supply a clear flow for the bridge mechanism.</li>
</ol>
<h3 id="motivation-25"><a class="header" href="#motivation-25">Motivation</a></h3>
<p>Our current bridge solution has been increasing in complexity with each iteration. Originally requiring three on-chain transactions, it now requires four, initiate bridge, lock, complete source chain, complete target chain. Additionally, the bridge does not currently support gas charging mechanisms to prevent exploits, and ongoing discussions are leaning toward adding further components, making it even more complex and computationally expensive.</p>
<p>We believe the best approach is to draw from live implementations that have achieved a streamlined user experience with minimal cost to the user. One such example is USDC’s <a href="https://www.circle.com/en/cross-chain-transfer-protocol">CCTP</a>, which offers simplicity, security, and efficiency in cross-chain bridging. Instead of increasing the complexity of our current bridge design, we should aim to adopt more proven mechanisms.</p>
<h2 id="desiderata-10"><a class="header" href="#desiderata-10">Desiderata</a></h2>
<h3 id="d1-take-inspiration-from-cctp"><a class="header" href="#d1-take-inspiration-from-cctp">D1: Take inspiration from CCTP</a></h3>
<h4 id="user-journey"><a class="header" href="#user-journey">User Journey</a></h4>
<p>The developer can understand the <a href="https://developers.circle.com/stablecoins/docs/generic-message-passing">Cross-Chain Transfer Protocol (CCTP)</a> model and draw from it to design a bridge mechanism that is simple, secure, and efficient.</p>
<h4 id="description"><a class="header" href="#description">Description</a></h4>
<p>The CCTP operates using a set of attesters that validate all bridge transactions occurring between chains. These attesters listen for bridge events, confirm the validity of transactions, and, if necessary, revert them by providing appropriate proofs. A transfer allowance managed by a centralized authority further ensures that breaches are mitigated by limiting the amount of value transferred.</p>
<h4 id="justification"><a class="header" href="#justification">Justification</a></h4>
<p><strong>Already operational</strong>
Relying on a protocol like CCTP that has been tested in live environments significantly reduces the risk of any unexpected utilization of off-chain and on-chain proofs. It is also operational and widely adopted.</p>
<p><strong>Reduction of messages</strong></p>
<ol>
<li>An on-chain component on source domain emits a message.</li>
<li>Circle’s off-chain attestation service signs the message.</li>
<li>The on-chain component at the destination domain receives the message, and forwards the message body to the specified recipient.</li>
</ol>
<p>This results in 2 onchain transactions and 1 offchain transaction. Comparatively, HTLC requires 4 onchain transactions.</p>
<p>This approach minimizes the need for additional components and avoids the reliance on synthetic assets, leading to a simplified and cost-effective bridge solution.</p>
<h4 id="recommendations-2"><a class="header" href="#recommendations-2">Recommendations</a></h4>
<p><strong>Reference Implementation</strong>
For more details on how this model operates, refer to USDC’s Cross-Chain Transfer Protocol (CCTP) documentation:<br />
<a href="https://developers.circle.com/stablecoins/docs/generic-message-passing">USDC CCTP Overview</a></p>
<h3 id="d2-apply-the-attester-model-and-multisig-scheme"><a class="header" href="#d2-apply-the-attester-model-and-multisig-scheme">D2: Apply the Attester Model and Multisig Scheme</a></h3>
<h4 id="user-journey-1"><a class="header" href="#user-journey-1">User Journey</a></h4>
<p>The developer can implement a bridge mechanism that uses a multisig scheme.</p>
<h4 id="justification-1"><a class="header" href="#justification-1">Justification</a></h4>
<p><strong>Security Implications</strong>:
The use of a multisig setup adds a layer of security, with aggregated signatures preventing unauthorized access. The transfer allowance mechanism further mitigates potential breaches by limiting how much can be transferred.</p>
<p><strong>Performance Impacts</strong>:
Because we would use a multisig off-chain signature to complete bridges, the set of attesters and the multisig address to produce the signature that we have to check the message against it could be the same set of the L2 Settlement signers.
This method reduces the computational overhead associated with multiple on-chain transactions and simplifies the bridge process. The reliance on a proven mechanism ensures minimal performance degradation. It also provides a bridging service with 1:1 bridging with minimal logic that could be potentially used for exploits.
It could also facilitate aggregating bridges since a merkle root could be used to handle the validity of the logic.</p>
<p><strong>Validation Procedures</strong>:
Formal and machine-aided validation of the off-chain signature and on-chain message handling will be crucial for ensuring the correctness of this proposal.</p>
<p><strong>Peer Review and Community Feedback</strong>:
The approach should be subject to review and feedback from the Movement Labs team and the wider community to ensure that it meets the needs of the ecosystem.</p>
<h4 id="recommendations-3"><a class="header" href="#recommendations-3">Recommendations</a></h4>
<ul>
<li>
<p><strong>Bridge Relayer as Attester</strong>: The Bridge Relayer in our system will function as an attester, operating via a multisig scheme (i.e. the attester collects signatures from a threshold number of comittee members that approve of the message). This relayer, through aggregated signatures, produces a proof on a signed message.</p>
</li>
<li>
<p><strong>User Interaction</strong>: Users, or other parties interested in completing the bridge, retrieve their funds on the target chain by submitting the signature and message.</p>
</li>
<li>
<p><strong>Validation Mechanism</strong>: The off-chain signature produced by the multisig scheme is verified against the message on-chain. As a reference, we could use the same automation scheme as the <a href="https://github.com/movementlabsxyz/MIP/pulls">MIP-18 Stage 0 Upgradeability and Multisigs</a>.
The challenge is to make sure that the signature is only used once so no transaction is replayed, but the beauty is that the signature is provided by a multi-party system that do not need to provide onchain signatures. It’s also important to use a solid architecture that prevents hash mining attacks.</p>
</li>
</ul>
<h3 id="d3-specify-the-flow"><a class="header" href="#d3-specify-the-flow">D3: Specify the Flow</a></h3>
<h4 id="user-journey-2"><a class="header" href="#user-journey-2">User Journey</a></h4>
<p>The developer can understand the flow of the bridge mechanism. Hence a flow diagram and description should be provided.</p>
<h4 id="justification-2"><a class="header" href="#justification-2">Justification</a></h4>
<p>The bridge mechanism should be straightforward and easy to understand.</p>
<h4 id="recommendations-4"><a class="header" href="#recommendations-4">Recommendations</a></h4>
<ol>
<li>
<p><strong>User Deposits</strong>:</p>
<ul>
<li>The user deposits tokens on the source chain, which triggers a deposit event.</li>
</ul>
</li>
<li>
<p><strong>Bridge Relayer</strong>:</p>
<ul>
<li>The Bridge Relayer, listening for the deposit event, picks up the message or messages associated with the deposit.</li>
</ul>
</li>
<li>
<p><strong>Multisig Signing</strong>:</p>
<ul>
<li>The multisig party signs the bridge transaction. The combination of signatures produces an aggregated signature that ties the signatures to the message.</li>
</ul>
</li>
<li>
<p><strong>Target Chain Verification</strong>:</p>
<ul>
<li>On the target chain, the aggregated signature and the message are used to verify the validity of the bridge transaction. The withdrawal can only occur if the multisig-provided signature is valid.</li>
</ul>
</li>
<li>
<p><strong>User Withdrawal</strong>:</p>
<ul>
<li>Once the signature is verified, the user can withdraw the corresponding funds on the target chain.</li>
</ul>
</li>
</ol>
<p>This process is bi-directional, allowing funds to be bridged between Layer 1 and Layer 2, and vice versa, with minimal complexity and friction.</p>
<h2 id="errata-22"><a class="header" href="#errata-22">Errata</a></h2>
<h2 id="appendix-20"><a class="header" href="#appendix-20">Appendix</a></h2>
<ul>
<li>[R1] USDC Cross-Chain Transfer Protocol: https://www.circle.com/en/cross-chain-transfer-protocol</li>
<li>[R2] USDC CCTP Overview: https://developers.circle.com/stablecoins/docs/generic-message-passing</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="md-26-user-facing-checks"><a class="header" href="#md-26-user-facing-checks">MD-26: User-facing checks</a></h1>
<ul>
<li><strong>Description</strong>: Automate checking user experience by submitting transactions every few minutes</li>
<li><strong>Authors</strong>: <a href="mailto:andygolay@movementlabs.xyz">Andy Golay</a></li>
</ul>
<!--
  This template is for drafting Desiderata. It ensures a structured representation of wishes, requirements, or needs related to the overarching objective mentioned in the title. After filling in the requisite fields, please delete these comments.

  Note that an MD number will be assigned by an editor. When opening a pull request to submit your MD, please use an abbreviated title in the filename, `md-draft_title_abbrev.md`.

  TODO: Remove this comment before finalizing.
-->
<h2 id="overview-12"><a class="header" href="#overview-12">Overview</a></h2>
<p>We need to check that users can submit transactions. This MD outlines a simple automated solution.</p>
<h2 id="definitions-4"><a class="header" href="#definitions-4">Definitions</a></h2>
<p>Provide definitions that you think will empower the reader to quickly dive into the topic.</p>
<h2 id="desiderata-26"><a class="header" href="#desiderata-26">Desiderata 26</a></h2>
<h3 id="user-facing-suzuka-checks"><a class="header" href="#user-facing-suzuka-checks">User-facing Suzuka Checks</a></h3>
<p><strong>User Journey</strong>: Users get more assurance that we know when Suzuka testnet has a transaction-processing outage.</p>
<p><strong>Description</strong>:</p>
<ul>
<li>
<p>Implement e2e tests which are already packaged as containers. See https://github.com/movementlabsxyz/movement/tree/main/networks/suzuka/suzuka-client/src/bin/e2e for the test logic and https://github.com/orgs/movementlabsxyz/packages?repo_name=movement for the containers (those with e2e in the name).</p>
</li>
<li>
<p>Run these checks periodically, say once every 3 minutes, to simulate users sending transactions, and add to monitoring infrastructure, reporting based on the exit code of the e2e test binaries and not requiring any modifications to the implementation.</p>
</li>
</ul>
<p>(See @l-monninger comments in discussion and reference implementation by Liam below.)</p>
<p><strong>Justification</strong>:</p>
<p>It’s a high priority to have testnet running and able to process transactions, or alerting us otherwise.</p>
<p><strong>Guidance and suggestions</strong>:</p>
<p>We will need the address for this job allowlisted to use the Suzuka testnet faucet.</p>
<p><strong>Reference Implementation</strong>:</p>
<p><a href="https://github.com/movementlabsxyz/movement/pull/726/"><code>movement</code> PR 726</a></p>
<h2 id="errata-23"><a class="header" href="#errata-23">Errata</a></h2>
<!--
  Errata should be maintained after publication.

  1. **Transparency and Clarity**: An erratum acknowledges any corrections made post-publication, ensuring that readers are not misled and are always equipped with the most accurate information.

  2. **Accountability**: By noting errors openly, we maintain a high level of responsibility and ownership over our content. It’s an affirmation that we value precision and are ready to correct oversights.

  Each erratum should briefly describe the discrepancy and the correction made, accompanied by a reference to the date and version of the desiderata in which the error was identified.

  TODO: Maintain this comment.
-->
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="md-30-movement-name-service"><a class="header" href="#md-30-movement-name-service">MD-30: Movement Name Service</a></h1>
<ul>
<li><strong>Description</strong>: Define the structure for the Movement Name Service (MNS) on the Movement blockchain, providing a user-friendly way for users to interact with names and rooms through bonding curve-based access keys.</li>
<li><strong>Authors</strong>: <a href="mailto:primata@movementlabs.xyz">Primata</a></li>
<li><strong>Collaborators</strong>: Community contributions welcome</li>
</ul>
<h2 id="overview-13"><a class="header" href="#overview-13">Overview</a></h2>
<p>The Move Name Service (MNS) is a system that allows users to register human-readable names on the Movement blockchain. It is designed to facilitate user-friendly interactions, registrations, and transactions on-chain. Expanding beyond traditional name services, MNS introduces the concept of access keys tied to a bonding curve, which determines the minting and burning prices of these keys. The MNS also provides revenue generation mechanisms for both the protocol and name owners.</p>
<p>MNS falls under the SoFi category, offering a decentralized, permissionless framework that encourages community participation to build and iterate on infrastructure and services centered on Names and Rooms.</p>
<h2 id="definitions-5"><a class="header" href="#definitions-5">Definitions</a></h2>
<ul>
<li><strong>Names</strong>: Human-readable identifiers registered on-chain. Should be freely tradeable. Room ownership is tied to Name. Names domain is <code>.move</code>. E.g. <code>[owned_name].move</code>.</li>
<li><strong>Rooms</strong>: Digital spaces associated with a registered Name, accessible by the Name’s owner or key holders.</li>
<li><strong>Keys</strong>: Access key to Name’s rooms. Mintable and burnable according to a bonding curve.</li>
<li><strong>Bonding Curve</strong>: A mathematical model used to determine minting and burning prices for access keys.</li>
</ul>
<h2 id="desiderata-11"><a class="header" href="#desiderata-11">Desiderata</a></h2>
<h3 id="d1-decentralized-and-permissionless-name-system"><a class="header" href="#d1-decentralized-and-permissionless-name-system">D1: Decentralized and Permissionless Name System</a></h3>
<p><strong>User Journey</strong>: Users can register human-readable names on the blockchain and access related services.</p>
<p><strong>Justification</strong>: A decentralized name system is essential for empowering users with on-chain identities and ensuring they can interact with the blockchain without technical friction.</p>
<p><strong>Guidance and suggestions</strong>:</p>
<ul>
<li>Names should be fully decentralized and governed by the community, adhering to the principles of openness and transparency.</li>
</ul>
<h3 id="d2-bonding-curve-for-key-minting-and-burning"><a class="header" href="#d2-bonding-curve-for-key-minting-and-burning">D2: Bonding Curve for Key Minting and Burning</a></h3>
<p><strong>User Journey</strong>: Users or services can mint or burn access keys based on a bonding curve.</p>
<p><strong>Justification</strong>: A bonding curve ensures that access keys’ prices are dynamically adjusted, preventing speculation and enabling fair access to Names and Rooms.</p>
<h3 id="d3-community-driven-revenue-models"><a class="header" href="#d3-community-driven-revenue-models">D3: Community-Driven Revenue Models</a></h3>
<p><strong>User Journey</strong>: The community can implement their own revenue models via Rooms and Keys. Movement drives the first implementation with Ductus, a backend serving the name service and rooms, and Domus, the frontend that allows minting, trading, viewing of names and keys, and using chat rooms.</p>
<p><strong>Justification</strong>: Allowing the community to drive revenue through their traffic contributions promotes incentivized participation, enabling them to earn protocol-generated funds.</p>
<p><strong>Guidance and suggestions</strong>:</p>
<ul>
<li>For Rooms and Keys, community members should be able to pass their address as <code>application_fee_recipient</code> to receive funds generated by the traffic they drive to the protocol.</li>
</ul>
<h3 id="d4-expandable-name-and-room-ecosystem"><a class="header" href="#d4-expandable-name-and-room-ecosystem">D4: Expandable Name and Room Ecosystem</a></h3>
<p><strong>User Journey</strong>: Developers can build custom applications and infrastructure using the Name and Room system.</p>
<p><strong>Justification</strong>: A flexible framework encourages innovation, enabling third-party developers to create services, tools, or applications that enhance the user experience within the MNS ecosystem.</p>
<p><strong>Guidance and suggestions</strong>:</p>
<ul>
<li>Name and Room ownership should be tied to flexible access key resources, allowing for extensibility through third-party integrations and custom services.</li>
</ul>
<h3 id="d5-each-movement-name-should-grant-access-to-its-own-domain-for-move-tld"><a class="header" href="#d5-each-movement-name-should-grant-access-to-its-own-domain-for-move-tld">D5: Each Movement Name should grant access to its own Domain for .move TLD</a></h3>
<p><strong>User Journey</strong>: Users acquire a <code>.move</code> domain. This allows the user to host an application running on http/https.</p>
<p><strong>Justification</strong>: Domains are yet to be fully implemented for any web3 name service and <code>.move</code> is an elegant TLD with intrinsic value for a global market.</p>
<h2 id="design"><a class="header" href="#design">Design</a></h2>
<h3 id="protocol-units"><a class="header" href="#protocol-units">Protocol Units</a></h3>
<ul>
<li><strong>NameRegistry</strong>: Manages the registration and ownership of Names on the Movement blockchain, similar to the Aptos Name Service.</li>
<li><strong>NameKeys</strong>: Manages the minting and burning of access keys tied to Rooms and Names using the bonding curve mechanism.</li>
<li><strong>Ductus</strong> (temporary name): A server responsible for generating and serving Rooms’ content off-chain.</li>
<li><strong>Domus</strong> (temporary name): A frontend interface where users can access, message, and manage their Rooms, including features like messaging, timeline integration, and third-party service integration (such as Parthenon).</li>
<li><strong>Community Integrations</strong>: The community can generate revenue on existing infrastructure by driving Keys trading on their own interface by utilizing the <code>application_fee</code> feature. This allows them to find new revenue models that either compete with or improve the Ductus and Domus ecosystem.</li>
</ul>
<p>The community can modify these temporary names or replace them with their own infrastructure and branding.</p>
<h2 id="background--motivation"><a class="header" href="#background--motivation">Background &amp; Motivation</a></h2>
<p>Name services are integral to establishing on-chain identities, creating a user-friendly interface for interaction. Move-based name services have historically been owned by the network. The MNS maintains this model while also allowing the community to contribute content and services. The goal is to create a more innovative, community-driven Name Service on the Movement blockchain.</p>
<h3 id="expanded"><a class="header" href="#expanded">Expanded</a></h3>
<p>The Movement Name Service (MNS) goes beyond simply assigning human-readable names by introducing the concept of access keys tied to a bonding curve. This mechanism provides users with more than just an identifier—it adds a layer of value through the potential for ownership, community-building, and monetization. Access keys allow users to unlock private Rooms associated with Names, creating a user-driven ecosystem where participation and engagement with specific names hold tangible economic and social value.</p>
<h4 id="keys-and-bonding-curve"><a class="header" href="#keys-and-bonding-curve">Keys and Bonding Curve</a></h4>
<p>Keys are pivotal to this system. By tying the issuance of keys to a bonding curve, the cost of minting and burning keys dynamically adjusts based on demand, ensuring a fair and transparent market for entry into exclusive rooms. Users who acquire these keys not only gain access to specific digital spaces but also gain a stake in the name’s ecosystem. For example, as more users mint keys to access a popular room, the minting price rises, reflecting the increased demand for that space.</p>
<p>This incentivizes early participation in popular rooms and encourages users to build brands around their names. When these names and associated rooms grow in value and demand, users can sell the keys on secondary markets, benefiting from increased key prices and potential residual earnings tied to those trades.</p>
<h4 id="integrating-sofi-into-mns"><a class="header" href="#integrating-sofi-into-mns">Integrating SoFi into MNS</a></h4>
<p>The integration of SoFi (Social Finance) into the MNS framework amplifies the value of the name service. Rather than tying a name’s worth to external platforms like Twitter or Discord, SoFi enables names to exist as self-contained ecosystems where the owner can control not only their brand but also the flow of interactions and transactions within their domain.</p>
<p>By allowing people to trade well-established names, MNS unlocks additional value—when acquiring a prominent name, users can also gain access to that name’s followers and established community. This creates opportunities for individuals or brands to sell and transfer their influence on the blockchain in a decentralized manner. For developers and entrepreneurs, the introduction of an application fee tied to keys incentivizes the creation of third-party applications that route trades and interactions through their platforms, driving a thriving secondary market for names and keys.</p>
<p>In this model, the name service and key market extend far beyond the initial design, encouraging continual growth and evolution as users build their own applications on top of the MNS framework.</p>
<h4 id="userdeveloper-experience"><a class="header" href="#userdeveloper-experience">User/Developer Experience</a></h4>
<p>For users, the experience of interacting with MNS is streamlined and intuitive. Registering a name or purchasing access keys involves interacting with simple on-chain functions, all while benefiting from the bonding curve’s dynamic pricing. As users participate in these interactions, they become integral parts of the MNS ecosystem, with the potential to trade, mint, or burn keys as demand shifts. This flexibility provides users with agency over their digital spaces and monetization paths.</p>
<p>For developers, MNS presents a unique opportunity to create value-added services. By integrating with the bonding curve for keys, developers can create custom frontends or applications where users manage their names and keys, while collecting application fees on trades. This creates a lucrative ecosystem where developers benefit from user engagement and traffic on their platforms.</p>
<h2 id="goals-and-non-goals"><a class="header" href="#goals-and-non-goals">Goals and Non-Goals</a></h2>
<h3 id="goals"><a class="header" href="#goals">Goals</a></h3>
<ul>
<li>Establish a framework for the MNS system that is open and permissionless.</li>
<li>Provide the minimum viable feature set for registering and managing Names and Rooms.</li>
<li>Enable the community to iterate on the system and create content, infrastructure, and services based on Names and Rooms.</li>
</ul>
<h3 id="non-goals"><a class="header" href="#non-goals">Non-Goals</a></h3>
<ul>
<li>Define the full scope of the MNS system beyond its initial implementation.</li>
<li>Prescribe how the Community Movement will build upon or extend the system.</li>
</ul>
<h2 id="timeline"><a class="header" href="#timeline">Timeline</a></h2>
<ul>
<li><strong>Q4 2024</strong>:
<ul>
<li>Finalize module designs and implementation.</li>
<li>Deploy modules to testnet.</li>
<li>Design and build the Domus frontend interface and Ductus server.</li>
</ul>
</li>
<li><strong>Q1 2025</strong>:
<ul>
<li>Launch the NameRegistry and key management modules on mainnet.</li>
<li>Community-driven integrations incentives.</li>
</ul>
</li>
</ul>
<h2 id="operations"><a class="header" href="#operations">Operations</a></h2>
<p>The protocol should utilize a bonding curve model for minting and burning access keys, with funds flowing through the following structure:</p>
<pre><code class="language-move">struct Settings {
    protocol_fee_destination: address,
    application_fee_percent: u64,
    protocol_fee_percent: u64,
    subject_fee_percent: u64,
}

#[event]
struct Trade {
    trader: address,
    domain: address,
    application: address,
    is_buy: bool,
    key_amount: u64,
    move_amount: u64,
    protocol_amount: u64,
    domain_amount: u64,
    application_amount: u64,
    new_supply: u64,
}
</code></pre>
<p><a href="https://github.com/0xPrimata/movement-names-contracts">preliminary sketch of the implementation on GitHub</a></p>
<h2 id="securityprivacycompliance"><a class="header" href="#securityprivacycompliance">Security/Privacy/Compliance</a></h2>
<p>As this system is decentralized and permissionless, Movement Labs is not responsible for third-party content or services built by the Community Movement. The community may establish their own privacy and security mechanisms.</p>
<h2 id="risks"><a class="header" href="#risks">Risks</a></h2>
<p>Community-driven services may introduce unforeseen vulnerabilities or suboptimal practices if not properly vetted.</p>
<h2 id="disclaimers"><a class="header" href="#disclaimers">Disclaimers</a></h2>
<ul>
<li>This initiative is a potential continuation of the “Building the Parthenon” project.</li>
<li>The MNS system is open and permissionless, meaning Movement Labs is not responsible for content or services built by the Community Movement.</li>
</ul>
<h2 id="appendix-21"><a class="header" href="#appendix-21">Appendix</a></h2>
<ul>
<li>Revisions:
<ul>
<li>Initial RFC Creation: 02232024</li>
<li>Update: Moved timeline to Q4 2024 to include community contributions. Final design and implementation shifted accordingly.</li>
<li>There is a <a href="https://github.com/0xPrimata/movement-names-contracts">preliminary sketch of the implementation on GitHub</a>. If accepted, this should be moved to the official Movement Labs GitHub repository for further development and refinement.</li>
<li>First reference to Movement Name Service is available as an <a href="https://github.com/movementlabsxyz/rfcs/blob/move-name-service/draft-move-name-service/rfc-move-name-service.md">RFC</a>.</li>
</ul>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="md-34-fast-finality-settlement"><a class="header" href="#md-34-fast-finality-settlement">MD-34: Fast Finality Settlement</a></h1>
<ul>
<li><strong>Description</strong>: Fast Finality Settlement mechanism requirements.</li>
<li><strong>Authors</strong>: <a href="Review/mip/FFS/MD/md-34/">Andreas Penzkofer</a></li>
</ul>
<h2 id="overview-14"><a class="header" href="#overview-14">Overview</a></h2>
<h2 id="abstract-25"><a class="header" href="#abstract-25">Abstract</a></h2>
<p>We require a mechanism to confirm the validity of transactions on L2. This mechanism should provide fast confirmations with crypto-economic security on L2. Moreover, it should also provide confirmations that leverage the economic security from L1 (this may be slower).</p>
<!--
  Provide a brief, high-level overview of the desiderata. This section should illuminate the unified objective of the desired elements, functionalities, or features. More granular specifications should be provided below.

  TODO: Remove this comment before finalizing.
-->
<h2 id="desiderata-12"><a class="header" href="#desiderata-12">Desiderata</a></h2>
<h3 id="d1-postconfirmation"><a class="header" href="#d1-postconfirmation">D1: Postconfirmation</a></h3>
<p><strong>User Journey</strong>: Validators can attest to the correctness of a sequence of L2Blocks (superBlocks) on L1.</p>
<p><strong>Description</strong>: Postconfirmation is the process of confirming a sequence of L2Blocks on L1. Validators attest to the correctness of the L2Blocks. The postconfirmation process leverages the economic security of L1.</p>
<p><strong>Justification</strong>: Postconfirmation is necessary to provide finality to the L2 transactions. It leverages the economic security of L1 to provide finality to the L2 transactions.</p>
<h3 id="d2-staking-mechanism-for-postconfirmation"><a class="header" href="#d2-staking-mechanism-for-postconfirmation">D2: Staking Mechanism for Postconfirmation</a></h3>
<p><strong>User Journey</strong>: Validators can stake assets, distribute rewards, and manage slashing for misbehavior.</p>
<p><strong>Description</strong>: A staking mechanism is required on L1 for validators to stake assets, distribute rewards, and manage slashing for misbehavior.</p>
<p><strong>Justification</strong>: A staking mechanism is necessary to incentivize validators to act honestly.</p>
<h3 id="d3-fastconfirmation"><a class="header" href="#d3-fastconfirmation">D3: Fastconfirmation</a></h3>
<p><strong>User Journey</strong>: Validators can attest to the correctness of L2Blocks on L2.</p>
<p><strong>Description</strong>: Fastconfirmation is the process of confirming L2Blocks on L2. Validators attest to the correctness of the L2Blocks. The fastconfirmation process provides fast confirmations for the L2 transactions.</p>
<p><strong>Justification</strong>: Fastconfirmation is necessary to provide fast confirmations for the L2 transactions. It provides fast confirmation to the L2 transactions.</p>
<h3 id="d4-staking-mechanism-for-fastconfirmation"><a class="header" href="#d4-staking-mechanism-for-fastconfirmation">D4: Staking Mechanism for Fastconfirmation</a></h3>
<p><strong>User Journey</strong>: Validators can stake assets, distribute rewards, and manage slashing for misbehavior.</p>
<p><strong>Description</strong>: A staking mechanism is required on L2 for validators to stake assets, distribute rewards, and manage slashing for misbehavior.</p>
<p><strong>Justification</strong>: A staking mechanism is necessary to incentivize validators to act honestly.</p>
<h3 id="d5-communication-of-fastconfirmation-certificates"><a class="header" href="#d5-communication-of-fastconfirmation-certificates">D5: Communication of Fastconfirmation Certificates</a></h3>
<p><strong>User Journey</strong>: Validators can communicate fascconfirmation certificates to users.</p>
<p><strong>Description</strong>: Validators communicate fastconfirmation certificates to users. The fastconfirmation certificates provide proof of the correctness of the L2Blocks.</p>
<p><strong>Justification</strong>: The users need to know that the L2Blocks are correct.</p>
<h3 id="d6-compare-fastconfirmations-with-postconfirmation"><a class="header" href="#d6-compare-fastconfirmations-with-postconfirmation">D6: Compare Fastconfirmations with Postconfirmation</a></h3>
<p><strong>User Journey</strong>: Postconfirmation and fastconfirmation must confirm the same L2Blocks.</p>
<p><strong>Description</strong>: Postconfirmation and fastconfirmation must confirm the same L2Blocks. The superBlock confirmed by postconfirmation must contain the L2Blocks that are confirmed by fastconfirmations.</p>
<h2 id="errata-24"><a class="header" href="#errata-24">Errata</a></h2>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="md-38-provide-for-fixed-token-supply-when-using-native-bridge-and-fast-finality-settlement-ffs"><a class="header" href="#md-38-provide-for-fixed-token-supply-when-using-native-bridge-and-fast-finality-settlement-ffs">MD-38: Provide for Fixed Token Supply when Using Native Bridge and Fast Finality Settlement (FFS)</a></h1>
<ul>
<li><strong>Description</strong>: Requests for Movement Improvement Proposals (MIPs) to provide for fixed token supply when using the Native Bridge and Fast Finality Settlement (FFS).</li>
<li><strong>Authors</strong>: <a href="mailto:liam@movementlabs.xyz">Liam Monninger</a></li>
<li><strong>Reviewer</strong>: <a href="mailto:andreas.penzkofer@movementlabs.xyz">Andreas Penzkofer</a></li>
</ul>
<h2 id="overview-15"><a class="header" href="#overview-15">Overview</a></h2>
<p><img src="Review/l-monninger/provisions-for-fixed-token-supply/MD/md-38/./fixed-supply-rewarding-problem.png" alt="Fixed Supply Rewarding Problem" /></p>
<p>Using Fast Finality Settlement with the Native Bridge presents a challenge when the token supply is fixed.</p>
<p>Burning token on the L2 without a way to return it to pools on the L2 or the L1 will result in a <strong>deflationary token</strong>, i.e., the supply decreases over time and eventually reaches 0 rendering any operations relying on gas impossible.</p>
<p>On the other hand, providing minting capabilities which involve the operation of fallible services can result in the violation of a constant supply principle and lead to <strong>either a deflationary or inflationary token</strong> and the opportunity for <strong>byzantine attacks</strong>.</p>
<p>Using FFS-Postconfirmation requires a reward scheme on L1. On the other hand, users pay fees on L2 into an L2 pool. Namely, in this context, trying to use the same token for both L2 gas and L1 rewards requires that the token be bridged back over from L2 to L1, or else rely on a trusted signer to relay the gas. This document outlines the challenges and potential solutions for this problem.</p>
<p>Users of the Movement SDK should be <strong>informed of different approaches and trade-offs when using the Native Bridge and Fast Finality Settlement with a fixed token supply.</strong> This document provides an initial conceptual framing towards that end.</p>
<p>This document also seeks a response to the concerns raised in <a href="https://github.com/movementlabsxyz/MIP/pull/20">MD-20</a>.</p>
<h2 id="desiderata-13"><a class="header" href="#desiderata-13">Desiderata</a></h2>
<h3 id="d1-provide-mips-for-approaches-presented-in-appendix-a1-and-similar"><a class="header" href="#d1-provide-mips-for-approaches-presented-in-appendix-a1-and-similar">D1: Provide MIPs for Approaches Presented in Appendix A1 and Similar</a></h3>
<p><strong>User Journey</strong>: Developers can reference MIPs for <strong>different approaches to using the Native Bridge and Fast Finality Settlement with a fixed token supply.</strong> Developers can also <strong>reference rejected MIPs</strong> to understand why certain approaches are not recommended.</p>
<p><strong>Justification</strong>: Developers need a clear understanding of the different approaches to using the Native Bridge and Fast Finality Settlement with a fixed token supply. MIPs provide a clear and standardized way to document these approaches.</p>
<h3 id="d2-provide-staged-approaches-for-networks-building-on-the-native-bridge-and-fast-finality-settlement"><a class="header" href="#d2-provide-staged-approaches-for-networks-building-on-the-native-bridge-and-fast-finality-settlement">D2: Provide Staged Approaches for Networks Building on the Native Bridge and Fast Finality Settlement</a></h3>
<p><strong>User Journey</strong>: Developers can reference approaches spawned from these desiderata to understand how to build networks using the Native Bridge and Fast Finality Settlement with a fixed token supply <strong>in stages.</strong> For example, developers can initially roll out a network using the <strong>“Free Execution” approach and then transition to the “Noble Attester”</strong> approach and so on. Some formats may be more suitable for certain stages of network development and release than others.</p>
<p><strong>Justification</strong>: Developers need a clear understanding of how to build networks using the Native Bridge and Fast Finality Settlement with a fixed token supply in stages. This allows developers to roll out networks in a more controlled and manageable way.</p>
<p><strong>Recommendations</strong>:</p>
<ul>
<li>Ensure that achieving upgrades for each execution layer to support these transitions are also documented in MIPs.</li>
</ul>
<h3 id="d3-provide-additional-software-necessary-to-achieve-accepted-approaches-in-movement-sdk"><a class="header" href="#d3-provide-additional-software-necessary-to-achieve-accepted-approaches-in-movement-sdk">D3: Provide Additional Software Necessary to Achieve Accepted Approaches in Movement SDK</a></h3>
<p><strong>User Journey</strong>: Developers can use <strong>modules from the Movement SDK</strong> to achieve the approaches presented in Appendix A1 and similar.</p>
<p><strong>Justification</strong>: Developers need a clear understanding of how to use the Movement SDK to achieve the approaches presented in Appendix A1 and similar. This allows developers to build networks using the Native Bridge and Fast Finality Settlement with a fixed token supply more easily.</p>
<h3 id="d4-provide-guides-and-software-for-genesis-procedures-and-initial-conditions-of-l1-and-l2-networks-using-the-native-bridge-and-fast-finality-settlement"><a class="header" href="#d4-provide-guides-and-software-for-genesis-procedures-and-initial-conditions-of-l1-and-l2-networks-using-the-native-bridge-and-fast-finality-settlement">D4: Provide Guides and Software for Genesis Procedures and Initial Conditions of L1 and L2 Networks Using the Native Bridge and Fast Finality Settlement</a></h3>
<p><strong>User Journey</strong>: Developers can use guides and software from the Movement SDK to understand how to set up the <strong>initial conditions of L1 and L2 networks</strong> using the Native Bridge and Fast Finality Settlement.</p>
<p><strong>Justification</strong>: Developers need a clear understanding of how to set up the initial conditions of L1 and L2 networks using the Native Bridge and Fast Finality Settlement. This allows developers to build networks using the Native Bridge and Fast Finality Settlement with a fixed token supply more easily. For example, one possible usage approach could be to generate an initial supply on the L1 and run a privileged bridge and voucher swap exchange to the L2 such that overall circulation is grounded in the L1 mint.</p>
<h3 id="d5-provide-and-argument-agains-the-need-to-resolve-ab-ffs-fixed-supply-concerns"><a class="header" href="#d5-provide-and-argument-agains-the-need-to-resolve-ab-ffs-fixed-supply-concerns">D5: Provide and Argument Agains the Need to Resolve AB-FFS Fixed Supply Concerns</a></h3>
<p><strong>User Journey</strong>: Developers, exchanges, and users can understand why the bridge can be assumed reasonably secure and inherent fallibility is within network security contraints given a set of assumptions.</p>
<p><strong>Justification</strong>: We can argue, for example, that many other bridge services use a trusted signer and that said trusted signer is uncomprimised is a fundamental and acceptable assumption.</p>
<h2 id="errata-25"><a class="header" href="#errata-25">Errata</a></h2>
<!--
  Errata should be maintained after publication.

  1. **Transparency and Clarity**: An erratum acknowledges any corrections made post-publication, ensuring that readers are not misled and are always equipped with the most accurate information.

  2. **Accountability**: By noting errors openly, we maintain a high level of responsibility and ownership over our content. It’s an affirmation that we value precision and are ready to correct oversights.

  Each erratum should briefly describe the discrepancy and the correction made, accompanied by a reference to the date and version of the desiderata in which the error was identified.

  TODO: Maintain this comment.
-->
<h2 id="appendix-22"><a class="header" href="#appendix-22">Appendix</a></h2>
<h3 id="a1-suggested-solutions-for-fixed-token-supply"><a class="header" href="#a1-suggested-solutions-for-fixed-token-supply">A1: Suggested Solutions for Fixed Token Supply</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Description</th><th>Gas Destination</th><th>Reward Form</th><th>Challenges</th></tr></thead><tbody>
<tr><td><strong>Decoupled</strong></td><td>• Gas spent on the L2 deposited to pools on the L2. <br> • Rewards on the L1 are issued in a LP token which is demurrage. <br> • Ideally, intermediary tokens are used in the bridge to shield gas and staking token from bridge fallibility.</td><td>Pool on the L2</td><td>FFS LP Token; voucher periods can be assigned.</td><td>• LP Token’s demurrage assigns a lifetime to the viability of the settlement protocol which will require a new or asymptotic token voucher or token generation event at some point.</td></tr>
<tr><td><strong>Trickle-back</strong></td><td>• Gas spent on the L2 recirculates to pools on the L2. <br> • Rewards are provided on the L2 for bridging back to the L1 at the address of the FFS LP Token. <br> • Ideally, intermediary tokens are used in the bridge to shield gas and staking token from bridge fallibility.</td><td>Pool on the L2</td><td>Staking Token</td><td>• Rewards for pool providers to bridge back to the L1 at the address of the FFS LP Token need to be sufficient. <br> • Pool providers likely need to have only custodial access to token, otherwise intended rewarding game theory would likely be intractable.</td></tr>
<tr><td><strong>Settle with Gas</strong></td><td>• The settlement messages include the amount of gas spent. The LP for the FFS claims token locked in the L1 bridge. <br> • Bridge may still benefit from intermediary tokens.</td><td>FFS LP Token</td><td>Staking Token</td><td>• Unclear how to handle forks. <br> • Centralization remains as FFS contract needs to have capability to claim token locked in L1 bridge. However, this can be governed on-chain in this case. <br> • Intermediary tokens can still help reduce attack surface via the bridge. Now attacks would likely focus on exploiting capabilities of the settlement contract to unlock token.</td></tr>
<tr><td><strong>Noble Gasmaster</strong></td><td>• A trusted signer is responsible for successfully relaying gas spent. The use of intermediary tokens in the bridge is moot.</td><td>FFS LP Token</td><td>Staking Token</td><td>• Centralized signer.</td></tr>
<tr><td><strong>Free Execution</strong></td><td>• Execution does not charge gas fees, meaning gas token stays in circulation and supply does not change.</td><td>Nowhere</td><td>Staking Token or FFS LP Token</td><td>• No sybil resistance; not suitable for anything but promotional or initial stages of a network. <br> Gas fees do not contribute to rewards, so rewards rely solely on initial grant and perhaps LP. Execution does not have cost in token and so cannot drive work-based benefits in token.</td></tr>
<tr><td><strong>Gas Lock</strong></td><td>• Execution does not charge permanent gas fees, meaning gas token stays in circulation and supply does not change. <br> Gas for a transaction gets locked away until a time or block lock expires and then is returned to the account.</td><td>Nowhere/Temporary Lock</td><td>Staking Token or FFS LP Token</td><td>• Sybil resistance effectively only applies over the window of the time-lock or the amortized windows of the time-locks. Game theory is more complex for standard gas attacks. <br> • Gas fees do not contribute to rewards, so rewards rely solely on initial grant and perhaps LP. Execution does not have ultimate cost in token and so cannot drive work-based benefits in token.</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="md-49-movement-l2-gas-fees"><a class="header" href="#md-49-movement-l2-gas-fees">MD-49: Movement L2 Gas Fees</a></h1>
<ul>
<li><strong>Description</strong>: Provide a means of computing, charging, and distributing gas fees for the Movement L2s which rely on a separate DA and Settlement Layer, e.g., the Movement Network.</li>
<li><strong>Authors</strong>: <a href="mailto:liam@movementlabs.xyz">Liam Monninger</a></li>
<li><strong>Reviewer</strong>: Andreas Penzkofer</li>
</ul>
<h2 id="overview-16"><a class="header" href="#overview-16">Overview</a></h2>
<p>In order to understand how to fairly and effectively incentivize participation in the Movement Network, we need to establish a means of computing, charging, and distributing gas fees for the Movement L2s which rely on a separate DA and Settlement Layer. This will allow us to ensure that the Movement Network is able to operate efficiently and that the incentives for participation are aligned with the goals of the Movement Network.</p>
<p>The work done in a Movement Network L2 is mostly outlined in <a href="https://github.com/movementlabsxyz/MIP/pull/19">MIP-19</a>. These desiderata request means to actually compute said work, charge proportional gas fees, and distribute these fees to the appropriate parties.</p>
<h2 id="desiderata-14"><a class="header" href="#desiderata-14">Desiderata</a></h2>
<!--
  List out the specific desiderata. Each entry should consist of:

  1. Title: A concise name for the desideratum.
  2. User Journey: A one or two-sentence statement focusing on the "user" (could be a human, machine, software, etc.) and their interaction or experience.
  3. Description (optional): A more detailed explanation if needed.
  4. Justification: The reasoning behind the desideratum. Why is it necessary or desired?
  5. Recommendations (optional): Suggestions or guidance related to the desideratum.

  Format as:

  ### Desideratum Title

  **User Journey**: [user] can [action].

  **Description**: <More detailed explanation if needed (optional)>

  **Justification**: <Why this is a significant or required desideratum>

  **Recommendations**: <Any specific guidance or suggestions (optional)>

  TODO: Remove this comment before finalizing.
-->
<h3 id="d1-specify-how-to-compute-execution-fees-for-a-movement-l2"><a class="header" href="#d1-specify-how-to-compute-execution-fees-for-a-movement-l2">D1: Specify How to Compute Execution Fees for a Movement L2</a></h3>
<p><strong>User Journey</strong>: A developer can implement execution fee computation for a Movement L2 from a specification thereof.</p>
<p><strong>Justification</strong>:  <a href="https://github.com/movementlabsxyz/MIP/pull/19">MIP-19</a> categorizes execution fees as “the costs that correspond to resources usage, CPU and permanent storage.” These need to be accounted for in any system to ensure the operators of nodes are appropriately incentivized for their participation and the fairness of resource usage is maintained.</p>
<h3 id="d2-specify-how-to-compute-da-gas-fees-for-a-movement-l2"><a class="header" href="#d2-specify-how-to-compute-da-gas-fees-for-a-movement-l2">D2: Specify How to Compute DA Gas Fees for a Movement L2</a></h3>
<p><strong>User Journey</strong>: A developer can implement DA fee computation for a Movement L2 from a specification thereof.</p>
<p><strong>Justification</strong>:  <a href="https://github.com/movementlabsxyz/MIP/pull/19">MIP-19</a> categorizes DA fees as “the costs of publishing transactions/blocks data to a data availability layer.” These are considered separately from execution fees because the DA is expected to be a extrinsic system with its own fee model.</p>
<h3 id="d3-specify-how-to-compute-settle-gas-fees-for-a-movement-l2"><a class="header" href="#d3-specify-how-to-compute-settle-gas-fees-for-a-movement-l2">D3: Specify How to Compute Settle Gas Fees for a Movement L2</a></h3>
<p><strong>User Journey</strong>: A developer can implement settlement fee computation for a Movement L2 from a specification thereof.</p>
<p><strong>Justification</strong>: <a href="https://github.com/movementlabsxyz/MIP/pull/19">MIP-19</a> categorizes DA fees as “the costs of validating a transaction (e.g. zk-proof generation and verification, validators attestations).” These are considered separately from execution fees because settlement is expected to be a extrinsic system with its own fee model.</p>
<h3 id="d4-specify-which-participants-should-be-charged-which-gas-fees"><a class="header" href="#d4-specify-which-participants-should-be-charged-which-gas-fees">D4: Specify which Participants Should Be Charged which Gas Fees</a></h3>
<p><strong>User Journey</strong>: A network participant can understand which fees they are responsible for.</p>
<p><strong>Justification</strong>: Costs can be passed through to various actors in the L2 system. It is important to specify which actors are responsible for which fees to ensure that the system is fair and that the incentives for participation are aligned with the goals of the Movement Network.</p>
<h3 id="d5-specify-how-to-distribute-gas-fees-to-the-appropriate-parties"><a class="header" href="#d5-specify-how-to-distribute-gas-fees-to-the-appropriate-parties">D5: Specify How to Distribute Gas Fees to the Appropriate Parties</a></h3>
<p><strong>User Journey</strong>: A network participant can understand how gas fees are distributed.</p>
<p><strong>Justification</strong>: Gas fees must ultimately be used to pay extrinsic costs or else be considered as rewards. It is important to specify how gas fees are distributed to ensure that the system is fair and that the incentives for participation are aligned with the goals of the Movement Network.</p>
<h2 id="errata-26"><a class="header" href="#errata-26">Errata</a></h2>
<!--
  Errata should be maintained after publication.

  1. **Transparency and Clarity**: An erratum acknowledges any corrections made post-publication, ensuring that readers are not misled and are always equipped with the most accurate information.

  2. **Accountability**: By noting errors openly, we maintain a high level of responsibility and ownership over our content. It’s an affirmation that we value precision and are ready to correct oversights.

  Each erratum should briefly describe the discrepancy and the correction made, accompanied by a reference to the date and version of the desiderata in which the error was identified.

  TODO: Maintain this comment.
-->
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="md-61-relayer-for-the-lockmint-native-bridge"><a class="header" href="#md-61-relayer-for-the-lockmint-native-bridge">MD-61: Relayer for the Lock/Mint Native Bridge</a></h1>
<ul>
<li><strong>Description</strong>: A desiderata for the relayer in the lock/mint bridge, focusing on event processing, transfer completion, and robust recovery mechanisms.</li>
<li><strong>Authors</strong>: Andreas Penzkofer, Philippe</li>
</ul>
<h2 id="overview-17"><a class="header" href="#overview-17">Overview</a></h2>
<p>This desiderata outlines the desired functionalities and recovery mechanisms for a Relayer handling the completion of transfers in the lock/mint Native Bridge protocol. It emphasizes uninterrupted operation, recovery from failure, and minimal dependencies.</p>
<h2 id="desiderata-15"><a class="header" href="#desiderata-15">Desiderata</a></h2>
<h3 id="d1-continuous-event-processing"><a class="header" href="#d1-continuous-event-processing">D1: Continuous Event Processing</a></h3>
<p><strong>User Journey</strong>: The relayer continuously processes events from the source chain, created from user transfer requests, and ensures their completion on the target chain.</p>
<p><strong>Justification</strong>: Guarantees the seamless execution of cross-chain transfers and minimizes delays or interruptions.</p>
<h3 id="d2-robust-bootstrapping-mechanism"><a class="header" href="#d2-robust-bootstrapping-mechanism">D2: Robust Bootstrapping Mechanism</a></h3>
<p><strong>User Journey</strong>: Upon restart, the relayer automatically determines the state of pending transfers and resumes processing without requiring manual intervention.</p>
<p><strong>Justification</strong>: Ensures resilience and reliability even after unexpected failures or downtime.</p>
<h3 id="d3-finality-aware-processing"><a class="header" href="#d3-finality-aware-processing">D3: Finality-aware Processing</a></h3>
<p><strong>User Journey</strong>: The relayer respects the finality rules of both source and target chains. It ensures transfers are only processed once finalized on the source chain. It considers the finality of the target chain for completing transactions.</p>
<p><strong>Justification</strong>: Prevents inconsistencies and sending duplicate transfer-completing transactions.</p>
<h3 id="d4-minimal-trusted-components"><a class="header" href="#d4-minimal-trusted-components">D4: Minimal Trusted Components</a></h3>
<p><strong>User Journey</strong>: The relayer operates independently without reliance on external indexers or databases.</p>
<p><strong>Justification</strong>: Reduces operational complexity and points of failure, enhancing system robustness.</p>
<h3 id="d5-timeout-and-retry-mechanism"><a class="header" href="#d5-timeout-and-retry-mechanism">D5: Timeout and Retry Mechanism</a></h3>
<p><strong>User Journey</strong>: Pending transfers are retried automatically after a timeout, ensuring eventual completion without manual oversight.</p>
<p><strong>Justification</strong>: Improves the reliability of the relayer by handling transient errors and network issues gracefully.</p>
<p><strong>Recommendations</strong>: Implement a configurable timeout period for retries.</p>
<h2 id="changelog-7"><a class="header" href="#changelog-7">Changelog</a></h2>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="md-69-bridge-fees"><a class="header" href="#md-69-bridge-fees">MD-69: Bridge fees</a></h1>
<ul>
<li><strong>Description</strong>: This MD provides some background on the bridge fees mechanism requirements.</li>
<li><strong>Authors</strong>: <a href="Review/issue66/MDMIP-for-bridge-fees/MD/md-69/franck.cassez@movementlabs.xyz">Franck Cassez</a></li>
</ul>
<h2 id="overview-18"><a class="header" href="#overview-18">Overview</a></h2>
<p>To use the Movement Mainnet, users need to pay for <em>transaction fees</em> in $L2MOVE tokens. As the $MOVE token is minted on Ethereum ($L1MOVE), users need to transfer some $L1MOVE tokens from the Ethereum network to the Movement Mainnet (to get $L2MOVE), and back.
This asset transfer capability is provided by the Movement Mainnet <strong>native bridge</strong>, which is a <a href="https://chain.link/education-hub/cross-chain-bridge#types-of-cross-chain-bridges">lock/mint bridge</a> described in <a href="Review/issue66/MDMIP-for-bridge-fees/MD/md-69/tdc">MIP-58</a>.</p>
<p>This bridge (transfer) operation requires several steps, two of which are transactions:</p>
<ol>
<li>initiate a transfer on one chain;</li>
<li>finalize the transfer on the other chain.</li>
</ol>
<p>Step (1) is performed by the user on the network (Ethereum or Movement), and step (2) is performed by the bridge operator via a <em>relayer</em> (<strong>ADD link to relayer MIP here</strong>).
As a result, the operator has to cover the transaction fees for the <em>finalize</em> step.
When transferring from Ethereum to Movement, the fees are expected to be very low so we can consider that the operator can cover them using a pool of transaction fees collected from the users on the Movement Mainnet.
In the other direction, bridging from Movement to Ethereum, the Ethereum fees are expected to be higher, and the operator may not be able to cover them all.</p>
<blockquote>
<p>[!IMPORTANT]
We need to define a mechanism to collect the Ethereum fees from the users.</p>
</blockquote>
<blockquote>
<p>[!TIP]
This MD describes the requirements for this fee collection mechanism when bridging from Movement Mainnet to Ethereum.</p>
</blockquote>
<h2 id="desiderata-16"><a class="header" href="#desiderata-16">Desiderata</a></h2>
<h3 id="d1-user-bridges-from-movement-mainnet-to-ethereum"><a class="header" href="#d1-user-bridges-from-movement-mainnet-to-ethereum">D1: User bridges from Movement Mainnet to Ethereum</a></h3>
<p><strong>User Journey</strong>: A user can initiate a <em>bridge</em> transaction on the Movement Mainnet.</p>
<p><strong>Description</strong>: When a user initiates a bridge transaction from the Movement Mainnet to Ethereum, the user pays the Movement Mainnet transaction fees in $L2MOVE tokens. They request a transfer of $L2MOVE to $L1MOVE.</p>
<p><strong>Justification</strong>: The user should be able to transfer their tokens from the Movement Mainnet to Ethereum.</p>
<h3 id="d2-operator-covers-the-ethereum-transaction-fees"><a class="header" href="#d2-operator-covers-the-ethereum-transaction-fees">D2: Operator covers the Ethereum transaction fees</a></h3>
<p><strong>User Journey</strong>: Once initiated, the bridge transaction is completed by the operator of the Movement Mainnet via a <em>relayer</em>.</p>
<p><strong>Description</strong>: The operator must cover the Ethereum transaction fees for the completion step.</p>
<p><strong>Justification</strong>: Only the operator can finalize the transfer on the Ethereum network.</p>
<h3 id="d3-operator-collects-the-ethereum-transaction-fees-from-the-user"><a class="header" href="#d3-operator-collects-the-ethereum-transaction-fees-from-the-user">D3: Operator collects the Ethereum transaction fees from the user</a></h3>
<p><strong>User Journey</strong>: The operator collects the Ethereum transaction fees from the user in \.</p>
<p><strong>Description</strong>: The operator collects the Ethereum transaction fees from the user in \ tokens.</p>
<p><strong>Justification</strong>: We must collect the fees in $MOVE tokens. The fees cannot be collected in $ETH as</p>
<ol>
<li>we cannot ask the user to approve the relayer to transfer \ to them; and</li>
<li>even if we could, the user may not have enough \ and they initiated the transfer on the Movement Mainnet.</li>
</ol>
<h3 id="d4-robustness-of-the-fee-collection-mechanism"><a class="header" href="#d4-robustness-of-the-fee-collection-mechanism">D4: Robustness of the fee collection mechanism</a></h3>
<p><strong>User Journey</strong>: The operator pays the Ethereum transaction fees in $ETH and charges the user for bridge fees in $MOVE. The operator must not run a deficit</p>
<p><strong>Description</strong>: The operator must ensure that the fees collected from the users are sufficient to cover the Ethereum transaction fees to complete transfers. This implies that</p>
<ol>
<li>we accurately estimate the Ethereum fees in advance, and</li>
<li>we also estimate the ratio $MOVE/$ETH.</li>
</ol>
<p><strong>Justification</strong>: The operator must not run a deficit. We must decide how much the user is charged when they initiate a transfer at time $t<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal">ro</span><span class="mord mathnormal">m</span><span class="mord mathnormal">t</span><span class="mord mathnormal">h</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal">e</span><span class="mord mathnormal">m</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mord mathnormal" style="margin-right:0.10903em;">tM</span><span class="mord mathnormal">ainn</span><span class="mord mathnormal">e</span><span class="mord mathnormal">tt</span><span class="mord mathnormal">o</span><span class="mord mathnormal">Et</span><span class="mord mathnormal">h</span><span class="mord mathnormal">ere</span><span class="mord mathnormal">u</span><span class="mord mathnormal">m</span><span class="mord">.</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mord mathnormal">h</span><span class="mord mathnormal">eco</span><span class="mord mathnormal">u</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.02778em;">er</span><span class="mord mathnormal">p</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">t</span><span class="mord mathnormal">co</span><span class="mord mathnormal">m</span><span class="mord mathnormal" style="margin-right:0.01968em;">pl</span><span class="mord mathnormal">e</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">an</span><span class="mord mathnormal">s</span><span class="mord mathnormal">a</span><span class="mord mathnormal">c</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord mathnormal">s</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mord mathnormal">i</span><span class="mord mathnormal" style="margin-right:0.01968em;">ll</span><span class="mord mathnormal">b</span><span class="mord mathnormal">ee</span><span class="mord mathnormal">x</span><span class="mord mathnormal">ec</span><span class="mord mathnormal">u</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mord mathnormal">d</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mord mathnormal">h</span><span class="mord mathnormal">e</span><span class="mord mathnormal">Et</span><span class="mord mathnormal">h</span><span class="mord mathnormal">ere</span><span class="mord mathnormal">u</span><span class="mord mathnormal">ma</span><span class="mord mathnormal">t</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.02778em;">er</span><span class="mord mathnormal">t</span><span class="mord mathnormal">im</span><span class="mord mathnormal">e</span></span></span></span>t’ &gt; t<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">.</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mord mathnormal">oco</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal" style="margin-right:0.02778em;">er</span><span class="mord mathnormal">t</span><span class="mord mathnormal">h</span><span class="mord mathnormal">e</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">an</span><span class="mord mathnormal">s</span><span class="mord mathnormal">a</span><span class="mord mathnormal">c</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal">ees</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mord mathnormal">e</span><span class="mord mathnormal">ha</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal">e</span><span class="mord mathnormal">t</span><span class="mord mathnormal">o</span><span class="mord">1</span><span class="mclose">)</span><span class="mord mathnormal">es</span><span class="mord mathnormal">t</span><span class="mord mathnormal">ima</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mord mathnormal">t</span><span class="mord mathnormal">h</span><span class="mord mathnormal">e</span><span class="mord mathnormal">Et</span><span class="mord mathnormal">h</span><span class="mord mathnormal">ere</span><span class="mord mathnormal">u</span><span class="mord mathnormal">m</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal">ees</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span></span></span></span>t’<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">an</span><span class="mord mathnormal">d</span><span class="mord">2</span><span class="mclose">)</span><span class="mord mathnormal">t</span><span class="mord mathnormal">h</span><span class="mord mathnormal" style="margin-right:0.02778em;">er</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal">o</span><span class="mord">$</span><span class="mord mathnormal" style="margin-right:0.02778em;">MO</span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mord">/$</span><span class="mord mathnormal" style="margin-right:0.13889em;">ET</span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span></span></span></span>t’$.</p>
<h3 id="d5-minimize-the-user-fees"><a class="header" href="#d5-minimize-the-user-fees">D5: Minimize the user fees</a></h3>
<p><strong>User Journey</strong>: Minimize the bridge transfer fees for the user.</p>
<p><strong>Description</strong>: We have to minimize the fees for the users.</p>
<p><strong>Justification</strong>:
The user pays the minimum fees to transfer their tokens from the Movement Mainnet to Ethereum. If a user transfers 10 $L2MOVE, they expect to receive $10 - \epsilon<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9444em;vertical-align:-0.1944em;"></span><span class="mord">$</span><span class="mord mathnormal">L</span><span class="mord">1</span><span class="mord mathnormal" style="margin-right:0.02778em;">MO</span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord mathnormal">Et</span><span class="mord mathnormal">h</span><span class="mord mathnormal">ere</span><span class="mord mathnormal">u</span><span class="mord mathnormal">m</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mord mathnormal">i</span><span class="mord mathnormal">t</span><span class="mord mathnormal">h</span></span></span></span>\epsilon$ small.</p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="md-71-informer-service-for-the-lockmint-based-native-bridge"><a class="header" href="#md-71-informer-service-for-the-lockmint-based-native-bridge">MD-71: Informer service for the Lock/Mint-based Native Bridge</a></h1>
<ul>
<li><strong>Description</strong>: Provide a component that informs about the total circulating supply of \ across L1 and L2.</li>
<li><strong>Authors</strong>: <a href="mailto:andreas.penzkofer@movementlabs.xyz">Author</a></li>
</ul>
<h2 id="overview-19"><a class="header" href="#overview-19">Overview</a></h2>
<p>Several components should react if the bridge is under attack or faulty. In particular, the considered components are the Insurance Fund, see <a href="https://github.com/movementlabsxyz/MIP/pull/50">MIP-50</a> and the Rate Limiter, see <a href="https://github.com/movementlabsxyz/MIP/pull/56">MIP-56</a>, and more generally the governance operator.</p>
<p>The Operator that controls these components requires knowledge about the states of minted or locked tokens on L1 and L2. The Operator is an entity (e.g. multisig human) that has the ability to sign transactions and send funds from the Security Fund. Moreover, the operation of these components may also be handled via a governance, which could also rely on state information.</p>
<p>This MD requests to provide an informing service that satisfies the above.</p>
<h2 id="desiderata-17"><a class="header" href="#desiderata-17">Desiderata</a></h2>
<h3 id="d1-provide-information-about-the-circulating-supply-on-l2"><a class="header" href="#d1-provide-information-about-the-circulating-supply-on-l2">D1: Provide information about the circulating supply on L2</a></h3>
<p>On the L2 the bridge contract mints $MOVE token when token should be transferred to L2. When tokens are transferred to L1, the user burns provably some tokens on L2. The Informer should learn about those two supplies and provide information about the current circulating $MOVE supply on L2.</p>
<h3 id="d2-provide-information-about-the-locked-supply-on-l1"><a class="header" href="#d2-provide-information-about-the-locked-supply-on-l1">D2: Provide information about the locked supply on L1</a></h3>
<p>On the L1 the L1 bridge contract locks any $MOVE token that should be transferred to L2 in a bridge pool. When $MOVE token should be transferred to L1 the L1 bridge contract releases tokens held by the bridge pool. The operator should be informed about the locked amount.</p>
<h3 id="d3-optional-provide-information-about-the-inflight-tokens"><a class="header" href="#d3-optional-provide-information-about-the-inflight-tokens">D3: Optional: Provide information about the inflight tokens</a></h3>
<p>Provide information about the inflight tokens. This includes tokens that are not yet processed by the relayer, as well as tokens that are processed (i.e. the <code>complete</code> transaction is in a block on the target chain) but not yet finalized.</p>
<h3 id="d4-define-what-it-means-for-the-native-bridge-to-be-secure"><a class="header" href="#d4-define-what-it-means-for-the-native-bridge-to-be-secure">D4: Define what it means for the Native Bridge to be secure</a></h3>
<p>Based on the variables above the informer should derive a metric that can provide a warning if the metric seems incorrect. It has to be defined what means incorrect.</p>
<h3 id="d5-explore-implications-if-relayer-does-not-utilize-postconfirmations"><a class="header" href="#d5-explore-implications-if-relayer-does-not-utilize-postconfirmations">D5: Explore implications if relayer does not utilize postconfirmations</a></h3>
<p>The postconfirmation process is a synchronization mechanism for L2 to L1, see <a href="https://github.com/movementlabsxyz/MIP/pull/37">MIP-37</a>.</p>
<p>If the Relayer completes transfers from L2 to L1 without awaiting postconfirmation of the L2 <code>initiate</code> transaction, synchronization guarantees are reduced. The postconfirmation is an anchoring mechanism that binds the L2 to a certain L2 block height and hash, and hinders reorgs beyond a certain depth on L2.</p>
<p>We need to check the implications for the Informer if the Relayer ignores postconfirmations.</p>
<h2 id="errata-27"><a class="header" href="#errata-27">Errata</a></h2>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="md-74-rate-limiter-for-the-lockmint-type-native-bridge"><a class="header" href="#md-74-rate-limiter-for-the-lockmint-type-native-bridge">MD-74: Rate-Limiter for the Lock/Mint-type Native Bridge</a></h1>
<ul>
<li><strong>Description</strong>: A rate limitation mechanism for the Lock/Mint-type Native Bridge.</li>
<li><strong>Authors</strong>: <a href="mailto:andreas.penzkofer@movementlabs.xyz">Andreas Penzkofer</a></li>
</ul>
<h2 id="overview-20"><a class="header" href="#overview-20">Overview</a></h2>
<p>The Lock/Mint-type Native Bridge (hereafter called the “Native Bridge”), see <a href="https://github.com/movementlabsxyz/MIP/pull/58">MIP-58</a>, must be protected against faulty components and attacks. A Rate-Limiter is a mechanism that can help to protect the Native Bridge. It limits the volume of transferred value, the maximum value transferred with a given transfer, or the number of transactions.</p>
<h2 id="desiderata-18"><a class="header" href="#desiderata-18">Desiderata</a></h2>
<h3 id="d1-specify-the-actors-and-their-trust-assumptions"><a class="header" href="#d1-specify-the-actors-and-their-trust-assumptions">D1: Specify the actors and their trust assumptions</a></h3>
<p><strong>User Journey</strong>: The developer should understand existing trust assumptions.</p>
<p><strong>Description</strong>: The Native Bridge is operated via contracts, actors and components. What are the trust assumptions on these?</p>
<h3 id="d2-specify-the-risks-and-threats-from-components"><a class="header" href="#d2-specify-the-risks-and-threats-from-components">D2: Specify the risks and threats from components</a></h3>
<p><strong>User Journey</strong>: The developer should understand the risks from components.</p>
<p><strong>Description</strong>: We must ensure that risks are minimized even in the case that a component is compromised or faulty.</p>
<p><strong>Recommendations</strong>: Address the risks by first identifying the relevant parties and their trust assumptions. Then, specify the risks and threats from these components. How can we restrict the risks?</p>
<h3 id="d3-define-the-rate-limiting-mechanism"><a class="header" href="#d3-define-the-rate-limiting-mechanism">D3: Define the rate-limiting mechanism</a></h3>
<p><strong>User Journey</strong>: The developer should understand the rate-limiting mechanism.</p>
<p><strong>Description</strong>: The rate-limiting mechanism should be defined in a way that it is clear how it works and how it can be adjusted. Moreover all components and their parameters should be defined. It should also be defined what is being rate-limited.</p>
<h2 id="errata-28"><a class="header" href="#errata-28">Errata</a></h2>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->

        <script>
        window.addEventListener('load', function() {
            MathJax.Hub.Register.StartupHook('End', function() {
                window.setTimeout(window.print, 100);
            });
        });
        </script>

    </div>
    </body>
</html>
